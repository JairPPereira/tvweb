{"version":3,"sources":["../../../../../src/streaming/text/EmbeddedTextHtmlRender.js"],"names":["EmbeddedTextHtmlRender","captionId","instance","checkIndent","chars","line","c","length","uc","uchar","l","ll","replace","getRegionProperties","region","x","y1","Math","max","y2","createRGB","color","getStyle","videoElement","style","fontSize","videoHeight","foreground","italics","underline","background","ltrim","s","rtrim","createHTMLCaptionsFromScreen","startTime","endTime","captionScreen","currRegion","existingRegion","lastRowHasText","lastRowIndentL","currP","start","end","spans","currentStyle","seenRegions","styleStates","regions","r","row","rows","prevPenState","isEmpty","rowIndent","p","push","name","hasOwnProperty","contat","currPenState","penState","equals","trim","currPenStateString","JSON","parse","stringify","captionsArray","cueID","finalDiv","document","createElement","id","cueRegionProperties","cssText","bodyDiv","className","cueUniWrapper","ptag","lastSpanRow","span","brElement","appendChild","sameRow","spanStyle","spanElement","textContent","type","cueHTMLElement","cellResolution","isFromCEA608","lineHeight","linePadding","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"EmbeddedTextHtmlRender.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport FactoryMaker from '../../core/FactoryMaker';\n\nfunction EmbeddedTextHtmlRender() {\n\n    let captionId = 0;\n    let instance;\n\n    /* HTML Rendering functions */\n    function checkIndent(chars) {\n        let line = '';\n\n        for (let c = 0; c < chars.length; ++c) {\n            const uc = chars[c];\n            line += uc.uchar;\n        }\n\n        const l = line.length;\n        const ll = line.replace(/^\\s+/,'').length;\n        return l - ll;\n    }\n\n    function getRegionProperties(region) {\n        return 'left: ' + (region.x * 3.125) + '%; top: ' + (region.y1 * 6.66) + '%; width: ' + (100 - (region.x * 3.125)) + '%; height: ' + (Math.max((region.y2 - 1) - region.y1, 1) * 6.66) + '%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;';\n    }\n\n    function createRGB(color) {\n        if (color === 'red') {\n            return 'rgb(255, 0, 0)';\n        } else if (color === 'green') {\n            return 'rgb(0, 255, 0)';\n        } else if (color === 'blue') {\n            return 'rgb(0, 0, 255)';\n        } else if (color === 'cyan') {\n            return 'rgb(0, 255, 255)';\n        } else if (color === 'magenta') {\n            return 'rgb(255, 0, 255)';\n        } else if (color === 'yellow') {\n            return 'rgb(255, 255, 0)';\n        } else if (color === 'white') {\n            return 'rgb(255, 255, 255)';\n        } else if (color === 'black') {\n            return 'rgb(0, 0, 0)';\n        }\n        return color;\n    }\n\n    function getStyle(videoElement, style) {\n        const fontSize = videoElement.videoHeight / 15.0;\n        if (style) {\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; color: ' + ((style.foreground) ? createRGB(style.foreground) : 'rgb(255, 255, 255)') + '; font-style: ' + (style.italics ? 'italic' : 'normal') + '; text-decoration: ' + (style.underline ? 'underline' : 'none') + '; white-space: pre; background-color: ' + ((style.background) ? createRGB(style.background) : 'transparent') + ';';\n        } else {\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;';\n        }\n    }\n\n    function ltrim(s) {\n        return s.replace(/^\\s+/g, '');\n    }\n\n    function rtrim(s) {\n        return s.replace(/\\s+$/g, '');\n    }\n\n    function createHTMLCaptionsFromScreen(videoElement, startTime, endTime, captionScreen) {\n        let currRegion = null;\n        let existingRegion = null;\n        let lastRowHasText = false;\n        let lastRowIndentL = -1;\n        let currP = {start: startTime, end: endTime, spans: []};\n        let currentStyle = 'style_cea608_white_black';\n        const seenRegions = {};\n        const styleStates = {};\n        const regions = [];\n        let r, s;\n\n        for (r = 0; r < 15; ++r) {\n            const row = captionScreen.rows[r];\n            let line = '';\n            let prevPenState = null;\n\n            if (false === row.isEmpty()) {\n                /* Row is not empty */\n\n                /* Get indentation of this row */\n                const rowIndent = checkIndent(row.chars);\n\n                /* Create a new region is there is none */\n                if (currRegion === null) {\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\n                }\n\n                /* Check if indentation has changed and we had text of last row */\n                if ((rowIndent !== lastRowIndentL) && lastRowHasText) {\n                    currRegion.p.push(currP);\n                    currP = { start: startTime, end: endTime, spans: [] };\n                    currRegion.y2 = r;\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                        regions.push(currRegion);\n                        seenRegions[currRegion.name] = currRegion;\n                    } else {\n                        existingRegion = seenRegions[currRegion.name];\n                        existingRegion.p.contat(currRegion.p);\n                    }\n\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\n                }\n\n                for (let c = 0; c < row.chars.length; ++c) {\n                    const uc = row.chars[c];\n                    const currPenState = uc.penState;\n                    if ((prevPenState === null) || (!currPenState.equals(prevPenState))) {\n                        if (line.trim().length > 0) {\n                            currP.spans.push({ name: currentStyle, line: line, row: r });\n                            line = '';\n                        }\n\n                        let currPenStateString = 'style_cea608_' + currPenState.foreground + '_' + currPenState.background;\n                        if (currPenState.underline) {\n                            currPenStateString += '_underline';\n                        }\n                        if (currPenState.italics) {\n                            currPenStateString += '_italics';\n                        }\n\n                        if (!styleStates.hasOwnProperty(currPenStateString)) {\n                            styleStates[currPenStateString] = JSON.parse(JSON.stringify(currPenState));\n                        }\n\n                        prevPenState = currPenState;\n\n                        currentStyle = currPenStateString;\n                    }\n\n                    line += uc.uchar;\n                }\n\n                if (line.trim().length > 0) {\n                    currP.spans.push({ name: currentStyle, line: line, row: r });\n                }\n\n                lastRowHasText = true;\n                lastRowIndentL = rowIndent;\n            } else {\n                /* Row is empty */\n                lastRowHasText = false;\n                lastRowIndentL = -1;\n\n                if (currRegion) {\n                    currRegion.p.push(currP);\n                    currP = { start: startTime, end: endTime, spans: [] };\n                    currRegion.y2 = r;\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                        regions.push(currRegion);\n                        seenRegions[currRegion.name] = currRegion;\n                    } else {\n                        existingRegion = seenRegions[currRegion.name];\n                        existingRegion.p.contat(currRegion.p);\n                    }\n\n                    currRegion = null;\n                }\n\n            }\n        }\n\n        if (currRegion) {\n            currRegion.p.push(currP);\n            currRegion.y2 = r + 1;\n            currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n            if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                regions.push(currRegion);\n                seenRegions[currRegion.name] = currRegion;\n            } else {\n                existingRegion = seenRegions[currRegion.name];\n                existingRegion.p.contat(currRegion.p);\n            }\n\n            currRegion = null;\n        }\n\n        const captionsArray = [];\n\n        /* Loop thru regions */\n        for (r = 0; r < regions.length; ++r) {\n            const region = regions[r];\n\n            const cueID = 'sub_cea608_' + (captionId++);\n            const finalDiv = document.createElement('div');\n            finalDiv.id = cueID;\n            const cueRegionProperties = getRegionProperties(region);\n            finalDiv.style.cssText = 'position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;' + cueRegionProperties;\n\n            const bodyDiv = document.createElement('div');\n            bodyDiv.className = 'paragraph bodyStyle';\n            bodyDiv.style.cssText = getStyle(videoElement);\n\n            const cueUniWrapper = document.createElement('div');\n            cueUniWrapper.className = 'cueUniWrapper';\n            cueUniWrapper.style.cssText = 'unicode-bidi: normal; direction: ltr;';\n\n            for (let p = 0; p < region.p.length; ++p) {\n                const ptag = region.p[p];\n                let lastSpanRow = 0;\n                for (s = 0; s < ptag.spans.length; ++s) {\n                    let span = ptag.spans[s];\n                    if (span.line.length > 0) {\n                        if ((s !== 0) && lastSpanRow != span.row) {\n                            const brElement = document.createElement('br');\n                            brElement.className = 'lineBreak';\n                            cueUniWrapper.appendChild(brElement);\n                        }\n                        let sameRow = false;\n                        if (lastSpanRow === span.row) {\n                            sameRow = true;\n                        }\n                        lastSpanRow = span.row;\n                        const spanStyle = styleStates[span.name];\n                        const spanElement = document.createElement('span');\n                        spanElement.className = 'spanPadding ' + span.name + ' customSpanColor';\n                        spanElement.style.cssText = getStyle(videoElement, spanStyle);\n                        /* If this is not the first span, and it's on the same\n                         * row as the last one */\n                        if ((s !== 0) && sameRow) {\n                            /* and it's the last span on this row */\n                            if (s === ptag.spans.length - 1) {\n                                /* trim only the right side */\n                                spanElement.textContent = rtrim(span.line);\n                            } else {\n                                /* don't trim at all */\n                                spanElement.textContent = span.line;\n                            }\n                        } else {\n                            /* if there is more than 1 span and this isn't the last span */\n                            if (ptag.spans.length > 1 && s < (ptag.spans.length - 1)) {\n                                /* Check if next text is on same row */\n                                if (span.row === ptag.spans[s + 1].row) {\n                                    /* Next element on same row, trim start */\n                                    spanElement.textContent = ltrim(span.line);\n                                } else {\n                                    /* Different rows, trim both */\n                                    spanElement.textContent = span.line.trim();\n                                }\n                            } else {\n                                spanElement.textContent = span.line.trim();\n                            }\n                        }\n                        cueUniWrapper.appendChild(spanElement);\n                    }\n                }\n            }\n\n            bodyDiv.appendChild(cueUniWrapper);\n            finalDiv.appendChild(bodyDiv);\n\n            const fontSize = { 'bodyStyle': ['%', 90] };\n            for (const s in styleStates) {\n                if (styleStates.hasOwnProperty(s)) {\n                    fontSize[s] = ['%', 90];\n                }\n            }\n\n            captionsArray.push({ type: 'html',\n                                start: startTime,\n                                end: endTime,\n                                cueHTMLElement: finalDiv,\n                                cueID: cueID,\n                                cellResolution: [32, 15],\n                                isFromCEA608: true,\n                                fontSize: fontSize,\n                                lineHeight: {},\n                                linePadding: {}\n                               });\n        }\n        return captionsArray;\n    }\n\n    instance = {\n        createHTMLCaptionsFromScreen: createHTMLCaptionsFromScreen\n    };\n    return instance;\n}\n\nEmbeddedTextHtmlRender.__dashjs_factory_name = 'EmbeddedTextHtmlRender';\nexport default FactoryMaker.getSingletonFactory(EmbeddedTextHtmlRender);\n"]}