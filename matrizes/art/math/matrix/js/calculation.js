(function(global){"use strict";var escapeHTML=function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};var html2html=function(container){var result="";var tagName=container.tagName.toUpperCase();if(tagName==="LINK"&&container.getAttribute("rel")==="stylesheet"){var href=container.href;result+="<link href=\""+escapeHTML(href)+"\" rel=\"stylesheet\" type=\"text/css\"/>";}else if(tagName!=="SCRIPT"&&tagName!=="IFRAME"){result+="<";result+=tagName;if(tagName==="INPUT"){result+=" "+"value"+"="+"\""+escapeHTML(container.value)+"\"";}
var attributes=container.attributes;var length=attributes.length;for(var i=0;i<length;i+=1){var a=attributes[i];result+=" "+escapeHTML(a.name)+"="+"\""+escapeHTML(a.value)+"\"";}
result+=">";if(tagName==="TEXTAREA"){result+=escapeHTML(container.value);}else{var child=container.firstChild;while(child!=undefined){if(child.nodeType===Node.ELEMENT_NODE){result+=html2html(child);}
if(child.nodeType===Node.TEXT_NODE){result+=escapeHTML(child.nodeValue);}
child=child.nextSibling;}}
result+="</";result+=tagName;result+=">";}
return result;};global.sendSnapshot=function(){if(global.document!=undefined){var activeElement=global.document.body.querySelector(":focus");if(activeElement!=null){activeElement.setAttribute("data-state","focus");}
var snapshot=html2html(global.document.documentElement,activeElement);if(activeElement!=null){activeElement.removeAttribute("data-state");}
snapshot+="<style>[data-state=\"focus\"] { outline: 2px solid green; } </style>";var dataURL="data:text/html;charset=utf-8,"+encodeURIComponent(snapshot);global.onerror(dataURL,"snapshot.js",0,0,undefined);}};}(this));(function(global){"use strict";if(Date.now==undefined){Date.now=function(){return new Date().getTime();};}
if(Object.create==undefined){Object.create=function(prototype){var F=function(){};F.prototype=prototype;return new F();};}
if(Object.defineProperty==undefined&&Object.prototype.__defineGetter__!=undefined&&Object.prototype.__defineSetter__!=undefined){Object.defineProperty=function(object,property,descriptor){var getter=descriptor.get;if(getter!=undefined){object.__defineGetter__(property,getter);}
var setter=descriptor.set;if(setter!=undefined){object.__defineSetter__(property,setter);}};}
if((-2147483649).toString(16)==="-0"){var numberToString=Number.prototype.toString;Number.prototype.toString=function(radix){"use strict";return(this<0?"-":"")+numberToString.call(this<0?0-this:this,radix);};}
if(Object.assign==undefined){Object.assign=function(target){for(var i=1;i<arguments.length;i+=1){var source=arguments[i];if(source!=undefined){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}}
return target;};}
if(Number.parseInt==undefined){Number.parseInt=parseInt;}
if(Number.parseFloat==undefined){Number.parseFloat=parseFloat;}}(this));if(this.JSON==undefined){this.JSON={parse:function(x){"use strict";return eval("("+x+")");},stringify:function(x){"use strict";var quote=function(string){return"\""+string.replace(/[\x00-\x1f\\"]/g,function(character){return"\\u"+(0x10000+character.charCodeAt(0)).toString(16).slice(1);})+"\"";};if(typeof x==="object"){if(typeof x.toJSON==="function"){return quote(x.toJSON().toString());}
var isArray=x.length!=undefined;var f=false;var s="";s+=isArray?"[":"{";for(var i in x){if(Object.prototype.hasOwnProperty.call(x,i)){var v=x[i];if(v!=undefined){if(f){s+=",";}
f=true;s+=(isArray?"":quote(i)+":")+JSON.stringify(v);}}}
s+=isArray?"]":"}";return s;}
if(typeof x==="number"||typeof x==="boolean"){return x.toString();}
return x==undefined?"null":quote(x.toString());}};}
if(!("firstElementChild"in document.documentElement)){(function(){"use strict";function f(property0,property1,property2){if(!(property0 in document.documentElement)){Object.defineProperty(Element.prototype,property0,{get:function(){var t=this[property1];while(t!=undefined&&t.nodeType!==Node.ELEMENT_NODE){t=t[property2];}
return t;}});}}
f("previousElementSibling","previousSibling","previousSibling");f("nextElementSibling","nextSibling","nextSibling");f("firstElementChild","firstChild","nextSibling");f("lastElementChild","lastChild","previousSibling");}());}
if(Element.prototype.querySelectorAll==undefined){Element.prototype.querySelectorAll=function(s){"use strict";var results=[];var toWalk=[];var i=-1;toWalk.push(this);while(++i<toWalk.length){var x=toWalk[i];if((s.charCodeAt(0)===".".charCodeAt(0)&&x.classList.contains(s.slice(1)))||(s.charCodeAt(0)==="[".charCodeAt(0)&&x.getAttribute(s.slice(1,-1))!=undefined)||x.tagName.toUpperCase()===s.toUpperCase()){results.push(x);}
var c=x.firstElementChild;while(c!=undefined){toWalk.push(c);c=c.nextElementSibling;}}
return results;};}
if(Element.prototype.querySelector==undefined){Element.prototype.querySelector=function(s){"use strict";var x=this.querySelectorAll(s);return x.length===0?undefined:x[0];};}
if(Document.prototype.querySelectorAll==undefined){Document.prototype.querySelectorAll=function(s){"use strict";return this.documentElement.querySelectorAll(s);};}
if(Document.prototype.querySelector==undefined){Document.prototype.querySelector=function(s){"use strict";return this.documentElement.querySelector(s);};}
if(!("classList"in document.documentElement)){(function(){"use strict";var update=function(cl){for(var i=0;i<cl.tokens.length;i+=1){cl[i]=cl.tokens[i];}
cl.length=cl.tokens.length;};function ClassList(element){this.element=element;var s=element.className.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ");this.tokens=s===""?[]:s.split(" ");update(this);}
ClassList.prototype.item=function(index){return this.tokens[index];};ClassList.prototype.contains=function(className){var i=-1;while(++i<this.tokens.length){if(this.tokens[i]===className){return true;}}
return false;};ClassList.prototype.add=function(className){this.toggle(className,true);};ClassList.prototype.remove=function(className){this.toggle(className,false);};ClassList.prototype.toggle=function(className,force){force=force==undefined?!this.contains(className):force;if(force){var j=-1;while(++j<this.tokens.length){if(this.tokens[j]===className){return force;}}
this.tokens.push(className);}else{var i=-1;var k=0;while(++i<this.tokens.length){if(this.tokens[i]!==className){this.tokens[k]=this.tokens[i];k+=1;}}
if(k===i){return force;}
this.tokens.length=k;}
update(this);this.element.className=this.tokens.join(" ");return force;};ClassList.prototype.toString=function(){return this.element.className;};Object.defineProperty(Element.prototype,"classList",{get:function(){return new ClassList(this);},set:undefined,enumerable:false,configurable:true});}());}
if(window.XDomainRequest!=undefined&&!("draggable"in document.documentElement)){document.addEventListener("selectstart",function(event){"use strict";var target=event.target;while(target!=undefined&&!(target.nodeType===Node.ELEMENT_NODE&&target.getAttribute("draggable")!=undefined)){target=target.parentNode;}
if(target!=undefined){event.preventDefault();target.dragDrop();}},false);}
if(window.XDomainRequest!=undefined||window.opera!=undefined){(function(){"use strict";document.addEventListener("input",function(event){event.target.setAttribute("data-last-value",event.target.value);},false);var fire=function(type,element){window.setTimeout(function(){var event=document.createEvent("Event");event.initEvent(type,true,false);element.dispatchEvent(event);},0);};var check=function(elements){for(var i=0;i<elements.length;i+=1){var e=elements[i];var lastValue=e.getAttribute("data-last-value");var value=String(e.value);if(lastValue!==value){fire("input",e);}}};var inputs=document.getElementsByTagName("input");var textareas=document.getElementsByTagName("textarea");var checkInputs=function(){check(inputs);check(textareas);window.setTimeout(checkInputs,300);};window.setTimeout(checkInputs,300);}());}
if(!("onmouseenter"in document.documentElement)){document.addEventListener("mouseover",function(event){"use strict";if(!event.target.contains(event.relatedTarget)){var e=document.createEvent("MouseEvent");e.initMouseEvent("mouseenter",false,false,event.view,event.detail,event.screenX,event.screenY,event.clientX,event.clientY,event.ctrlKey,event.altKey,event.shiftKey,event.metaKey,event.button,event.relatedTarget);event.target.dispatchEvent(e);}},false);document.documentElement.onmouseenter=undefined;}
if(!("onmouseleave"in document.documentElement)){document.addEventListener("mouseout",function(event){"use strict";if(!event.target.contains(event.relatedTarget)){var e=document.createEvent("MouseEvent");e.initMouseEvent("mouseleave",false,false,event.view,event.detail,event.screenX,event.screenY,event.clientX,event.clientY,event.ctrlKey,event.altKey,event.shiftKey,event.metaKey,event.button,event.relatedTarget);event.target.dispatchEvent(e);}},false);document.documentElement.onmouseleave=undefined;}
if(!("defaultPrevented"in Event.prototype)&&!("defaultPrevented"in document.createEvent("Event"))){var preventDefault=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){"use strict";this.defaultPrevented=true;preventDefault.call(this);};}
if(window.clipboardData!=undefined){Object.defineProperty(Event.prototype,"clipboardData",{get:function(){"use strict";return window.clipboardData;},set:undefined,enumerable:false,configurable:true});}
if(!("oncopy"in document)){window.setTimeout(function(){"use strict";var lastFocusedNode=undefined;var removeCopyFix=function(){var copyFix=document.getElementById("copy-fix");if(copyFix!=undefined){document.body.removeChild(copyFix);if(lastFocusedNode!=undefined){lastFocusedNode.focus();lastFocusedNode=undefined;}}};var addCopyFix=function(){var activeElement=document.activeElement;if(activeElement==undefined||activeElement.tagName.toUpperCase()!=="INPUT"&&activeElement.tagName.toUpperCase()!=="TEXTAREA"){var selection=window.getSelection();if(selection.isCollapsed){var copyFix=document.createElement("div");copyFix.id="copy-fix";copyFix.innerHTML="&nbsp;";document.body.appendChild(copyFix);lastFocusedNode=document.activeElement;selection.collapse(copyFix,0);selection.selectAllChildren(copyFix);window.setTimeout(function(){removeCopyFix();},0);}}};document.addEventListener("keydown",function(event){if(event.keyCode==="C".charCodeAt(0)&&(event.ctrlKey||event.metaKey)&&!event.altKey&&!event.shiftKey&&!event.defaultPrevented){addCopyFix();}},false);var nativeExecCommand=document.execCommand;document.execCommand=function(name,showDefaultUI,value){if(name==="copy"){addCopyFix();}
return nativeExecCommand.call(this,name,showDefaultUI,value);};document.addEventListener("copy",function(event){removeCopyFix();},false);},0);}
if(Element.prototype.scrollIntoViewIfNeeded==undefined){Element.prototype.scrollIntoViewIfNeeded=function(){"use strict";var rect=this.getBoundingClientRect();if(rect.left<0||document.documentElement.clientWidth<rect.right||rect.top<0||document.documentElement.clientHeight<rect.bottom){this.scrollIntoView(document.documentElement.clientHeight<rect.bottom-rect.top||rect.top<0);}};}
if(HTMLElement.prototype.click==undefined){HTMLElement.prototype.click=function(element){"use strict";var event=document.createEvent("MouseEvent");event.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,undefined);this.dispatchEvent(event);};}
if(Node.prototype.contains==undefined){Node.prototype.contains=function(otherNode){"use strict";var x=otherNode;while(x!=undefined&&x!==this){x=x.parentNode;}
return x!=undefined;};}
if(document.documentElement.classList.toggle("test",false)){DOMTokenList.prototype.toggle=function(token,force){"use strict";force=force==undefined?!this.contains(token):force;if(force){this.add(token);}else{this.remove(token);}
return force;};}
if((window.DataTransfer!=undefined&&window.DataTransfer.prototype!=undefined&&"mozCursor"in window.DataTransfer.prototype&&!("caretColor"in document.documentElement.style))||window.XDomainRequest!=undefined){(function(){"use strict";var lastScrollTop=0;document.addEventListener("dragover",function(event){if(lastScrollTop===window.pageYOffset){var t=event.clientY;var b=document.documentElement.clientHeight-event.clientY;var dy=t<16?-1*(16-t)*(16-t):(b<16?+1*(b-16)*(b-16):0);if(dy!==0){window.scrollBy(0,dy);}}
lastScrollTop=window.pageYOffset;},false);}());}
if("MozBackgroundInlinePolicy"in document.documentElement.style&&document.readyState==="interactive"){(function(){"use strict";var contentLoadedTimeoutId=0;var onTimeout=function(){contentLoadedTimeoutId=window.setTimeout(onTimeout,10);if(document.readyState==="complete"){var event=document.createEvent("Event");event.initEvent("DOMContentLoaded",false,false);document.dispatchEvent(event);}};onTimeout();document.addEventListener("DOMContentLoaded",function(event){window.clearTimeout(contentLoadedTimeoutId);},false);}());}
if(!("head"in document)){document.head=document.documentElement.firstElementChild;}
if(window.clipboardData!=undefined&&window.MouseEvent!=undefined){var redefineClientXY=function(property){"use strict";var clinetXDescriptor=Object.getOwnPropertyDescriptor(window.MouseEvent.prototype,"clientX");var clinetYDescriptor=Object.getOwnPropertyDescriptor(window.MouseEvent.prototype,"clientY");Object.defineProperty(window.MouseEvent.prototype,property,{get:function(){if(this.screenX===0&&this.screenY===0){return 0;}
var rect=this.target.getBoundingClientRect();var x=clinetXDescriptor.get.call(this);var y=clinetYDescriptor.get.call(this);return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom?(property==="clientX"?x:y):0;},set:undefined,enumerable:false,configurable:true});};redefineClientXY("clientX");redefineClientXY("clientY");}
if(!("hidden"in document.documentElement)){Object.defineProperty(HTMLElement.prototype,"hidden",{get:function(){"use strict";return this.getAttribute("hidden")!=undefined;},set:function(value){"use strict";if(value!=="hidden"){if(value){this.setAttribute("hidden","hidden");}else{this.removeAttribute("hidden");}}},enumerable:false,configurable:true});}
if(window.clipboardData!=undefined){document.nativeGetElementById=document.getElementById;document.getElementById=function(id){"use strict";return document.nativeGetElementById(id)||(/^[_a-zA-Z0-9\-]+$/.exec(id)!=undefined?document.querySelector("[id=\""+id+"\"]"):undefined);};}
if(window.navigator!=undefined){var connection=window.navigator.connection;if(connection!=undefined){if(!("effectiveType"in connection)){var type=connection.type;if(typeof type==="number"){connection.effectiveType=(connection.type===connection.CELL_2G?"2g":"unknown");}else{if("downlinkMax"in connection){connection.effectiveType=connection.downlinkMax<=70?"2g":"3g";}}}
if(!("saveData"in connection)){if("metered"in connection){connection.saveData=connection.metered;}}}}
if(window.console==undefined&&window.opera!=undefined&&window.opera.postError!=undefined){window.console={log:function(s){window.opera.postError(s);}};}
if(window.console==undefined){window.console={log:function(s){}};}
(function(){"use strict";var cubicBezier=function(a,b,t){return 3*a*(1-t)*(1-t)*t+3*b*(1-t)*t*t+t*t*t;};var cubic=function(x,error,a,b,c,d){var start=0;var end=1;while(end-start>error){var middle=(start+end)/ 2;var e=cubicBezier(a,c,middle);if(e<x){start=middle;}else{end=middle;}}
return cubicBezier(b,d,start);};var easeInOut=function(x,error){return cubic(x,error,0.42,0,0.58,1);};var animationNameCounter=0;var createStyleElement=function(name,css){var styleElement=document.createElement("style");styleElement.id=name;styleElement.appendChild(document.createTextNode(css));document.head.appendChild(styleElement);};var removeStyleElement=function(name){var styleElement=document.getElementById(name);document.head.removeChild(styleElement);};var setAnimationStyles=function(element,keyframes,options){animationNameCounter+=1;var newName="animation"+animationNameCounter.toString();var oldName=element.style.animationName;if(keyframes!=undefined){var c="";for(var j=0;j<keyframes.length;j+=1){var x=keyframes[j];c+=(100*j /(keyframes.length-1)).toString()+"% { "+
(x.opacity!=undefined?"opacity: "+x.opacity.toString()+";":"")+
(x.transform!=undefined?"transform: "+x.transform.toString()+";":"")+" } \n";}
var rule="@keyframes "+newName+" { "+c+" } ";createStyleElement(newName,rule);}
element.style.animationDuration=options==undefined?"":(options.duration / 1000).toString()+"s";element.style.animationFillMode=options==undefined?"":options.fill;element.style.animationName=keyframes==undefined?"":newName;element.style.animationTimingFunction=options==undefined?"":options.easing;if(oldName!==""){removeStyleElement(oldName);}};var animations=[];var interpolateValues=function(a,b,p){return(1-p)*a+p*b;};var addValues=function(a,b){return a+b;};function Transform(name,arg){this.name=name;this.arg=arg;}
Transform.prototype.toString=function(){return this.name+"("+this.arg.toString()+(this.name!=="scale"?"px":"")+")";};Transform.parseTransform=function(transform){var match=/^\s*([a-zA-Z]+)\(([^\),]+)\)\s*$/.exec(transform);if(match==undefined){throw new Error();}
var name=match[1];var arg=Number.parseFloat(match[2]);return new Transform(name,arg);};function Keyframe(opacity,transform){this.opacity=opacity;this.transform=transform;}
Keyframe.parseKeyframe=function(style){var opacity=style.opacity==undefined||style.opacity===""?undefined:Number.parseFloat(style.opacity);var transform=style.transform==undefined||style.transform===""?undefined:Transform.parseTransform(style.transform);return new Keyframe(opacity,transform);};Keyframe.prototype.interpolate=function(keyframe,p){var opacity=undefined;if(this.opacity!=undefined||keyframe.opacity!=undefined){opacity=interpolateValues(this.opacity!=undefined?this.opacity:1,keyframe.opacity!=undefined?keyframe.opacity:1,p);}
var transform=undefined;if(this.transform!=undefined||keyframe.transform!=undefined){if(this.transform==undefined&&keyframe.transform==undefined&&this.transform.name!==keyframe.transform.name){throw new Error();}
var name=this.transform!=undefined?this.transform.name:keyframe.transform.name;transform=new Transform(name,interpolateValues(this.transform!=undefined?this.transform.arg:(name==="scale"?1:0),keyframe.transform!=undefined?keyframe.transform.arg:(name==="scale"?1:0),p));}
return new Keyframe(opacity,transform);};Keyframe.prototype.add=function(keyframe,composite){var opacity=keyframe.opacity==undefined?this.opacity:(this.opacity==undefined||composite!=="add"?keyframe.opacity:addValues(this.opacity,keyframe.opacity));var transform=keyframe.transform==undefined?this.transform:(this.transform==undefined||composite!=="add"?keyframe.transform:new Transform(this.transform.name,this.transform.name==="scale"?this.transform.arg*keyframe.transform.arg:addValues(this.transform.arg,keyframe.transform.arg)));return new Keyframe(opacity,transform);};Keyframe.willChange="transform, opacity";var generateKeyframes=function(element,startTime,endTime){var style=Keyframe.parseKeyframe(element.style);var keyframes=[];for(var time=startTime;time<endTime;time+=1000 / 60){var value=style;for(var i=0;i<animations.length;i+=1){var a=animations[i];if(a.element===element){var timeFraction=(time-a.startTime)/ a.duration;if(timeFraction<0){timeFraction=0;}
if(timeFraction>1){timeFraction=1;}
var p=easeInOut(timeFraction,1000 / 60 / a.duration / 32);var frame0=value.add(a.keyframes[0],a.composite);var frame1=value.add(a.keyframes[1],a.composite);value=frame0.interpolate(frame1,p);}}
keyframes.push(value);}
return keyframes;};var startTime=0;if(window.operamini==undefined&&window.opera==undefined&&("animationName"in document.documentElement.style)&&("transform"in document.documentElement.style)&&(Element.prototype.animate==undefined||window.KeyframeEffect==undefined||!("composite"in window.KeyframeEffect.prototype))){Element.prototype.animate=function(frames,keyframeEffectOptions){if(startTime===0){startTime=Date.now();window.setTimeout(function(){startTime=0;},0);}
var now=startTime;var keyframes=[];for(var j=0;j<frames.length;j+=1){keyframes.push(Keyframe.parseKeyframe(frames[j]));}
var element=this;var animation={element:element,keyframes:keyframes,duration:keyframeEffectOptions.duration,composite:keyframeEffectOptions.composite,startTime:now};animations.push(animation);element.style.willChange=Keyframe.willChange;var endTime=0;for(var i=0;i<animations.length;i+=1){if(animations[i].element===element){var animationEndTime=animations[i].startTime+animations[i].duration;if(endTime<animationEndTime){endTime=animationEndTime;}}}
var animationKeyframes=generateKeyframes(element,now,endTime);setAnimationStyles(element,animationKeyframes,{duration:endTime-now,fill:"both",easing:"linear"});window.setTimeout(function(){var k=0;var active=0;for(var i=0;i<animations.length;i+=1){if(animations[i]!==animation){if(animations[i].element===element){active+=1;}
animations[k]=animations[i];k+=1;}}
animations.length=k;if(active===0){setAnimationStyles(element,undefined,undefined);element.style.willChange="";}},animation.duration);return animation;};}}(this));(function(){"use strict";function Inert(){}
Inert.observers=[];Inert.dialogs=[];Inert.f=function(tabIndex){return-42-tabIndex;};Inert.toggleInert=function(node,dialog,value){if(!dialog.contains(node)){if((value&&node.tabIndex>=0)||(!value&&node.tabIndex<=Inert.f(0))){node.tabIndex=Inert.f(node.tabIndex);}
var c=node.firstElementChild;while(c!=undefined){Inert.toggleInert(c,dialog,value);c=c.nextElementSibling;}}};Inert.push=function(dialog){Inert.toggleInert(document.documentElement,dialog,true);if(window.MutationObserver!=undefined){var observer=new window.MutationObserver(function(mutations){for(var i=0;i<mutations.length;i+=1){var mutation=mutations[i];var addedNodes=mutation.addedNodes;for(var j=0;j<addedNodes.length;j+=1){Inert.toggleInert(addedNodes[j],dialog,true);}
var removedNodes=mutation.removedNodes;for(var k=0;k<removedNodes.length;k+=1){Inert.toggleInert(removedNodes[k],dialog,false);}}});observer.observe(document.documentElement,{childList:true,subtree:true});Inert.observers.push(observer);}
Inert.dialogs.push(dialog);};Inert.pop=function(){var dialog=Inert.dialogs.pop();if(window.MutationObserver!=undefined){var observer=Inert.observers.pop();observer.disconnect();}
Inert.toggleInert(document.documentElement,dialog,false);};var setFocus=function(dialog){var autofocus=dialog.querySelector("[autofocus]");autofocus.focus();};var show=function(){if(this.getAttribute("open")==undefined){this.setAttribute("open","open");setFocus(this);}};var showModal=function(){if(this.getAttribute("open")==undefined){this.setAttribute("data-modal","data-modal");this.setAttribute("open","open");Inert.push(this);setFocus(this);}};var close=function(returnValue){if(this.getAttribute("open")!=undefined){if(this.getAttribute("data-modal")!=undefined){this.removeAttribute("data-modal");Inert.pop();}
this.removeAttribute("open");this.returnValue=returnValue;var event=document.createEvent("Event");event.initEvent("close",false,false);this.dispatchEvent(event);}};Element.prototype.initDialog=function(){var dialog=this;if(dialog.show==undefined||dialog.showModal==undefined||dialog.close==undefined){dialog.setAttribute("role","dialog");dialog.show=show;dialog.showModal=showModal;dialog.close=close;dialog.returnValue=undefined;dialog.addEventListener("keydown",function(event){var DOM_VK_ESCAPE=27;if(event.keyCode===DOM_VK_ESCAPE&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();this.close(undefined);}},false);dialog.addEventListener("submit",function(event){event.preventDefault();this.close(event.target.getAttribute("value"));},false);}};}());(function(){"use strict";Element.prototype.initDetails=function(summary){var details=this;if(summary.tagName.toUpperCase()!=="SUMMARY"){throw new RangeError("Unexpected "+summary.tagName.toUpperCase());}
if(!("open"in details)||!("ontoggle"in details)||summary.tabIndex===-1){details.setAttribute("role","group");summary.setAttribute("aria-expanded","false");summary.setAttribute("role","button");summary.setAttribute("tabindex","0");summary.addEventListener("click",function(event){var summary=this;var details=summary.parentNode;event.preventDefault();var isOpen=details.getAttribute("open")!=undefined;if(!isOpen){summary.setAttribute("aria-expanded","true");details.setAttribute("open","open");}else{details.setAttribute("aria-expanded","false");details.removeAttribute("open");}
summary.focus();var e=document.createEvent("Event");e.initEvent("toggle",false,false);details.dispatchEvent(e);},false);summary.addEventListener("keydown",function(event){var DOM_VK_SPACE=32;if(event.keyCode===DOM_VK_SPACE&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();}
var DOM_VK_RETURN=13;if(event.keyCode===DOM_VK_RETURN&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();this.click();}},false);summary.addEventListener("keyup",function(event){var DOM_VK_SPACE=32;if(event.keyCode===DOM_VK_SPACE&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();this.click();}},false);}};}());(function(){"use strict";if(Object.getOwnPropertyDescriptor!=undefined&&HTMLInputElement.prototype.createTextRange!=undefined){var fixSetSelectionRange=function(C){var setSelectionRange=C.prototype.setSelectionRange;C.prototype.setSelectionRange=function(selectionStart,selectionEnd,selectionDirection){setSelectionRange.call(this,selectionStart,selectionEnd,selectionDirection);var textRange=this.createTextRange();textRange.moveStart("character",this.selectionStart);textRange.moveEnd("character",this.selectionEnd-this.value.length);textRange.scrollIntoView(true);};};fixSetSelectionRange(HTMLInputElement);fixSetSelectionRange(HTMLTextAreaElement);}
if(Object.getOwnPropertyDescriptor!=undefined&&HTMLInputElement.prototype.createTextRange!=undefined&&document.attachEvent!=undefined){var originalGetBoundingClientRect=TextRange.prototype.getBoundingClientRect;TextRange.prototype.getBoundingClientRect=function(){var zoomX=window.screen.logicalXDPI / window.screen.deviceXDPI;var zoomY=window.screen.logicalYDPI / window.screen.deviceYDPI;var rect=originalGetBoundingClientRect.call(this);return{top:rect.top*zoomY,right:rect.right*zoomX,bottom:rect.bottom*zoomY,left:rect.left*zoomX,height:(rect.bottom-rect.top)*zoomY,width:(rect.right-rect.left)*zoomX};};}
if(Object.getOwnPropertyDescriptor!=undefined&&HTMLInputElement.prototype.createTextRange!=undefined){var fixScrollProperty=function(property){var originalScrollProperty=Object.getOwnPropertyDescriptor(Element.prototype,property);if(originalScrollProperty!=undefined){Object.defineProperty(Element.prototype,property,{get:function(){if(this.tagName.toUpperCase()!=="INPUT"){return originalScrollProperty.get.call(this);}
var inputElement=this;var textRange=inputElement.createTextRange();var inputStyle=window.getComputedStyle(inputElement,undefined);var paddingLeft=Number.parseFloat(inputStyle.paddingLeft);var paddingRight=Number.parseFloat(inputStyle.paddingRight);var rangeRect=textRange.getBoundingClientRect();var scrollLeft=inputElement.getBoundingClientRect().left+inputElement.clientLeft+paddingLeft-rangeRect.left;var clientWidth=inputElement.clientWidth;var contentWidth=paddingLeft+(rangeRect.right-rangeRect.left)+paddingRight;var scrollWidth=clientWidth>contentWidth?clientWidth:contentWidth;return property==="scrollLeft"?scrollLeft:scrollWidth;},set:function(value){return originalScrollProperty.set.call(this,value);},enumerable:false,configurable:true});}
fixScrollProperty("scrollLeft");};}
if(Object.getOwnPropertyDescriptor!=undefined){var lastDevicePixelRatio=0;var lastScrollLeftFix=1;var originalScrollLeft=undefined;try{originalScrollLeft=Object.getOwnPropertyDescriptor(Element.prototype,"scrollLeft");}catch(error){window.console.log(error);}
if(originalScrollLeft!=undefined&&originalScrollLeft.get!=undefined&&originalScrollLeft.set!=undefined){Object.defineProperty(HTMLInputElement.prototype,"scrollLeft",{get:function(){if(this.tagName.toUpperCase()!=="INPUT"){return originalScrollLeft.get.call(this);}
if(lastDevicePixelRatio!==window.devicePixelRatio){lastDevicePixelRatio=window.devicePixelRatio;var input=document.createElement("input");document.body.appendChild(input);input.style.width="1px";input.style.overflow="hidden";input.value="xxxxxxxxxxxxxxx";originalScrollLeft.set.call(input,16383);var s=originalScrollLeft.get.call(input);if(s===0){lastScrollLeftFix=1;}else{lastScrollLeftFix=(input.scrollWidth-input.clientWidth)/ s;if((1-lastScrollLeftFix)*(1-lastScrollLeftFix)<0.05*0.05){lastScrollLeftFix=1;}}
document.body.removeChild(input);}
return lastScrollLeftFix*originalScrollLeft.get.call(this);},set:function(value){originalScrollLeft.set.call(this,value);},enumerable:false,configurable:true});}}}());if(document.caretPositionFromPoint==undefined&&document.caretRangeFromPoint==undefined){document.caretRangeFromPoint=function(x,y){"use strict";var element=document.elementFromPoint(x,y);var walk=function(candidate,e,x,y){var node=candidate;var c=e.firstChild;if(c==undefined&&e.nodeType===Node.TEXT_NODE&&e.parentNode.tagName.toUpperCase()!=="TEXTAREA"){var range=document.createRange();range.setStart(e,0);range.setEnd(e,e.nodeValue.length);var rect=range.getBoundingClientRect();if(x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom){node=e;}}
while(c!=undefined){node=walk(node,c,x,y);c=c.nextSibling;}
return node;};var node=walk(element,element,x,y);var result=document.createRange();result.selectNode(node);if(node.nodeType===Node.TEXT_NODE){var length=node.nodeValue.length;var min=1 / 0;for(var i=0;i<length;i+=1){var range=document.createRange();range.setStart(node,i);range.setEnd(node,i+1);var rect=range.getBoundingClientRect();var d=x-(rect.left+rect.right)/ 2;var distance=d<0?0-d:0+d;if(distance<min&&y>=rect.top&&y<=rect.bottom){result=range;min=distance;}}}
return result;};}
if(document.caretPositionFromPoint==undefined){document.caretPositionFromPoint=function(x,y){"use strict";var element=document.elementFromPoint(x,y);if(element.tagName.toUpperCase()!=="INPUT"&&element.tagName.toUpperCase()!=="TEXTAREA"){var caretRange=document.caretRangeFromPoint(x,y);return{offsetNode:caretRange.startContainer,offset:caretRange.startOffset};}
var input=element;var inputStyle=window.getComputedStyle(input,undefined);var scrollLeft=input.scrollLeft;var scrollTop=input.scrollTop;var inputRect=input.getBoundingClientRect();var value=input.value.replace(/\r\n/g,"\n")+"\n";var div=document.createElement("div");div.appendChild(document.createTextNode(value));div.style.position="absolute";div.style.display="inline-block";div.style.margin="0px";div.style.border="0px solid transparent";div.style.paddingLeft=inputStyle.paddingLeft;div.style.paddingRight=inputStyle.paddingRight;div.style.paddingTop=inputStyle.paddingTop;div.style.paddingBottom=inputStyle.paddingBottom;div.style.left=(inputRect.left+window.pageXOffset+input.clientLeft).toString()+"px";div.style.top=(inputRect.top+window.pageYOffset+input.clientTop).toString()+"px";div.style.width=input.clientWidth.toString()+"px";div.style.height=input.clientHeight.toString()+"px";if("boxSizing"in div.style){div.style.boxSizing="border-box";}
if("MozBoxSizing"in div.style){div.style.MozBoxSizing="border-box";}
if("webkitBoxSizing"in div.style){div.style.webkitBoxSizing="border-box";}
div.style.whiteSpace=input.tagName.toUpperCase()==="INPUT"?"nowrap":"pre";div.style.wordWrap=inputStyle.wordWrap;div.style.fontSize=inputStyle.fontSize;div.style.fontFamily=inputStyle.fontFamily;div.style.overflow="hidden";div.style.visibility="visible";div.style.zIndex="100000";document.body.appendChild(div);div.scrollLeft=scrollLeft;div.scrollTop=scrollTop;var range=document.caretRangeFromPoint(x,y);var offset=range.startOffset;document.body.removeChild(div);return{offsetNode:input,offset:offset};};}
(function(){"use strict";var operators={",":{c:",",p:-10},"\u2192":{c:"->",p:-9},"\u2194":{c:"<->",p:-9},".^":{c:".^",p:7},"^":{c:"^",p:6},"\u00D7":{c:"*",p:5},"\u2061":{c:"",p:5},"\u2062":{c:"",p:10},"/":{c:"/",p:4},"\u2212":{c:"-",p:3},"+":{c:"+",p:2}};var isRightToLeftAssociative=function(operator){return operator==="^"||operator===".^";};var fence=function(x,operator,left){return(x.precedence<operators[operator].p||(x.precedence===operators[operator].p&&(left&&!isRightToLeftAssociative(x)||!left&&isRightToLeftAssociative(x))))?"("+x.string+")":x.string;};var transformMTABLE=function(node){var childNode=node.firstElementChild;var rows="";while(childNode!=undefined){if(childNode.tagName.toUpperCase()==="MTR"){var c=childNode.firstElementChild;var row="";while(c!=undefined){if(c.tagName.toUpperCase()==="MTD"){row+=(row!==""?", ":"")+fence(transformMathML(c),",",true);}
c=c.nextElementSibling;}
rows+=(rows!==""?", ":"")+"{"+row+"}";}
childNode=childNode.nextElementSibling;}
return"{"+rows+"}";};function TransformResult(string,precedence){this.string=string;this.precedence=precedence;}
var transformMathML=function(node){var tagName=node.tagName.toUpperCase();if(tagName==="MATH"||tagName==="MTD"||tagName==="MTR"||tagName==="MROW"||tagName==="MENCLOSE"||tagName==="MFENCED"||tagName==="MO"||tagName==="MPADDED"||tagName==="MSTYLE"||tagName==="MUNDER"||tagName==="MI"||tagName==="MN"){var s="";var p=42;if(tagName==="MI"||tagName==="MN"||tagName==="MO"){s=node.textContent;}else{var childNode=node.firstChild;while(childNode!=undefined){if(childNode.nodeType===Node.TEXT_NODE){s+=childNode.nodeValue;}else if(childNode.nodeType===Node.ELEMENT_NODE){var tmp=transformMathML(childNode);s+=tmp.string;if(p>tmp.precedence){p=tmp.precedence;}}
childNode=childNode.nextSibling;}}
if(tagName==="MO"){var o=operators[s];var precedence=o==undefined?0:o.p;if(p>precedence){p=precedence;}
s=o==undefined?s:o.c;}
return tagName==="MFENCED"?new TransformResult(node.getAttribute("open")+s+node.getAttribute("close"),42):new TransformResult(s,p);}
if(tagName==="MSUP"){return new TransformResult(fence(transformMathML(node.firstElementChild),"^",true)+"^"+fence(transformMathML(node.firstElementChild.nextElementSibling),"^",false),operators["^"].p);}
if(tagName==="MSUB"){var x=transformMathML(node.firstElementChild.nextElementSibling).string;return new TransformResult(transformMathML(node.firstElementChild).string+"_"+(x.indexOf(",")!==-1?"("+x+")":x),42);}
if(tagName==="MFRAC"){return new TransformResult(fence(transformMathML(node.firstElementChild),"/",true)+"/"+fence(transformMathML(node.firstElementChild.nextElementSibling),"/",false),operators["/"].p);}
if(tagName==="MSQRT"){return new TransformResult("sqrt("+transformMathML(node.firstElementChild).string+")",42);}
if(tagName==="MROOT"){return new TransformResult(fence(transformMathML(node.firstElementChild),"^",true)+"^"+"(1/"+transformMathML(node.firstElementChild.nextElementSibling).string+")",operators["^"].p);}
if(tagName==="MTABLE"){return new TransformResult(transformMTABLE(node),42);}
if(tagName==="MTEXT"){return new TransformResult("",42);}
throw new Error("transformMathML:"+tagName);};var isBlock=function(display){switch(display){case"inline":case"inline-block":case"inline-flex":case"inline-grid":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":return false;}
return true;};var getLength=function(container){if(container.nodeType===Node.TEXT_NODE){return container.nodeValue.length;}
if(container.nodeType===Node.ELEMENT_NODE){var i=0;var child=container.firstChild;while(child!=undefined){child=child.nextSibling;i+=1;}
return i;}};var getChildNode=function(container,offset,node,roundUp){var child=undefined;var x=container;var intersectsAll=(roundUp?offset===getLength(container):offset===0);while(x!==node){child=x;intersectsAll=intersectsAll&&(roundUp?child.nextSibling==undefined:child.previousSibling==undefined);x=x.parentNode;}
if(child!=undefined){child=roundUp?child.nextSibling:child;}else{var i=-1;child=container.firstChild;while(++i<offset){child=child.nextSibling;}}
return{child:child,intersectsAll:intersectsAll};};var serialize=function(range,isLineStart,specialSerializer){var node=range.commonAncestorContainer;var startContainer=range.startContainer;var startOffset=range.startOffset;var endContainer=range.endContainer;var endOffset=range.endOffset;if(node.nodeType===Node.TEXT_NODE){var nodeValue=node.nodeValue.slice(node===startContainer?startOffset:0,node===endContainer?endOffset:node.nodeValue.length);nodeValue=nodeValue.replace(/[\u0020\n\r\t\v]+/g," ");if(isLineStart){nodeValue=nodeValue.replace(/^[\u0020\n\r\t\v]/g,"");}
return nodeValue;}
if(node.nodeType===Node.ELEMENT_NODE){var display=window.getComputedStyle(node,undefined).display;if(display==="none"){return"";}
var intersectsAll=true;var tmp0=getChildNode(startContainer,startOffset,node,false);var startChildNode=tmp0.child;intersectsAll=intersectsAll&&tmp0.intersectsAll;var tmp1=getChildNode(endContainer,endOffset,node,true);var endChildNode=tmp1.child;intersectsAll=intersectsAll&&tmp1.intersectsAll;var childNode=startChildNode;var result="";if(isBlock(display)&&!isLineStart){result+="\n";isLineStart=true;}
var x=undefined;if(intersectsAll){x=specialSerializer(node);}
if(x!=undefined){result+=x;}else{while(childNode!==endChildNode){var childNodeRange=document.createRange();childNodeRange.setStart(childNode,0);childNodeRange.setEnd(childNode,getLength(childNode));if(childNode===startChildNode&&startContainer!==node){childNodeRange.setStart(startContainer,startOffset);}
if(childNode.nextSibling===endChildNode&&endContainer!==node){childNodeRange.setEnd(endContainer,endOffset);}
var v=serialize(childNodeRange,isLineStart,specialSerializer);isLineStart=v===""&&isLineStart||v.slice(-1)==="\n";result+=v;childNode=childNode.nextSibling;}}
if(display==="table-cell"){result+="\t";}
if(isBlock(display)&&!isLineStart){result=result.replace(/[\u0020\n\r\t\v]$/g,"");result+="\n";isLineStart=true;}
return result;}
return"";};var serializePlainText=function(range,specialSerializer){var isLineStart=!(range.startContainer.nodeType===Node.TEXT_NODE&&range.startContainer.nodeValue.slice(0,range.startOffset).replace(/\s+/g,"")!=="");var isLineEnd=!(range.endContainer.nodeType===Node.TEXT_NODE&&range.endContainer.nodeValue.slice(range.endOffset,range.endContainer.nodeValue.length).replace(/\s+/g,"")!=="");var value=serialize(range,false,specialSerializer);if(isLineStart){value=value.replace(/^\s/g,"");}
if(isLineEnd){value=value.replace(/\s$/g,"");}
return value;};var specialSerializer=function(node){var tagName=node.tagName.toUpperCase();var isMathMLNode=tagName.charCodeAt(0)==="M".charCodeAt(0)&&tagName!=="MAIN"&&tagName!=="MAP"&&tagName!=="MARK"&&tagName!=="MATH"&&tagName!=="MENU"&&tagName!=="MENUITEM"&&tagName!=="META"&&tagName!=="METER";if(isMathMLNode||tagName==="MATH"){try{return transformMathML(node).string;}catch(error){window.setTimeout(function(){throw error;},0);}}
if(tagName==="BR"){return"\n";}
return undefined;};var serializeHTML=function(range){var fragment=range.cloneContents();var div=document.createElement("div");div.appendChild(fragment);return div.innerHTML;};var onCopyOrDragStart=function(event){var dataTransfer=event.type==="copy"?event.clipboardData:event.dataTransfer;var tagName=event.target.nodeType===Node.ELEMENT_NODE?event.target.tagName.toUpperCase():"";if(tagName!=="INPUT"&&tagName!=="TEXTAREA"&&tagName!=="A"&&tagName!=="IMG"){if((event.type==="copy"||dataTransfer.effectAllowed==="uninitialized")&&!event.defaultPrevented){var selection=window.getSelection();var rangeCount=selection.rangeCount;if(rangeCount!==0){var i=-1;var plainText="";var htmlText="";while(++i<rangeCount){var range=selection.getRangeAt(i);htmlText+=serializeHTML(range);plainText+=serializePlainText(range,specialSerializer);}
try{dataTransfer.setData("Text",plainText);dataTransfer.setData("text/html",htmlText);}catch(error){window.console.log(error);}
if(event.type==="copy"){event.preventDefault();}else{dataTransfer.effectAllowed="copy";}}}}};document.addEventListener("copy",onCopyOrDragStart,false);document.addEventListener("dragstart",onCopyOrDragStart,false);}());(function(global){"use strict";var parseInteger=function(s,from,to,radix){var i=from-1;var n=0;var y=radix<10?radix:10;while(++i<to){var code=s.charCodeAt(i);var v=code-48;if(v<0||y<=v){v=10-65+code;if(v<10||radix<=v){v=10-97+code;if(v<10||radix<=v){throw new RangeError();}}}
n=n*radix+v;}
return n;};var createArray=function(length){var x=new Array(length);var i=-1;while(++i<length){x[i]=0;}
return x;};var pow=function(x,count){var accumulator=1;var v=x;var c=count;while(c>1){var q=Math.floor(c / 2);if(q*2!==c){accumulator*=v;}
v*=v;c=q;}
return accumulator*v;};var epsilon=2 /(9007199254740991+1);while(1+epsilon / 2!==1){epsilon /=2;}
var BASE=2 / epsilon;var s=134217728;while(s*s<2 / epsilon){s*=2;}
var SPLIT=s+1;var fma=function(a,b,product){var at=SPLIT*a;var ahi=at-(at-a);var alo=a-ahi;var bt=SPLIT*b;var bhi=bt-(bt-b);var blo=b-bhi;var error=((ahi*bhi+product)+ahi*blo+alo*bhi)+alo*blo;return error;};var fastTrunc=function(x){var v=(x-BASE)+BASE;return v>x?v-1:v;};var performMultiplication=function(carry,a,b){var product=a*b;var error=fma(a,b,-product);var hi=fastTrunc(product / BASE);var lo=product-hi*BASE+error;if(lo<0){lo+=BASE;hi-=1;}
lo+=carry-BASE;if(lo<0){lo+=BASE;}else{hi+=1;}
return{lo:lo,hi:hi};};var performDivision=function(a,b,divisor){if(a>=divisor){throw new RangeError();}
var p=a*BASE;var q=fastTrunc(p / divisor);var r=0-fma(q,divisor,-p);if(r<0){q-=1;r+=divisor;}
r+=b-divisor;if(r<0){r+=divisor;}else{q+=1;}
var y=fastTrunc(r / divisor);r-=y*divisor;q+=y;return{q:q,r:r};};function BigIntegerInternal(sign,magnitude,length){this.sign=sign;this.magnitude=magnitude;this.length=length;}
var createBigInteger=function(sign,magnitude,length){return new BigIntegerInternal(sign,magnitude,length);};BigIntegerInternal.parseInt=function(s,radix){if(radix==undefined){radix=10;}
if(radix!==10&&(radix<2||radix>36||radix!==Math.floor(radix))){throw new RangeError("radix argument must be an integer between 2 and 36");}
var length=s.length;if(length===0){throw new RangeError();}
var sign=0;var signCharCode=s.charCodeAt(0);var from=0;if(signCharCode===43){from=1;}
if(signCharCode===45){from=1;sign=1;}
length-=from;if(length===0){throw new RangeError();}
if(pow(radix,length)<=BASE){var value=parseInteger(s,from,from+length,radix);var a=createArray(1);a[0]=value;return createBigInteger(value===0?0:sign,a,value===0?0:1);}
var groupLength=0;var groupRadix=1;var limit=fastTrunc(BASE / radix);while(groupRadix<=limit){groupLength+=1;groupRadix*=radix;}
var size=Math.floor((length-1)/ groupLength)+1;var magnitude=createArray(size);var start=from+1+(length-1-(size-1)*groupLength)-groupLength;var j=-1;while(++j<size){var groupStart=start+j*groupLength;var c=parseInteger(s,(groupStart>=from?groupStart:from),groupStart+groupLength,radix);var l=-1;while(++l<j){var tmp=performMultiplication(c,magnitude[l],groupRadix);var lo=tmp.lo;var hi=tmp.hi;magnitude[l]=lo;c=hi;}
magnitude[j]=c;}
while(size>0&&magnitude[size-1]===0){size-=1;}
return createBigInteger(size===0?0:sign,magnitude,size);};var compareMagnitude=function(a,b){if(a.length!==b.length){return a.length<b.length?-1:+1;}
var i=a.length;while(--i>=0){if(a.magnitude[i]!==b.magnitude[i]){return a.magnitude[i]<b.magnitude[i]?-1:+1;}}
return 0;};BigIntegerInternal.compareTo=function(a,b){var c=a.sign===b.sign?compareMagnitude(a,b):1;return a.sign===1?0-c:c;};BigIntegerInternal.addAndSubtract=function(a,b,isSubtraction){var z=compareMagnitude(a,b);var resultSign=z<0?(isSubtraction!==0?1-b.sign:b.sign):a.sign;var min=z<0?a:b;var max=z<0?b:a;if(min.length===0){return createBigInteger(resultSign,max.magnitude,max.length);}
var subtract=0;var resultLength=max.length;if(a.sign!==(isSubtraction!==0?1-b.sign:b.sign)){subtract=1;if(min.length===resultLength){while(resultLength>0&&min.magnitude[resultLength-1]===max.magnitude[resultLength-1]){resultLength-=1;}}
if(resultLength===0){return createBigInteger(0,createArray(0),0);}}
var result=createArray(resultLength+(1-subtract));var i=-1;var c=0;while(++i<resultLength){var aDigit=i<min.length?min.magnitude[i]:0;c+=max.magnitude[i]+(subtract!==0?0-aDigit:aDigit-BASE);if(c<0){result[i]=BASE+c;c=0-subtract;}else{result[i]=c;c=1-subtract;}}
if(subtract===0){result[resultLength]=c;resultLength+=c!==0?1:0;}else{while(resultLength>0&&result[resultLength-1]===0){resultLength-=1;}}
return createBigInteger(resultSign,result,resultLength);};BigIntegerInternal.add=function(a,b){return BigIntegerInternal.addAndSubtract(a,b,0);};BigIntegerInternal.subtract=function(a,b){return BigIntegerInternal.addAndSubtract(a,b,1);};BigIntegerInternal.multiply=function(a,b){if(a.length===0||b.length===0){return createBigInteger(0,createArray(0),0);}
var resultSign=a.sign===1?1-b.sign:b.sign;if(a.length===1&&a.magnitude[0]===1){return createBigInteger(resultSign,b.magnitude,b.length);}
if(b.length===1&&b.magnitude[0]===1){return createBigInteger(resultSign,a.magnitude,a.length);}
var resultLength=a.length+b.length;var result=createArray(resultLength);var k=-1;while(++k<a.length){result[k]=0;}
var i=-1;while(++i<b.length){var c=0;var j=-1;while(++j<a.length){var carry=0;c+=result[j+i]-BASE;if(c>=0){carry=1;}else{c+=BASE;}
var tmp=performMultiplication(c,a.magnitude[j],b.magnitude[i]);var lo=tmp.lo;var hi=tmp.hi;result[j+i]=lo;c=hi+carry;}
result[a.length+i]=c;}
while(resultLength>0&&result[resultLength-1]===0){resultLength-=1;}
return createBigInteger(resultSign,result,resultLength);};BigIntegerInternal.divideAndRemainder=function(a,b,isDivision){if(b.length===0){throw new RangeError();}
if(a.length===0){return createBigInteger(0,createArray(0),0);}
var quotientSign=a.sign===1?1-b.sign:b.sign;if(b.length===1&&b.magnitude[0]===1){if(isDivision!==0){return createBigInteger(quotientSign,a.magnitude,a.length);}
return createBigInteger(0,createArray(0),0);}
var divisorOffset=a.length+1;var divisorAndRemainder=createArray(divisorOffset+b.length+1);var divisor=divisorAndRemainder;var remainder=divisorAndRemainder;var n=-1;while(++n<a.length){remainder[n]=a.magnitude[n];}
remainder[a.length]=0;var m=-1;while(++m<b.length){divisor[divisorOffset+m]=b.magnitude[m];}
divisor[divisorOffset+b.length]=0;var top=divisor[divisorOffset+b.length-1];var lambda=1;if(b.length>1){lambda=fastTrunc(BASE /(top+1));if(lambda>1){var carry=0;var l=-1;while(++l<divisorOffset+b.length){var tmp=performMultiplication(carry,divisorAndRemainder[l],lambda);var lo=tmp.lo;var hi=tmp.hi;divisorAndRemainder[l]=lo;carry=hi;}
divisorAndRemainder[divisorOffset+b.length]=carry;top=divisor[divisorOffset+b.length-1];}
if(top<fastTrunc(BASE / 2)){throw new RangeError();}}
var shift=a.length-b.length+1;if(shift<0){shift=0;}
var quotient=undefined;var quotientLength=0;var i=shift;while(--i>=0){var t=b.length+i;var q=BASE-1;if(remainder[t]!==top){var tmp2=performDivision(remainder[t],remainder[t-1],top);var q2=tmp2.q;q=q2;}
var ax=0;var bx=0;var j=i-1;while(++j<=t){var rj=remainder[j];var tmp3=performMultiplication(bx,q,divisor[divisorOffset+j-i]);var lo3=tmp3.lo;var hi3=tmp3.hi;remainder[j]=lo3;bx=hi3;ax+=rj-remainder[j];if(ax<0){remainder[j]=BASE+ax;ax=-1;}else{remainder[j]=ax;ax=0;}}
while(ax!==0){q-=1;var c=0;var k=i-1;while(++k<=t){c+=remainder[k]-BASE+divisor[divisorOffset+k-i];if(c<0){remainder[k]=BASE+c;c=0;}else{remainder[k]=c;c=+1;}}
ax+=c;}
if(isDivision!==0&&q!==0){if(quotientLength===0){quotientLength=i+1;quotient=createArray(quotientLength);}
quotient[i]=q;}}
if(isDivision!==0){if(quotientLength===0){return createBigInteger(0,createArray(0),0);}
return createBigInteger(quotientSign,quotient,quotientLength);}
var remainderLength=a.length+1;if(lambda>1){var r=0;var p=remainderLength;while(--p>=0){var tmp4=performDivision(r,remainder[p],lambda);var q4=tmp4.q;var r4=tmp4.r;remainder[p]=q4;r=r4;}
if(r!==0){throw new RangeError();}}
while(remainderLength>0&&remainder[remainderLength-1]===0){remainderLength-=1;}
if(remainderLength===0){return createBigInteger(0,createArray(0),0);}
var result=createArray(remainderLength);var o=-1;while(++o<remainderLength){result[o]=remainder[o];}
return createBigInteger(a.sign,result,remainderLength);};BigIntegerInternal.divide=function(a,b){return BigIntegerInternal.divideAndRemainder(a,b,1);};BigIntegerInternal.remainder=function(a,b){return BigIntegerInternal.divideAndRemainder(a,b,0);};BigIntegerInternal.negate=function(a){return createBigInteger(a.length===0?a.sign:1-a.sign,a.magnitude,a.length);};BigIntegerInternal.prototype.toString=function(radix){if(radix==undefined){radix=10;}
if(radix!==10&&(radix<2||radix>36||radix!==Math.floor(radix))){throw new RangeError("radix argument must be an integer between 2 and 36");}
var a=this;var result=a.sign===1?"-":"";var remainderLength=a.length;if(remainderLength===0){return"0";}
if(remainderLength===1){result+=a.magnitude[0].toString(radix);return result;}
var groupLength=0;var groupRadix=1;var limit=fastTrunc(BASE / radix);while(groupRadix<=limit){groupLength+=1;groupRadix*=radix;}
if(groupRadix*radix<=BASE){throw new RangeError();}
var size=remainderLength+Math.floor((remainderLength-1)/ groupLength)+1;var remainder=createArray(size);var n=-1;while(++n<remainderLength){remainder[n]=a.magnitude[n];}
var k=size;while(remainderLength!==0){var groupDigit=0;var i=remainderLength;while(--i>=0){var tmp=performDivision(groupDigit,remainder[i],groupRadix);var q=tmp.q;var r=tmp.r;remainder[i]=q;groupDigit=r;}
while(remainderLength>0&&remainder[remainderLength-1]===0){remainderLength-=1;}
k-=1;remainder[k]=groupDigit;}
result+=remainder[k].toString(radix);while(++k<size){var t=remainder[k].toString(radix);var j=groupLength-t.length;while(--j>=0){result+="0";}
result+=t;}
return result;};BigIntegerInternal.fromNumber=function(x){var a=createArray(1);a[0]=x<0?0-x:0+x;return createBigInteger(x<0?1:0,a,x===0?0:1);};BigIntegerInternal.isSafeInteger=function(a){return a.length<2;};BigIntegerInternal.toNumber=function(a){if(a.length===0){return 0;}
if(a.length===1){return a.sign===1?0-a.magnitude[0]:a.magnitude[0];}
throw new RangeError();};var n=function(f){return function(x,y){return f(x,y);};};var parseInt=n(function(string,radix){return BigIntegerInternal.parseInt(string,radix);});var valueOf=function(x){if(typeof x==="number"){return BigIntegerInternal.fromNumber(x);}
return x;};var compareTo=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return BigIntegerInternal.compareTo(a,b);});var toResult=function(x){if(BigIntegerInternal.isSafeInteger(x)){return BigIntegerInternal.toNumber(x);}
return x;};var add=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return toResult(BigIntegerInternal.add(a,b));});var subtract=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return toResult(BigIntegerInternal.subtract(a,b));});var multiply=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return toResult(BigIntegerInternal.multiply(a,b));});var divide=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return toResult(BigIntegerInternal.divide(a,b));});var remainder=n(function(x,y){var a=valueOf(x);var b=valueOf(y);return toResult(BigIntegerInternal.remainder(a,b));});var negate=n(function(x){var a=valueOf(x);return toResult(BigIntegerInternal.negate(a));});function BigInteger(){}
BigInteger.parseInt=function(string,radix){if(typeof string==="string"&&typeof radix==="number"){var value=0+Number.parseInt(string,radix);if(value>=-9007199254740991&&value<=+9007199254740991){return value;}}
return parseInt(string,radix);};BigInteger.compareTo=function(x,y){if(typeof x==="number"&&typeof y==="number"){return x<y?-1:(y<x?+1:0);}
return compareTo(x,y);};BigInteger.add=function(x,y){if(typeof x==="number"&&typeof y==="number"){var value=x+y;if(value>=-9007199254740991&&value<=+9007199254740991){return value;}}
return add(x,y);};BigInteger.subtract=function(x,y){if(typeof x==="number"&&typeof y==="number"){var value=x-y;if(value>=-9007199254740991&&value<=+9007199254740991){return value;}}
return subtract(x,y);};BigInteger.multiply=function(x,y){if(typeof x==="number"&&typeof y==="number"){var value=0+x*y;if(value>=-9007199254740991&&value<=+9007199254740991){return value;}}
return multiply(x,y);};BigInteger.divide=function(x,y){if(typeof x==="number"&&typeof y==="number"){if(y!==0){return x===0?0:(x>0&&y>0)||(x<0&&y<0)?0+Math.floor(x / y):0-Math.floor((0-x)/ y);}}
return divide(x,y);};BigInteger.remainder=function(x,y){if(typeof x==="number"&&typeof y==="number"){if(y!==0){return 0+x%y;}}
return remainder(x,y);};BigInteger.negate=function(x){if(typeof x==="number"){return 0-x;}
return negate(x);};global.BigInteger=BigInteger;}(this));(function(global){"use strict";var pow=function(x,count,accumulator){if(count<0){throw new RangeError();}
if(count>9007199254740991){throw new RangeError("UserError");}
return(count<1?accumulator:(2*Math.floor(count / 2)!==count?pow(x,count-1,accumulator.multiply(x)):pow(x.multiply(x),Math.floor(count / 2),accumulator)));};var enableEX=true;Expression.prototype.powExpression=function(x){var y=this;if(x instanceof Matrix&&y instanceof Symbol&&(y.symbol==="t"||y.symbol==="T")){return x.transpose();}
if(y instanceof Division&&y.a instanceof Integer&&y.b instanceof Integer){if(global.hit!=undefined){global.hit({powExpression:y.toString()});}
var n=Number.parseInt(y.b.toString(),10);var q=y.a.truncatingDivide(y.b);var r=y.a.subtract(q.multiply(y.b));return x.pow(q).multiply(x.pow(r)._nthRoot(n));}
if(enableEX){if(x===Expression.E){var isValid=function(y){if(y instanceof Addition){return isValid(y.a)&&isValid(y.b);}
if(y instanceof Integer){return true;}
return(y instanceof Symbol||y instanceof Multiplication&&y.a instanceof Integer&&y.b instanceof Symbol);};if(isValid(y)){if(y instanceof Multiplication&&y.a instanceof Integer&&y.a.compareTo(Integer.ZERO)<0){return Integer.ONE.divide(new Expression.Exponentiation(x,y.negate()));}
return new Expression.Exponentiation(x,y);}}}
throw new RangeError("UserError");};Expression.prototype.compare4Addition=function(y){var x=this;if(x instanceof Symbol&&y instanceof Integer){return+1;}
if(x instanceof Integer&&y instanceof Symbol){return-1;}
if(x instanceof Integer&&y instanceof Integer){return x.compareTo(y);}
if(x instanceof Symbol&&y instanceof Symbol){return x.symbol<y.symbol?-1:(y.symbol<x.symbol?+1:0);}
if(x instanceof Matrix&&y instanceof MatrixSymbol){return+1;}
if(x instanceof MatrixSymbol&&y instanceof Matrix){return-1;}
if(x instanceof Matrix&&y instanceof Matrix){return 0;}
if(x instanceof Addition||y instanceof Addition){return Addition.compare4Addition(x,y);}
if(x instanceof Multiplication||y instanceof Multiplication){return Multiplication.compare4Addition(x,y);}
if(x instanceof Matrix||y instanceof Symbol){return-1;}
throw new RangeError();};var compare=function(x,y){return x.compare4Addition(y);};var compare4Multiplication=function(x,y){return x.compare4Multiplication(y);};var getBase=function(x){return x instanceof Exponentiation?x.a:x;};var getExponent=function(x){return x instanceof Exponentiation?x.b:Integer.ONE;};var getConstant=function(x){if(x instanceof Integer){return x;}else if(x instanceof Expression.Complex){return x;}else if(x instanceof Multiplication){var c=undefined;for(var i=x.factors();i.value()!=undefined;i=i.next()){var t=getConstant(i.value());c=c==undefined?t:t.multiply(c);}
if(c!=undefined){return c;}}else if(x instanceof Addition){var c=undefined;for(var i=x.summands();i.value()!=undefined;i=i.next()){var t=getConstant(i.value());c=c==undefined?t:integerGCD(t,c);}
if(c!=undefined){return c;}}
return Integer.ONE;};var getTerm=function(x){if(x instanceof Integer){return undefined;}else if(x instanceof Expression.Complex){return undefined;}else if(x instanceof Multiplication){var terms=[];for(var i=x.factors();i.value()!=undefined;i=i.next()){var t=getTerm(i.value());if(t!=undefined){terms.push(t);}}
var result=undefined;for(var j=terms.length-1;j>=0;j-=1){result=result==undefined?terms[j]:new Multiplication(result,terms[j]);}
return result;}
return x;};var multiplyByInteger=function(x,y){if(x.compareTo(Integer.ZERO)===0){return x;}
if(x.compareTo(Integer.ONE)===0){return y;}
return new Multiplication(x,y);};Expression.prototype.multiplyExpression=function(x){var y=this;if(x instanceof IdentityMatrix&&y instanceof MatrixSymbol){return y;}
if(y instanceof IdentityMatrix&&x instanceof MatrixSymbol){return x;}
var c=0;if(x instanceof Integer&&y instanceof Symbol){return multiplyByInteger(x,y);}
if(x instanceof Symbol&&y instanceof Integer){return multiplyByInteger(y,x);}
if(x instanceof Symbol&&y instanceof Symbol){c=compare4Multiplication(x,y);if(c===0){return x.pow(Integer.TWO);}
return c>0?new Multiplication(y,x):new Multiplication(x,y);}
if(x instanceof Integer&&y instanceof Exponentiation){return multiplyByInteger(x,y);}
if(x instanceof Exponentiation&&y instanceof Integer){return multiplyByInteger(y,x);}
if(x instanceof Exponentiation&&y instanceof Symbol){c=compare4Multiplication(getBase(x),y);if(c===0){return y.pow(getExponent(x).add(Integer.ONE));}
return c>0?new Multiplication(y,x):new Multiplication(x,y);}
if(x instanceof Symbol&&y instanceof Exponentiation){c=compare4Multiplication(x,getBase(y));if(c===0){return x.pow(getExponent(y).add(Integer.ONE));}
return c>0?new Multiplication(y,x):new Multiplication(x,y);}
if(x instanceof Exponentiation&&y instanceof Exponentiation){c=compare4Multiplication(getBase(x),getBase(y));if(c===0){return getBase(x).pow(getExponent(x).add(getExponent(y)));}
return c>0?new Multiplication(y,x):new Multiplication(x,y);}
if(x instanceof SquareRoot&&y instanceof SquareRoot){return x.a.multiply(y.a).squareRoot();}
if(x instanceof CubeRoot&&y instanceof CubeRoot){return x.a.multiply(y.a).cubeRoot();}
if(x instanceof NthRoot&&y instanceof NthRoot){if(x.n===y.n){return x.a.multiply(y.a)._nthRoot(x.n);}
return x.n<y.n?new Multiplication(x,y):new Multiplication(y,x);}
if(x instanceof MatrixSymbol&&y instanceof Matrix){return new Multiplication(x,y);}
if(x instanceof Matrix&&y instanceof MatrixSymbol){return new Multiplication(x,y);}
if(x instanceof Integer&&y instanceof Expression){if(x.compareTo(Integer.ZERO)===0){return x;}
if(x.compareTo(Integer.ONE)===0){return y;}}
if(x instanceof Expression&&y instanceof Integer){if(y.compareTo(Integer.ZERO)===0){return y;}
if(y.compareTo(Integer.ONE)===0){return x;}}
var cmp=compare4Multiplication(getBase(x),getBase(y));if(cmp===0){return getBase(x).pow(getExponent(x).add(getExponent(y)));}
if(cmp<0){return new Multiplication(x,y);}
if(cmp>0){return new Multiplication(y,x);}};var compare4Addition=function(x,y){if(x==undefined&&y==undefined){return 0;}
if(x==undefined){return-1;}
if(y==undefined){return+1;}
var xIterator=x.factors();var yIterator=y.factors();while(true){var fx=xIterator.value();xIterator=xIterator.next();var fy=yIterator.value();yIterator=yIterator.next();if(fx==undefined&&fy==undefined){return 0;}
if(fx==undefined){return-1;}
if(fy==undefined){return+1;}
var cmp=0-compare(getBase(fx),getBase(fy));if(cmp===0){cmp=compare(getExponent(fx),getExponent(fy));}
if(cmp!==0){return cmp;}}};Expression.prototype.addExpression=function(x){var y=this;if(x instanceof Expression&&y instanceof Addition){return x.add(y.a).add(y.b);}
if(x instanceof Addition&&y instanceof Expression){var c=compare4Addition(getTerm(x.b),getTerm(y));if(c===0){return x.a.add(x.b.add(y));}
if(y.equals(Integer.ZERO)){return x;}
return c>0?new Addition(x,y):x.a.add(y).add(x.b);}
var fxTerm=getTerm(x);var fyTerm=getTerm(y);var cmp=compare4Addition(fxTerm,fyTerm);if(cmp===0){var constant=getConstant(x).add(getConstant(y));var last=fxTerm==undefined?constant:constant.multiply(fxTerm);return last;}
if(cmp>0){var tmp=x;x=y;y=tmp;}
if(x.equals(Integer.ZERO)){return y;}
if(y.equals(Integer.ZERO)){return x;}
return new Addition(y,x);};var checkMultivariatePolynomial=function(e,d){return true;if(d<1&&e instanceof Addition){return checkMultivariatePolynomial(e.a,0)&&checkMultivariatePolynomial(e.b,1);}
if(d<2&&e instanceof Integer){return true;}
if(d<2&&e instanceof Multiplication&&(e.a instanceof Integer||e.a instanceof Symbol)){return checkMultivariatePolynomial(e.b,2);}
if(d<3&&e instanceof Multiplication){return(e.a instanceof Symbol)&&checkMultivariatePolynomial(e.b,2);}
if(d<4&&e instanceof Exponentiation){return(e.a instanceof Symbol)&&(e.b instanceof Integer)&&e.b.compareTo(Integer.ZERO)>0;}
if(e instanceof Symbol){return true;}
return false;};var pseudoRemainder=function(x,y){var lcg=y.getLeadingCoefficient();var n=x.getDegree()-y.getDegree();if(n<0){throw new RangeError();}
var sx=x.multiply(Polynom.of(lcg.pow(Integer.parseInteger(n.toString()).add(Integer.ONE))));return sx.divideAndRemainder(y,"throw").remainder;};var divideByInteger=function(x,f){if(f.equals(Integer.ZERO)){throw new RangeError("ArithmeticException");}
var result=Integer.ZERO;for(var additions=x.summands();additions.value()!=undefined;additions=additions.next()){var fx=additions.value();var rest=Integer.ONE;var t=undefined;for(var multiplications=fx.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var z=multiplications.value();if(z instanceof Integer){t=z;}else if(z instanceof Expression.Complex){t=z;}else{if(rest===Integer.ONE){rest=z;}else{rest=z.multiply(rest);}}}
if(!(t instanceof Expression.Complex)){if(!(t instanceof Integer)){throw new RangeError();}}
result=result.add(t.truncatingDivide(f).multiply(rest));}
return result;};Expression.getCoefficients=function(x,v){var result=[];for(var additions=x.summands();additions.value()!=undefined;additions=additions.next()){var fx=additions.value();var d=Integer.ZERO;var c=Integer.ONE;for(var multiplications=fx.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var t=multiplications.value();for(var variables=getVariableInternal(t);variables.value()!=undefined;variables=variables.next()){var ve=variables.value();if(ve.v.equals(v)){d=d.add(ve.e);}else{c=c.multiply(ve.e===Integer.ONE?ve.v:ve.v.pow(ve.e));}}}
var tmp={coefficient:c,degree:d};var k=result.length-1;while(k>=0&&tmp.degree.compareTo(result[k].degree)<0){k-=1;}
if(k>=0&&tmp.degree.compareTo(result[k].degree)===0){result[k].coefficient=tmp.coefficient.add(result[k].coefficient);}else{result.push(tmp);var i=result.length-1;while(i>=k+2){result[i]=result[i-1];i-=1;}
result[k+1]=tmp;}}
return result;};var getFirstAdditionOperand=function(x){var result=x;while(result instanceof Addition){result=result.a;}
return result;};var getLastMultiplicationOperand=function(x){var result=x;while(result instanceof Multiplication){result=result.b;}
return result;};function VIterator(v){this.v=v;}
VIterator.prototype.next=function(){return new VIterator(undefined);};VIterator.prototype.value=function(){return this.v;};function VariablesIterator(v,additions){this.v=v;this.additions=additions;}
VariablesIterator.prototype.next=function(){return new VariablesIterator(this.v,this.additions.next());};VariablesIterator.prototype.value=function(){var x=this.additions.value();if(x==undefined){return undefined;}else if(x instanceof Symbol){return{v:new Exponentiation(this.v,x),e:Integer.ONE};}else if(x instanceof Multiplication&&x.a instanceof Integer&&x.b instanceof Symbol){return{v:new Exponentiation(this.v,x.b),e:x.a};}else if(x instanceof Integer){return{v:this.v,e:x};}else{throw new RangeError();}};var getVariableInternal=function(t){var v=getBase(t);var e=getExponent(t);if(enableEX){if(!(e instanceof Integer)){var additions=e.summands();return new VariablesIterator(v,additions);}}
return new VIterator({v:v,e:e});};var getVariable=function(e){for(var additions=e.summands();additions.value()!=undefined;additions=additions.next()){var x=additions.value();for(var multiplications=x.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var y=multiplications.value();if(y instanceof NthRoot){return y;}}}
var result=getVariableInternal(getLastMultiplicationOperand(getFirstAdditionOperand(e))).value().v;if(result instanceof Expression.Complex){return undefined;}
if(result instanceof Integer){return undefined;}
return result;};Expression.getVariable=getVariable;var integerGCD=function(a,b){if(a.compareTo(Integer.ZERO)<0){a=a.negate();}
if(b.compareTo(Integer.ZERO)<0){b=b.negate();}
var t=undefined;while(b.compareTo(Integer.ZERO)!==0){t=a.remainder(b);a=b;b=t;}
return a;};var complexGCD=function(a,b){return integerGCD(a instanceof Expression.Complex?integerGCD(a.real,a.imaginary):a,b instanceof Expression.Complex?integerGCD(b.real,b.imaginary):b);};var gcd=function(a,b,v){if(v==undefined){if(getVariable(a)!=undefined){return gcd(a,b,getVariable(a));}
if(getVariable(b)!=undefined){return gcd(a,b,getVariable(b));}
return complexGCD(getConstant(a),getConstant(b));}
return polynomialGCD(Polynom.toPolynomial(a,v),Polynom.toPolynomial(b,v)).calcAt(v);};var polynomialGCD=function(a,b){if(a.getDegree()<b.getDegree()){var tmp=a;a=b;b=tmp;}
var contentA=a.getContent();var contentB=b.getContent();var ppA=a.divideAndRemainder(Polynom.of(contentA),"throw").quotient;var ppB=b.divideAndRemainder(Polynom.of(contentB),"throw").quotient;var A=ppA;var B=ppB;while(!B.equals(Polynom.ZERO)){var r=pseudoRemainder(A,B);A=B;B=r;}
var c=gcd(contentA,contentB);return Polynom.of(c).multiply(A.divideAndRemainder(Polynom.of(A.getContent()),"throw").quotient);};var getConjugateFactor=function(a){var r=1 / 0;var p=undefined;for(var additions=a.summands();additions.value()!=undefined;additions=additions.next()){var x=additions.value();for(var multiplications=x.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var y=multiplications.value();if(y instanceof NthRoot){var degree=y.getDegree();if(r>degree){p=y.a;r=degree;}else if(r===degree){var z=integerGCD(p,y.a);if(z.compareTo(Integer.ONE)!==0){p=z;}}}}}
return{p:p,r:r};};var getConjugate=function(a){var e=undefined;e=Expression.getComplexConjugate(a);if(e!=undefined){return e;}
e=Expression.getNthRootConjugate(a);if(e!=undefined){return e;}
return undefined;};Expression.getNthRootConjugate=function(a){var tmp=getConjugateFactor(a);var p=tmp.p;var r=tmp.r;if(p==undefined){return undefined;}
var up=Integer.ZERO;var v=Integer.ZERO;for(var additions=a.summands();additions.value()!=undefined;additions=additions.next()){var x=additions.value();var ok=false;for(var multiplications=x.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var y=multiplications.value();if(y instanceof NthRoot&&r===y.getDegree()){var z=integerGCD(p,y.a);if(z.compareTo(Integer.ONE)!==0){ok=true;}}}
if(ok){v=v.add(x);}else{up=up.add(x);}}
var conjugate=Integer.ZERO;for(var k=0;k<r;k+=1){var t=pow(Integer.ONE.negate(),k,Integer.ONE).multiply(pow(up,r-1-k,Integer.ONE)).multiply(pow(v,k,Integer.ONE));conjugate=conjugate.add(t);}
return conjugate;};Expression.fillLinearEquationVariablesMap=function(e,onVariable){if(e instanceof Division){throw new RangeError();}
for(var additions=e.summands();additions.value()!=undefined;additions=additions.next()){var x=additions.value();var v=undefined;var c=Integer.ONE;for(var multiplications=x.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var y=multiplications.value();if(y instanceof Exponentiation){throw new RangeError();}else if(y instanceof Symbol){if(v!=undefined){throw new RangeError();}
v=y;}else{if(!(y instanceof Integer)&&!(y instanceof NthRoot)){throw new RangeError();}
c=c.multiply(y);}}
var variable=v==undefined?"":v.toString();onVariable(c,variable);}};var has=function(e,Class){if(e instanceof Class){return true;}
if(e instanceof BinaryOperation){return has(e.a,Class)||has(e.b,Class);}
if(e instanceof Negation){return has(e.b,Class);}
if(e instanceof Expression.Function){return has(e.a,Class);}
return false;};Expression.has=has;Expression.prototype.divideExpression=function(x,allowConjugate){allowConjugate=allowConjugate==undefined?true:allowConjugate;var y=this;if(has(x,IdentityMatrix)){throw new RangeError("NotSupportedError");}
if(has(y,MatrixSymbol)){throw new RangeError("NotSupportedError");}
if(x instanceof Matrix&&y instanceof Matrix){return new Matrix(x.matrix.multiply(y.matrix.inverse()));}
if(x instanceof Matrix&&y instanceof Expression){return new Matrix(x.matrix.scale(y.inverse()));}
if(x instanceof Expression&&y instanceof Matrix){if(Expression.callback!=undefined){Expression.callback(new Expression.Event(y.matrix.getDeterminantEventType("inverse").type,y));}
return new Matrix(y.matrix.inverse().scale(x));}
if(y.equals(Integer.ZERO)){throw new RangeError("ArithmeticException");}
if(x.equals(Integer.ZERO)){return Integer.ZERO;}
if(y.equals(Integer.ONE)){return x;}
if(!checkMultivariatePolynomial(x,0)){throw new RangeError();}
if(!checkMultivariatePolynomial(y,0)){throw new RangeError();}
if(allowConjugate){var e=getConjugate(y);if(e!=undefined){return x.multiply(e).divide(y.multiply(e));}}
if(true){var c=Expression.getComplexConjugate(x);if(c!=undefined){var a=x.add(c).divide(Integer.TWO);var b=x.subtract(c).multiply(Expression.I.negate()).divide(Integer.TWO);var g=gcd(a.equals(Integer.ZERO)?y:gcd(a,y),b.equals(Integer.ZERO)?y:gcd(b,y));if(!g.equals(Integer.ONE)){x=a.divide(g).add(b.divide(g).multiply(Expression.I));y=y.divide(g);}
if(y.isNegative()){x=x.negate();y=y.negate();}
return y.equals(Integer.ONE)?x:new Division(x,y);}}
var v=getVariable(x);if(v==undefined){var g=complexGCD(getConstant(x),getConstant(y));if(!g.equals(Integer.ONE)){x=divideByInteger(x,g);y=divideByInteger(y,g);return x.divide(y,false);}}else{var px=Polynom.toPolynomial(x,v);var py=Polynom.toPolynomial(y,v);var g=polynomialGCD(px,py);if(g.getDegree()!==0||!g.getLeadingCoefficient().equals(Integer.ONE)){var x2=px.divideAndRemainder(g,"throw").quotient;var y2=py.divideAndRemainder(g,"throw").quotient;return x2.calcAt(v).divide(y2.calcAt(v),false);}}
var lc=getConstant(getFirstAdditionOperand(y));if(lc.compareTo(Integer.ZERO)<0){return x.negate().divide(y.negate(),false);}
return new Division(x,y);};function Expression(){throw new Error("Do not call for better performance");}
Expression.callback=undefined;Expression.Event=function(type,data,second){second=second==undefined?undefined:second;this.type=type;this.data=data;this.second=second;};Expression.prototype.compare4Multiplication=function(y){throw new Error(this.toString());};Expression.prototype.compare4MultiplicationInteger=function(x){throw new Error();};Expression.prototype.compare4MultiplicationSymbol=function(x){throw new Error();};Expression.prototype.compare4MultiplicationNthRoot=function(x){throw new Error();};Expression.prototype.negate=function(){return Integer.ONE.negate().multiply(this);};Expression.prototype.add=function(y){return y.addExpression(this);};Expression.prototype.subtract=function(y){return this.add(y.negate());};Expression.prototype.divide=function(y,allowConjugate){return y.divideExpression(this,allowConjugate);};Expression.prototype.multiply=function(y){return y.multiplyExpression(this);};Expression.prototype.pow=function(y){return y.powExpression(this);};Expression.prototype.getDenominator=function(){return this instanceof Division?this.b:Integer.ONE;};Expression.prototype.getNumerator=function(){return this instanceof Division?this.a:this;};Expression.prototype.inverse=function(){return Integer.ONE.divide(this);};Expression.prototype.gcd=function(x){return gcd(this,x,getVariable(this));};Expression.prototype.lcm=function(x){return this.divide(this.gcd(x)).multiply(x);};var precedence={binary:{".^":5,"^":5,"*":3,"/":3,"+":2,"-":2},unary:{"-":5}};function Symbol(symbol){this.symbol=symbol;}
Symbol.prototype=Object.create(Expression.prototype);Symbol.prototype.compare4Multiplication=function(y){return y.compare4MultiplicationSymbol(this);};Symbol.prototype.compare4MultiplicationInteger=function(x){return-1;};Symbol.prototype.compare4MultiplicationSymbol=function(x){return x.symbol<this.symbol?-1:(this.symbol<x.symbol?+1:0);};Symbol.prototype.compare4MultiplicationNthRoot=function(x){return-1;};Symbol.prototype.toString=function(options){return this.symbol;};Expression.prototype.addInteger=function(x){return this.addExpression(x);};Expression.prototype.multiplyInteger=function(x){return this.multiplyExpression(x);};Expression.prototype.divideInteger=function(x){return this.divideExpression(x);};function Integer(value){this.value=value;}
Integer.prototype=Object.create(Expression.prototype);Integer.prototype.powExpression=function(x){var y=this;if(x instanceof IdentityMatrix){return new IdentityMatrix(x.symbol);}
if(x instanceof MatrixSymbol){if(y.equals(Integer.ZERO)){return Integer.ONE;}
return new Exponentiation(x,y);}
if(y.compareTo(Integer.ZERO)<0){return Integer.ONE.divide(x.pow(y.negate()));}
if(x instanceof Matrix){if(y.compareTo(Integer.ONE)>0){if(Expression.callback!=undefined){Expression.callback(new Expression.Event("pow",x,new Expression.Matrix(self.Matrix.I(1).map(function(){return y;}))));}}
return new Matrix(pow(x.matrix,Number.parseInt(y.toString(),10),self.Matrix.I(x.matrix.rows())));}
if(y.equals(Integer.ZERO)){return Integer.ONE;}
if(y.equals(Integer.ONE)){return x;}
if(x instanceof Symbol){return new Exponentiation(x,y);}
if(x instanceof Exponentiation){return x.a.pow(x.b.multiply(y));}
if(x instanceof Integer&&(x.compareTo(Integer.ZERO)===0||x.compareTo(Integer.ONE)===0||x.compareTo(Integer.ONE.negate())===0)){return y.remainder(Integer.TWO).compareTo(Integer.ZERO)===0?x.multiply(x):x;}
return pow(x,Number.parseInt(y.toString(),10),Integer.ONE);};Integer.prototype.compare4Multiplication=function(y){return y.compare4MultiplicationInteger(this);};Integer.prototype.compare4MultiplicationInteger=function(x){return x.compareTo(this);};Integer.prototype.compare4MultiplicationSymbol=function(x){return+1;};Integer.prototype.compare4MultiplicationNthRoot=function(x){return+1;};Integer.prototype.negate=function(){return new Integer(BigInteger.negate(this.value));};Integer.prototype.compareTo=function(y){return BigInteger.compareTo(this.value,y.value);};Integer.prototype.add=function(y){return y.addInteger(this);};Integer.prototype.addInteger=function(x){return new Integer(BigInteger.add(x.value,this.value));};Integer.prototype.multiply=function(y){return y.multiplyInteger(this);};Integer.prototype.multiplyInteger=function(x){return new Integer(BigInteger.multiply(x.value,this.value));};Integer.prototype.divide=function(y,allowConjugate){return y.divideInteger(this,allowConjugate);};Integer.prototype.divideInteger=function(x){var y=this;if(y.equals(Integer.ZERO)){throw new RangeError("ArithmeticException");}
var gInteger=integerGCD(x,y);if(y.compareTo(Integer.ZERO)<0){gInteger=gInteger.negate();}
x=x.truncatingDivide(gInteger);y=y.truncatingDivide(gInteger);return y.compareTo(Integer.ONE)===0?x:new Division(x,y);};Integer.prototype.truncatingDivide=function(y){return new Integer(BigInteger.divide(this.value,y.value));};Integer.prototype.remainder=function(y){return new Integer(BigInteger.remainder(this.value,y.value));};Integer.prototype.toString=function(options){return this.value.toString();};Integer.parseInteger=function(s){return new Integer(BigInteger.parseInt(s,10));};Integer.ZERO=Integer.parseInteger("0");Integer.ONE=Integer.parseInteger("1");Integer.TWO=Integer.parseInteger("2");Integer.TEN=Integer.parseInteger("10");function Matrix(matrix){this.matrix=matrix;}
Matrix.prototype=Object.create(Expression.prototype);Matrix.prototype.equals=function(x){if(x instanceof Integer){return false;}
throw new RangeError("NotSupportedError");};Matrix.prototype.compare4Multiplication=function(x){if(x instanceof Matrix){return 0;}
return+1;};Matrix.prototype.compare4MultiplicationNthRoot=function(x){return+1;};Matrix.prototype.multiply=function(y){return y.multiplyMatrix(this);};Expression.prototype.multiplyMatrix=function(x){var t=getIdentityMatrixCoefficient(this);if(t!=undefined){return new Matrix(x.matrix.scale(t));}
return this.multiplyExpression(x);};Matrix.prototype.multiplyExpression=function(x){var t=getIdentityMatrixCoefficient(x);if(t!=undefined){return new Matrix(this.matrix.scale(t));}
return Expression.prototype.multiplyExpression.call(this,x);};Matrix.prototype.multiplyMatrix=function(x){if(Expression.callback!=undefined){Expression.callback(new Expression.Event("multiply",x,this));}
return new Matrix(x.matrix.multiply(this.matrix));};Matrix.prototype.compare4MultiplicationSymbol=function(x){return+1;};Matrix.prototype.multiplyDivision=Matrix.prototype.multiplyExpression;Matrix.prototype.add=function(y){return y.addMatrix(this);};Matrix.prototype.addMatrix=function(x){return new Matrix(x.matrix.add(this.matrix));};var isScalar=function(x){if(x instanceof Integer){return true;}
if(x instanceof Expression.Complex){return true;}
if(x instanceof MatrixSymbol){return false;}
if(x instanceof Symbol){return true;}
if(x instanceof BinaryOperation){return isScalar(x.a)&&isScalar(x.b);}
if(x instanceof Negation){return isScalar(x.b);}
if(x instanceof Expression.Function){return isScalar(x.a);}
return false;};Expression.isScalar=isScalar;var getIdentityMatrixCoefficient=function(x){var t=undefined;if(x instanceof Multiplication&&x.b instanceof IdentityMatrix){t=x.a;}else if(x instanceof IdentityMatrix){t=Integer.ONE;}else if(isScalar(x)){t=x;}
return t;};Expression.prototype.addMatrix=function(x){var t=getIdentityMatrixCoefficient(this);if(t!=undefined){if(x.matrix.rows()===x.matrix.cols()){return new Matrix(self.Matrix.I(x.matrix.rows()).scale(t)).add(x);}else{throw new RangeError("NotSupportedError");}}
return this.addExpression(x);};Matrix.prototype.addExpression=function(x){var t=getIdentityMatrixCoefficient(x);if(t!=undefined){if(this.matrix.rows()===this.matrix.cols()){return this.add(new Matrix(self.Matrix.I(this.matrix.rows()).scale(t)));}else{throw new RangeError("NotSupportedError");}}
return Expression.prototype.addExpression.call(this,x);};Matrix.prototype.toString=function(options){return this.matrix.toString(setTopLevel(true,options));};function BinaryOperation(a,b){this.a=a;this.b=b;}
BinaryOperation.prototype=Object.create(Expression.prototype);BinaryOperation.prototype.isNegation=function(){return(this instanceof Multiplication&&this.a instanceof Integer&&this.a.equals(Integer.ONE.negate()));};var setTopLevel=function(isTopLevel,options){return options==undefined?{isTopLevel:isTopLevel}:Object.assign({},options,{isTopLevel:isTopLevel});};Expression.setTopLevel=setTopLevel;BinaryOperation.prototype.toString=function(options){var a=this.a;var b=this.b;var isSubtraction=false;if(this instanceof Addition&&b.isNegative()){isSubtraction=true;b=b.negateCarefully();}
var fa=a.getPrecedence()+(a.isRightToLeftAssociative()?-1:0)<this.getPrecedence();var fb=this.getPrecedence()+(this.isRightToLeftAssociative()?-1:0)>=b.getPrecedence();if(options!=undefined&&options.isTopLevel!=undefined&&options.isTopLevel===false){fa=fa||a.isUnaryPlusMinus();}
fb=fb||b.isUnaryPlusMinus();fb=fb||(this.unwrap()instanceof Exponentiation&&b.unwrap()instanceof Exponentiation);fa=fa||(this.unwrap()instanceof Exponentiation&&a.unwrap()instanceof Expression.Function);var s=isSubtraction?"-":this.getS();if(this.isNegation()){return"-"+(fb?"(":"")+b.toString(setTopLevel(fb,options))+(fb?")":"");}
return(fa?"(":"")+a.toString(setTopLevel(fa||options==undefined||options.isTopLevel,options))+(fa?")":"")+s+(fb?"(":"")+b.toString(setTopLevel(fb,options))+(fb?")":"");};Expression.prototype.unwrap=function(){return this;};function Exponentiation(a,b){BinaryOperation.call(this,a,b);}
Exponentiation.prototype=Object.create(BinaryOperation.prototype);function Multiplication(a,b){BinaryOperation.call(this,a,b);}
Multiplication.prototype=Object.create(BinaryOperation.prototype);Multiplication.prototype.multiply=function(y){return y.multiplyMultiplication(this);};Expression.prototype.multiplyMultiplication=function(x){var c=compare4Multiplication(getBase(x.b),getBase(this));if(c===0){return x.a.multiply(x.b.multiply(this));}
return c>0?x.a.multiply(this).multiply(x.b):new Multiplication(x,this);};Multiplication.prototype.multiplyExpression=function(x){return x.multiply(this.a).multiply(this.b);};Multiplication.prototype.multiplyMultiplication=Multiplication.prototype.multiplyExpression;function Negation(b){this.b=b;}
Negation.prototype=Object.create(Expression.prototype);Expression.prototype.equalsNegation=function(x){return false;};Negation.prototype.equalsNegation=function(b){return this.b.equals(b.b);};Negation.prototype.equals=function(b){return b.equalsNegation();};Negation.prototype.toString=function(options){var b=this.b;var fb=this.getPrecedence()+(this.isRightToLeftAssociative()?-1:0)>=b.getPrecedence();fb=fb||b.isUnaryPlusMinus();return"-"+(fb?"(":"")+b.toString(setTopLevel(fb,options))+(fb?")":"");};function Subtraction(a,b){BinaryOperation.call(this,a,b);}
Subtraction.prototype=Object.create(BinaryOperation.prototype);Subtraction.prototype.getS=function(){return"-";};function Addition(a,b){BinaryOperation.call(this,a,b);}
Addition.prototype=Object.create(BinaryOperation.prototype);Addition.prototype.multiply=function(y){return y.multiplyAddition(this);};Expression.prototype.multiplyAddition=function(x){return x.a.multiply(this).add(x.b.multiply(this));};Addition.prototype.multiplyExpression=function(x){return x.multiply(this.a).add(x.multiply(this.b));};Addition.prototype.multiplyMultiplication=Addition.prototype.multiplyExpression;function Division(a,b){BinaryOperation.call(this,a,b);}
Division.prototype=Object.create(BinaryOperation.prototype);Division.prototype.multiply=function(y){return y.multiplyDivision(this);};Expression.prototype.multiplyDivision=function(x){return x.a.multiply(this).divide(x.b);};Division.prototype.multiplyExpression=function(x){return x.multiply(this.a).divide(this.b);};Division.prototype.multiplyMultiplication=Division.prototype.multiplyExpression;Division.prototype.add=function(y){return y.addDivision(this);};Expression.prototype.addDivision=function(x){return x.a.add(this.multiply(x.b)).divide(x.b);};Division.prototype.addExpression=function(x){return x.multiply(this.b).add(this.a).divide(this.b);};Division.prototype.divide=function(y,allowConjugate){return this.a.divide(this.b.multiply(y));};Division.prototype.divideExpression=function(x,allowConjugate){return x.multiply(this.b).divide(this.a);};Expression.prototype.equals=function(b){throw new RangeError();};Expression.prototype.equalsInteger=function(){return false;};Integer.prototype.equals=function(y){if(y==undefined){return false;}
return y.equalsInteger(this);};Integer.prototype.equalsInteger=function(x){return x.compareTo(this)===0;};Symbol.prototype.equals=function(b){return b instanceof Symbol&&this.symbol===b.symbol;};BinaryOperation.prototype.equals=function(b){return b instanceof BinaryOperation&&this.getS()===b.getS()&&this.a.equals(b.a)&&this.b.equals(b.b);};function MatrixSymbol(symbol){Symbol.call(this,symbol);}
MatrixSymbol.prototype=Object.create(Symbol.prototype);Exponentiation.prototype.inverse=function(){return this.pow(Integer.ONE.negate());};MatrixSymbol.prototype.inverse=function(){return this.pow(Integer.ONE.negate());};MatrixSymbol.prototype.compare4Multiplication=function(y){return y.compare4MultiplicationMatrixSymbol(this);};Expression.prototype.compare4MultiplicationMatrixSymbol=function(x){return+1;};Matrix.prototype.compare4MultiplicationMatrixSymbol=function(x){return x instanceof IdentityMatrix?+1:-1;};MatrixSymbol.prototype.compare4MultiplicationMatrixSymbol=function(x){var c=Symbol.prototype.compare4MultiplicationSymbol.call(this,x);return c===+1?-1:c;};MatrixSymbol.prototype.compare4MultiplicationSymbol=function(x){return-1;};MatrixSymbol.prototype.equals=function(b){return b instanceof MatrixSymbol&&Symbol.prototype.equals.call(this,b);};Expression.MatrixSymbol=MatrixSymbol;function IdentityMatrix(symbol){MatrixSymbol.call(this,symbol);}
IdentityMatrix.prototype=Object.create(MatrixSymbol.prototype);IdentityMatrix.prototype.multiply=function(y){return y.multiplyIdentityMatrix(this);};Expression.prototype.multiplyIdentityMatrix=function(x){return this.multiplyExpression(x);};IdentityMatrix.prototype.multiplyIdentityMatrix=function(x){return new IdentityMatrix(this.symbol);};IdentityMatrix.prototype.addMatrix=function(x){return x.add(new Matrix(self.Matrix.I(x.matrix.rows())));};IdentityMatrix.prototype.add=function(y){return y.addIdentityMatrix(this);};Expression.prototype.addIdentityMatrix=function(x){return this.addExpression(x);};Matrix.prototype.addIdentityMatrix=function(x){return new Matrix(self.Matrix.I(this.matrix.rows())).add(this);};Expression.IdentityMatrix=IdentityMatrix;BinaryOperation.prototype.getS=function(){throw new Error("abstract");};Exponentiation.prototype.getS=function(){return"^";};Multiplication.prototype.getS=function(){return"*";};Negation.prototype.getS=function(){return"-";};Addition.prototype.getS=function(){return"+";};Division.prototype.getS=function(){return"/";};Expression.Function=function(name,a){this.name=name;this.a=a;};Expression.Function.prototype=Object.create(Expression.prototype);Expression.Function.prototype.toString=function(options){return this.name+"("+this.a.toString(setTopLevel(true,options))+")";};Expression.Function.prototype.equals=function(b){return b instanceof Expression.Function&&this.name===b.name&&this.a.equals(b.a);};Negation.prototype.isUnaryPlusMinus=function(){return true;};BinaryOperation.prototype.isUnaryPlusMinus=function(){return this.isNegation();};Expression.Function.prototype.isUnaryPlusMinus=function(){return false;};Expression.prototype.isUnaryPlusMinus=function(){return false;};Integer.prototype.isUnaryPlusMinus=function(){return this.compareTo(Integer.ZERO)<0;};Negation.prototype.getPrecedence=function(){return precedence.unary["-"];};BinaryOperation.prototype.getPrecedence=function(){return this.isNegation()?precedence.unary["-"]:precedence.binary[this.getS()];};Expression.Function.prototype.getPrecedence=function(){return precedence.unary["-"];};Expression.prototype.getPrecedence=function(){return 1000;};Integer.prototype.getPrecedence=function(){return this.compareTo(Integer.ZERO)<0?precedence.unary["-"]:1000;};Expression.prototype.isNegative=function(){var x=this;if(x instanceof Integer){return x.compareTo(Integer.ZERO)<0;}
if(x instanceof Expression.Complex){return x.real.compareTo(Integer.ZERO)<0||(x.real.compareTo(Integer.ZERO)===0&&x.imaginary.compareTo(Integer.ZERO)<0);}
if(x instanceof Addition){return x.a.isNegative();}
if(x instanceof Multiplication){return x.a.isNegative()!==x.b.isNegative();}
if(x instanceof Division){return x.a.isNegative()!==x.b.isNegative();}
if(x instanceof Negation){return true;}
return false;};Expression.prototype.negateCarefully=function(){if(this instanceof Integer){return this.negate();}
if(this instanceof Addition){return new Addition(this.a.negateCarefully(),this.b.negateCarefully());}
if(this instanceof Multiplication){return this.b.isNegative()?new Multiplication(this.a,this.b.negateCarefully()):(this.a.negateCarefully().equals(Integer.ONE)?this.b:new Multiplication(this.a.negateCarefully(),this.b));}
if(this instanceof Division){return this.b.isNegative()?new Division(this.a,this.b.negateCarefully()):new Division(this.a.negateCarefully(),this.b);}
if(this instanceof Negation){return this.b;}
return this.negate();};function NthRoot(name,a,n){Expression.Function.call(this,name,a);this.n=n;}
NthRoot.prototype=Object.create(Expression.Function.prototype);NthRoot.prototype.compare4Multiplication=function(y){return y.compare4MultiplicationNthRoot(this);};NthRoot.prototype.compare4MultiplicationInteger=function(x){return-1;};NthRoot.prototype.compare4MultiplicationSymbol=function(x){return+1;};NthRoot.prototype.compare4MultiplicationNthRoot=function(x){return x.n<this.n?-1:(x.n>this.n?+1:0);};NthRoot.prototype.toString=function(options){var fa=this.a.getPrecedence()<this.getPrecedence();return(fa?"(":"")+this.a.toString(setTopLevel(fa||options==undefined||options.isTopLevel,options))+(fa?")":"")+"^"+(this.n===2?"0.5":"(1/"+this.n+")");};NthRoot.prototype.getDegree=function(){return this.n;};Expression.prototype._nthRoot=function(n){if(n>9007199254740991){throw new RangeError("UserError");}
var x=this;if(n===2){if(x instanceof Addition){if((x.a instanceof SquareRoot||x.a instanceof Multiplication&&x.a.a instanceof Integer&&x.a.b instanceof SquareRoot)&&x.b instanceof Integer){var u=x.a;var v=x.b;var tt=v.multiply(v).subtract(u.multiply(u));var t=tt.compareTo(Integer.ZERO)>=0?tt.squareRoot():undefined;if(t!=undefined&&(t instanceof Integer)){var aa=v.add(t);var a=aa.compareTo(Integer.ZERO)>=0?aa.squareRoot().divide(Integer.TWO.squareRoot()):undefined;if(a!=undefined){var b=u.divide(Integer.TWO.multiply(a));return a.add(b);}}}}}
if(x instanceof NthRoot){if(global.hit!=undefined){global.hit({rootFromRoot:""});}
return x.a._nthRoot(x.n*n);}
if(x instanceof Division){return x.a._nthRoot(n).divide(x.b._nthRoot(n));}
if(x instanceof Multiplication){return x.a._nthRoot(n).multiply(x.b._nthRoot(n));}
if(x instanceof Integer){if(x.compareTo(Integer.ZERO)<0){if(n%2===0){throw new RangeError("UserError");}}
if(x.compareTo(Integer.ZERO)===0){return x;}
var makeRoot=function(i,n){return n===1?i:(n===2?new SquareRoot(i):(n===3?new CubeRoot(i):new NthRoot("n"+"-root",i,n)));};var roots={};var i=x.compareTo(Integer.ZERO)<0?x.negate():x;while(i.compareTo(Integer.ONE)>0){var d=primeFactor(i);var e=0;while(i.remainder(d).compareTo(Integer.ZERO)===0){i=i.truncatingDivide(d);e+=1;}
while(e!==0){var g=e;while(n%g!==0){g-=1;}
var e1=Math.floor(e / g);var k=Math.floor(n / g);roots["~"+k]=(roots["~"+k]||Integer.ONE).multiply(pow(d,e1,Integer.ONE));e=e-g*e1;}}
var y=Integer.ONE;for(var jj in roots){if(Object.prototype.hasOwnProperty.call(roots,jj)){var j=Number.parseInt(jj.slice("~".length),10);var r=roots[jj];y=y.multiply(makeRoot(r,j));}}
return x.compareTo(Integer.ZERO)<0?y.negate():y;}
if(x instanceof Matrix){if(global.hit!=undefined){global.hit(n===2?{squareRoot:"matrix"}:(n===3?{cubeRoot:"matrix"}:{nthRoot:"Matrix^(1/"+n+")"}));}
if(Expression.callback!=undefined){Expression.callback(new Expression.Event("diagonalize",x));}
var tmp=Expression.diagonalize({},x.matrix);if(tmp.message===""){var L=tmp.L;var SL=L.map(function(e,i,j){return i===j?e._nthRoot(n):e;});return new Matrix(tmp.T.multiply(SL).multiply(tmp.T_INVERSED));}}
throw new RangeError("UserError");};function SquareRoot(a){NthRoot.call(this,"sqrt",a,2);}
SquareRoot.prototype=Object.create(NthRoot.prototype);Expression.prototype.squareRoot=function(){return this._nthRoot(2);};function CubeRoot(a){NthRoot.call(this,"cbrt",a,3);}
CubeRoot.prototype=Object.create(NthRoot.prototype);Expression.prototype.cubeRoot=function(){return this._nthRoot(3);};Expression.Rank=function(matrix){Expression.Function.call(this,"rank",matrix);};Expression.Rank.prototype=Object.create(Expression.Function.prototype);Expression.prototype.rank=function(){var x=this;if(!(x instanceof Matrix)){throw new RangeError("UserError");}
if(Expression.callback!=undefined){Expression.callback(new Expression.Event("rank",x));}
return Integer.parseInteger(x.matrix.rank().toString());};Expression.Determinant=function(matrix){Expression.Function.call(this,"determinant",matrix);};Expression.Determinant.prototype=Object.create(Expression.Function.prototype);Expression.prototype.determinant=function(){var x=this;if(!(x instanceof Matrix)){throw new RangeError("UserError");}
if(Expression.callback!=undefined){Expression.callback(new Expression.Event(x.matrix.getDeterminantEventType("determinant").type,x));}
return x.matrix.determinant();};Expression.Transpose=function(matrix){Expression.Function.call(this,"transpose",matrix);};Expression.Transpose.prototype=Object.create(Expression.Function.prototype);Expression.prototype.transpose=function(){var x=this;if(!(x instanceof Matrix)){throw new RangeError("UserError");}
return new Matrix(x.matrix.transpose());};Expression.Adjugate=function(matrix){Expression.Function.call(this,"adjugate",matrix);};Expression.Adjugate.prototype=Object.create(Expression.Function.prototype);Expression.prototype.adjugate=function(){var x=this;if(!(x instanceof Matrix)){throw new RangeError("UserError");}
if(Expression.callback!=undefined){Expression.callback(new Expression.Event("adjugate",x));}
if(x.matrix.rows()===1&&x.matrix.cols()===1){return new Matrix(self.Matrix.I(1));}
var C=x.matrix.map(function(element,i,j,matrix){return((i+j)-2*Math.floor((i+j)/ 2)===1?Integer.ONE.negate():Integer.ONE).multiply(matrix.minorMatrix(i,j).determinant());});var CT=new Matrix(C.transpose());return CT;};Expression.NoAnswerExpression=function(matrix,name,second){Expression.Function.call(this,name,matrix);this.second=second;};Expression.NoAnswerExpression.prototype=Object.create(Expression.Function.prototype);Expression.prototype.transformNoAnswerExpression=function(name,second){second=second==undefined?undefined:second;if(!(this instanceof Matrix)){throw new RangeError("UserError");}
if(name==="solve"){if(Expression.callback!=undefined){Expression.callback(new Expression.Event("solve",this));}}
return new Expression.NoAnswerExpression(this,name,second);};Expression.NoAnswerExpression.prototype.multiply=function(){throw new RangeError("UserError");};Expression.NoAnswerExpression.prototype.toString=function(options){if(this.second==undefined){return Expression.Function.prototype.toString.call(this,options);}
return this.a.toString(setTopLevel(true,options))+" "+this.name+" "+this.second.toString(setTopLevel(true,options));};Expression.ElementWisePower=function(a,b){BinaryOperation.call(this,a,b);};Expression.ElementWisePower.prototype=Object.create(BinaryOperation.prototype);Expression.ElementWisePower.prototype.getS=function(){return".^";};Expression.prototype.elementWisePower=function(e){if(!(this instanceof Matrix)){throw new RangeError("UserError");}
return new Matrix(this.matrix.map(function(element,i,j){return element.pow(e);}));};Expression.prototype.isRightToLeftAssociative=function(){var x=this;if(x instanceof Integer){return x.compareTo(Integer.ZERO)<0;}
if(x instanceof Negation){return true;}
if(x instanceof BinaryOperation){if(x.isNegation()){return true;}
return x instanceof Exponentiation;}
return false;};var primeFactor=function(n){if(n.remainder(Integer.TWO).compareTo(Integer.ZERO)===0){return Integer.TWO;}
for(var i=Integer.TWO.add(Integer.ONE);i.multiply(i).compareTo(n)<=0;i=i.add(Integer.TWO)){if(n.remainder(i).compareTo(Integer.ZERO)===0){return i;}}
return n;};var everySimpleDivisor=function(e,callback){e=e.getNumerator();if(e instanceof Matrix){throw new RangeError();}
if(e instanceof Symbol){if(!callback(e)){return false;}
return true;}
if(e instanceof Integer){var x=e;var i=x.compareTo(Integer.ZERO)<0?x.negate():x;while(i.compareTo(Integer.ONE)>0){var d=primeFactor(i);while(i.remainder(d).compareTo(Integer.ZERO)===0){if(!callback(d)){return false;}
i=i.truncatingDivide(d);}}
return true;}
if(e instanceof Expression.Complex){return everySimpleDivisor(integerGCD(e.real,e.imaginary),callback);}
var v=getVariable(e);if(v!=undefined){var np=Polynom.toPolynomial(e,v);var content=np.getContent();if(!everySimpleDivisor(content,callback)){return false;}
np=np.divideAndRemainder(Polynom.of(content),"throw").quotient;while(np.getDegree()>0&&np.getCoefficient(0).equals(Integer.ZERO)){if(!callback(v)){return false;}
np=np.divideAndRemainder(Polynom.of(Integer.ZERO,Integer.ONE),"throw").quotient;}
if(np.getDegree()>=2){np=np.doRationalRootTest(function(sp,q,np){return callback(v.multiply(q).subtract(sp));});if(np==undefined){return false;}}
e=np.calcAt(v);if(!e.equals(Integer.ONE.negate())){if(!e.equals(Integer.ONE)){if(e.isNegative()){e=e.negate();}
return callback(e);}}
return true;}
throw new RangeError();};Expression.everySimpleDivisor=everySimpleDivisor;Expression.everyDivisor=function(e,callback){var divisors=[];if(!callback(Integer.ONE)){return false;}
return everySimpleDivisor(e,function(d){var rec=function(start,n,s){if(n>=0){var x=divisors[n];var d=x.d;var e=x.e;for(var i=start;i<=e;i+=1){if(!rec(0,n-1,s.multiply(pow(d,i,Integer.ONE)))){return false;}}}else{if(!callback(s)){return false;}}
return true;};if(divisors.length===0||!divisors[divisors.length-1].d.equals(d)){divisors.push({d:d,e:0});}
divisors[divisors.length-1].e+=1;return rec(divisors[divisors.length-1].e,divisors.length-1,Integer.ONE);});};Expression.Integer=Integer;Expression.Symbol=Symbol;Expression.Matrix=Matrix;Expression.NthRoot=NthRoot;Expression.SquareRoot=SquareRoot;Expression.CubeRoot=CubeRoot;Expression.Negation=Negation;Expression.Subtraction=Subtraction;Expression.BinaryOperation=BinaryOperation;Expression.Exponentiation=Exponentiation;Expression.Multiplication=Multiplication;Expression.Addition=Addition;Expression.Division=Division;Expression.pow=pow;global.Expression=Expression;Expression.Equality=function(a,b){BinaryOperation.call(this,a,b);};Expression.Equality.prototype=Object.create(BinaryOperation.prototype);Expression.Equality.prototype.getS=function(){return"=";};var AdditionIterator=function(e){this.e=e;};AdditionIterator.prototype.value=function(){if(this.e==undefined){return undefined;}
return this.e instanceof Addition?this.e.b:this.e;};AdditionIterator.prototype.next=function(){if(this.e==undefined){return undefined;}
return new AdditionIterator(this.e instanceof Addition?this.e.a:undefined);};var MultiplicationIterator=function(e){this.e=e;};MultiplicationIterator.prototype.value=function(){if(this.e==undefined){return undefined;}
return this.e instanceof Multiplication?this.e.b:this.e;};MultiplicationIterator.prototype.next=function(){if(this.e==undefined){return undefined;}
return new MultiplicationIterator(this.e instanceof Multiplication?this.e.a:undefined);};Expression.prototype.summands=function(){return new AdditionIterator(this);};Expression.prototype.factors=function(){return new MultiplicationIterator(this);};var splitX=function(e){var scalar=undefined;var l=undefined;var r=undefined;for(var i=e.summands();i.value()!=undefined;i=i.next()){var summand=i.value();var state=0;for(var j=summand.factors();j.value()!=undefined;j=j.next()){var factor=j.value();if(!(factor instanceof Integer)&&!(factor instanceof Symbol)&&!(factor instanceof Matrix)){throw new RangeError("NotSupportedError");}
var s=factor instanceof Symbol?factor.toString():"";if(s==="X"){state=1;}else{if(isScalar(factor)){scalar=scalar==undefined?factor:factor.multiply(scalar);}else{if(state===0){r=r==undefined?factor:factor.multiply(r);}
if(state===1){l=l==undefined?factor:factor.multiply(l);}}}}}
scalar=scalar==undefined?Integer.ONE:scalar;return{s:scalar,l:l,r:r};};var groupX=function(a,b){var tmp1=splitX(a);var tmp2=splitX(b);var s1=tmp1.s;var l1=tmp1.l;var r1=tmp1.r;var s2=tmp2.s;var l2=tmp2.l;var r2=tmp2.r;if(r1==undefined&&r2==undefined){l1=l1==undefined?new IdentityMatrix("I"):l1;l2=l2==undefined?new IdentityMatrix("I"):l2;return new Multiplication(s1.multiply(l1).add(s2.multiply(l2)),new Expression.Symbol("X"));}
if(l1==undefined&&l2==undefined){r1=r1==undefined?new IdentityMatrix("I"):r1;r2=r2==undefined?new IdentityMatrix("I"):r2;return new Multiplication(new Expression.Symbol("X"),s1.multiply(r1).add(s2.multiply(r2)));}
throw new RangeError("NotSupportedError");};var getExpressionWithX=function(e){var withX=undefined;var withoutX=undefined;for(var i=e.summands();i.value()!=undefined;i=i.next()){var summand=i.value();var hasX=false;for(var j=summand.factors();j.value()!=undefined;j=j.next()){var factor=j.value();var factorBase=getBase(factor);if(!(factorBase instanceof Integer)&&!(factorBase instanceof Symbol)){if(!(factorBase instanceof Matrix)){throw new RangeError("NotSupportedError");}}
if(factorBase instanceof Symbol){var s=factorBase.toString();if(s==="X"){if(hasX){throw new RangeError("NotSupportedError");}
hasX=true;}}}
if(hasX){if(withX!=undefined){withX=groupX(withX,summand);}else{withX=summand;}}
if(!hasX){withoutX=withoutX==undefined?summand.negate():withoutX.subtract(summand);}}
return{withX:withX,withoutX:withoutX};};Expression.prototype.transformEquality=function(b){var e=this.subtract(b);var tmp=getExpressionWithX(e);var withX=tmp.withX;var withoutX=tmp.withoutX;if(withX==undefined){throw new RangeError("NotSupportedError");}
if(withoutX==undefined){withoutX=Integer.ZERO;}
var left=withX;var right=withoutX;var isToTheLeft=false;for(var j=withX.factors();j.value()!=undefined;j=j.next()){var factor=j.value();var factorBase=getBase(factor);var isX=false;if(factorBase instanceof Symbol){var s=factorBase.toString();if(s==="X"){isX=true;isToTheLeft=true;}}
if(!isX){var f=factor.inverse();if(isToTheLeft){right=f.multiply(right);}else{right=right.multiply(f);}}else{left=factor;}}
return new Expression.Equality(left,right);};Expression.simplifications=[];Expression.prototype.simplifyExpression=function(){var e=this;for(var i=0;i<Expression.simplifications.length;i+=1){e=Expression.simplifications[i](e);}
return e;};}(this));(function(global){"use strict";var _ilogb=function(value,base){if(BigInteger.compareTo(base,value)<=0){var tmp=_ilogb(value,BigInteger.multiply(base,base));var p=tmp.p;var e=tmp.e;var t=BigInteger.multiply(p,base);return BigInteger.compareTo(t,value)<=0?{p:t,e:2*e+1}:{p:p,e:2*e};}
return{p:BigInteger.ONE,e:0};};var ilogb=function(value,base){return _ilogb(value,base).e;};var nthRoot=function(A,n){var nthRootInternal=function(A,n,e){if(e<n){return BigInteger.ONE;}
var bigN=BigInteger.parseInt(n.toString(),10);var q=Math.floor(Math.floor(e / n)/ 2);var t=BigInteger.pow(BigInteger.TWO,q);var x0=q===0?BigInteger.pow(BigInteger.TWO,1+Math.floor(e / n)):BigInteger.multiply(BigInteger.add(t,BigInteger.ONE),nthRootInternal(BigInteger.divide(A,BigInteger.pow(t,n)),n,e-q*n));var x=x0;var xp=BigInteger.add(x,BigInteger.ONE);while(BigInteger.compareTo(x,xp)<0){xp=x;var t=BigInteger.divide(A,BigInteger.pow(x,n-1));x=BigInteger.divide(BigInteger.add(BigInteger.multiply(x,BigInteger.subtract(bigN,BigInteger.ONE)),t),bigN);}
return xp;};if(BigInteger.compareTo(A,BigInteger.ZERO)===0){return BigInteger.ZERO;}
var e=ilogb(A,BigInteger.TWO);var x=nthRootInternal(A,n,e);while(BigInteger.compareTo(A,BigInteger.pow(x,n))<0){x=BigInteger.subtract(x,BigInteger.ONE);self.setTimeout(function(){throw new RangeError(A.toString()+"**(1/"+n.toString()+")");},0);}
if(e>=n){while(BigInteger.compareTo(A,BigInteger.pow(BigInteger.add(x,BigInteger.ONE),n))>=0){x=BigInteger.add(x,BigInteger.ONE);self.setTimeout(function(){throw new RangeError(A.toString()+"**(1/"+n.toString()+")");},0);}}else{if(BigInteger.compareTo(x,BigInteger.ONE)!==0){self.setTimeout(function(){throw new RangeError(A.toString()+"**(1/"+n.toString()+")");},0);}}
return{x0:x,x1:BigInteger.compareTo(A,BigInteger.pow(x,n))===0?x:BigInteger.add(x,BigInteger.ONE)};};var pow=function(x,count,accumulator){if(count<0){throw new RangeError();}
if(count>9007199254740991){throw new RangeError();}
return(count<1?accumulator:(2*Math.floor(count / 2)!==count?pow(x,count-1,BigInteger.multiply(accumulator,x)):pow(BigInteger.multiply(x,x),Math.floor(count / 2),accumulator)));};BigInteger.pow=function(x,count){return pow(x,count,BigInteger.ONE);};BigInteger.ZERO=BigInteger.parseInt("0",10);BigInteger.ONE=BigInteger.parseInt("1",10);BigInteger.TWO=BigInteger.parseInt("2",10);BigInteger.TEN=BigInteger.parseInt("10",10);BigInteger.gcd=function(a,b){if(BigInteger.compareTo(a,BigInteger.ZERO)<0){a=BigInteger.negate(a);}
if(BigInteger.compareTo(b,BigInteger.ZERO)<0){b=BigInteger.negate(b);}
while(BigInteger.compareTo(b,BigInteger.ZERO)>0){var t=BigInteger.remainder(a,b);a=b;b=t;}
return a;};function Q(n,d){this.n=n;this.d=d;}
Q.prototype.cancel=function(){var gcd=BigInteger.gcd(this.n,this.d);return BigInteger.compareTo(gcd,BigInteger.ONE)>0?new Q(BigInteger.divide(this.n,gcd),BigInteger.divide(this.d,gcd)):this;};Q.prototype.toString=function(){return this.n.toString()+"/"+this.d.toString();};Q.prototype.sign=function(){return BigInteger.compareTo(this.n,BigInteger.ZERO)<0?-1:+1;};Q.prototype.round=function(){var i=BigInteger.divide(this.n,this.d);var r=BigInteger.remainder(this.n,this.d);var r2=BigInteger.add(r,r);return BigInteger.compareTo(BigInteger.negate(r2),this.d)>=0?BigInteger.subtract(i,BigInteger.ONE):(BigInteger.compareTo(r2,this.d)>=0?BigInteger.add(i,BigInteger.ONE):i);};Q.Context=function(){};Q.Context.prototype.fromInteger=function(n){return new Q(n,BigInteger.ONE);};Q.Context.prototype.compareTo=function(x,y){return BigInteger.compareTo(BigInteger.multiply(x.n,y.d),BigInteger.multiply(y.n,x.d));};Q.Context.prototype.negate=function(x){return new Q(BigInteger.negate(x.n),x.d);};Q.Context.prototype.add=function(x,y){return new Q(BigInteger.add(BigInteger.multiply(x.n,y.d),BigInteger.multiply(y.n,x.d)),BigInteger.multiply(x.d,y.d)).cancel();};Q.Context.prototype.subtract=function(x,y){return this.add(x,y.negate());};Q.Context.prototype.multiply=function(x,y){return new Q(BigInteger.multiply(x.n,y.n),BigInteger.multiply(x.d,y.d)).cancel();};Q.Context.prototype.divide=function(x,y){return this.multiply(x,BigInteger.compareTo(y.n,BigInteger.ZERO)<0?new Q(BigInteger.negate(y.d),BigInteger.negate(y.n)):new Q(y.d,y.n));};Q.Context.prototype.min=function(x,y){return this.compareTo(x,y)>0?y:x;};Q.Context.prototype.max=function(x,y){return this.compareTo(x,y)<0?y:x;};function Interval(a,b){this.a=a;this.b=b;}
Interval.Context=function(precision){this.down=new Q.Context();this.up=new Q.Context();this.precision=precision;this.zero=this.down.fromInteger(BigInteger.ZERO);};Interval.Context.prototype.negate=function(x){return new Interval(this.down.negate(x.b),this.up.negate(x.a));};Interval.Context.prototype.add=function(x,y){return new Interval(this.down.add(x.a,y.a),this.up.add(x.b,y.b));};Interval.Context.prototype.subtract=function(x,y){return this.add(x,this.negate(y));};Interval.Context.prototype.multiply=function(x,y){return new Interval(this.down.min(this.down.min(this.down.multiply(x.a,y.a),this.down.multiply(x.a,y.b)),this.down.min(this.down.multiply(x.b,y.a),this.down.multiply(x.b,y.b))),this.up.max(this.up.max(this.up.multiply(x.a,y.a),this.up.multiply(x.a,y.b)),this.up.max(this.up.multiply(x.b,y.a),this.up.multiply(x.b,y.b))));};Interval.Context.prototype.divide=function(x,y){if(this.down.compareTo(y.a,this.zero)<=0&&this.down.compareTo(y.b,this.zero)>=0){throw new RangeError();}
return new Interval(this.down.min(this.down.min(this.down.divide(x.a,y.a),this.down.divide(x.a,y.b)),this.down.min(this.down.divide(x.b,y.a),this.down.divide(x.b,y.b))),this.up.max(this.up.max(this.up.divide(x.a,y.a),this.up.divide(x.a,y.b)),this.up.max(this.up.divide(x.b,y.a),this.up.divide(x.b,y.b))));};Interval.Context.prototype.nthRoot=function(A,n){var c=BigInteger.pow(BigInteger.TEN,this.precision);var sA=BigInteger.multiply(A,BigInteger.pow(c,n));var tmp=nthRoot(sA,n);return this.divide(this.fromIntegers(tmp.x0,tmp.x1),this.fromIntegers(c,c));};Interval.Context.prototype.fromIntegers=function(a,b){return new Interval(this.down.fromInteger(a),this.up.fromInteger(b));};Interval.prototype.left=function(){return this.a;};Interval.prototype.right=function(){return this.b;};Interval.prototype.toString=function(){return"["+this.a.toString()+";"+this.b.toString()+"]";};Expression.prototype.evaluate=function(context){var e=this;if(e instanceof Expression.Integer){var n=e.value;return context.fromIntegers(n,n);}else if(e instanceof Expression.NthRoot){var a=e.a;var n=e.n;if(a instanceof Expression.Integer){return context.nthRoot(a.value,n);}}else if(e instanceof Expression.BinaryOperation){var a=e.a.evaluate(context);var b=e.b.evaluate(context);if(a!=undefined&&b!=undefined){var operator=e.getS();if(operator==="+"){return context.add(a,b);}else if(operator==="-"){return context.subtract(a,b);}else if(operator==="*"){return context.multiply(a,b);}else if(operator==="/"){return context.divide(a,b);}}}
return undefined;};var digitsToDecimalNumber=function(s,value,fractionDigits,toMathML){var sign=s<0?"-":"";var digits=(BigInteger.compareTo(value,BigInteger.ZERO)<0?BigInteger.negate(value):value).toString();var decimalSeparator=".";var zeros="";for(var i=0;i<fractionDigits;i+=1){zeros+="0";}
var number=(fractionDigits===0?digits:(digits.slice(0,-fractionDigits)||"0")+decimalSeparator+(zeros+digits).slice(-fractionDigits));return toMathML?(sign==="-"?"<mrow>":"")+(sign==="-"?"<mo>&minus;</mo>":"")+"<mn>"+number+"</mn>"+(sign==="-"?"</mrow>":""):sign+number;};Expression.toDecimalNumberOld=function(numerator,denominator,fractionDigits,toMathML){var sign=(BigInteger.compareTo(numerator,BigInteger.ZERO)<0?-1:+1)*(BigInteger.compareTo(denominator,BigInteger.ZERO)<0?-1:+1);var a=BigInteger.multiply(sign<0?BigInteger.negate(BigInteger.ONE):BigInteger.ONE,BigInteger.divide(BigInteger.TEN,BigInteger.TWO));var value=BigInteger.divide(BigInteger.add(BigInteger.divide(BigInteger.multiply(numerator,BigInteger.pow(BigInteger.TEN,fractionDigits+1)),denominator),a),BigInteger.TEN);return digitsToDecimalNumber(sign,value,fractionDigits,toMathML);};Expression.toDecimalStringInternal=function(expression,fractionDigits,toMathML){if(expression instanceof Expression.Integer){return Expression.toDecimalNumberOld(expression.value,BigInteger.ONE,fractionDigits,toMathML);}
if(expression instanceof Expression.Division){var numerator=expression.getNumerator();var denominator=expression.getDenominator();if(numerator instanceof Expression.Integer&&denominator instanceof Expression.Integer){return Expression.toDecimalNumberOld(numerator.value,denominator.value,fractionDigits,toMathML);}
if(numerator instanceof Expression.Complex&&denominator instanceof Expression.Integer){var real=Expression.toDecimalNumberOld(numerator.real.value,denominator.value,fractionDigits,toMathML);var imaginary=Expression.toDecimalNumberOld(numerator.imaginary.value,denominator.value,fractionDigits,toMathML);return real+(numerator.imaginary.compareTo(Expression.Integer.ZERO)>=0?(toMathML?"<mo>+<mo>":"+"):"")+imaginary+(toMathML?"<mo>&#8290;</mo><mi>i</mi>":"i");}}
if(expression instanceof Expression.NthRoot){var a=expression.a;if(a instanceof Expression.Integer){var A=a.value;var n=expression.n;var c=BigInteger.pow(BigInteger.TEN,fractionDigits);var sA=BigInteger.multiply(A,BigInteger.pow(c,n));var tmp=nthRoot(sA,n);var x0=tmp.x0;var x1=tmp.x1;var nearest=BigInteger.compareTo(BigInteger.multiply(BigInteger.pow(BigInteger.TWO,n),sA),BigInteger.pow(BigInteger.add(x0,x1),n))<0?x0:x1;return Expression.toDecimalNumberOld(nearest,c,fractionDigits,toMathML);}}
if(!Expression.has(expression,Expression.NthRoot)){self.setTimeout(function(){self.postError(new RangeError("toDecimalString:"+fractionDigits+":"+expression.toString({})));},0);}
if(fractionDigits<0||fractionDigits>9007199254740991){throw new RangeError();}
var sign=0;var candidateA=BigInteger.ZERO;var candidateB=BigInteger.ONE;var guessedPrecision=fractionDigits+1;while(BigInteger.compareTo(candidateA,candidateB)!==0){var context=new Interval.Context(guessedPrecision);var x=new Expression.Multiplication(expression,new Expression.Integer(BigInteger.pow(BigInteger.TEN,fractionDigits))).evaluate(context);if(x==undefined){return undefined;}
if(x.left().sign()===x.right().sign()){candidateA=x.left().round();candidateB=x.right().round();sign=x.left().sign();}
guessedPrecision*=2;}
return digitsToDecimalNumber(sign,candidateA,fractionDigits,toMathML);};}(this));(function(){"use strict";function GF2(a){this.a=a;}
GF2.prototype=Object.create(Expression.prototype);Expression.GF2=GF2;Expression.GF2.prototype.toString=function(options){return"GF2("+this.a.toString(Expression.setTopLevel(true,options))+")";};Expression.GF2.prototype.toMathML=function(options){return this.a.toMathML(options);};function GF2Value(value){this.value=value;}
Expression.GF2Value=GF2Value;GF2Value.prototype=Object.create(Expression.prototype);Expression.GF2Value.prototype.equals=function(b){if(Expression.Integer.ZERO===b){return this.value===0;}
return false;};Expression.GF2Value.prototype.negate=function(){return new GF2Value(this.value===0?0:2-this.value);};GF2Value.prototype.add=function(x){if(x===Expression.Integer.ZERO){return new GF2Value(this.value);}
if(!(x instanceof GF2Value)){throw new RangeError();}
var v=this.value-2+x.value;return new GF2Value(v>=0?v:v+2);};GF2Value.prototype.multiply=function(x){if(x===Expression.Integer.ZERO){return new GF2Value(0);}
if(!(x instanceof GF2Value)){throw new RangeError();}
var v=this.value*x.value;return new GF2Value(v-2*Math.floor(v / 2));};GF2Value.prototype.divide=function(x){return new GF2Value(this.value);};Expression.prototype.GF2=function(){var x=this;if(!(x instanceof Expression.Matrix)){throw new RangeError("UserError");}
return new Expression.Matrix(x.matrix.map(function(e,i,j){return new Expression.GF2Value(e.equals(Expression.Integer.ZERO)?0:1);}));};GF2Value.prototype.toString=function(options){return this.value.toString();};Expression.GF2Value.prototype.toMathML=function(options){return"<mrow>"+"<mn>"+this.value.toString()+"</mn>"+"</mrow>";};}());(function(){"use strict";var Symbol=Expression.Symbol;function PI(){Symbol.call(this,"\u03C0");}
PI.prototype=Object.create(Symbol.prototype);function EulerNumber(){Symbol.call(this,"e");}
EulerNumber.prototype=Object.create(Symbol.prototype);function ImaginaryUnit(){Symbol.call(this,"i");}
ImaginaryUnit.prototype=Object.create(Symbol.prototype);Expression.PI=new PI();Expression.E=new EulerNumber();Expression.I=new ImaginaryUnit();Expression.getComplexConjugate=function(e){return undefined;};Expression.Complex=function(){};}());(function(){"use strict";var Integer=Expression.Integer;var Symbol=Expression.Symbol;var Addition=Expression.Addition;var Multiplication=Expression.Multiplication;var Division=Expression.Division;var Exponentiation=Expression.Exponentiation;var BinaryOperation=Expression.BinaryOperation;var separateSinCos=function(e){if(!(e instanceof Multiplication)){throw new Error();}
var sinCos=undefined;var other=undefined;for(var i=e.factors();i.value()!=undefined;i=i.next()){var v=i.value();if(v instanceof Sin||v instanceof Cos||(v instanceof Exponentiation&&(v.a instanceof Sin||v.a instanceof Cos))){sinCos=sinCos==undefined?v:sinCos.multiply(v);}else{other=other==undefined?v:other.multiply(v);}}
return{sinCos:sinCos==undefined?Integer.ONE:sinCos,other:other==undefined?Integer.ONE:other};};var expandMainOp=function(u){return u;};var contractTrigonometryInternal=function(a,b){var ax=a.a;var bx=b.a;if(a instanceof Sin&&b instanceof Sin){return ax.subtract(bx).cos().divide(Integer.TWO).subtract(ax.add(bx).cos().divide(Integer.TWO));}
if(a instanceof Cos&&b instanceof Cos){return ax.add(bx).cos().divide(Integer.TWO).add(ax.subtract(bx).cos().divide(Integer.TWO));}
if(a instanceof Sin&&b instanceof Cos){return ax.add(bx).sin().divide(Integer.TWO).add(ax.subtract(bx).sin().divide(Integer.TWO));}
if(a instanceof Cos&&b instanceof Sin){return ax.add(bx).sin().divide(Integer.TWO).subtract(ax.subtract(bx).sin().divide(Integer.TWO));}
throw new Error();};var contractTrigonometryPower=function(u){var b=u.a;if(!(b instanceof Sin)&&!(b instanceof Cos)){return u;}
var e=contractTrigonometryInternal(b,b).multiply(u.divide(b.multiply(b)));return contractTrigonometryRules(e.getNumerator()).divide(e.getDenominator());};var contractTrigonometryProduct=function(u){var i=u.factors();var a=i.value();i=i.next();var b=i.value();i=i.next();var rest=i==undefined||i.e==undefined?Integer.ONE:i.e;if(a instanceof Exponentiation){a=contractTrigonometryPower(a);return contractTrigonometryRules(a.multiply(b).multiply(rest));}
if(b instanceof Exponentiation){b=contractTrigonometryPower(b);return contractTrigonometryRules(a.multiply(b).multiply(rest));}
var c=contractTrigonometryInternal(a,b);return contractTrigonometryRules(c.multiply(rest));};var contractTrigonometryRules=function(u){var v=expandMainOp(u);if(v instanceof Exponentiation){return contractTrigonometryPower(v);}
if(v instanceof Multiplication){var tmp=separateSinCos(v);var c=tmp.other;var d=tmp.sinCos;if(d.equals(Integer.ONE)){return v;}
if(d instanceof Sin||d instanceof Cos){return v;}
if(d instanceof Exponentiation){return expandMainOp(c.multiply(contractTrigonometryPower(d)));}
if(d instanceof Multiplication){return expandMainOp(c.multiply(contractTrigonometryProduct(d)));}
throw new Error();}
if(v instanceof Addition){var s=Integer.ZERO;for(var i=v.summands();i.value()!=undefined;i=i.next()){var y=i.value();if(y instanceof Multiplication||y instanceof Exponentiation){s=s.add(contractTrigonometryRules(y));}else{s=s.add(y);}}
return s;}
return v;};var map=function(f,u){if(u instanceof Integer){return f(u);}
if(u instanceof Addition){return f(u.a).add(f(u.b));}
if(u instanceof Multiplication){return f(u.a).multiply(f(u.b));}
if(u instanceof Division){return f(u.a).divide(f(u.b));}
if(u instanceof Exponentiation){return f(u.a).pow(f(u.b));}
if(u instanceof Sin){return f(u.a).sin();}
if(u instanceof Cos){return f(u.a).cos();}
if(u instanceof Expression.Matrix){return new Expression.Matrix(u.matrix.map(function(e,i,j){return map(f,e);}));}
if(u instanceof Polynom){return u.map(f);}
if(u instanceof Expression.GF2Value){return u;}
if(u instanceof Expression.NthRoot){return u;}
if(u instanceof Expression.Negation){return u;}
throw new Error();};var expandTrigonometryRulesCosInternal=function(a,b){return expandTrigonometryRulesCos(a).multiply(expandTrigonometryRulesCos(b)).subtract(expandTrigonometryRulesSin(a).multiply(expandTrigonometryRulesSin(b)));};var expandTrigonometryRulesCos=function(A){if(A instanceof Addition){return expandTrigonometryRulesCosInternal(A.a,A.b);}else if(A instanceof Multiplication){var a=A.a;var b=A.b;if(!(a instanceof Integer)){throw new Error();}
if(a.compareTo(Integer.ONE.negate())===0){return expandTrigonometryRulesCos(b);}
var c=a.compareTo(Integer.ZERO)>0?Integer.ONE:Integer.ONE.negate();return expandTrigonometryRulesCosInternal(c.multiply(b),a.subtract(c).multiply(b));}
if(A instanceof Symbol){return A.cos();}
throw new Error();};var expandTrigonometryRulesSinInternal=function(a,b){return expandTrigonometryRulesSin(a).multiply(expandTrigonometryRulesCos(b)).add(expandTrigonometryRulesCos(a).multiply(expandTrigonometryRulesSin(b)));};var expandTrigonometryRulesSin=function(A){if(A instanceof Addition){return expandTrigonometryRulesSinInternal(A.a,A.b);}else if(A instanceof Multiplication){var a=A.a;var b=A.b;if(!(a instanceof Integer)){throw new Error();}
if(a.compareTo(Integer.ONE.negate())===0){return expandTrigonometryRulesSin(b).negate();}
var c=a.compareTo(Integer.ZERO)>0?Integer.ONE:Integer.ONE.negate();return expandTrigonometryRulesSinInternal(c.multiply(b),a.subtract(c).multiply(b));}
if(A instanceof Symbol){return A.sin();}
throw new Error();};var expandTrigonometry=function(u){if(u instanceof Integer||u instanceof Symbol){return u;}
var v=map(expandTrigonometry,u);if(v instanceof Sin){return expandTrigonometryRulesSin(v.a);}
if(v instanceof Cos){return expandTrigonometryRulesCos(v.a);}
return v;};var contractTrigonometry=function(u){if(u instanceof Integer||u instanceof Symbol){return u;}
var v=map(contractTrigonometry,u);if(v instanceof Division){return contractTrigonometry(v.getNumerator()).divide(v.getDenominator());}
if(v instanceof Multiplication||v instanceof Exponentiation||v instanceof Addition){return contractTrigonometryRules(v);}
if(v instanceof Cos||v instanceof Sin){return v;}
if(v instanceof Integer){return v;}
return v;};var hasTrigonometry=function(e){if(e instanceof BinaryOperation){return hasTrigonometry(e.a)||hasTrigonometry(e.b);}
return e instanceof Cos||e instanceof Sin;};var simplifyTrigonometry=function(u){if(!hasTrigonometry(u)){return u;}
var n=expandTrigonometry(u.getNumerator());n=contractTrigonometry(n);var d=expandTrigonometry(u.getDenominator());d=contractTrigonometry(d);return n.divide(d);};Expression.simplifyTrigonometry=simplifyTrigonometry;Expression.Multiplication.prototype.compare4Multiplication=function(y){var x=this;var i=x.factors();var j=y.factors();while(i.value()!=undefined&&j.value()!=undefined){var a=i.value();i=i.next();var b=j.value();j=j.next();var c=a.compare4Multiplication(b);if(c!==0){return c;}}
return i.value()!=undefined?+1:(j.value()!=undefined?-1:0);};Expression.Multiplication.compare4Addition=function(x,y){var i=x.factors();var j=y.factors();while(i.value()!=undefined&&j.value()!=undefined){var a=i.value();i=i.next();var b=j.value();j=j.next();var c=a.compare4Addition(b);if(c!==0){return c;}}
return i.value()!=undefined?+1:(j.value()!=undefined?-1:0);};Expression.Multiplication.prototype.compare4MultiplicationSymbol=function(x){return 0-this.compare4Multiplication(x);};Expression.Function.prototype.compare4Addition=function(y){if(y instanceof Expression.Function){return this.name<y.name?-1:(y.name<this.name?+1:this.a.compare4Addition(y.a));}
return+1;};Expression.prototype.compare4AdditionSymbol=function(x){var y=this;if(y instanceof Expression.Function){return-1;}
return Expression.prototype.compare4Addition.call(x,y);};Symbol.prototype.compare4Addition=function(y){return y.compare4AdditionSymbol(this);};Expression.Function.prototype.compare4Multiplication=function(y){if(y instanceof Expression.NthRoot){return+1;}
if(y instanceof Expression.Function){return this.name<y.name?-1:(y.name<this.name?+1:this.a.compare4Multiplication(y.a));}
return+1;};Expression.Function.prototype.compare4MultiplicationInteger=function(x){return 0-this.compare4Multiplication(x);};Expression.Function.prototype.compare4MultiplicationSymbol=function(x){return-1;};Expression.Function.prototype.compare4MultiplicationNthRoot=function(x){return 0-this.compare4Multiplication(x);};Expression.Function.prototype.pow=function(y){if(this instanceof Expression.NthRoot){return Expression.prototype.pow.call(this,y);}
if(y instanceof Expression.Integer){if(y.compareTo(Expression.Integer.ONE)>0){return new Expression.Exponentiation(this,y);}
return Expression.prototype.pow.call(this,y);}
throw new RangeError("NotSupportedError");};function Sin(x){Expression.Function.call(this,"sin",x);}
Sin.prototype=Object.create(Expression.Function.prototype);var simplifyConstantValueInternal=function(a,type){a=a.remainder(Integer.parseInteger("360"));var d=Number.parseInt(a.toString(),10);if(type==="cos"){d=90-d;if(d>=360-90){d-=360;}}
if(d<0){d+=360;}
var s=d>=180?Integer.ONE.negate():Integer.ONE;if(d>=180){d-=180;}
if(d>=90){d=180-d;}
if(d===0){return s.multiply(Integer.ZERO);}
if(d===15){return s.multiply(Integer.TWO.add(Integer.ONE).squareRoot().subtract(Integer.ONE).divide(Integer.TWO.multiply(Integer.TWO.squareRoot())));}
if(d===30){return s.multiply(Integer.ONE.divide(Integer.TWO));}
if(d===45){return s.multiply(Integer.ONE.divide(Integer.TWO.squareRoot()));}
if(d===60){return s.multiply(Integer.ONE.add(Integer.TWO).squareRoot().divide(Integer.TWO));}
if(d===75){return s.multiply(Integer.TWO.add(Integer.ONE).squareRoot().add(Integer.ONE).divide(Integer.TWO.multiply(Integer.TWO.squareRoot())));}
if(d===90){return s.multiply(Integer.ONE);}
return undefined;};var simplifyConstantValue=function(x,type){if(x instanceof Integer){if(x.compareTo(Integer.ZERO)===0){return simplifyConstantValueInternal(Integer.ZERO,type);}}
if(x instanceof Expression.Degrees){return simplifyConstantValueInternal(x.value.simplify(),type);}
var a=undefined;var b=undefined;if(x===Expression.PI){a=Expression.Integer.ONE;b=Expression.Integer.ONE;}else if(x instanceof Multiplication&&x.a instanceof Integer&&x.b===Expression.PI){a=x.a;b=Expression.Integer.ONE;}else if(x instanceof Division&&x.b instanceof Integer&&x.a===Expression.PI){a=Expression.Integer.ONE;b=x.b;}else if(x instanceof Division&&x.b instanceof Integer&&x.a instanceof Multiplication&&x.a.a instanceof Integer&&x.a.b===Expression.PI){a=x.a.a;b=x.b;}
if(a!=undefined&&b!=undefined){b=Number.parseInt(b.toString(),10);if(b===1||b===2||b===3||b===4||b===6||b===12){var d=a.multiply(Integer.parseInteger(Math.floor(180 / b).toString()));return simplifyConstantValueInternal(d,type);}}
return undefined;};var isArgumentValid=function(x){if(simplifyConstantValue(x,"sin")!=undefined){return true;}
if(!(Expression.isScalar(x)&&x instanceof Symbol)&&!(x instanceof Multiplication&&x.a instanceof Integer&&Expression.isScalar(x.b)&&x.b instanceof Symbol)&&!(x instanceof Addition&&isArgumentValid(x.a)&&isArgumentValid(x.b))){return false;}
return true;};Expression.prototype.sin=function(){var x=this;if(!isArgumentValid(x)){throw new RangeError("NotSupportedError");}
if(x.isNegative()){return new Sin(x.negate()).negate();}
var t=simplifyConstantValue(x,"sin");if(t!=undefined){return t;}
return new Sin(x);};function Cos(x){Expression.Function.call(this,"cos",x);}
Cos.prototype=Object.create(Expression.Function.prototype);Expression.prototype.cos=function(){var x=this;if(!isArgumentValid(x)){throw new RangeError("NotSupportedError");}
if(x.isNegative()){return new Cos(x.negate());}
var t=simplifyConstantValue(x,"cos");if(t!=undefined){return t;}
return new Cos(x);};Expression.simplifications.push(simplifyTrigonometry);Expression.Sin=Sin;Expression.Cos=Cos;Expression.Addition.prototype.compare4Addition=function(y){var x=this;return Expression.Addition.compare4Addition(x,y);};Expression.Addition.prototype.compare4Multiplication=function(y){var x=this;var i=x.summands();var j=y.summands();while(i.value()!=undefined&&j.value()!=undefined){var a=i.value();i=i.next();var b=j.value();j=j.next();var c=a.compare4Multiplication(b);if(c!==0){return c;}}
return i.value()!=undefined?+1:(j.value()!=undefined?-1:0);};Expression.Addition.prototype.compare4MultiplicationSymbol=function(x){return 0-this.compare4Multiplication(x);};Expression.Addition.compare4Addition=function(x,y){var i=x.summands();var j=y.summands();while(i.value()!=undefined&&j.value()!=undefined){var a=i.value();i=i.next();var b=j.value();j=j.next();var c=a.compare4Addition(b);if(c!==0){return c;}}
return i.value()!=undefined?+1:(j.value()!=undefined?-1:0);};Expression.Degrees=function(value){this.value=value;};Expression.Degrees.prototype=Object.create(Expression.prototype);Expression.Degrees.prototype.toString=function(options){return this.value.toString(options)+"\u00B0";};Expression.Degrees.prototype.toMathML=function(options){return"<mrow>"+this.value.toMathML(options)+"<mo>&#8290;</mo><mi>&deg;</mi></mrow>";};}());(function(global){"use strict";var Integer=Expression.Integer;function Complex(real,imaginary){if(!(real instanceof Integer)||!(imaginary instanceof Integer)||imaginary.compareTo(Integer.ZERO)===0){throw new RangeError();}
this.real=real;this.imaginary=imaginary;}
Complex.prototype=Object.create(Expression.prototype);Expression.I=new Complex(Integer.ZERO,Integer.ONE);Expression.Complex=Complex;Complex.prototype.add=function(y){return y.addComplex(this);};Expression.prototype.addComplex=function(x){return this.addExpression(x);};Integer.prototype.addComplex=function(x){return new Complex(x.real.add(this),x.imaginary);};Complex.prototype.addComplex=function(x){var real=x.real.add(this.real);var imaginary=x.imaginary.add(this.imaginary);return imaginary.compareTo(Integer.ZERO)===0?real:new Complex(real,imaginary);};Complex.prototype.addInteger=function(x){return new Complex(x.add(this.real),this.imaginary);};Complex.prototype.equals=function(y){return y instanceof Complex&&this.real.equals(y.real)&&this.imaginary.equals(y.imaginary)?true:false;};Complex.prototype.compare4AdditionSymbol=function(x){return+1;};Complex.prototype.compare4MultiplicationNthRoot=function(x){return+1;};Complex.prototype.compare4Addition=function(y){if(y instanceof Complex){return 0;}
if(y instanceof Integer){return 0;}
return-1;};Complex.prototype.compare4Multiplication=function(y){return-1;};Complex.prototype.compare4MultiplicationSymbol=function(y){return+1;};Complex.prototype.multiply=function(y){return y.multiplyComplex(this);};Complex.prototype.multiplyComplex=function(x){var real=x.real.multiply(this.real).subtract(x.imaginary.multiply(this.imaginary));var imaginary=x.real.multiply(this.imaginary).add(x.imaginary.multiply(this.real));return imaginary.compareTo(Integer.ZERO)===0?real:new Complex(real,imaginary);};Expression.prototype.multiplyComplex=function(x){return this.multiplyExpression(x);};Integer.prototype.multiplyComplex=function(x){if(this.compareTo(Integer.ZERO)===0){return this;}
return new Complex(x.real.multiply(this),x.imaginary.multiply(this));};Complex.prototype.multiplyInteger=function(x){if(x.compareTo(Integer.ZERO)===0){return x;}
return new Complex(x.multiply(this.real),x.multiply(this.imaginary));};Complex.prototype.conjugate=function(){return new Complex(this.real,this.imaginary.negate());};Complex.prototype.getPrecedence=function(){return this.real.equals(Integer.ZERO)?(this.imaginary.equals(Integer.ONE)?1000:3):2;};Complex.prototype.truncatingDivide=function(f){return new Complex(this.real.truncatingDivide(f),this.imaginary.truncatingDivide(f));};Complex.prototype.toStringInternal=function(options,times,i,minus,plus,toString){var isNegative=this.imaginary.isNegative();var imaginary=(isNegative?this.imaginary.negateCarefully():this.imaginary);var si=imaginary.equals(Integer.ONE)?"":toString(imaginary,options)+times;var sr=this.real.equals(Integer.ZERO)?"":toString(this.real,options);return sr+(isNegative?minus:(this.real.equals(Integer.ZERO)?"":plus))+si+i;};Complex.prototype.toString=function(options){return this.toStringInternal(options,"","i","-","+",function(x,options){return x.toString(options);});};Complex.prototype.toLaTeX=function(options){return this.toStringInternal(options,"","i","-","+",function(x,options){return x.toString(options);});};Complex.prototype.toMathML=function(options){return"<mrow>"+this.toStringInternal(options,"<mo>&#8290;</mo>","<mi>i</mi>","<mo>&minus;</mo>","<mo>+</mo>",function(x,options){return x.toMathML(options);})+"</mrow>";};Expression.getComplexConjugate=function(e){if(!Expression.has(e,Complex)){return undefined;}
var c=Integer.ZERO;for(var additions=e.summands();additions.value()!=undefined;additions=additions.next()){var x=additions.value();var f=undefined;for(var multiplications=x.factors();multiplications.value()!=undefined;multiplications=multiplications.next()){var y=multiplications.value();if(y instanceof Complex){f=y;}}
if(f==undefined){c=c.add(x);}else{var fc=f.conjugate();c=c.add(x.multiply(fc).divide(f.multiply(fc)).multiply(fc));}}
return c;};Expression.Complex=Complex;}());(function(global){"use strict";var idCounter=0;function NonSimplifiedExpression(e,position,length,input){this.e=e;this.position=position==undefined?-1:position;this.length=length==undefined?-1:length;this.input=input==undefined?"":input;this.id=(idCounter+=1);}
NonSimplifiedExpression.prototype=Object.create(Expression.prototype);NonSimplifiedExpression.prototype.negate=function(){return new NonSimplifiedExpression(new Expression.Negation(this));};NonSimplifiedExpression.prototype.add=function(y){return new NonSimplifiedExpression(new Expression.Addition(this,y));};NonSimplifiedExpression.prototype.subtract=function(y){return new NonSimplifiedExpression(new Expression.Subtraction(this,y));};NonSimplifiedExpression.prototype.divide=function(y,allowConjugate){return new NonSimplifiedExpression(new Expression.Division(this,y));};NonSimplifiedExpression.prototype.multiply=function(y){return new NonSimplifiedExpression(new Expression.Multiplication(this,y));};NonSimplifiedExpression.prototype.pow=function(y){return new NonSimplifiedExpression(new Expression.Exponentiation(this,y));};NonSimplifiedExpression.prototype.powExpression=function(x){return new NonSimplifiedExpression(new Expression.Exponentiation(x,this));};NonSimplifiedExpression.prototype.multiplyAddition=function(x){return new NonSimplifiedExpression(new Expression.Multiplication(x,this));};NonSimplifiedExpression.prototype.multiplyMultiplication=function(x){return new NonSimplifiedExpression(new Expression.Multiplication(x,this));};NonSimplifiedExpression.prototype.multiplyDivision=function(x){return new NonSimplifiedExpression(new Expression.Multiplication(x,this));};NonSimplifiedExpression.prototype.multiplyMatrix=function(x){return new NonSimplifiedExpression(new Expression.Multiplication(x,this));};NonSimplifiedExpression.prototype.addDivision=function(x){return new NonSimplifiedExpression(new Expression.Addition(x,this));};NonSimplifiedExpression.prototype.addMatrix=function(x){return new NonSimplifiedExpression(new Expression.Addition(x,this));};NonSimplifiedExpression.prototype.addExpression=function(x){return new NonSimplifiedExpression(new Expression.Addition(x,this));};NonSimplifiedExpression.prototype.multiplyExpression=function(x){return new NonSimplifiedExpression(new Expression.Multiplication(x,this));};NonSimplifiedExpression.prototype.divideExpression=function(x,allowConjugate){return new NonSimplifiedExpression(new Expression.Division(x,this));};NonSimplifiedExpression.prototype.squareRoot=function(){return new NonSimplifiedExpression(new Expression.SquareRoot(this));};NonSimplifiedExpression.prototype.cubeRoot=function(){return new NonSimplifiedExpression(new Expression.CubeRoot(this));};NonSimplifiedExpression.prototype.sin=function(){return new NonSimplifiedExpression(new Expression.Sin(this));};NonSimplifiedExpression.prototype.cos=function(){return new NonSimplifiedExpression(new Expression.Cos(this));};NonSimplifiedExpression.prototype.rank=function(){return new NonSimplifiedExpression(new Expression.Rank(this));};NonSimplifiedExpression.prototype.determinant=function(){return new NonSimplifiedExpression(new Expression.Determinant(this));};NonSimplifiedExpression.prototype.GF2=function(){return new NonSimplifiedExpression(new Expression.GF2(this));};NonSimplifiedExpression.prototype.transpose=function(){return new NonSimplifiedExpression(new Expression.Transpose(this));};NonSimplifiedExpression.prototype.adjugate=function(){return new NonSimplifiedExpression(new Expression.Adjugate(this));};NonSimplifiedExpression.prototype.elementWisePower=function(a){return new NonSimplifiedExpression(new Expression.ElementWisePower(this,a));};NonSimplifiedExpression.prototype.transformNoAnswerExpression=function(name,second){return new NonSimplifiedExpression(new Expression.NoAnswerExpression(this,name,second));};NonSimplifiedExpression.prototype.transformEquality=function(b){return new NonSimplifiedExpression(new Expression.Equality(this,b));};Expression.prototype.addPosition=function(){return this;};NonSimplifiedExpression.prototype.addPosition=function(position,length,input){return new NonSimplifiedExpression(this.e,position,length,input);};var prepare=function(x,holder){var e=x.simplify();RPN.startPosition=holder.position;RPN.endPosition=holder.position+holder.length;RPN.input=holder.input;return e;};Expression.prototype.simplifyInternal=function(holder){return this;};Expression.Exponentiation.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).pow(prepare(this.b,holder));};Expression.Multiplication.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).multiply(prepare(this.b,holder));};Expression.Addition.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).add(prepare(this.b,holder));};Expression.Division.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).divide(prepare(this.b,holder));};Expression.SquareRoot.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).squareRoot();};Expression.CubeRoot.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).cubeRoot();};Expression.Sin.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).sin();};Expression.Cos.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).cos();};Expression.Rank.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).rank();};Expression.Determinant.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).determinant();};Expression.GF2.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).GF2();};Expression.Transpose.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).transpose();};Expression.Adjugate.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).adjugate();};Expression.NoAnswerExpression.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).transformNoAnswerExpression(this.name,this.second==undefined?undefined:prepare(this.second,holder));};Expression.Equality.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).transformEquality(prepare(this.b,holder));};Expression.Matrix.prototype.simplifyInternal=function(holder){return new Expression.Matrix(this.matrix.map(function(e,i,j){return prepare(e,holder);}));};Expression.prototype.simplify=function(){return this;};NonSimplifiedExpression.prototype.simplify=function(){return this.e.simplify().simplifyInternal(this).simplifyExpression();};NonSimplifiedExpression.prototype.toString=function(options){return this.e.toString(options);};NonSimplifiedExpression.prototype.equals=function(y){return this.simplify().equals(y.simplify());};NonSimplifiedExpression.prototype.toMathML=function(options){if(options.printId!=undefined){return"<mrow id=\""+this.getId()+"\">"+this.e.toMathML(options)+"</mrow>";}
return this.e.toMathML(options);};NonSimplifiedExpression.prototype.unwrap=function(){return this.e;};Expression.Negation.prototype.simplifyInternal=function(holder){return prepare(this.b,holder).negate();};Expression.Subtraction.prototype.simplifyInternal=function(holder){return prepare(this.a,holder).subtract(prepare(this.b,holder));};NonSimplifiedExpression.prototype.isUnaryPlusMinus=function(){return this.e.isUnaryPlusMinus();};NonSimplifiedExpression.prototype.getPrecedence=function(){return this.e.getPrecedence();};NonSimplifiedExpression.prototype.getId=function(){return"e"+this.id.toString();};Expression.prototype.getIds=function(){return"";};Expression.BinaryOperation.prototype.getIds=function(){var a=this.a.getIds();var b=this.b.getIds();return a===""?b:(b===""?a:a+", "+b);};NonSimplifiedExpression.prototype.getIds=function(){var a=this.getId();var b=this.e.getIds();return a===""?b:(b===""?a:a+", "+b);};NonSimplifiedExpression.prototype.isNegative=function(){return false;};NonSimplifiedExpression.prototype.negateCarefully=function(){return new NonSimplifiedExpression(this.e.negateCarefully());};NonSimplifiedExpression.prototype.isRightToLeftAssociative=function(){return this.e.isRightToLeftAssociative();};Expression.NonSimplifiedExpression=NonSimplifiedExpression;global.NonSimplifiedExpression=NonSimplifiedExpression;}(this));var RPN=undefined;(function(global){"use strict";var RPN=undefined;var isAlpha=function(code){return(code>="a".charCodeAt(0)&&code<="z".charCodeAt(0))||(code>="A".charCodeAt(0)&&code<="Z".charCodeAt(0));};var LEFT_TO_RIGHT=0;var RIGHT_TO_LEFT=1;var UNARY_PRECEDENCE=5;var Operator=function(name,arity,rightToLeftAssociative,precedence,i){this.name=name;this.arity=arity;this.rightToLeftAssociative=rightToLeftAssociative;this.precedence=precedence;this.i=i;};var ADDITION=new Operator("+",2,LEFT_TO_RIGHT,2,function(a,b){return a.add(b);});var MULTIPLICATION=new Operator("*",2,LEFT_TO_RIGHT,3,function(a,b){return a.multiply(b);});var EXPONENTIATION=new Operator("^",2,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a,b){return a.pow(b);});var prepareTrigonometricArgument=function(a){if(a instanceof Expression.Integer){return new Expression.Degrees(a);}
if(a instanceof Expression.NonSimplifiedExpression&&a.e instanceof Expression.Integer){return new Expression.NonSimplifiedExpression(new Expression.Degrees(a));}
if(a instanceof Expression.NonSimplifiedExpression&&a.e instanceof Expression.Negation&&a.e.b instanceof Expression.NonSimplifiedExpression&&a.e.b.e instanceof Expression.Integer){return new Expression.NonSimplifiedExpression(new Expression.Degrees(a));}
return a;};var operations=[ADDITION,new Operator("-",2,LEFT_TO_RIGHT,2,function(a,b){return a.subtract(b);}),MULTIPLICATION,new Operator("/",2,LEFT_TO_RIGHT,3,function(a,b){return a.divide(b);}),new Operator("\\",2,LEFT_TO_RIGHT,3,function(a,b){return a.inverse().multiply(b);}),new Operator("+",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(e){return e;}),new Operator("-",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(e){return e.negate();}),EXPONENTIATION,new Operator(".^",2,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a,b){return a.elementWisePower(b);}),new Operator("\u221A",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.squareRoot();}),new Operator("sqrt",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){return a.squareRoot();}),new Operator("\u221B",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.cubeRoot();}),new Operator("cbrt",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){return a.cubeRoot();}),new Operator("rank",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.rank();}),new Operator("adjugate",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.adjugate();}),new Operator("inverse",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.inverse();}),new Operator("determinant",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.determinant();}),new Operator("transpose",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.transpose();}),new Operator("'",1,LEFT_TO_RIGHT,UNARY_PRECEDENCE,function(a){return a.transpose();}),new Operator("solve",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.transformNoAnswerExpression("solve");}),new Operator("=",2,LEFT_TO_RIGHT,1,function(a,b){return a.transformEquality(b);}),new Operator(";",2,LEFT_TO_RIGHT,1,function(a,b){if(!Expression.isDebugging){throw new RangeError("NotSupportedError");}
return a.transformStatement(b);}),new Operator("GF2",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.GF2();}),new Operator("sin",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){if(a.sin==undefined){throw new RangeError("NotSupportedError");}
a=prepareTrigonometricArgument(a);return a.sin();}),new Operator("cos",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){if(a.cos==undefined){throw new RangeError("NotSupportedError");}
a=prepareTrigonometricArgument(a);return a.cos();}),new Operator("tan",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){if(a.sin==undefined||a.cos==undefined){throw new RangeError("NotSupportedError");}
a=prepareTrigonometricArgument(a);return a.sin().divide(a.cos());}),new Operator("exp",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){return Expression.E.pow(a);}),new Operator("log",1,RIGHT_TO_LEFT,UNARY_PRECEDENCE+1,function(a){throw new RangeError("NotSupportedError");})];function OperationSearchCache(){this.array=new Array(32);for(var i=0;i<this.array.length;i+=1){this.array[i]=undefined;}}
var asciiToLowerCase=function(charCode){return(charCode<65?charCode:(charCode<91?charCode+32:(charCode<128?charCode:charCode)));};OperationSearchCache.prototype.append=function(firstCharCode,operator){var index=asciiToLowerCase(firstCharCode)%this.array.length;if(this.array[index]==undefined){this.array[index]=[];}
this.array[index].push(operator);};OperationSearchCache.prototype.getAll=function(firstCharCode){var index=asciiToLowerCase(firstCharCode)%this.array.length;return this.array[index];};var operationSearchCache=new OperationSearchCache();var i=-1;while(++i<operations.length){operationSearchCache.append(operations[i].name.charCodeAt(0),operations[i]);}
function Input(){}
Input.EOF=-1;Input.trimLeft=function(input,position,skip){var tmp=Input.exec(input,position+skip,whiteSpaces);return position+skip+(tmp==undefined?0:tmp[0].length);};Input.parseCharacter=function(input,position,characterCode){var c=Input.getFirst(input,position);if(c!==characterCode){RPN.startPosition=position;RPN.endPosition=position+1;RPN.input=input;throw new RangeError("UserError:"+characterCode.toString());}
return Input.trimLeft(input,position,1);};Input.getFirst=function(input,position){return position<input.length?input.charCodeAt(position):Input.EOF;};Input.startsWith=function(input,position,s){var length=s.length;if(position+length>input.length){return false;}
var i=-1;while(++i<length){if(asciiToLowerCase(input.charCodeAt(position+i))!==asciiToLowerCase(s.charCodeAt(i))){return false;}}
return true;};Input.exec=function(input,position,regularExpression){if(position===input.length){return undefined;}
var match=regularExpression.exec(position===0?input:input.slice(position));return match==undefined||match[0].length===0?undefined:match;};var MATRIX_OPENING_BRACKET="{".charCodeAt(0);var MATRIX_CLOSING_BRACKET="}".charCodeAt(0);var GROUPING_OPENING_BRACKET="(".charCodeAt(0);var GROUPING_CLOSING_BRACKET=")".charCodeAt(0);var VERTICAL_BAR="|".charCodeAt(0);var DELIMITER=",".charCodeAt(0);function ParseResult(result,position){this.result=result;this.position=position;}
var parseMatrix=function(input,position,context){var openingBracket=MATRIX_OPENING_BRACKET;var closingBracket=MATRIX_CLOSING_BRACKET;var rows=[];var firstRow=true;while(firstRow||Input.getFirst(input,position)===DELIMITER){if(firstRow){firstRow=false;}else{position=Input.trimLeft(input,position,1);}
position=Input.parseCharacter(input,position,openingBracket);var row=[];var firstCell=true;while(firstCell||Input.getFirst(input,position)===DELIMITER){if(firstCell){firstCell=false;}else{position=Input.trimLeft(input,position,1);}
var tmp=parseExpression(input,position,context,true,0,undefined);position=tmp.position;row.push(tmp.result);}
position=Input.parseCharacter(input,position,closingBracket);rows.push(row);}
return new ParseResult(context.wrap(RPN.createMatrix(Matrix.padRows(rows,false))),position);};var parseLaTeXArgument=function(input,position,context){return parseExpression(input,position,context,true,0,undefined);};var getDecimalFraction=function(match){var integerPartAsString=match[1];var nonRepeatingFractionalPartAsString=integerPartAsString!=undefined?match[2]:match[4];var repeatingFractionalPartAsString=integerPartAsString!=undefined?match[3]:(nonRepeatingFractionalPartAsString!=undefined?match[5]:match[6]);var exponentSingPartAsString=match[7];var exponentPartAsString=match[8];var numerator=RPN.ZERO;var denominator=undefined;var factor=undefined;if(integerPartAsString!=undefined){numerator=RPN.parseInteger(integerPartAsString);}
if(nonRepeatingFractionalPartAsString!=undefined){factor=Expression.pow(RPN.TEN,nonRepeatingFractionalPartAsString.length,RPN.ONE);numerator=numerator.multiply(factor).add(RPN.parseInteger(nonRepeatingFractionalPartAsString));denominator=denominator==undefined?factor:denominator.multiply(factor);}
if(repeatingFractionalPartAsString!=undefined){factor=Expression.pow(RPN.TEN,repeatingFractionalPartAsString.length,RPN.ONE).subtract(RPN.ONE);numerator=numerator.multiply(factor).add(RPN.parseInteger(repeatingFractionalPartAsString));denominator=denominator==undefined?factor:denominator.multiply(factor);}
if(exponentPartAsString!=undefined){factor=Expression.pow(RPN.TEN,Number.parseInt(exponentPartAsString,10),RPN.ONE);if(exponentSingPartAsString==="-"){denominator=denominator==undefined?factor:denominator.multiply(factor);}else{numerator=numerator.multiply(factor);}}
var value=denominator==undefined?numerator:numerator.divide(denominator);return value;};var whiteSpaces=/^\s+/;var symbols=/^(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|varsigma|sigma|tau|upsilon|phi|chi|psi|omega|[a-zA-Z\u0430-\u044F\u0410-\u042F\u03B1-\u03C9](?:\_\d+|\_\([a-z\d]+,[a-z\d]+\)|[\u2080-\u2089]+)?)/;var decimalFractionRegExp=/^(?:(\d+)(?:[\.,](\d+)?(?:\((\d+)\))?)?|[\.,](?:(\d+)(?:\((\d+)\))?|(?:\((\d+)\))))(?:(?:e|E)(\+|-)?(\d+))?/;var decimalFractionRegExpWithoutComma=/^(?:(\d+)(?:[\.](\d+)?(?:\((\d+)\))?)?|[\.](?:(\d+)(?:\((\d+)\))?|(?:\((\d+)\))))(?:(?:e|E)(\+|-)?(\d+))?/;var superscripts=/^[\u00B2\u00B3\u00B9\u2070\u2074-\u2079]+/;var vulgarFractions=/^[\u00BC-\u00BE\u2150-\u215E]/;var normalizeSuperscripts=function(s){return s.replace(/[\u00B2\u00B3\u00B9\u2070\u2074-\u2079]/g,function(c){var charCode=c.charCodeAt(0);if(charCode===0x00B2){return"2";}
if(charCode===0x00B3){return"3";}
if(charCode===0x00B9){return"1";}
if(charCode===0x2070){return"0";}
return(charCode-0x2074+4).toString();});};var normalizeVulgarFractions=function(s){return s.replace(/[\u00BC-\u00BE\u2150-\u215E]/g,function(c){var charCode=c.charCodeAt(0);var i=charCode-0x2150<0?(charCode-0x00BC)*2:(3+charCode-0x2150)*2;return"141234171911132315253545165618385878".slice(i,i+2).replace(/^\S/g,"$&/").replace(/1\/1/g,"1/10");});};var normalizeSubscripts=function(s){var i=s.length-1;while(i>=0&&s.charCodeAt(i)>=0x2080){i-=1;}
return i===s.length-1?s:s.slice(0,i+1)+"_"+s.slice(i+1).replace(/[\u2080-\u2089]/g,function(c){return String.fromCharCode(c.charCodeAt(0)-0x2080+"0".charCodeAt(0));});};var normalizeFullwidthForms=function(charCode){return String.fromCharCode(charCode-0xFF01+0x0021);};var normalizeGreek=function(s){var i=s.indexOf("_");var k=i===-1?s.length:i;if(k>1){var name=s.slice(0,k);var greek=" alpha beta gamma delta epsilon zeta eta theta iota kappa lambda mu nu xi omicron pi rho varsigma sigma tau upsilon phi chi psi omega ";var j=greek.indexOf(" "+name+" ");if(j!==-1){return String.fromCharCode(0x03B1+greek.slice(0,j).split(" ").length-1)+s.slice(k);}}
return s;};var parseExpression=function(input,position,context,isMatrixElement,precedence,left){var ok=true;var firstCharacterCode=Input.getFirst(input,position);while(firstCharacterCode!==Input.EOF&&ok){var op=undefined;var operand=undefined;var tmp=undefined;var match=undefined;var isOnlyInteger=false;var right=undefined;var operationsArray=operationSearchCache.getAll(firstCharacterCode);if(operationsArray!=undefined){var length=operationsArray.length;var bestMatchLength=0;var j=-1;while(++j<length){var candidate=operationsArray[j];if((left!=undefined&&(candidate.arity!==1||candidate.rightToLeftAssociative!==RIGHT_TO_LEFT||precedence<MULTIPLICATION.precedence)||(left==undefined&&candidate.arity===1&&candidate.rightToLeftAssociative===RIGHT_TO_LEFT))&&Input.startsWith(input,position,candidate.name)&&bestMatchLength<candidate.name.length){op=candidate;bestMatchLength=op.name.length;}}}
if(op!=undefined){if(precedence>op.precedence+(op.rightToLeftAssociative===RIGHT_TO_LEFT?0:-1)){ok=false;}else{var operatorPosition=position;position=Input.trimLeft(input,position,op.name.length);if(op.arity===1&&op.rightToLeftAssociative!==RIGHT_TO_LEFT){RPN.startPosition=operatorPosition;RPN.endPosition=operatorPosition+op.name.length;RPN.input=input;left=op.i(left).addPosition(operatorPosition,op.name.length,input);}else{if(op.arity===1&&op.rightToLeftAssociative===RIGHT_TO_LEFT&&op.precedence===UNARY_PRECEDENCE+1&&op.name.length>1&&(op.name==="sin"||op.name==="cos"||op.name==="sen"||op.name==="tan"||op.name==="tg")&&Input.startsWith(input,position,EXPONENTIATION.name)){var exponentiationPosition=position;position=position+EXPONENTIATION.name.length;tmp=parseExpression(input,position,context,isMatrixElement,EXPONENTIATION.precedence,undefined);var middle=tmp.result;position=tmp.position;tmp=parseExpression(input,position,context,isMatrixElement,op.precedence,undefined);right=tmp.result;position=tmp.position;operand=EXPONENTIATION.i(op.i(right).addPosition(operatorPosition,op.name.length,input),middle).addPosition(exponentiationPosition,EXPONENTIATION.name.length,input);}else{tmp=parseExpression(input,position,context,isMatrixElement,op.precedence,undefined);right=tmp.result;position=tmp.position;RPN.startPosition=operatorPosition;RPN.endPosition=operatorPosition+op.name.length;RPN.input=input;if(op.arity===1){operand=op.i(right).addPosition(operatorPosition,op.name.length,input);}else if(op.arity===2){left=op.i(left,right).addPosition(operatorPosition,op.name.length,input);}else{throw new RangeError();}}}}}else if(left==undefined||precedence<MULTIPLICATION.precedence){if(firstCharacterCode===GROUPING_OPENING_BRACKET){position=Input.parseCharacter(input,position,GROUPING_OPENING_BRACKET);tmp=parseExpression(input,position,context,false,0,undefined);operand=tmp.result;position=tmp.position;position=Input.parseCharacter(input,position,GROUPING_CLOSING_BRACKET);}else if(firstCharacterCode===MATRIX_OPENING_BRACKET){position=Input.parseCharacter(input,position,MATRIX_OPENING_BRACKET);if(Input.getFirst(input,position)===MATRIX_OPENING_BRACKET){tmp=parseMatrix(input,position,context);operand=tmp.result;position=tmp.position;}else{tmp=parseLaTeXArgument(input,position,context);operand=tmp.result;position=tmp.position;}
position=Input.parseCharacter(input,position,MATRIX_CLOSING_BRACKET);}else if((match=Input.exec(input,position,isMatrixElement?decimalFractionRegExpWithoutComma:decimalFractionRegExp))!=undefined){operand=context.wrap(getDecimalFraction(match));position=Input.trimLeft(input,position,match[0].length);isOnlyInteger=match[1]!=undefined&&match[0].length===match[1].length;}else if((match=Input.exec(input,position,symbols))!=undefined){var symbolName=match[0];symbolName=normalizeSubscripts(symbolName);symbolName=normalizeGreek(symbolName);operand=context.get(symbolName);if(operand==undefined){operand=RPN.createSymbol(symbolName);operand=context.wrap(operand);}else{operand=context.wrap(operand);}
position=Input.trimLeft(input,position,match[0].length);}else if(firstCharacterCode===VERTICAL_BAR&&left==undefined){position=Input.parseCharacter(input,position,VERTICAL_BAR);tmp=parseExpression(input,position,context,isMatrixElement,0,undefined);operand=tmp.result;position=tmp.position;position=Input.parseCharacter(input,position,VERTICAL_BAR);operand=operand.determinant();}else{ok=false;}}else{ok=false;}
if(!ok&&left!=undefined&&precedence<=EXPONENTIATION.precedence+(EXPONENTIATION.rightToLeftAssociative===RIGHT_TO_LEFT?0:-1)){if((match=Input.exec(input,position,superscripts))!=undefined){left=EXPONENTIATION.i(left,RPN.parseInteger(normalizeSuperscripts(match[0]))).addPosition(position,EXPONENTIATION.name.length,input);position=Input.trimLeft(input,position,match[0].length);ok=true;}}
if(!ok||isOnlyInteger){if((match=Input.exec(input,position,vulgarFractions))!=undefined){tmp=parseExpression(normalizeVulgarFractions(match[0]),0,context,isMatrixElement,0,undefined);if(isOnlyInteger){operand=ADDITION.i(operand,tmp.result).addPosition(position,ADDITION.name.length,input);}else{operand=tmp.result;}
position=Input.trimLeft(input,position,match[0].length);ok=true;}}
if(!ok&&firstCharacterCode==="\\".charCodeAt(0)&&isAlpha(Input.getFirst(input,position+1))){ok=true;position+=1;}
if(operand!=undefined){if(left!=undefined){tmp=parseExpression(input,position,context,isMatrixElement,MULTIPLICATION.precedence,operand);var right1=tmp.result;var position1=tmp.position;left=MULTIPLICATION.i(left,right1).addPosition(position,MULTIPLICATION.name.length,input);position=position1;}else{left=operand;}}
firstCharacterCode=Input.getFirst(input,position);}
if(left==undefined){RPN.startPosition=position;RPN.endPosition=position+1;RPN.input=input;throw new RangeError("UserError:"+"0");}
return new ParseResult(left,position);};var table={"\u0410":"A","\u0430":"A","\u0412":"B","\u0432":"B","\u0421":"C","\u0441":"C","\u00B7":"*","\u00D7":"*","\u2022":"*","\u22C5":"*","\u2010":"-","\u2011":"-","\u2012":"-","\u2013":"-","\u2014":"-","\u2015":"-","\u2212":"-","\u003A":"/","\u00F7":"/"};var replaceSomeChars=function(input){var lastIndex=0;var result="";for(var i=0;i<input.length;i+=1){var charCode=input.charCodeAt(i);if(charCode>0x007F||charCode===0x003A){var x=table[input.slice(i,i+1)];if(x==undefined){if(charCode>=0xFF01&&charCode<=0xFF5E){x=normalizeFullwidthForms(charCode);}}
if(x!=undefined){result+=input.slice(lastIndex,i);result+=x;lastIndex=i+1;}}}
result+=input.slice(lastIndex);return result;};var fs={};RPN=function(input,context){context=context==undefined?new RPN.SimpleContext():context;RPN.startPosition=-1;RPN.endPosition=-1;RPN.input=input;if(typeof input!=="string"){throw new RangeError();}
input=replaceSomeChars(input);if(global.hit!=undefined&&!(context instanceof RPN.CheckContext)){var re=/[a-z][a-z][a-z\-]+/gi;var m=null;while((m=re.exec(input))!=null){var t=m[0];if(!(t in fs)&&t.indexOf("-")===-1){fs[t]=true;global.hit({fs:t});}}}
var position=0;position=Input.trimLeft(input,position,0);var tmp=parseExpression(input,position,context,false,0,undefined);if(Input.getFirst(input,tmp.position)!==Input.EOF){RPN.startPosition=tmp.position;RPN.endPosition=tmp.position+1;RPN.input=input;throw new RangeError("UserError:"+Input.EOF.toString());}
return tmp.result;};RPN.startPosition=-1;RPN.endPosition=-1;RPN.input="";Expression.isDebugging=false;var getConstant=function(e){if(e==="pi"||e==="\u03C0"){return Expression.PI;}
if(e==="e"){return Expression.E;}
if(e==="i"){return Expression.I;}
return undefined;};RPN.Context=function(getter){this.getter=getter;};RPN.Context.prototype.get=function(e){var x=this.getter==undefined?undefined:this.getter(e);if(x!=undefined){return x;}
return getConstant(e);};RPN.Context.prototype.wrap=function(e){return new NonSimplifiedExpression(e);};RPN.CheckContext=function(getter){RPN.Context.call(this,getter);};RPN.CheckContext.prototype=Object.create(RPN.Context.prototype);RPN.SimpleContext=function(x){};RPN.SimpleContext.prototype.get=function(e){return getConstant(e);};RPN.SimpleContext.prototype.wrap=function(e){return e;};RPN.addOperation=function(denotation,arity){var newOperation=arity===1?new Operator(denotation,arity,RIGHT_TO_LEFT,UNARY_PRECEDENCE,function(a){return a.transformNoAnswerExpression(denotation);}):new Operator(denotation,arity,RIGHT_TO_LEFT,3,function(a,b){return a.transformNoAnswerExpression(denotation,b);});operations.push(newOperation);operationSearchCache.append(newOperation.name.charCodeAt(0),newOperation);};RPN.addDenotations=function(operationName,denotations,denotationsKeys){var operations=operationSearchCache.getAll(operationName.charCodeAt(0));var operation=undefined;var i=-1;while(++i<operations.length){var o=operations[i];if(o.name===operationName){operation=o;}}
var j=-1;while(++j<denotationsKeys.length){var denotation=denotations[denotationsKeys[j]];var newOperation=new Operator(denotation,operation.arity,operation.rightToLeftAssociative,operation.precedence,operation.i);operations.push(newOperation);operationSearchCache.append(newOperation.name.charCodeAt(0),newOperation);}};RPN.parseInteger=function(s){return Expression.Integer.parseInteger(s);};RPN.createMatrix=function(x){return new Expression.Matrix(x);};RPN.createSymbol=function(x){if(x==="I"||x==="U"||x==="E"){return new Expression.IdentityMatrix(x);}
return new Expression.Symbol(x);};RPN.ZERO=Expression.Integer.ZERO;RPN.ONE=Expression.Integer.ONE;RPN.TWO=Expression.Integer.TWO;RPN.TEN=Expression.Integer.TEN;Expression.Division.prototype.negate=function(){return new Expression.Division(this.a.negate(),this.b);};function PolynomialTerm(degree,coefficient){if(degree<0){throw new RangeError();}
if(degree>9007199254740991){throw new RangeError("UserError");}
if(coefficient.equals(RPN.ZERO)){throw new RangeError();}
this.degree=degree;this.coefficient=coefficient;}
function PolynomialData(length){this.array=new Array(length);this.i=0;this.length=length;}
PolynomialData.prototype.add=function(degree,coefficient){var k=this.i;if(k>=this.length){throw new RangeError();}
this.array[k]=new PolynomialTerm(degree,coefficient);this.i=k+1;};PolynomialData.prototype.degree=function(i){return this.array[i].degree;};PolynomialData.prototype.coefficient=function(i){return this.array[i].coefficient;};PolynomialData.prototype.trim=function(){if(this.i!==this.length){var array=new Array(this.i);for(var i=0;i<this.i;i+=1){array[i]=this.array[i];}
this.array=array;this.length=this.i;}
return this;};PolynomialData.prototype.getCoefficient=function(degree){var from=0;var to=this.array.length;while(from<to){var middle=from+Math.floor((to-from)/ 2);var y=this.array[middle].degree;if(y<degree){from=middle+1;}else if(y>degree){to=middle;}else{return this.array[middle].coefficient;}}
return RPN.ZERO;};function Polynom(a){this.a=a;}
Polynom.prototype=Object.create(Expression.prototype);Polynom.of=function(){var newData=new PolynomialData(arguments.length);for(var i=0;i<arguments.length;i+=1){var a=arguments[i];if(!a.equals(RPN.ZERO)){newData.add(i,a);}}
return new Polynom(newData.trim());};Polynom.from=function(array){var newData=new PolynomialData(array.length);for(var i=0;i<array.length;i+=1){var a=array[i];if(!a.equals(RPN.ZERO)){newData.add(i,a);}}
return new Polynom(newData.trim());};Polynom.ZERO=Polynom.of();Polynom.prototype.getDegree=function(){return this.a.length===0?-1:this.a.degree(this.a.length-1);};Polynom.prototype.getCoefficient=function(degree){if(degree>this.getDegree()){throw new RangeError();}
return this.a.getCoefficient(degree);};Polynom.prototype.getLeadingCoefficient=function(){return this.a.length===0?RPN.ZERO:this.a.coefficient(this.a.length-1);};Polynom.prototype.map=function(mapFunction){var newData=new PolynomialData(this.a.length);for(var i=0;i<this.a.length;i+=1){var coefficient=this.a.coefficient(i);var c=mapFunction(coefficient);if(!c.equals(RPN.ZERO)){newData.add(this.a.degree(i),c);}}
return new Polynom(newData.trim());};Polynom.prototype.equals=function(y){return y.equalsPolynom(this);};Expression.prototype.equalsPolynom=function(x){return(x.a.length===0&&this.equals(RPN.ZERO))||(x.a.length===1&&x.a.degree(x.a.length-1)===0&&this.equals(x.a.coefficient(x.a.length-1)));};Polynom.prototype.equalsPolynom=function(p){var i=this.a.length;if(i!==p.a.length){return false;}
while(--i>=0){if(this.a.degree(i)!==p.a.degree(i)||!this.a.coefficient(i).equals(p.a.coefficient(i))){return false;}}
return true;};Polynom.prototype.add=function(p){var i=0;var j=0;var newData=new PolynomialData(this.a.length+p.a.length);while(i<this.a.length&&j<p.a.length){var x=this.a.degree(i);var y=p.a.degree(j);if(x<y){newData.add(x,this.a.coefficient(i));i+=1;}else if(x>y){newData.add(y,p.a.coefficient(j));j+=1;}else{var c=this.a.coefficient(i).add(p.a.coefficient(j));if(!c.equals(RPN.ZERO)){newData.add(x,c);}
i+=1;j+=1;}}
while(i<this.a.length){newData.add(this.a.degree(i),this.a.coefficient(i));i+=1;}
while(j<p.a.length){newData.add(p.a.degree(j),p.a.coefficient(j));j+=1;}
return new Polynom(newData.trim());};Polynom.prototype.multiply=function(p){return p.multiplyPolynom(this);};Expression.Division.prototype.multiplyPolynom=function(p){return this.multiplyExpression(p);};Polynom.prototype.multiplyPolynom=function(p){if(this.a.length===0||p.a.length===0){return Polynom.ZERO;}
var result=Polynom.ZERO;for(var i=0;i<this.a.length;i+=1){var xd=this.a.degree(i);var xc=this.a.coefficient(i);var newData=new PolynomialData(p.a.length);for(var j=0;j<p.a.length;j+=1){var yd=p.a.degree(j);var yc=p.a.coefficient(j);newData.add(xd+yd,xc.multiply(yc));}
result=result.add(new Polynom(newData.trim()));}
return result;};Polynom.prototype.shift=function(n){if(n<0){throw new RangeError();}
var newData=new PolynomialData(this.a.length);for(var i=0;i<this.a.length;i+=1){newData.add(this.a.degree(i)+n,this.a.coefficient(i));}
return new Polynom(newData.trim());};Polynom.prototype.divideAndRemainder=function(p,w){w=w||undefined;if(p.equals(Polynom.ZERO)){throw new RangeError("ArithmeticException");}
var quotient=Polynom.ZERO;var remainder=this;while(remainder.getDegree()>=p.getDegree()){var n=remainder.getDegree()-p.getDegree();var q=remainder.getLeadingCoefficient().divide(p.getLeadingCoefficient());if(w!=undefined){if(q instanceof Expression.Division){if(w==="throw"){throw new RangeError();}
if(w==="undefined"){return undefined;}
throw new RangeError();}}
var pq=Polynom.of(q);quotient=quotient.add(pq.shift(n));remainder=remainder.subtract(p.multiply(pq).shift(n));}
return{quotient:quotient,remainder:remainder};};Polynom.prototype.calcAt=function(point){var n=RPN.ZERO;var lastDegree=-1;var i=this.a.length;while(--i>=-1){var degree=i===-1?0:this.a.degree(i);var coefficient=i===-1?RPN.ZERO:this.a.coefficient(i);if(i!==this.a.length-1){n=n.multiply(point.pow(RPN.parseInteger((lastDegree-degree).toString())));}
if(i!==-1){n=n.add(coefficient);}
lastDegree=degree;}
return n;};Polynom.prototype.getContent=function(){if(this.a.length===0){throw new RangeError();}
var x=this.a.coefficient(this.a.length-1);var denominator=x.getDenominator();var numerator=x.getNumerator();var i=this.a.length-1;while(--i>=0){var y=this.a.coefficient(i);denominator=denominator.lcm(y.getDenominator());numerator=numerator.gcd(y.getNumerator());}
var c=numerator.divide(denominator);return x.isNegative()&&!numerator.isNegative()?c.negate():c;};Polynom.prototype.negate=function(){return this.multiply(Polynom.of(RPN.ONE.negate()));};Polynom.prototype.subtract=function(l){return this.negate().add(l).negate();};Polynom.prototype.divide=function(l){if(l.equals(RPN.ONE)){return this;}
return l.dividePolynom(this);};Expression.Division.prototype.dividePolynom=function(p){return this.divideExpression(p);};Polynom.prototype.dividePolynom=function(l){var a=l;var b=this;if(a.getDegree()<0&&b.getDegree()>=0){return a;}
var t=undefined;while(b.getDegree()>=0){t=a.remainder(b);a=b;b=t;}
var gcd=a;var x=l.divideAndRemainder(gcd).quotient;return this.equals(gcd)?x:new Expression.Division(x,this.divideAndRemainder(gcd).quotient);};Polynom.prototype.remainder=function(l){return this.divideAndRemainder(l).remainder;};Polynom.prototype.scale=function(x){return this.multiplyPolynom(Polynom.of(x));};Polynom.toPolynomial=function(e,v){if(e instanceof Expression.Division){throw new RangeError();}
var coefficients=Expression.getCoefficients(e,v);var newData=new PolynomialData(coefficients.length);for(var i=0;i<coefficients.length;i+=1){var x=coefficients[i];var d=Number.parseInt(x.degree.toString(),10);var c=x.coefficient;newData.add(d,c);}
return new Polynom(newData.trim());};Polynom.prototype.toExpression=function(variableSymbol){var i=this.a.length;var result=undefined;while(--i>=0){var degree=this.a.degree(i);var coefficient=this.a.coefficient(i);var v=degree===0?undefined:(degree===1?variableSymbol:new Expression.Exponentiation(variableSymbol,Expression.Integer.parseInteger(degree.toString())));var current=v==undefined?coefficient:(coefficient.equals(RPN.ONE)?v:new Expression.Multiplication(coefficient,v));result=result==undefined?current:new Expression.Addition(result,current);}
return result==undefined?RPN.ZERO:result;};Polynom.prototype.doRationalRootTest=function(callback){var np=this;var an=np.getLeadingCoefficient();var a0=np.getCoefficient(0);Expression.everyDivisor(a0,function(p){return Expression.everyDivisor(an,function(q){var sign=-3;while((sign+=2)<3){var sp=sign===-1?p.negate():p;var x=Polynom.of(sp.negate(),q);var z=np.divideAndRemainder(x,"undefined");while(z!=undefined&&z.remainder.equals(Polynom.ZERO)){np=z.quotient;if(!callback(sp,q,np)){np=undefined;return false;}
if(np.getDegree()===1){sp=np.getCoefficient(0).negate();q=np.getCoefficient(1);np=Polynom.of(RPN.ONE);if(!callback(sp,q,np)){np=undefined;return false;}
return false;}
if(np.getDegree()<1){return false;}
z=np.divideAndRemainder(x,"undefined");}}
return true;});});return np;};Polynom.prototype.getroots=function(callback){callback=callback||undefined;var np=this;var roots=[];var content=np.getContent();if(!content.equals(RPN.ONE)){np=np.divideAndRemainder(Polynom.of(content),"throw").quotient;}
while(np.getCoefficient(0).equals(RPN.ZERO)){np=np.divideAndRemainder(Polynom.of(RPN.ZERO,RPN.ONE),"throw").quotient;roots.push(RPN.ZERO);}
if(!content.equals(RPN.ONE)||roots.length>0){if(roots.length>0){if(global.hit!=undefined){global.hit({getroots:{special:"0"}});}}
if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:"factorOutTheGreatestCommonFactor"});}}
if(np.getDegree()===1){roots.push(np.getCoefficient(0).negate().divide(np.getCoefficient(1)));np=Polynom.of(RPN.ONE);if(global.hit!=undefined){global.hit({getroots:{linear:""}});}
if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:"solveLinearEquation"});}
return roots;}
var nthRootInternal=function(n,x){if(x instanceof Expression.Division){var sa1=nthRootInternal(n,x.a);var sb1=nthRootInternal(n,x.b);return sa1==undefined||sb1==undefined?undefined:sa1.divide(sb1);}
if(x instanceof Expression.Exponentiation){var N=Expression.Integer.parseInteger(n.toString());return x.b.remainder(N).equals(RPN.ZERO)?x.a.pow(x.b.divide(N)):undefined;}
if(x instanceof Expression.Multiplication){var sa=nthRootInternal(n,x.a);var sb=nthRootInternal(n,x.b);return sa==undefined||sb==undefined?undefined:sa.multiply(sb);}
if(x instanceof Expression.Complex){if(n===2){var m=x.real.multiply(x.real).add(x.imaginary.multiply(x.imaginary)).squareRoot();var g=nthRootInternal(2,x.real.add(m).divide(Expression.Integer.TWO));var d=nthRootInternal(2,x.real.negate(m).add(m).divide(Expression.Integer.TWO));if(g!=undefined&&d!=undefined){var result=g.add((x.imaginary.compareTo(Expression.Integer.ZERO)<0?d.negate():d).multiply(Expression.I));return result;}}
if(x.real.equals(RPN.ZERO)&&n%2===0){var c=nthRootInternal(Math.floor(n / 2),x);if(c!=undefined){return nthRootInternal(2,c);}}
if(x.real.equals(RPN.ZERO)&&n%2===1){var c=nthRootInternal(n,x.imaginary);if(c!=undefined){return c.multiply((n%4===1?Expression.I:Expression.I.negate()));}}}
if(x instanceof Expression.Addition){var lastFactor=undefined;var e=0;var result=Expression.Integer.ONE;Expression.everySimpleDivisor(x,function(f){if(e===0){lastFactor=f;e+=1;}else if(f.equals(lastFactor)){e+=1;if(e===n){e=0;result=result.multiply(lastFactor);}}else if(e!==0){result=undefined;}
return result!=undefined;});if(result!=undefined&&e===0){return result;}}
var y=undefined;try{y=x._nthRoot(n);}catch(error){}
return y;};var nthRoot=function(n,x,np){var y=nthRootInternal(n,x);if(y==undefined){if(!(x instanceof Expression.Integer)){self.setTimeout(function(){throw new RangeError((n===2?"squareRoot":(n===3?"cubeRoot":n+"-root"))+":"+x.toString()+":"+np.toString());},0);}}
return y;};var continueWithNewPolynomial=function(roots,np){var rs=np.getroots();for(var i=0;i<rs.length;i+=1){roots.push(rs[i]);}
return roots;};if(np.getDegree()>=2){var gcd=function(a,b){return b===0?a:gcd(b,a%b);};var g=np.getDegree();for(var i=1;i<=np.getDegree();i+=1){if(!np.getCoefficient(i).equals(RPN.ZERO)){g=gcd(g,i);}}
if(g>=2){if(global.hit!=undefined){if(g===np.getDegree()){global.hit({getroots:{allZeros:""}});}else{global.hit({getroots:g%2===0?(np.getDegree()===4?{biquadratic:""}:{even:""}):{xyz:np.toString()}});}}
var newData=new Array(Math.floor((np.getDegree()+g)/ g));var k=0;for(var i=0;i<=np.getDegree();i+=g){newData[k]=np.getCoefficient(i);k+=1;}
var q=Polynom.from(newData);var qRoots=q.getroots();var n=np.getDegree();var ok=false;for(var k=0;k<qRoots.length;k+=1){var qRoot=qRoots[k];var s=nthRoot(g,qRoot,np);if(s!=undefined){roots.push(s);np=np.divide(Polynom.of(s.negate(),RPN.ONE));if(g%2===0){roots.push(s.negate());np=np.divide(Polynom.of(s,RPN.ONE));}}
ok=ok||Expression.has(qRoot,Expression.Complex);}
if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:(g===2?"applyDifferenceOfSquaresRule":(g===3?"applyDifferenceOfCubesRule":"applyDifferenceOfNthPowersRule"))});}
if(n!==np.getDegree()&&ok){return continueWithNewPolynomial(roots,np);}
return roots;}}
if(np.getDegree()===2){var a=np.getCoefficient(2);var b=np.getCoefficient(1);var c=np.getCoefficient(0);var D=b.multiply(b).subtract(RPN.TWO.multiply(RPN.TWO).multiply(a).multiply(c));var sD=nthRoot(2,D,np);if(global.hit!=undefined){global.hit({getroots:{quadratic:(sD==undefined?(D instanceof Expression.Integer?D.compareTo(RPN.ZERO):"?"+D.toString()):"OK")}});}
if(sD!=undefined){var x1=b.negate().subtract(sD).divide(RPN.TWO.multiply(a));var x2=b.negate().add(sD).divide(RPN.TWO.multiply(a));roots.push(x1);roots.push(x2);np=Polynom.of(RPN.ONE);if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:"solveQuadraticEquation"});}
return roots;}}
if(np.getDegree()>=4&&np.getDegree()%2===0){try{var middle=Math.floor(np.getDegree()/ 2);var j=1;while(j<middle+1&&np.getCoefficient(middle+j).equals(RPN.ZERO)&&np.getCoefficient(middle-j).equals(RPN.ZERO)){j+=1;}
if(j<middle+1&&!np.getCoefficient(middle+j).equals(RPN.ZERO)&&!np.getCoefficient(middle-j).equals(RPN.ZERO)){var jj=RPN.parseInteger(j.toString());var mj=np.getCoefficient(middle+j).divide(np.getCoefficient(middle-j));var isQuasiPalindromic=true;for(var i=2;i<middle+1;i+=1){isQuasiPalindromic=isQuasiPalindromic&&np.getCoefficient(middle+i).pow(jj).subtract(np.getCoefficient(middle-i).pow(jj).multiply(mj.pow(RPN.parseInteger(i.toString())))).equals(RPN.ZERO);}
if(isQuasiPalindromic){if(global.hit!=undefined){global.hit({getroots:{quasiPalindromic:np.getDegree()}});}}
if(isQuasiPalindromic&&np.getDegree()<=53){var substitute=function(m,np){var choose=function(n,k){return k===0?1:Math.floor((n*choose(n-1,k-1))/ k);};var p=function(n,i,mpi){return n-2*i>=0?p(n-2*i,1,m).scale(Expression.Integer.parseInteger(choose(n,i).toString()).multiply(mpi).negate()).add(p(n,i+1,mpi.multiply(m))):Polynom.of(RPN.ONE).shift(n);};var f=function(n,i){return i<=n?p(n-i,1,m).scale(np.getCoefficient(i)).add(f(n,i+1)):Polynom.ZERO;};return f(Math.floor(np.getDegree()/ 2),0);};var m=j===1?mj:nthRoot(j,mj,np);var pt=substitute(m,np);var ptRoots=pt.getroots();for(var i=0;i<ptRoots.length;i+=1){var ptRoot=ptRoots[i];var u=Polynom.of(RPN.ONE,ptRoot.negate(),m);var uRoots=u.getroots();for(var j=0;j<uRoots.length;j+=1){var root=uRoots[j];np=np.divide(Polynom.of(root.negate(),RPN.ONE));roots.push(root);}}
if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:"solvePalindromicEquaion"});}
return roots;}}}catch(error){self.setTimeout(function(){throw error;},0);self.setTimeout(function(){throw new RangeError(np.toString());},0);}}
if(np.getDegree()>2){var n=roots.length;np=np.doRationalRootTest(function(sp,q,np){roots.push(sp.divide(q));return true;});if(n!==roots.length){if(callback!=undefined){callback({content:content,roots:roots,newPolynomial:np,type:"useTheRationalRootTest"});}
if(global.hit!=undefined){global.hit({getroots:{rational:""}});}
return continueWithNewPolynomial(roots,np);}}
if(np.getDegree()===3){var context=new RPN.Context(function(id){return np.getCoefficient(3-(id.charCodeAt(0)-"a".charCodeAt(0)));});var delta=RPN("18*a*b*c*d-4*b^3*d+b^2*c^2-4*a*c^3-27*a^2*d^2",context).simplify();var delta0=RPN("b^2-3*a*c",context).simplify();if(global.hit!=undefined){global.hit({getroots:{cubic:(delta instanceof Expression.Integer?delta.compareTo(RPN.ZERO):"?")+"-"+(delta0 instanceof Expression.Integer?delta0.compareTo(RPN.ZERO):"?")}});}
if(delta0.equals(RPN.ZERO)){if(delta.equals(RPN.ZERO)){var root=RPN("-b/(3*a)",context).simplify();roots.push(root);roots.push(root);roots.push(root);np=Polynom.of(RPN.ONE);return roots;}else{var delta1=RPN("2*b^3-9*a*b*c+27*a^2*d",context).simplify();var C=nthRoot(3,delta1,np);if(C!=undefined){var root=np.getCoefficient(2).add(C).add(delta0.divide(C)).negate().divide(RPN("3").multiply(np.getCoefficient(3)));roots.push(root);np=np.divide(Polynom.of(root.negate(),RPN.ONE));return continueWithNewPolynomial(roots,np);}}}else{if(delta.equals(RPN.ZERO)){var root=RPN("9*a*d-b*c",context).simplify().divide(RPN("2").multiply(delta0));roots.push(root);roots.push(root);var p=Polynom.of(root.negate(),RPN.ONE);np=np.divide(p.multiply(p));roots.push(np.getCoefficient(0).negate().divide(np.getCoefficient(1)));np=Polynom.of(RPN.ONE);return roots;}else{}}}
if(np.getDegree()>=4){var integerCoefficients=true;for(var i=0;i<=np.getDegree();i+=1){integerCoefficients=integerCoefficients&&np.getCoefficient(i)instanceof Expression.Integer;}
if(integerCoefficients){var f=function(){var n=np.getDegree();var ys=new Array(n);var total=1;for(var i=0;i<=Math.floor(n / 2);i+=1){var bi=Expression.Integer.parseInteger(i.toString());var y=np.calcAt(bi);if(y.equals(RPN.ZERO)){return Polynom.of(bi.negate(),RPN.ONE);}
var attachNegative=function(array){var result=new Array(array.length*2);for(var i=0;i<array.length;i+=1){result[i*2]=array[i];result[i*2+1]=array[i].negate();}
return result;};var divisors=function(e){var divisors=[];Expression.everyDivisor(e,function(d){divisors.push(d);return true;});return divisors;};ys[i]=attachNegative(divisors(y));total*=ys[i].length;var V=Matrix.Zero(i+1,i+1).map(function(e,i,j){return Expression.pow(Expression.Integer.parseInteger(i.toString()),j,Expression.Integer.ONE);});var inv=V.inverse();var u=new Array(i+1);for(var j=0;j<i+1;j+=1){u[j]=0;}
u[0]=-1;for(var j=0;j<total;j+=1){var k=0;u[k]+=1;while(u[k]===ys[k].length){u[k]=0;k+=1;u[k]+=1;}
var y=Matrix.Zero(i+1,1).map(function(e,i,j){return ys[i][u[i]];});var s=inv.multiply(y);var polynomialFromVector=function(s){var c=new Array(s.rows());for(var j=0;j<s.rows();j+=1){c[j]=s.e(j,0);}
return Polynom.from(c);};var g=polynomialFromVector(s);if(g.getDegree()>0&&np.divideAndRemainder(g).remainder.equals(Polynom.ZERO)){return g;}}}
return undefined;};var g=f();if(g!=undefined){var h=np.divideAndRemainder(g).quotient;var gr=g.getroots();for(var i=0;i<gr.length;i+=1){roots.push(gr[i]);}
var hr=h.getroots();for(var i=0;i<hr.length;i+=1){roots.push(hr[i]);}
if(hr.length>0||gr.length>0){if(global.hit!=undefined){global.hit({getroots:{methodOfKronecker:np.toString()}});}}
return roots;}}}
if(np.getDegree()>=4){if(global.hit!=undefined){global.hit({getroots:{other:np.getDegree()}});}}
return roots;};Polynom.prototype.getPrecedence=function(){var d=this.getDegree();var count=0;for(var i=0;i<=d;i+=1){if(!this.getCoefficient(i).equals(RPN.ZERO)){count+=1;}}
return(count<2?(this.getLeadingCoefficient().equals(RPN.ONE)?new Expression.Symbol("x"):new Expression.Multiplication(RPN.ONE,RPN.ONE)):new Expression.Addition(RPN.ONE,RPN.ONE)).getPrecedence();};global.Polynom=Polynom;global.RPN=RPN;}(this));(function(global){"use strict";function Matrix(data){this.a=data;}
Matrix.Zero=function(rows,cols){var a=new Array(rows);var i=-1;while(++i<rows){var j=-1;var x=new Array(cols);while(++j<cols){x[j]=RPN.ZERO;}
a[i]=x;}
return new Matrix(a);};Matrix.I=function(n){return Matrix.Zero(n,n).map(function(element,i,j){return(i===j?RPN.ONE:RPN.ZERO);});};Matrix.prototype.rows=function(){return this.a.length;};Matrix.prototype.cols=function(){return this.a.length>0?this.a[0].length:0;};Matrix.prototype.e=function(i,j){return this.a[i][j];};Matrix.prototype.isSquare=function(){return this.rows()>0&&this.rows()===this.cols();};Matrix.prototype.map=function(callback){var rows=this.rows();var cols=this.cols();var c=new Array(rows);var i=-1;while(++i<rows){var x=new Array(cols);var j=-1;while(++j<cols){var e=callback.call(undefined,this.e(i,j),i,j,this);x[j]=e.simplifyExpression();}
c[i]=x;}
return new Matrix(c);};Matrix.prototype.transpose=function(){var that=this;return Matrix.Zero(that.cols(),that.rows()).map(function(element,i,j){return that.e(j,i);});};Matrix.prototype.scale=function(k){return this.map(function(element,i,j){return element.multiply(k);});};Matrix.prototype.multiply=function(b){var a=this;if(a.cols()!==b.rows()){throw new RangeError("DimensionMismatchException");}
return Matrix.Zero(a.rows(),b.cols()).map(function(element,i,j){var rows=b.rows();var k=-1;while(++k<rows){var current=a.e(i,k).multiply(b.e(k,j));element=k===0?current:element.add(current);}
return element;});};Matrix.prototype.add=function(b){var a=this;if(a.rows()!==b.rows()||a.cols()!==b.cols()){throw new RangeError("MatrixDimensionMismatchException");}
return a.map(function(elem,i,j){return elem.add(b.e(i,j));});};Matrix.prototype.augment=function(b){if(this.rows()!==b.rows()){throw new RangeError("NonSquareMatrixException");}
var a=this;return Matrix.Zero(a.rows(),a.cols()+b.cols()).map(function(element,i,j){return(j<a.cols()?a.e(i,j):b.e(i,j-a.cols()));});};Matrix.prototype.rowReduce=function(targetRow,pivotRow,pivotColumn,currentOrPreviousPivot){if(currentOrPreviousPivot==undefined){currentOrPreviousPivot=this.e(pivotRow,pivotColumn);}
var rows=this.rows();var cols=this.cols();var c=new Array(rows);var i=-1;while(++i<rows){var x=this.a[i];if(targetRow===i){x=new Array(cols);var j=-1;while(++j<cols){var e=this.e(pivotRow,pivotColumn).multiply(this.e(targetRow,j)).subtract(this.e(targetRow,pivotColumn).multiply(this.e(pivotRow,j))).divide(currentOrPreviousPivot);x[j]=e.simplifyExpression();}
c[i]=x;}
c[i]=x;}
return new Matrix(c);};Matrix.prototype.swapRows=function(pivotRow,targetRow,preserveDeterminant){var m=this;return m.map(function(e,i,j){if(i===pivotRow){return m.e(targetRow,j);}
if(i===targetRow){return preserveDeterminant?m.e(pivotRow,j).negate():m.e(pivotRow,j);}
return e;});};var notEqualsZero=function(e,condition){if(condition!=undefined){return!condition.andNotZero(e).isFalse();}
return e instanceof Expression.Integer&&!e.equals(RPN.ZERO);};Matrix.check=function(usage,matrix,from,to,condition){for(var i=from;i<to;i+=1){if(usage!=="solving"||notEqualsZero(matrix.e(i,matrix.cols()-1),condition)){var endColumnIndex=usage==="solving"?matrix.cols()-1:(usage==="determinant"?matrix.cols():(usage==="inverse"?Math.floor(matrix.cols()/ 2):-1));var j=0;while(j<endColumnIndex&&matrix.e(i,j).equals(RPN.ZERO)){j+=1;}
if(j===endColumnIndex){return i;}}}
return-1;};Matrix.toRowEchelonStep=function(m,pivotRow,pivotColumn,pivotOriginRow,previousPivot,options){var oldMatrix=undefined;var coefficient=undefined;var targetRow=0;if(pivotOriginRow!==pivotRow){oldMatrix=m;m=m.swapRows(pivotRow,pivotOriginRow,options.usage==="determinant");if(options.callback!=undefined){options.callback({previousPivot:undefined,newMatrix:m,oldMatrix:oldMatrix,type:options.usage==="determinant"?"swap-negate":"swap",targetRow:pivotRow,pivotRow:pivotOriginRow,pivotColumn:pivotColumn});}}
if(options.method===Matrix.GaussJordan){if(!m.e(pivotRow,pivotColumn).equals(RPN.ONE)){oldMatrix=m;coefficient=RPN.ONE.divide(m.e(pivotRow,pivotColumn));m=m.map(function(e,i,j){if(i!==pivotRow){return e;}
return e.multiply(coefficient);});if(options.callback!=undefined){options.callback({previousPivot:undefined,newMatrix:m,oldMatrix:oldMatrix,type:"divide",targetRow:pivotRow,pivotRow:pivotRow,pivotColumn:pivotColumn});}}}
if(options.method===Matrix.Gauss||options.method===Matrix.GaussJordan){targetRow=pivotRow;while(++targetRow<m.rows()){if(!m.e(targetRow,pivotColumn).equals(RPN.ZERO)){oldMatrix=m;m=m.rowReduce(targetRow,pivotRow,pivotColumn);if(options.callback!=undefined){options.callback({previousPivot:undefined,newMatrix:m,oldMatrix:oldMatrix,type:"reduce",targetRow:targetRow,pivotRow:pivotRow,pivotColumn:pivotColumn});}
var stoppedAtRow=Matrix.check(options.usage,m,targetRow,targetRow+1);if(stoppedAtRow!==-1){return{stoppedAtRow:stoppedAtRow,matrix:m};}}}}
if(options.method===Matrix.GaussMontante){oldMatrix=m;targetRow=-1;while(++targetRow<m.rows()){if(targetRow!==pivotRow){m=m.rowReduce(targetRow,pivotRow,pivotColumn,previousPivot);}}
if(options.callback!=undefined){options.callback({previousPivot:previousPivot,newMatrix:m,oldMatrix:oldMatrix,type:"pivot",targetRow:-1,pivotRow:pivotRow,pivotColumn:pivotColumn});}
var stoppedAtRow=Matrix.check(options.usage,m,0,m.rows());if(stoppedAtRow!==-1){return{stoppedAtRow:stoppedAtRow,matrix:m};}}
return{stoppedAtRow:-1,matrix:m};};Matrix.toRowEchelonBackSubstitution=function(m,pivotRow,options){if(options.method===Matrix.GaussJordan){while(--pivotRow>=0){var pivotColumn=0;while(pivotColumn<m.cols()&&m.e(pivotRow,pivotColumn).equals(RPN.ZERO)){pivotColumn+=1;}
if(pivotColumn<m.cols()){var targetRow=pivotRow;while(--targetRow>=0){if(!m.e(targetRow,pivotColumn).equals(RPN.ZERO)){var oldMatrix=m;m=m.rowReduce(targetRow,pivotRow,pivotColumn);if(options.callback!=undefined){options.callback({previousPivot:undefined,newMatrix:m,oldMatrix:oldMatrix,type:"reduce",targetRow:targetRow,pivotRow:pivotRow,pivotColumn:pivotColumn});}}}}}}
return m;};Matrix.Gauss="Gauss";Matrix.GaussJordan="Gauss-Jordan";Matrix.GaussMontante="Gauss-Montante";function ToRowEchelonOptions(method,usage,callback){if(usage!=="determinant"&&usage!=="inverse"&&usage!=="solving"&&usage!==""){throw new RangeError();}
this.method=method;this.usage=usage;this.callback=callback;}
Matrix.ToRowEchelonOptions=ToRowEchelonOptions;var COLUMN_LOOP=0;var ZERO=1;var NOT_ZERO=2;Matrix.prototype.toRowEchelon=function(method,usage,callback){var options=new Matrix.ToRowEchelonOptions(method,usage,callback);return this.toRowEchelonInternal(options,0,-1,-1,RPN.ONE,COLUMN_LOOP);};Matrix.prototype.toRowEchelonXXX=function(method,usage,callback,condition){var options=new Matrix.ToRowEchelonOptions(method,usage,callback);return this.toRowEchelonInternal(options,0,-1,-1,RPN.ONE,COLUMN_LOOP,condition);};Matrix.prototype.toRowEchelonInternal=function(options,pivotRow,pivotColumn,pivotOriginRow,previousPivot,state,condition){var matrix=this;var stoppedAtRow=Matrix.check(options.usage,matrix,0,matrix.rows(),condition);if(stoppedAtRow!==-1){return{stoppedAtRow:stoppedAtRow,matrix:matrix,condition:condition};}
while(true){switch(state){case COLUMN_LOOP:pivotColumn+=1;if(pivotColumn>=matrix.cols()){matrix=Matrix.toRowEchelonBackSubstitution(matrix,pivotRow,options);return{stoppedAtRow:-1,matrix:matrix,condition:condition};}
if(pivotColumn>pivotRow&&(options.usage==="determinant"||options.usage==="inverse")){if(pivotColumn>=Math.floor(matrix.cols()/ 2)&&options.usage==="inverse"){matrix=Matrix.toRowEchelonBackSubstitution(matrix,pivotRow,options);return{stoppedAtRow:-1,matrix:matrix,condition:condition};}
return{stoppedAtRow:pivotRow,matrix:matrix,condition:condition};}
pivotOriginRow=pivotRow-1;state=ZERO;break;case ZERO:if(condition==undefined){pivotOriginRow+=1;if(pivotOriginRow<matrix.rows()){if(matrix.e(pivotOriginRow,pivotColumn).equals(RPN.ZERO)){state=ZERO;}else{state=NOT_ZERO;}}else{state=COLUMN_LOOP;}}else{if(pivotOriginRow>=pivotRow){matrix=pivotRow>=matrix.rows()||matrix.e(pivotRow,pivotColumn).equals(RPN.ZERO)?matrix:matrix.map(function(e,i,j){return i===pivotOriginRow&&j===pivotColumn?RPN.ZERO:(condition.andNotZero(e).isFalse()?RPN.ZERO:e);});}
var found=false;if(pivotOriginRow===pivotRow-1){var row=pivotRow;while(row<matrix.rows()&&!(matrix.e(row,pivotColumn)instanceof Expression.Integer&&!matrix.e(row,pivotColumn).equals(RPN.ZERO))){row+=1;}
if(row<matrix.rows()){pivotOriginRow=row;found=true;}}
if(!found){pivotOriginRow+=1;if(pivotOriginRow<matrix.rows()){var candidate=matrix.e(pivotOriginRow,pivotColumn);var c1=condition.andNotZero(candidate);var c2=condition.andZero(candidate);if(c2.isFalse()){state=NOT_ZERO;}else if(c1.isFalse()){state=ZERO;}else{return{matrix:matrix,c1:c1,a1:function(){return matrix.toRowEchelonInternal(options,pivotRow,pivotColumn,pivotOriginRow,previousPivot,NOT_ZERO,c1);},c2:c2,a2:function(){return matrix.toRowEchelonInternal(options,pivotRow,pivotColumn,pivotOriginRow,previousPivot,ZERO,c2);}};}}else{state=COLUMN_LOOP;}}else{state=NOT_ZERO;}}
break;case NOT_ZERO:var tmp=Matrix.toRowEchelonStep(matrix,pivotRow,pivotColumn,pivotOriginRow,previousPivot,options);var stoppedAtRow=tmp.stoppedAtRow;matrix=tmp.matrix;if(stoppedAtRow!==-1){return{stoppedAtRow:stoppedAtRow,matrix:matrix,condition:condition};}
previousPivot=matrix.e(pivotRow,pivotColumn);pivotRow+=1;state=COLUMN_LOOP;break;}}};Matrix.prototype.determinant=function(){var n=this.rows();if(!this.isSquare()||n===0){throw new RangeError("NonSquareMatrixException");}
if(false){var tmp=this.toRowEchelon(Matrix.Gauss,"determinant",undefined);var stoppedAtRow=tmp.stoppedAtRow;var rowEchelonMatrix=tmp.matrix;if(stoppedAtRow!==-1){return RPN.ZERO;}
var det=rowEchelonMatrix.e(0,0);for(var j=1;j<rowEchelonMatrix.rows();j+=1){det=det.multiply(rowEchelonMatrix.e(j,j));}
return det;}
var tmp=this.toRowEchelon(Matrix.GaussMontante,"determinant",undefined);var stoppedAtRow=tmp.stoppedAtRow;var rowEchelonMatrix=tmp.matrix;if(stoppedAtRow!==-1){return RPN.ZERO;}
return rowEchelonMatrix.e(n-1,n-1);};Matrix.prototype.rank=function(){var m=this.toRowEchelon(Matrix.GaussMontante,"",undefined).matrix;var result=0;var pivotRow=0;var pivotColumn=0;while(pivotRow<m.rows()){while(pivotColumn<m.cols()&&m.e(pivotRow,pivotColumn).equals(RPN.ZERO)){pivotColumn+=1;}
if(pivotColumn<m.cols()){result+=1;}
pivotRow+=1;}
return result;};Matrix.prototype.inverse=function(){if(!this.isSquare()){throw new RangeError("NonSquareMatrixException");}
var m=this.augment(Matrix.I(this.rows()));m=m.toRowEchelon(Matrix.GaussMontante,"inverse",undefined).matrix;return Matrix.Zero(m.rows(),m.rows()).map(function(element,i,j){var e=m.e(i,i);if(e.equals(RPN.ZERO)){throw new RangeError("SingularMatrixException");}
var x=m.e(i,j+m.rows());return e.equals(RPN.ONE)?x:x.divide(e);});};Matrix.prototype.toString=function(options){var result="";var rows=this.rows();var cols=this.cols();var j=-1;result+="{";while(++j<rows){if(j!==0){result+=",";}
result+="{";var i=-1;while(++i<cols){if(i!==0){result+=",";}
result+=this.e(j,i).toString(options);}
result+="}";}
result+="}";return result;};Matrix.prototype.negate=function(){return this.map(function(element,i,j){return element.negate();});};Matrix.prototype.subtract=function(b){return this.negate().add(b).negate();};Matrix.prototype.getElements=function(){var rows=this.rows();var cols=this.cols();var elements=new Array(rows);for(var i=0;i<rows;i+=1){var row=new Array(cols);for(var j=0;j<cols;j+=1){row[j]=this.e(i,j).toString();}
elements[i]=row;}
return elements;};Matrix.prototype.slice=function(rowsStart,rowsEnd,colsStart,colsEnd){var that=this;return Matrix.Zero(rowsEnd-rowsStart,colsEnd-colsStart).map(function(e,i,j){return that.e(i+rowsStart,j+colsStart);});};Matrix.split=function(input){var result=[];var m=input;if(/^\s*\[[^\[\]]*\]\s*$/.exec(m)!=undefined){m=m.replace(/\[/g," ");m=m.replace(/\]/g," ");}
if(m.replace(/^\s+|\s+$/g,"")!==""){m=m.replace(/;/g,"\n");m=m.replace(/\r/g,"\n");var row=[];result.push(row);var position=0;var match=undefined;while((match=/^\s*\S+/.exec(m.slice(position)))!=undefined){var t=match[0];if(t.indexOf("\n")!==-1&&row.length!==0){row=[];result.push(row);t=t.replace(/\n/g," ");}
row.push(t);position+=t.length;}}
return result;};Matrix.padRows=function(array,convert,context){var rows=array.length;var cols=0;for(var k=0;k<rows;k+=1){var length=array[k].length;if(cols<length){cols=length;}}
var data=new Array(rows);for(var i=0;i<rows;i+=1){var y=array[i];var x=new Array(cols);for(var j=0;j<cols;j+=1){x[j]=j<y.length?(convert?RPN(y[j],context):y[j]):RPN.ZERO;}
data[i]=x;}
return new Matrix(data);};Matrix.toMatrix=function(array){return Matrix.padRows(array,true,new RPN.Context());};global.Matrix=Matrix;}(this));(function(global){"use strict";function Utils(){}
Utils.escapeHTML=function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};Polynom.prototype.toString=function(options){options=options||{};return this.toExpression(options.polynomialVariable||(new Expression.Symbol("x"))).toString(options);};Polynom.prototype.toMathML=function(options){options=options||{};return this.toExpression(options.polynomialVariable||(new Expression.Symbol("x"))).toMathML(options);};var printPartOfAddition=function(isLast,isFirst,coefficient,variable,options){if(coefficient.equals(RPN.ZERO)){return(isLast&&isFirst?"<mn>0</mn>":"");}
var sign1="+";if(coefficient.isNegative()){sign1="&minus;";coefficient=coefficient.negate();}
var coefficientString=coefficient.toMathML(options);var precedenceOfMultiptication=new Expression.Multiplication(RPN.ZERO,RPN.ZERO).getPrecedence();var areBracketsRequired=coefficient.getPrecedence()<precedenceOfMultiptication;return(isFirst&&sign1==="+"?"":"<mo>"+sign1+"</mo>")+
(coefficient.equals(RPN.ONE)?"":(areBracketsRequired&&coefficientString!==""?"<mfenced open=\"(\" close=\")\"><mrow>"+coefficientString+"</mrow></mfenced>":coefficientString)+(coefficientString!==""?"<mo>&times;</mo>":""))+
variable.toMathML(options);};var polynomToExpression2=function(coefficients,variableSymbols){var result=undefined;for(var i=0;i<coefficients.length;i+=1){var c=coefficients[i];var v=variableSymbols[i];if(!c.equals(RPN.ZERO)){var current=v==undefined?c:(c.equals(RPN.ONE)?v:new Expression.Multiplication(c,v));result=result==undefined?current:new Expression.Addition(result,current);}}
return result==undefined?RPN.ZERO:result;};Expression.toDecimalString=function(x,options){var fractionDigits=options.fractionDigits;if(fractionDigits>=0&&!Expression.has(x,Expression.Symbol)&&!Expression.has(x,Expression.NonSimplifiedExpression)&&!Expression.has(x,Expression.Matrix)){return Expression.toDecimalStringInternal(x,fractionDigits,true);}
return undefined;};Expression.Matrix.prototype.toMathML=function(options){var x=this.matrix;options=Expression.setTopLevel(true,options);var useMatrixContainer=options.useMatrixContainer==undefined?true:options.useMatrixContainer;var braces=options.useBraces==undefined?["(",")"]:options.useBraces;var columnlines=options.columnlines==undefined?0:options.columnlines;var variableNames=options.variableNames==undefined?undefined:options.variableNames;var verticalStrike=options.verticalStrike==undefined?-1:options.verticalStrike;var horizontalStrike=options.horizontalStrike==undefined?-1:options.horizontalStrike;var cellIdGenerator=options.cellIdGenerator==undefined?undefined:options.cellIdGenerator;var pivotCell=options.pivotCell==undefined?undefined:options.pivotCell;var isLUDecomposition2=options.isLUDecomposition2==undefined?undefined:options.isLUDecomposition2;var highlightRow=options.highlightRow==undefined?-1:options.highlightRow;var highlightCol=options.highlightCol==undefined?-1:options.highlightCol;options=Object.assign({},options,{useBraces:undefined,columnlines:undefined,variableNames:undefined,verticalStrike:undefined,horizontalStrike:undefined,cellIdGenerator:undefined,pivotCell:undefined,isLUDecomposition2:undefined,highlightRow:undefined,highlightCol:undefined});var result="";var rows=x.rows();var cols=x.cols();var i=-1;var containerId=options.idPrefix+"-"+RPN.id();if(useMatrixContainer){result+="<munder>";result+="<mrow>";result+="<menclose notation=\"none\" href=\"#\" id=\""+containerId+"\" data-matrix=\""+Utils.escapeHTML(x.toString())+"\" draggable=\"true\" tabindex=\"0\" contextmenu=\"matrix-menu\">";}
result+="<mfenced open=\""+braces[0]+"\" close=\""+braces[1]+"\">";result+="<mrow>";var columnlinesAttribute="";if(columnlines!==0&&cols-1>0){var k=-1;while(++k<cols-1){columnlinesAttribute+=(cols-1+columnlines===k?"solid ":"none ");}
columnlinesAttribute=columnlinesAttribute.slice(0,-1);}
var useColumnspacing=verticalStrike!==-1||horizontalStrike!==-1||pivotCell!=undefined||cellIdGenerator!=undefined;result+="<mtable"+(useColumnspacing?" rowspacing=\"0ex\""+" columnspacing=\"0em\"":" rowspacing=\"0ex\"")+(variableNames!=undefined?" columnalign=\"right\"":"")+(columnlinesAttribute!==""?" columnlines=\""+columnlinesAttribute+"\"":"")+">";while(++i<rows){var j=-1;result+="<mtr>";if(variableNames!=undefined){var row="";var wasNotZero=false;while(++j<cols-1){row+="<mtd>";row+=printPartOfAddition(j===cols-2,!wasNotZero,x.e(i,j),new Expression.Symbol(variableNames[j]),options);row+="</mtd>";wasNotZero=wasNotZero||!x.e(i,j).equals(RPN.ZERO);}
row+="<mtd><mo>=</mo></mtd><mtd>"+x.e(i,cols-1).toMathML(options)+"</mtd>";if(wasNotZero||!x.e(i,cols-1).equals(RPN.ZERO)){result+=row;}}else{while(++j<cols){result+="<mtd"+(cellIdGenerator!=undefined?" id=\""+cellIdGenerator(i,j)+"\"":"")+">";if(pivotCell!=undefined&&i===pivotCell.i&&j===pivotCell.j){result+="<mstyle mathvariant=\"bold\">";result+="<menclose notation=\"circle\">";}
if(verticalStrike!==-1||horizontalStrike!==-1){result+="<menclose notation=\"none "+(verticalStrike===j?" "+"verticalstrike":"")+(horizontalStrike===i?" "+"horizontalstrike":"")+"\">";}
if(useColumnspacing){result+="<mpadded width=\"+0.8em\" lspace=\"+0.4em\">";}
var highlight=j<i&&isLUDecomposition2||highlightRow===i&&(columnlines===0||j<=cols-1+columnlines)||highlightCol===j;if(highlight){result+="<mrow mathbackground=\"#80FF80\">";}
result+=x.e(i,j).toMathML(options);if(highlight){result+="</mrow>";}
if(useColumnspacing){result+="</mpadded>";}
if(verticalStrike!==-1||horizontalStrike!==-1){result+="</menclose>";}
if(pivotCell!=undefined&&i===pivotCell.i&&j===pivotCell.j){result+="</menclose>";result+="</mstyle>";}
result+="</mtd>";}}
result+="</mtr>";}
result+="</mtable>";result+="</mrow>";result+="</mfenced>";if(useMatrixContainer){result+="</menclose>";result+="</mrow>";result+="<mrow>";result+="<mtext data-x=\"TODO\">";result+="<button type=\"button\" class=\"matrix-menu-show matrix-menu-show-new\" data-for-matrix=\""+containerId+"\" aria-haspopup=\"true\">&#9776;</button>";result+="</mtext>";result+="</mrow>";result+="</munder>";}
return result;};Expression.Determinant.prototype.toMathML=function(options){var x=this;if(x.a instanceof Expression.Matrix||(x.a instanceof NonSimplifiedExpression&&x.a.e instanceof Expression.Matrix)){options=Object.assign({},options,{useBraces:["|","|"]});return x.a.toMathML(options);}
return"<mfenced open=\""+"|"+"\" close=\""+"|"+"\"><mrow>"+x.a.toMathML(options)+"</mrow></mfenced>";};Expression.Transpose.prototype.toMathML=function(options){var x=this;return"<msup><mrow>"+x.a.toMathML(options)+"</mrow><mrow><mi>T</mi></mrow></msup>";};Expression.SquareRoot.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
return"<msqrt><mrow>"+this.a.toMathML(Expression.setTopLevel(true,options))+"</mrow></msqrt>";};Expression.CubeRoot.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
return"<mroot><mrow>"+this.a.toMathML(Expression.setTopLevel(true,options))+"</mrow><mrow><mi>"+3+"</mi></mrow></mroot>";};Expression.NthRoot.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
return"<mroot><mrow>"+this.a.toMathML(Expression.setTopLevel(true,options))+"</mrow><mrow><mi>"+this.n+"</mi></mrow></mroot>";};Expression.Function.prototype.toMathML=function(options){var x=this;var fa=!(x.a instanceof Expression.Matrix)&&!(x.a instanceof NonSimplifiedExpression&&x.a.e instanceof Expression.Matrix);return"<mrow>"+"<mi>"+(x.name==="rank"?i18n.rankDenotation:(x.name==="sin"?i18n.sinDenotation:x.name))+"</mi>"+"<mo>&#8289;</mo>"+
(fa?"<mfenced open=\"(\" close=\")\"><mrow>":"")+
x.a.toMathML(Expression.setTopLevel(true,options))+
(fa?"</mrow></mfenced>":"")+"</mrow>";};Expression.Division.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
var x=this;var denominator=x.getDenominator();var numerator=x.getNumerator();return"<mfrac><mrow>"+numerator.toMathML(Expression.setTopLevel(true,options))+"</mrow><mrow>"+denominator.toMathML(Expression.setTopLevel(true,options))+"</mrow></mfrac>";};Expression.Integer.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
var x=this;var tmp=x.toString();return(tmp.slice(0,1)==="-"?"<mo>&minus;</mo><mn>"+tmp.slice(1)+"</mn>":"<mn>"+tmp+"</mn>");};Expression.BinaryOperation.prototype.toMathML=function(options){var d=Expression.toDecimalString(this,options);if(d!=undefined){return d;}
var a=this.a;var b=this.b;var isSubtraction=false;if(this instanceof Expression.Addition&&b.isNegative()){isSubtraction=true;b=b.negateCarefully();}
var fa=a.getPrecedence()+(a.isRightToLeftAssociative()?-1:0)<this.getPrecedence();var fb=this.getPrecedence()+(this.isRightToLeftAssociative()?-1:0)>=b.getPrecedence();if(options!=undefined&&options.isTopLevel!=undefined&&options.isTopLevel===false){fa=fa||a.isUnaryPlusMinus();}
fb=fb||b.isUnaryPlusMinus();fb=fb||(this.unwrap()instanceof Expression.Exponentiation&&b.unwrap()instanceof Expression.Exponentiation);fa=fa||(this.unwrap()instanceof Expression.Exponentiation&&a.unwrap()instanceof Expression.Function);var s=isSubtraction?"-":this.getS();if(this instanceof Expression.Exponentiation){return"<msup>"+"<mrow>"+
(fa?"<mfenced open=\"(\" close=\")\"><mrow>":"")+a.toMathML(Expression.setTopLevel(fa||options==undefined||options.isTopLevel,options))+(fa?"</mrow></mfenced>":"")+"</mrow>"+"<mrow>"+
(fb?"<mfenced open=\"(\" close=\")\"><mrow>":"")+b.toMathML(Expression.setTopLevel(fb,options))+(fb?"</mrow></mfenced>":"")+"</mrow>"+"</msup>";}
if(this.isNegation()){return"<mrow><mo>&minus;</mo>"+(fb?"<mfenced open=\"(\" close=\")\"><mrow>":"")+b.toMathML(Expression.setTopLevel(fb,options))+(fb?"</mrow></mfenced>":"")+"</mrow>";}
return"<mrow>"+
(fa?"<mfenced open=\"(\" close=\")\"><mrow>":"")+a.toMathML(Expression.setTopLevel(fa||options==undefined||options.isTopLevel,options))+(fa?"</mrow></mfenced>":"")+"<mo>"+(s==="*"?"&times;":(s==="-"?"&minus;":s))+"</mo>"+
(fb?"<mfenced open=\"(\" close=\")\"><mrow>":"")+b.toMathML(Expression.setTopLevel(fb,options))+(fb?"</mrow></mfenced>":"")+"</mrow>";};Expression.Symbol.prototype.toMathML=function(options){var x=this;var s=x.symbol;var i=s.indexOf("_");if(i!==-1){var indexes=s.slice(i+1).replace(/^\(|\)$/g,"").split(",");var indexesMathML="";for(var j=0;j<indexes.length;j+=1){indexesMathML+=(j!==0?"<mo>,</mo>":"")+
(/^\d+$/.exec(indexes[j])!=undefined?"<mn>":"<mi>")+
indexes[j]+
(/^\d+$/.exec(indexes[j])!=undefined?"</mn>":"</mi>");}
return"<msub>"+"<mrow>"+"<mi>"+s.slice(0,i)+"</mi>"+"</mrow>"+"<mrow>"+indexesMathML+"</mrow>"+"</msub>";}
return"<mi>"+s+"</mi>";};Expression.Negation.prototype.toMathML=function(options){var b=this.b;var fb=this.getPrecedence()+(this.isRightToLeftAssociative()?-1:0)>=b.getPrecedence();fb=fb||b.isUnaryPlusMinus();return"<mrow><mo>&minus;</mo>"+(fb?"<mfenced open=\"(\" close=\")\"><mrow>":"")+b.toMathML(Expression.setTopLevel(fb,options))+(fb?"</mrow></mfenced>":"")+"</mrow>";};Expression.prototype.toMathML=function(options){throw new Error();};var getInputValue=function(value,type){var v=value.replace(/^\s+|\s+$/g,"");if((v==="-"||v==="+")&&(type==="system"||type==="polynomial")){return v+"1";}
if(v===""){return"0";}
return value;};RPN.getElementsArray=function(matrixTableState){var mode=matrixTableState.mode;var type=matrixTableState.type;var textareaValue=matrixTableState.textareaValue;var inputValues=matrixTableState.inputValues;if(mode!=="cells"){if(type==="system"){var s=textareaValue;var lines=s.split("\n");var k=-1;var ok=true;var rows=[];var frees=[];var variableToColumnNumberMap={};var columnNumberToVariableMap=[];var free=undefined;var row=undefined;var onVariable=function(coefficient,variable){if(variable===""){free=free.add(coefficient);}else{var columnIndex=variableToColumnNumberMap[variable];if(columnIndex==undefined){columnIndex=columnNumberToVariableMap.length;variableToColumnNumberMap[variable]=columnIndex;columnNumberToVariableMap.push(variable);}
while(row.length<columnIndex+1){row.push(RPN.ZERO);}
row[columnIndex]=row[columnIndex].add(coefficient);}};while(ok&&++k<lines.length){var line=lines[k].replace(/^\s+|\s+$/g,"");if(line.indexOf("=")!==-1&&line.split("=").length===2){row=[];free=RPN.ZERO;var x=line.split("=");try{var y=RPN(x[0]).subtract(RPN(x[1])).getNumerator();Expression.fillLinearEquationVariablesMap(y,onVariable);}catch(error){ok=false;global.console.log(error);}
frees.push(free);rows.push(row);}else{if(line!==""){ok=false;}}}
if(ok){var a=-1;while(++a<rows.length){row=rows[a];while(row.length<columnNumberToVariableMap.length){row.push(RPN.ZERO);}
row.push(frees[a].negate());}
var b=-1;while(++b<rows.length){row=rows[b];var c=-1;while(++c<row.length){row[c]=row[c].toString();}}
b=-1;while(++b<rows.length){row=rows[b];var f=-1;var d=row.length-1;while(++f<--d){var tmp=row[f];row[f]=row[d];row[d]=tmp;}}
var newColumnNumberToVariableMap=[];b=-1;while(++b<columnNumberToVariableMap.length){newColumnNumberToVariableMap.push(columnNumberToVariableMap[columnNumberToVariableMap.length-1-b]);}
columnNumberToVariableMap=newColumnNumberToVariableMap;return{elements:rows,variableNames:columnNumberToVariableMap};}}
var resultRows=Matrix.split(textareaValue);return{elements:resultRows,variableNames:undefined};}
for(var i=0;i<inputValues.length;i+=1){for(var j=0;j<inputValues[i].length;j+=1){inputValues[i][j]=getInputValue(inputValues[i][j],type);}}
return{elements:inputValues,variableNames:undefined};};var getMatrixWithVariableNames=function(matrixTableState){var tmp=RPN.getElementsArray(matrixTableState);if(tmp.elements.length===0){throw new RangeError("ValueMissingError:"+matrixTableState.firstInputElementId);}
return{matrix:Matrix.toMatrix(tmp.elements),variableNames:tmp.variableNames};};RPN.addDenotations("rank",{bg:"ранг",de:"rang",en:"rank",es:"rango",fr:"rg",gl:"rango",it:"rango",pt:"posto",tr:"rank"},["bg","de","en","es","fr","gl","it","pt","tr"]);RPN.addDenotations("sin",{en:"sin",es:"sen"},["en","es"]);RPN.addDenotations("tan",{en:"tan",ru:"tg"},["en","ru"]);RPN.addDenotations("transpose",{es:"traspuesta",},["es"]);var getResultAndHTML=function(expression,variableNames,result,printOptions){var resultHTML="";if(result instanceof Expression.NoAnswerExpression){var name=result.name;var matrix=result.a.matrix;var second=result.second;if(name==="solve"){resultHTML="";}else{resultHTML=Expression.Details.getCallback(name)(printOptions,matrix,second==undefined?variableNames:second);}}else if(result instanceof Expression.Equality){resultHTML="";resultHTML+="<div>"+"<math>"+expression.toMathML(printOptions)+"</math>"+"</div>";resultHTML+="<div>"+"<math>"+result.toMathML(printOptions)+"</math>"+"</div>";}else{resultHTML="<math>"+expression.toMathML(printOptions)+"<mo>=</mo>"+result.toMathML(printOptions)+"</math>";}
return{result:result,html:resultHTML};};var createDetailsSummary=function(idPrefix,details,bestMethodsLimit){bestMethodsLimit=bestMethodsLimit==undefined?1:bestMethodsLimit;var s="";for(var j=0;j<details.length;j+=1){var rows=details[j].matrix.split("},").length;var type=details[j].type;var items=[];for(var i=0;i<Expression.Details.details.length;i+=1){var x=Expression.Details.details[i];if(x.type.indexOf(type)===0&&rows>=x.minRows&&rows<=x.maxRows){if(true){var jsonObject=[{type:x.type,matrix:details[j].matrix,second:details[j].second}];var item=""+"<div class=\"details-container\">"+"<details data-id-prefix=\""+idPrefix+"\" "+"data-details=\""+Utils.escapeHTML(JSON.stringify(jsonObject))+"\""+">"+"<summary>"+i18n.summaryLabel+(x.i18n!=undefined?" ("+x.i18n()+")":"")+"</summary>"+"<div class=\"indented\"></div>"+"</details>"+"</div>";items.push(item);}}}
var groupId=idPrefix+"-"+RPN.id();if(items.length>bestMethodsLimit+1){s+=items.slice(0,bestMethodsLimit).join("");s+="<div id=\""+groupId+"\" role=\"group\" hidden>";s+=items.slice(bestMethodsLimit).join("");s+="</div>";s+="<button type=\"button\" class=\"more-button\" aria-expanded=\"false\" aria-controls=\""+groupId+"\">&hellip;</button>";}else{s+=items.join("");}}
return s;};Matrix.prototype.minorMatrix=function(k,l){var that=this;return Matrix.Zero(this.rows()-1,this.cols()-1).map(function(e,i,j){return that.e(i<k?i:i+1,j<l?j:j+1);});};Expression.Minor=function(matrix,i,j){Expression.Determinant.call(this,matrix);this.i=i;this.j=j;};Expression.Minor.prototype=Object.create(Expression.Determinant.prototype);Expression.Minor.prototype.toMathML=function(options){options=Object.assign({},options,{horizontalStrike:this.i,verticalStrike:this.j,useBraces:["|","|"]});return this.a.toMathML(options);};Expression.p=function(s,args,printOptions){var result="";var parts=s.split("=");for(var i=0;i<parts.length;i+=1){if(i!==0){result+="<mo>=</mo>";}
args=args==undefined?undefined:args;var e=RPN(parts[i],new RPN.Context(function(id){return args!=undefined&&args[id]!=undefined?args[id]:undefined;}));result+=e.toMathML(printOptions);}
return result;};Expression.Details=function(){};Expression.Details.details=[];Expression.Details.getCallback=function(type){for(var i=0;i<Expression.Details.details.length;i+=1){if(Expression.Details.details[i].type===type){return Expression.Details.details[i].callback;}}
return undefined;};Expression.Details.add=function(data){var x={type:data.type,i18n:data.i18n,minRows:data.minRows==undefined?3:data.minRows,maxRows:data.maxRows==undefined?1 / 0:data.maxRows,priority:data.priority==undefined?1:data.priority,callback:data.callback};Expression.Details.details.push(x);var i=Expression.Details.details.length-1;while(i>=1&&Expression.Details.details[i-1].priority<x.priority){Expression.Details.details[i]=Expression.Details.details[i-1];i-=1;}
Expression.Details.details[i]=x;if(x.type!=="multiply"&&x.type!=="pow"&&x.type!=="special-determinant"){RPN.addOperation(x.type,x.type==="expand-along-column"||x.type==="expand-along-row"||x.type==="obtain-zeros-in-column"||x.type==="obtain-zeros-in-row"||x.type==="polynomial-multiply"||x.type==="multiply"||x.type==="pow"?2:1);}};Expression.Details.add({type:"Gaussian-elimination",minRows:2,callback:function(printOptions,matrix){var html=Expression.rowReductionGaussJordanMontante(matrix,Matrix.Gauss,"",Expression.rowReduceChangeToHTML,printOptions,function(tmp){return"";});return html;}});Expression.Details.add({type:"diagonalize",minRows:2,callback:function(printOptions,matrix){var results=Expression.diagonalize(printOptions,matrix);var resultHTML="";var detailsHTML="<div class=\"details-container\"><details open=\"open\"><summary>"+i18n.summaryLabel+"</summary><div class=\"indented\">"+results.html+"</div></details></div>";if(results.message!==""){resultHTML="<div>"+results.message+"</div>"+detailsHTML;}else{resultHTML="<math>"+new Expression.Matrix(matrix).toMathML(printOptions)+"<mo>=</mo>"+new Expression.Matrix(results.T).toMathML(printOptions)+"<mo>&times;</mo>"+new Expression.Matrix(results.L).toMathML(printOptions)+"<mo>&times;</mo>"+new Expression.Matrix(results.T_INVERSED).toMathML(printOptions)+"</math>"+detailsHTML;}
return resultHTML;}});var getAdjugateByDefinition=function(printOptions,matrix){var result="";var cofactors=new Array(matrix.rows());for(var i=0;i<matrix.rows();i+=1){cofactors[i]=new Array(matrix.cols());for(var j=0;j<matrix.cols();j+=1){result+="<div>";result+="<math>";result+="<msub><mrow><mi>C</mi></mrow><mrow><mn>${i}</mn><mn>${j}</mn></mrow></msub><mo>=</mo>".replace(/\$\{j\}/g,(j+1).toString()).replace(/\$\{i\}/g,(i+1).toString());result+=Expression.p("(-1)^(i+j)",{i:RPN((i+1).toString()),j:RPN((j+1).toString())},printOptions);result+="<mo>&times;</mo>";result+=new Expression.Minor(new Expression.Matrix(matrix),i,j).toMathML(printOptions);var minorMatrix=matrix.minorMatrix(i,j);var minor=minorMatrix.determinant();var isOdd=(i+j)-2*Math.floor((i+j)/ 2);var n=isOdd===1?RPN.ONE.negate():RPN.ONE;var c=n.multiply(minor);if(minorMatrix.rows()===2){result+="<munder><mrow><mo>=</mo></mrow><mrow><mtext data-x=\"TODO\">"+i18n.determinant2x2Link+"</mtext></mrow></munder>";result+=Expression.p("n*(a*d-b*c)",{n:n,a:minorMatrix.e(0,0),b:minorMatrix.e(0,1),c:minorMatrix.e(1,0),d:minorMatrix.e(1,1)},printOptions);}
if(isOdd===1){result+="<mo>=</mo>";result+=Expression.p("n*(d)",{n:n,d:minor},printOptions);}
result+="<mo>=</mo>";result+=Expression.p("c",{c:c},printOptions);result+="</math>";if(minorMatrix.rows()!==2){result+=createDetailsSummary(printOptions.idPrefix,[{type:minorMatrix.getDeterminantEventType("determinant").type,matrix:minorMatrix.toString(),second:undefined}]);}
cofactors[i][j]=c;result+="</div>";}}
var CT=new Expression.Matrix(new Matrix(cofactors).transpose());return{result:result,CT:CT};};Expression.Details.add({type:"adjugate-by-definition",i18n:undefined,priority:0,callback:function(printOptions,matrix){var tmp=getAdjugateByDefinition(printOptions,matrix);var result=tmp.result;var CT=tmp.CT;result+="<div>";result+="<math>";result+=Expression.p("adjugate(A)=C^T=Y",{A:new Expression.Matrix(matrix),Y:CT},printOptions);result+="</math>";result+=i18n.adjugateMatrixLink;result+="</div>";return result;}});Expression.Details.add({type:"inverse-adjugate",i18n:function(){return i18n.inverseDetailsUsingAdjugateMatrix;},priority:0,callback:function(printOptions,matrix){var result="";result+="<div>";result+="<math>";result+=Expression.p("A^-1=1/determinant(A)*C^T=1/determinant(A)*X",{X:new Expression.Matrix(matrix.map(function(e,i,j){return new Expression.Symbol("C_"+(j+1).toString()+(i+1).toString());}))},printOptions);result+="</math>";result+=i18n.inverseDetailsUsingAdjugateMatrixLink;result+="</div>";var determinant=matrix.determinant();result+="<div>";result+="<math>";result+=Expression.p("determinant(A)=X=y",{X:new Expression.Determinant(new Expression.Matrix(matrix)),y:determinant},printOptions);result+="</math>";result+=createDetailsSummary(printOptions.idPrefix,[{type:matrix.getDeterminantEventType("determinant").type,matrix:matrix.toString(),second:undefined}]);result+="</div>";if(determinant.equals(RPN.ZERO)){}else{var tmp=getAdjugateByDefinition(printOptions,matrix);result+=tmp.result;var CT=tmp.CT;result+="<div>";result+="<math>";result+=Expression.p("A^-1=1/determinant(A)*C^T=1/x*Y=Z",{x:determinant,Y:CT,Z:determinant.inverse().multiply(CT)},printOptions);result+="</math>";result+="</div>";}
return result;}});var roman=function(n){var digits="IVXLCDM";var i=digits.length+1;var result="";var value=1000;while((i-=2)>=0){var v=Math.floor(value / 10);var j=-1;while(++j<2){while(n>=value){n-=value;result+=digits.slice(i-j,i-j+1);}
value-=v;while(n>=value){n-=value;result+=digits.slice(i-2,i-2+1)+digits.slice(i-j,i-j+1);}
value-=4*v;}
value=v;}
return result;};var getMatrixRowDenotation=function(i){return i18n.matrixRowDenotation.replace(/\$\{i\}/g,i.toString()).replace(/\$\{i\:roman\}/g,roman(i));};Matrix.prototype.getDeterminantEventType=function(base){for(var i=0;i<this.rows();i+=1){var isZero=true;for(var j=0;j<this.cols();j+=1){var e=this.e(i,j);if(!e.equals(Expression.Integer.ZERO)){isZero=false;}}
if(isZero){return{type:"special-determinant",row:i,col:-1};}}
for(var j=0;j<this.cols();j+=1){var isZero=true;for(var i=0;i<this.rows();i+=1){var e=this.e(i,j);if(!e.equals(Expression.Integer.ZERO)){isZero=false;}}
if(isZero){return{type:"special-determinant",row:-1,col:j};}}
return{type:base,row:-1,col:-1};};Expression.Details.add({type:"special-determinant",i18n:undefined,priority:0,callback:function(printOptions,matrix){var html="";var x=matrix.getDeterminantEventType();html+="<div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(Object.assign({},printOptions,{highlightRow:x.row!==-1?x.row:undefined,highlightCol:x.col!==-1?x.col:undefined}))+"<mo>=</mo><mn>0</mn>";html+="</math>";if(x.row!==-1||x.col!==-1){html+="<div>"+i18n.zeroRowColumn+"</div>";}
html+="</div>";return html;}});Expression.Details.add({type:"determinant-Gauss",i18n:function(){return i18n.methodOfGauss;},priority:1,callback:function(printOptions,matrix){var html="";html+="<div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";html+="<p>"+i18n.determinantDetails.start+"</p>";html+=Expression.rowReductionGaussJordanMontante(matrix,Matrix.Gauss,"determinant",Expression.rowReduceChangeToHTML,printOptions,function(tmp){var rowEchelonMatrix=tmp.rowEchelonMatrix;var html="";html+="<div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Determinant(new Expression.Matrix(rowEchelonMatrix)).toMathML(printOptions);html+="<mo>=</mo>";var result=rowEchelonMatrix.determinant();if(!result.equals(RPN.ZERO)){var det=rowEchelonMatrix.e(0,0);det=new NonSimplifiedExpression(det);for(var j=1;j<rowEchelonMatrix.rows();j+=1){det=new Expression.Multiplication(det,rowEchelonMatrix.e(j,j));det=new NonSimplifiedExpression(det);}
html+=det.toMathML(printOptions);html+="<mo>=</mo>";}
html+=result.toMathML(printOptions);html+="</math>";html+="</div>";return html;});return html;}});Expression.Details.add({type:"rank-Gauss",i18n:function(){return i18n.methodOfGauss;},minRows:2,priority:1,callback:function(printOptions,matrix){var html="";html+="<div>";html+="<math>";html+=new Expression.Rank(new Expression.Matrix(matrix)).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";html+="<p>"+i18n.rankDetails.start+"</p>";html+=Expression.rowReductionGaussJordanMontante(matrix,Matrix.Gauss,"",Expression.rowReduceChangeToHTML,printOptions,function(tmp){var rowEchelon=tmp.rowEchelonMatrix;var html="";html+="<div>";html+="<math>";html+=new Expression.Rank(new Expression.Matrix(matrix)).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Rank(new Expression.Matrix(rowEchelon)).toMathML(printOptions);html+="<mo>=</mo>";html+="<mn>"+rowEchelon.rank().toString()+"</mn>";html+="</math>";html+="</div>";return html;});return html;}});Expression.Details.add({type:"inverse-Gauss",i18n:function(){return i18n.methodOfGaussJordan;},priority:1,callback:function(printOptions,matrix){var html="";html+="<div>";html+="<math>";html+=new Expression.Exponentiation(new Expression.Matrix(matrix),Expression.Integer.ONE.negate()).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";html+="<p>"+i18n.inverseDetails.start+"</p>";var augmented=matrix.augment(Matrix.I(matrix.rows()));html+=Expression.rowReductionGaussJordanMontante(augmented,Matrix.GaussJordan,"inverse",Expression.rowReduceChangeToHTML,Object.assign({},printOptions,{columnlines:-matrix.cols()}),function(tmp){var html="";var augmentedResult=tmp.rowEchelonMatrix;var hasZeroElement=false;for(var i=0;i<augmentedResult.rows();i+=1){if(augmentedResult.e(i,i).equals(RPN.ZERO)){hasZeroElement=true;}}
if(!hasZeroElement){var result=Matrix.Zero(matrix.rows(),matrix.rows()).map(function(element,i,j){var e=augmentedResult.e(i,i);var x=augmentedResult.e(i,j+augmentedResult.rows());return e.equals(RPN.ONE)?x:x.divide(e);});html+="<div>";html+="<math>";html+=new Expression.Exponentiation(new Expression.Matrix(matrix),Expression.Integer.ONE.negate()).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Matrix(result).toMathML(printOptions);html+="</math>";html+="</div>";}else{}
return html;});return html;}});Expression.Details.add({type:"multiply",i18n:function(){return i18n.matrixMultiplication;},minRows:2,maxRows:undefined,priority:1,callback:function(printOptions,matrixA,matrixB){var html="";html+="<p>"+i18n.matrixMultiplicationInfo+"</p>";var matrixAn=matrixA.map(function(e,i,j){return new NonSimplifiedExpression(e);});var matrixBn=matrixB.map(function(e,i,j){return new NonSimplifiedExpression(e);});var matrixAB=matrixAn.multiply(matrixBn);var resultOfMultiplication=matrixAB.map(function(e,i,j){return e.simplify();});html+="<math>";html+=new Expression.Matrix(matrixAn).toMathML(Object.assign({},printOptions,{cellIdGenerator:function(i,j){return matrixAn.e(i,j).getId();}}));html+="<mo>&times;</mo>";html+=new Expression.Matrix(matrixBn).toMathML(Object.assign({},printOptions,{cellIdGenerator:function(i,j){return matrixBn.e(i,j).getId();}}));html+="<mo>=</mo>";html+=new Expression.Matrix(matrixAB).toMathML(Object.assign({},printOptions,{cellIdGenerator:function(i,j){return matrixAB.e(i,j).getId();}}));html+="<mo>=</mo>";html+=new Expression.Matrix(resultOfMultiplication).toMathML(printOptions);html+="</math>";matrixAB.map(function(e,i,j){html+="<a class=\"a-highlight\" data-for=\""+e.getId().toString()+"\" data-highlight=\""+e.unwrap().getIds()+"\"></a>";return e;});return html;}});Expression.Details.add({type:"pow",i18n:function(){return i18n.matrixMultiplication;},minRows:1,maxRows:undefined,priority:1,callback:function(printOptions,matrix,second){var n=Number.parseInt(second.e(0,0).toString(),10);var i=0;var c=1;var t=[];t.push(matrix);var html="<ul>";html+="<li>";html+="<math>";html+=Expression.p("A",undefined,printOptions)+"<mo>=</mo>"+new Expression.Matrix(t[i]).toMathML(printOptions);html+="</math>";html+="</li>";while(c*2<=n){c*=2;t.push(t[i].multiply(t[i]));html+="<li>";html+="<math>";html+=Expression.p("A^"+c.toString(),undefined,printOptions)+"<mo>=</mo>"+Expression.p("A^"+Math.floor(c / 2).toString()+"*"+"A^"+Math.floor(c / 2).toString(),undefined,printOptions)+"<mo>=</mo>"+new Expression.Matrix(t[i+1]).toMathML(printOptions);html+="</math>";html+="</li>";i+=1;}
html+="</ul>";var result=undefined;var r=undefined;var nn=n;while(i!==-1&&nn!==0){if(nn>=c){nn-=c;result=result==undefined?t[i]:result.multiply(t[i]);var z=new Expression.NonSimplifiedExpression(new Expression.Symbol("A").pow(RPN(c.toString())));r=r==undefined?z:r.multiply(z);}
c=Math.floor(c / 2);i-=1;}
html+="<math>";html+=Expression.p("A^"+n.toString(),undefined,printOptions)+"<mo>=</mo>"+r.toMathML(printOptions)+"<mo>=</mo>"+new Expression.Matrix(result).toMathML(printOptions);html+="</math>";return html;}});Expression.someDetailsNew={"determinant2x2":"<span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,0],[1,1]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[0,1],[1,0]]\"><math><mrow><mfenced open=\"|\" close=\"|\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mtd></mtr></mtable></mrow></mfenced><mo>=</mo><mrow><mrow mathcolor=\"#D64040\"><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mrow><mo>&minus;</mo><mrow mathcolor=\"#4040D6\"><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mrow></mrow></mrow></math></span></span>${link}","determinant3x3":"<math><mrow><mfenced open=\"|\" close=\"|\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></mtd></mtr></mtable></mrow></mfenced><mo>=</mo></mrow></math>","matrix3x3":"<math><mtable rowspacing=\"0ex\"><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></mtd></mtr></mtable></math>","determinantTriangle":"${determinant3x3}<table class=\"some-details-table\"><tr><td><math><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,0],[1,1],[2,2]]\">${matrix3x3}</span></td></tr><tr><td><math><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,1],[1,2],[2,0]]\">${matrix3x3}</span></span></td></tr><tr><td><math><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,1],[1,2],[2,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,2],[1,0],[2,1]]\">${matrix3x3}</span></span></span></td></tr><tr><td><math><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,1],[1,2],[2,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,2],[1,0],[2,1]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[2,0],[1,1],[0,2]]\">${matrix3x3}</span></span></span></span></td></tr><tr><td><math><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,1],[1,2],[2,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,2],[1,0],[2,1]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1\" data-cells=\"[[2,0],[1,1],[0,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[2,1],[1,2],[0,0]]\">${matrix3x3}</span></span></span></span></span></td></tr><tr><td><math><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></math>${link}</td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,1],[1,2],[2,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,2],[1,0],[2,1]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1\" data-cells=\"[[2,0],[1,1],[0,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1\" data-cells=\"[[2,1],[1,2],[0,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[2,2],[1,0],[0,1]]\">${matrix3x3}</span></span></span></span></span></span></td></tr></table>","matrix5x3":"<math><mtable rowspacing=\"0ex\" columnlines=\"none none dashed none\"><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub></mtd><mtd mathcolor=\"#808080\"><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></mtd></mtr></mtable></math>","determinantSarrus":"${determinant3x3}<table class=\"some-details-table\"><tr><td><math><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub><mo>+</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub></math></td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,1],[1,2],[2,3]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,2],[1,3],[2,4]]\">${matrix5x3}</span></span></span></td></tr><tr><td><math><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>13</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>22</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>31</mn></mrow></msub><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>11</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>23</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>32</mn></mrow></msub><mo>&minus;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>12</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>21</mn></mrow></msub><mo>&times;</mo><msub><mrow><mi>a</mi></mrow><mrow><mn>33</mn></mrow></msub></math>${link}</td><td><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,0],[1,1],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,1],[1,2],[2,3]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"0\" data-cells=\"[[0,2],[1,3],[2,4]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[0,2],[1,1],[2,0]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[0,3],[1,2],[2,1]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[0,4],[1,3],[2,2]]\">${matrix5x3}</span></span></span></span></span></span></td></tr></table>","someDetails3":"<span data-custom-paint=\"custom-menclose\" data-color=\"0a\" data-cells=\"[[0,0],[2,2]]\"><span data-custom-paint=\"custom-menclose\" data-color=\"1a\" data-cells=\"[[0,2],[2,0]]\"><math><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mstyle mathvariant=\"bold\"><menclose notation=\"circle\"><msub><mrow><mi>a</mi></mrow><mrow><mi>r</mi><mo>,</mo><mi>c</mi></mrow></msub></menclose></mstyle></mtd><mtd><mtext>&hellip;</mtext></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mi>r</mi><mo>,</mo><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd><mtext>&#8942;</mtext></mtd><mtd><mrow></mrow></mtd><mtd><mtext>&#8942;</mtext></mtd></mtr><mtr><mtd><msub><mrow><mi>a</mi></mrow><mrow><mi>i</mi><mo>,</mo><mi>c</mi></mrow></msub></mtd><mtd><mtext>&hellip;</mtext></mtd><mtd><msub><mrow><mi>a</mi></mrow><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mtd></mtr></mtable></mrow></math></span></span>",};Expression.getSomeDetails=function(id,printOptions){var s=Expression.someDetailsNew[id];return s.replace(/\$\{determinant3x3\}/g,Expression.someDetailsNew.determinant3x3).replace(/\$\{matrix3x3\}/g,Expression.someDetailsNew.matrix3x3).replace(/\$\{matrix5x3\}/g,Expression.someDetailsNew.matrix5x3);};Expression.Details.add({type:"inverse-2x2",i18n:undefined,minRows:2,maxRows:2,priority:1,callback:function(printOptions,matrix){var html="";html+="<div>";html+=i18n.inverse2x2;html+=" ";html+="<math>";html+=Expression.p("A^-1={{a, b}, {c, d}}^-1=1/determinant(A)*{{C_11, C_21}, {C_21, C_22}}=1/(a*d-b*c)*{{d, -b}, {-c, a}}",undefined,printOptions);html+="</math>";html+=i18n.inverse2x2Link;html+="</div>";var det=matrix.e(0,0).multiply(matrix.e(1,1)).subtract(matrix.e(0,1).multiply(matrix.e(1,0)));html+="<math>";html+=Expression.p("A^-1=1/(a*d-b*c)*{{d, n}, {m, a}}"+(det.equals(RPN.ZERO)?"=1/0*{{d, n}, {m, a}}":"=t"),{A:new Expression.Matrix(matrix),a:matrix.e(0,0),b:matrix.e(0,1),c:matrix.e(1,0),d:matrix.e(1,1),n:matrix.e(0,1).negate(),m:matrix.e(1,0).negate(),t:det.equals(RPN.ZERO)?undefined:new Expression.Matrix(matrix.inverse())},printOptions);html+="</math>";return html;}});Expression.Details.add({type:"determinant-2x2",i18n:undefined,minRows:2,maxRows:2,priority:1,callback:function(printOptions,matrix){var html="<div>"+Expression.getSomeDetails("determinant2x2",printOptions).replace(/\$\{link\}/g,i18n.determinant2x2Link)+"</div>";var determinantResult=matrix.e(0,0).multiply(matrix.e(1,1)).subtract(matrix.e(0,1).multiply(matrix.e(1,0)));html+="<math>";html+=Expression.p("determinant(A)=a*d-b*c=r",{A:new Expression.Matrix(matrix),a:matrix.e(0,0),b:matrix.e(0,1),c:matrix.e(1,0),d:matrix.e(1,1),r:determinantResult},printOptions);html+="</math>";return html;}});function Myelem(m,a,z){this.m=m;this.a=a;this.z=z;}
var getDeterminant=function(m,k,r,z,koef){if(m.cols()===1){return m.e(0,0);}
var o=RPN.ZERO;var complement=function(elem,r,c){return m.e(r>=i?r+1:r,c>=k?c+1:c);};var i=-1;while(++i<m.cols()){var mx=Matrix.Zero(m.rows()-1,m.cols()-1).map(complement);var kk=koef.multiply(m.e(i,k));if(2*Math.floor((i+k)/ 2)!==i+k){kk=kk.negate();}
r.push(new Myelem(mx,kk,z));o=o.add(m.e(i,k).multiply(getDeterminant(mx,0,r,z+1,kk)));}
return o;};Expression.detfindDet=function(m,byRow,num,printOptions){var r=[];var k=Number.parseInt(num,10)-1;if(!m.isSquare()){throw new RangeError("NonSquareMatrixException");}
if(k>=m.rows()||k<0||k!==Math.floor(k)){throw new RangeError("IntegerInputError"+":"+num);}
r.push(new Myelem(m,RPN.ONE,0));if(byRow){getDeterminant(m.transpose(),k,r,1,RPN.ONE);var l=-1;while(++l<r.length){r[l].m=r[l].m.transpose();}}else{getDeterminant(m,k,r,1,RPN.ONE);}
var html="";html+="<math>";var z=r[0].m.cols()-1;var i=-1;while(++i<z){var j=-1;var e=undefined;while(++j<r.length){if(r[j].z===i&&!r[j].a.equals(RPN.ZERO)){var current=undefined;var det=new Expression.Determinant(new Expression.Matrix(r[j].m));if(i===0&&r[j].a.equals(RPN.ONE)){current=det;}else{current=new Expression.Multiplication(r[j].a,det);}
e=e==undefined?current:new Expression.Addition(e,current);}}
if(e!=undefined){html+=e.toMathML(printOptions);html+="<mo>=</mo>";}}
html+=m.determinant().toMathML(printOptions);html+="</math>";return html;};Expression.Details.add({type:"eigenvectors",callback:function(printOptions,matrix){return Expression.findEVectors(printOptions,matrix);}});Expression.Details.add({type:"expand-along-column",callback:function(printOptions,matrix,columnNumber){return Expression.detfindDet(matrix,false,columnNumber.toString(),printOptions);}});Expression.Details.add({type:"expand-along-row",callback:function(printOptions,matrix,rowNumber){return Expression.detfindDet(matrix,true,rowNumber.toString(),printOptions);}});Expression.Details.add({type:"obtain-zeros-in-column",callback:function(printOptions,matrix,columnNumber){return Expression.getZero(matrix,false,columnNumber.toString(),printOptions);}});Expression.Details.add({type:"obtain-zeros-in-row",callback:function(printOptions,matrix,rowNumber){return Expression.getZero(matrix,true,rowNumber.toString(),printOptions);}});var determinant3x3=function(printOptions,matrix,text){var containerId=printOptions.idPrefix+"-"+RPN.id();if(matrix.cols()!==3||matrix.rows()!==3){throw new RangeError("NonSquareMatrixException:"+i18n.theRuleOfSarrusCanBeUsedOnlyWith3x3Matrices);}
var matrixId=containerId;var cellId=function(i,j){return matrixId+"_"+i.toString()+"_"+j.toString();};var html="";html+="<div>"+text+"</div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(Object.assign({},printOptions,{cellIdGenerator:function(i,j){return cellId(i,j);}}));html+="<mo>=</mo>";var z=["a_11*a_22*a_33","a_12*a_23*a_31","a_13*a_21*a_32","a_31*a_22*a_13","a_32*a_23*a_11","a_33*a_21*a_12"];var context=new RPN.Context(function(id){return matrix.e(Number.parseInt(id.slice(2,3),10)-1,Number.parseInt(id.slice(3,4),10)-1);});var determinant=undefined;for(var i=0;i<z.length;i+=1){var e=RPN(z[i],context);if(i!==0){var sign=i<3?"+":"&minus;";html+="<mo>"+sign+"</mo>";}
var highlight=z[i].replace(/a_(\d)(\d)\*?/g,function(x,si,sj){var i=Number.parseInt(si,10)-1;var j=Number.parseInt(sj,10)-1;return"#"+cellId(i,j)+", ";}).slice(0,-2);html+="<munder>";html+="<mrow id=\""+(matrixId+"_x"+i.toString())+"\">";html+=e.toMathML(Object.assign({},printOptions,{isTopLevel:false}));html+="</mrow>";html+="<mrow>";html+="<mtext data-x=\"TODO\">";html+="<a class=\"a-highlight\" data-for=\""+(matrixId+"_x"+i.toString())+"\" data-highlight=\""+highlight+"\"></a>";html+="</mtext>";html+="</mrow>";html+="</munder>";determinant=i===0?e:(i<3?determinant.add(e):determinant.subtract(e));}
html+="<mo>=</mo>";html+=determinant.simplify().toMathML(printOptions);html+="</math>";return html;};Expression.Details.add({type:"determinant-Sarrus",i18n:function(){return i18n.ruleOfSarrus;},minRows:3,maxRows:3,priority:3,callback:function(printOptions,matrix){return determinant3x3(printOptions,matrix,Expression.getSomeDetails("determinantSarrus",printOptions).replace(/\$\{link\}/g,i18n.ruleOfSarrusLink));}});Expression.Details.add({type:"determinant-Triangle",i18n:function(){return i18n.ruleOfTriangle;},minRows:3,maxRows:3,priority:4,callback:function(printOptions,matrix){return determinant3x3(printOptions,matrix,Expression.getSomeDetails("determinantTriangle",printOptions).replace(/\$\{link\}/g,i18n.ruleOfTriangleLink));}});Matrix.permutations=function(n,callback){if(n<1){return;}
if(n!==Math.floor(n)){throw new RangeError();}
var p=new Array(n);var even=true;var i=-1;while(++i<n){p[i]=i;}
var k=0;var l=0;var t=0;while(true){callback(p,even);k=n-2;l=n-1;while(k>=0&&p[k]>p[k+1]){k-=1;}
if(k<0){return;}
while(p[k]>p[l]){l-=1;}
t=p[k];p[k]=p[l];p[l]=t;even=!even;i=k+1;while(i<n-i+k){t=p[n-i+k];p[n-i+k]=p[i];p[i]=t;even=!even;i+=1;}}};Matrix.prototype.determinantLeibniz=function(){if(!this.isSquare()){throw new RangeError("NonSquareMatrixException");}
var determinant=undefined;var matrix=this;Matrix.permutations(this.cols(),function(p,even){var t=undefined;for(var i=0;i<p.length;i+=1){t=t==undefined?matrix.e(i,p[i]):t.multiply(matrix.e(i,p[i]));}
determinant=determinant==undefined?(even?t:t.negate()):(even?determinant.add(t):determinant.subtract(t));});return determinant;};Expression.Details.add({type:"determinant-Leibniz",i18n:function(){return i18n.formulaOfLeibniz;},minRows:4,maxRows:6,priority:-1,callback:function(printOptions,matrix){var html="";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions);html+="<mo>=</mo>";html+=matrix.map(function(e,i,j){return new NonSimplifiedExpression(e);}).determinantLeibniz().toMathML(printOptions);html+="<mo>=</mo>";html+=matrix.determinantLeibniz().toMathML(printOptions);html+="</math>";return html;}});Expression.mgetZero=function(m,k){var r=[];var i=0;while(i<m.rows()&&m.e(i,k).equals(RPN.ZERO)){i+=1;}
if(i<m.rows()){var j=-1;while(++j<m.rows()){if(j!==i){m=m.rowReduce(j,i,k);r.push(m);}}}
return r;};Expression.getZero=function(matrix,atRow,a,printOptions){var k=Number.parseInt(a,10)-1;if(!matrix.isSquare()){throw new RangeError("NonSquareMatrixException");}
if(k>=matrix.rows()||k<0||k!==Math.floor(k)){throw new RangeError("IntegerInputError"+":"+a);}
var html="";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions)+"<mo>=</mo>";var dets=Expression.mgetZero(atRow?matrix.transpose():matrix,k);var i=-1;while(++i<dets.length){html+=(i===0?"":"<mo>=</mo>")+new Expression.Determinant(new Expression.Matrix(atRow?dets[i].transpose():dets[i])).toMathML(printOptions);}
html+="<mo>=</mo>";html+=matrix.determinant().toMathML(printOptions);html+="</math>";return html;};Matrix.trimRight=function(x){var lastColumn=0;x.map(function(e,i,j){if(lastColumn<j&&!e.equals(RPN.ZERO)){lastColumn=j;}
return e;});return x.slice(0,x.rows(),0,lastColumn+1);};var testSLECompatibility=function(printOptions,fullMatrix){if(fullMatrix.cols()<2){throw new RangeError("ValueMissingError:A-textarea");}
var st="<h4>"+i18n.textAnalyseCompatibility+"</h4>";st+="<p>"+i18n.analyseCompatibilityIntroduction+"</p>";var m=Matrix.trimRight(fullMatrix.slice(0,fullMatrix.rows(),0,fullMatrix.cols()-1));var b=fullMatrix.slice(0,fullMatrix.rows(),fullMatrix.cols()-1,fullMatrix.cols());var augmented=m.augment(b);var results=[];var w=function(result){if(result.c1==undefined&&result.c2==undefined){results.push(result);}else{w(result.a1());w(result.a2());}};w(augmented.toRowEchelonXXX(Matrix.GaussMontante,"",undefined,Condition.TRUE));if(results.length>1){st+="<ol>";}
for(var i=0;i<results.length;i+=1){st+=results.length>1?"<li><div>"+"<math>"+results[i].condition.toMathML(printOptions)+"</math>":"";var t=results[i].matrix;var mRank=t.slice(0,t.rows(),0,t.cols()-1).rank();var augmentedRank=t.rank();st+="<div>";st+="<math>";st+=new Expression.Rank(new Expression.Matrix(augmented)).toMathML(Object.assign({},printOptions,{columnlines:-1}))+"<mo>=</mo><mn>"+augmentedRank.toString()+"</mn>";st+="</math>";st+="</div>";st+="<div>";st+="<math>";st+=new Expression.Rank(new Expression.Matrix(m)).toMathML(printOptions)+"<mo>=</mo><mn>"+mRank.toString()+"</mn>";st+="</math>";st+="</div>";st+="<div>";if(mRank===augmentedRank){if(m.cols()===mRank){st+=i18n.textAn1a;}else{st+=i18n.textAn1b;}}else{st+=i18n.textAn2;}
st+="</div>";st+=results.length>1?"</div></li>":"";}
if(results.length>1){st+="</ol>";}
st+=createDetailsSummary(printOptions.idPrefix,[{type:"rank",matrix:augmented.toString(),second:undefined}]);return st;};Expression.Details.add({type:"analyse-compatibility",i18n:function(){return i18n.testForConsistency;},priority:1,callback:function(printOptions,matrix){return testSLECompatibility(printOptions,matrix);}});var outSystem=function(printOptions,matrix,variableNames){return new Expression.Matrix(matrix).toMathML(Object.assign({},printOptions,{variableNames:variableNames,useBraces:["{"," "]}));};var makeDefaultVariableNames=function(count){var variableNames=new Array(count);for(var i=0;i<count;i+=1){variableNames[i]="x_"+(i+1).toString();}
return variableNames;};var solveUsingCramersRule=function(printOptions,fullMatrix,variableNames){if(fullMatrix.cols()<2){throw new RangeError("ValueMissingError:A-textarea");}
if(variableNames==undefined){variableNames=makeDefaultVariableNames(fullMatrix.cols()-1);}
var m=Matrix.trimRight(fullMatrix.slice(0,fullMatrix.rows(),0,fullMatrix.cols()-1));var b=fullMatrix.slice(0,fullMatrix.rows(),fullMatrix.cols()-1,fullMatrix.cols());if(!m.isSquare()){throw new RangeError("NonSquareMatrixException:"+i18n.text01);}
var D0=m.determinant();var mstr="";mstr="<h4>"+i18n.solutionByRuleOfCramer+"</h4>";mstr+="<div>";mstr+="<math>";mstr+=outSystem(printOptions,fullMatrix,variableNames);mstr+="</math>";mstr+="</div>";mstr+="<div>";mstr+="<math>";mstr+="<mi>&Delta;</mi>";mstr+="<mo>=</mo>"+new Expression.Determinant(new Expression.Matrix(m)).toMathML(printOptions);mstr+="<mo>=</mo>"+D0.toMathML(printOptions);mstr+="</math>";mstr+="</div>";mstr+=createDetailsSummary(printOptions.idPrefix,[{type:m.getDeterminantEventType("determinant").type,matrix:m.toString(),second:undefined}]);if(D0.equals(RPN.ZERO)){mstr+="<div>";mstr+=i18n.forSolutionUsingCramersRuleCoefficientMatrixShouldHaveNonZeroDeterminant;mstr+="</div>";return mstr;}
var d=new Array(m.cols());var i=0;var detMatrixI=function(elem,row,col){return col===i?b.e(row,0):elem;};i=-1;while(++i<m.cols()){mstr+="<div>";var m1=m.map(detMatrixI);d[i]=m1.determinant();mstr+="<math>";mstr+="<msub><mrow><mi>&Delta;</mi></mrow><mrow><mn>"+(i+1)+"</mn></mrow></msub><mo>=</mo>"+new Expression.Determinant(new Expression.Matrix(m1)).toMathML(printOptions)+"<mo>=</mo>"+d[i].toMathML(printOptions);mstr+="</math>";mstr+="; ";mstr+=createDetailsSummary(printOptions.idPrefix,[{type:m1.getDeterminantEventType("determinant").type,matrix:m1.toString(),second:undefined}]);mstr+="</div>";}
mstr+="<ul>";i=-1;while(++i<m.cols()){mstr+="<li>";mstr+="<math>";mstr+=new Expression.Symbol(variableNames[i]).toMathML(printOptions);var deltaI=new NonSimplifiedExpression(d[i]).divide(new NonSimplifiedExpression(D0));var deltaISimplified=deltaI.simplify();mstr+="<mo>=</mo><msub><mrow><mi>&Delta;</mi></mrow><mrow><mn>"+(i+1)+"</mn></mrow></msub><mo>/</mo><mi>&Delta;</mi>";mstr+="<mo>=</mo>"+deltaI.toMathML(printOptions);if(deltaI.toString()!==deltaISimplified.toString()){mstr+="<mo>=</mo>"+deltaISimplified.toMathML(printOptions);}
mstr+="</math>";mstr+="</li>";}
mstr+="</ul>";mstr+="<div>"+i18n.textAnswer+"</div>";i=-1;while(++i<m.cols()){mstr+="<div>";mstr+="<math>";mstr+=new Expression.Symbol(variableNames[i]).toMathML(printOptions)+"<mo>=</mo>"+d[i].divide(D0).toMathML(printOptions);mstr+="</math>";mstr+="</div>";}
var condition=Condition.TRUE.andNotZero(D0);if(!condition.isTrue()){mstr+="<div>";mstr+="<math>";mstr+="<mo>(</mo>";mstr+=condition.toMathML(printOptions);mstr+="<mo>)</mo>";mstr+="</math>";mstr+="</div>";}
return mstr;};var solveUsingInverseMatrixMethod=function(printOptions,fullMatrix,variableNames){if(fullMatrix.cols()<2){throw new RangeError("ValueMissingError:A-textarea");}
var m=Matrix.trimRight(fullMatrix.slice(0,fullMatrix.rows(),0,fullMatrix.cols()-1));var b=fullMatrix.slice(0,fullMatrix.rows(),fullMatrix.cols()-1,fullMatrix.cols());var mstr="";var c=undefined;if(!m.isSquare()){throw new RangeError("NonSquareMatrixException:"+i18n.text05);}
try{c=m.inverse();}catch(error){if(error instanceof RangeError&&error.message.indexOf("SingularMatrixException")===0){}else{throw error;}}
mstr+="<h4>"+i18n.solutionByInverseMatrixMethod+"</h4>";mstr+="<div>";mstr+="<math>";mstr+="<mi>A</mi><mo>&times;</mo><mi>X</mi><mo>=</mo><mi>B</mi>";mstr+="</math>";mstr+="</div>";mstr+="<div>";mstr+="<math>";mstr+="<mi>A</mi><mo>=</mo>"+new Expression.Matrix(m).toMathML(printOptions);mstr+="</math>";mstr+="</div>";mstr+="<div>";mstr+="<math>";mstr+="<mi>B</mi><mo>=</mo>"+new Expression.Matrix(b).toMathML(printOptions);mstr+="</math>";mstr+="</div>";if(c!=undefined){mstr+="<div>";mstr+="<math>";mstr+="<msup><mrow><mi>A</mi></mrow><mrow><mo>&minus;</mo><mn>1</mn></mrow></msup><mo>=</mo>"+new Expression.Matrix(c).toMathML(printOptions);mstr+="</math>";mstr+="</div>";mstr+=createDetailsSummary(printOptions.idPrefix,[{type:m.getDeterminantEventType("inverse").type,matrix:m.toString(),second:undefined}]);mstr+="<math>";mstr+="<mi>X</mi><mo>=</mo><msup><mrow><mi>A</mi></mrow><mrow><mo>&minus;</mo><mn>1</mn></mrow></msup><mo>&times;</mo><mi>B</mi><mo>=</mo>"+new Expression.Matrix(c).toMathML(printOptions)+"<mo>&times;</mo>"+new Expression.Matrix(b).toMathML(printOptions)+"<mo>=</mo>"+new Expression.Matrix(c.multiply(b)).toMathML(printOptions);mstr+="</math>";}else{mstr+=i18n.toSolveSystemByInverseMatrixMethodCoefficientMatrixShouldHaveNonZeroDeterminant;mstr+=createDetailsSummary(printOptions.idPrefix,[{type:m.getDeterminantEventType("inverse").type,matrix:m.toString(),second:undefined}]);mstr+="<div class=\"for-details\"></div>";}
return mstr;};RPN.idCounter=0;RPN.id=function(){return(RPN.idCounter+=1).toString();};Expression.rowReduceChangeToHTML=function(change,printOptions,containerId,k,stepCondition){var multiplier=change.type==="reduce"?change.oldMatrix.e(change.targetRow,change.pivotColumn).divide(change.oldMatrix.e(change.pivotRow,change.pivotColumn)):undefined;var areBracketsRequired=change.type==="reduce"?multiplier.getPrecedence(multiplier)!==RPN.ZERO.getPrecedence():undefined;var jT="<code>"+(change.targetRow+1).toString()+"</code>";var iT="<code>"+(change.pivotRow+1).toString()+"</code>";var tooltip=(change.type==="swap-negate"?i18n.eliminationDetails.rowSwapNegate.replace(/\$\{\-1\}/g,"<math>"+"<mo>&minus;</mo><mn>1</mn>"+"</math>").replace(/\$\{j\}/g,jT).replace(/\$\{i\}/g,iT):"")+
(change.type==="swap"?i18n.eliminationDetails.rowSwap.replace(/\$\{j\}/g,jT).replace(/\$\{i\}/g,iT):"")+
(change.type==="divide"?i18n.eliminationDetails.rowDivision.replace(/\$\{a\}/g,"<code>"+"<math>"+change.oldMatrix.e(change.pivotRow,change.pivotColumn).toMathML(printOptions)+"</math>"+"</code>").replace(/\$\{j\}/g,jT).replace(/\$\{i\}/g,iT):"")+
(change.type==="reduce"?i18n.eliminationDetails.rowSubtraction.replace(/\$\{a\}/g,"<code>"+"<math>"+(areBracketsRequired?"<mfenced open=\"(\" close=\")\">":"")+"<mrow>"+multiplier.toMathML(printOptions)+"</mrow>"+(areBracketsRequired?"</mfenced>":"")+"</math>"+"</code>").replace(/\$\{j\}/g,jT).replace(/\$\{i\}/g,iT):"");var text="";var cellId=function(containerId,k,i,j){return containerId+"-"+k.toString()+"-"+i.toString()+"-"+j.toString();};var questionId=containerId+"-"+k.toString()+"-"+"question-mark";var tooltipId=questionId+"-"+"tooltip";k+=1;for(var i=0;i<change.oldMatrix.cols();i+=1){if(change.type==="reduce"||change.type==="divide"){var divId=cellId(containerId,k,change.targetRow,i)+"-"+"tooltip";var highlight="<a class=\"a-highlight\" data-for=\""+cellId(containerId,k,change.targetRow,i)+"\" data-highlight=\""+"#"+cellId(containerId,k-1,change.pivotRow,change.pivotColumn)+", "+"#"+cellId(containerId,k-1,change.targetRow,i)+", "+
(change.type==="reduce"?"#"+cellId(containerId,k-1,change.targetRow,change.pivotColumn)+", ":"")+
(change.type==="reduce"?"#"+cellId(containerId,k-1,change.pivotRow,i)+", ":"")+"#"+cellId(containerId,k,change.targetRow,i)+"\"></a>";var tooltips="<a class=\"a-tooltip\" data-for=\""+cellId(containerId,k,change.targetRow,i)+"\" data-tooltip=\""+divId+"\"></a>";text+="<div id=\""+divId+"\">"+"<math>"+
Expression.p("a_"+(change.targetRow+1).toString()+(i+1).toString()+"="+(change.type==="reduce"?"(b-(c/a)*d)":"(b*(1/a))")+"=r",{a:change.oldMatrix.e(change.pivotRow,change.pivotColumn),b:change.oldMatrix.e(change.targetRow,i),c:change.oldMatrix.e(change.targetRow,change.pivotColumn),d:change.oldMatrix.e(change.pivotRow,i),r:change.newMatrix.e(change.targetRow,i)},printOptions)+"</math>"+"</div>"+
highlight+
tooltips;}else if(change.type==="swap"||change.type==="swap-negate"){text+="<a class=\"a-highlight\" data-for=\""+cellId(containerId,k,change.targetRow,i)+"\" data-highlight=\""+"#"+cellId(containerId,k-1,change.pivotRow,i)+", "+"#"+cellId(containerId,k-1,change.targetRow,i)+", "+"#"+cellId(containerId,k,change.targetRow,i)+"\"></a>";text+="<a class=\"a-highlight\" data-for=\""+cellId(containerId,k,change.pivotRow,i)+"\" data-highlight=\""+"#"+cellId(containerId,k-1,change.targetRow,i)+", "+"#"+cellId(containerId,k-1,change.pivotRow,i)+", "+"#"+cellId(containerId,k,change.pivotRow,i)+"\"></a>";}}
return"<span class=\"nowrap\">"+"<math>"+
new Expression.Matrix(change.oldMatrix).toMathML(Object.assign({},printOptions,{columnlines:printOptions.columnlines,cellIdGenerator:function(i,j){return cellId(containerId,k-1,i,j);},pivotCell:change.type==="swap"||change.type==="swap-negate"?undefined:{i:change.pivotRow,j:change.pivotColumn}}))+"</math>"+"  <span class=\"arrow-with-label\" data-custom-paint=\"arrow-with-label\" data-type=\""+change.type+"\" data-start=\""+change.pivotRow+"\" data-end=\""+change.targetRow+"\">"+"    <div class=\"arrow\">"+
(change.type==="swap"||change.type==="swap-negate"||change.pivotRow<change.targetRow?"      <div class=\"arrow-head-bottom\"></div>":"")+
(change.type==="swap"||change.type==="swap-negate"||change.pivotRow>change.targetRow?"      <div class=\"arrow-head-top\"></div>":"")+
(change.type!=="divide"?"      <div class=\"arrow-line\"></div>":"")+"    </div>"+"    <div class=\"label\">"+
(change.type==="swap"?"":(change.type==="swap-negate"?"":"<math>"+(change.type==="divide"?"<mo>&times;</mo>"+"<mfenced open=\"(\" close=\")\"><mrow>"+RPN.ONE.divide(change.oldMatrix.e(change.targetRow,change.pivotColumn)).toMathML(printOptions)+"</mrow></mfenced>":"<mo>&times;</mo>"+"<mfenced open=\"(\" close=\")\"><mrow>"+multiplier.negate().toMathML(printOptions)+"</mrow></mfenced>")+"</math>"))+"    </div>"+"  </span>"+"</span>"+"<span class=\"relative\">"+"<math>"+"<mpadded width=\"+0.8em\" lspace=\"+0.4em\">"+"<munder>"+"<mrow><mo stretchy=\"false\">~</mo></mrow>"+"<mrow>"+
(stepCondition.isTrue()?"":"<munder>")+"<mrow>"+
((change.type==="swap-negate"?"${i}<mo>&harr;</mo><mrow><mo>&minus;</mo>${j}</mrow>":"")+
(change.type==="swap"?"${i}<mo>&harr;</mo>${j}":"")+
(change.type==="divide"?"${j}<mo>/</mo><mfenced open=\"(\" close=\")\"><mrow>${a}</mrow></mfenced><mo>&rarr;</mo>${j}".replace(/\$\{a\}/g,change.oldMatrix.e(change.pivotRow,change.pivotColumn).toMathML(printOptions)):"")+
(change.type==="reduce"?"${j}<mo>&minus;</mo>${a}<mo>&times;</mo>${i}<mo>&rarr;</mo>${j}".replace(/\$\{a\}/g,(areBracketsRequired?"<mfenced open=\"(\" close=\")\">":"")+(printOptions.isLUDecomposition!=undefined?"<mrow mathbackground=\"#80FF80\">":"")+"<mrow>"+multiplier.toMathML(printOptions)+"</mrow>"+(printOptions.isLUDecomposition!=undefined?"</mrow>":"")+(areBracketsRequired?"</mfenced>":"")):"")).replace(/\$\{j\}/g,getMatrixRowDenotation(change.targetRow+1)).replace(/\$\{i\}/g,getMatrixRowDenotation(change.pivotRow+1))+"</mrow>"+
(stepCondition.isTrue()?"":"<mrow>")+
(stepCondition.isTrue()?"":stepCondition.toMathML(printOptions))+
(stepCondition.isTrue()?"":"</mrow>")+
(stepCondition.isTrue()?"":"</munder>")+"</mrow>"+"</munder>"+"</mpadded>"+"</math>"+
(tooltip!==""?"<a class=\"question-icon\" tabindex=\"0\" id=\""+questionId+"\">?</a><a class=\"a-tooltip\" data-for=\""+questionId+"\" data-tooltip=\""+tooltipId+"\"></a><div hidden id=\""+tooltipId+"\">"+tooltip+"</div>":"")+"<span hidden>"+text+"</span>"+"</span>";};function Condition(array){this.array=array;}
Expression.Condition=Condition;Condition.NEZ=" != 0";Condition.EQZ=" == 0";Condition.prototype._and=function(operator,e){if(e==undefined){throw new RangeError();}
if(this===Condition.FALSE){return this;}
if(e instanceof Expression.GF2Value){return this._and(operator,e.value);}
if(e instanceof Expression.NthRoot){return this._and(operator,e.a);}
if(e instanceof Expression.Integer||e instanceof Expression.Complex){if(e.equals(RPN.ZERO)){if(operator===Condition.NEZ){return Condition.FALSE;}
return this;}
if(operator===Condition.EQZ){return Condition.FALSE;}
return this;}
if(operator===Condition.NEZ){if(e instanceof Expression.Multiplication){return this._and(Condition.NEZ,e.a)._and(Condition.NEZ,e.b);}}
if(e instanceof Expression.Division){return this._and(operator,e.a)._and(Condition.NEZ,e.b);}
var isConstant=function(e){if(e instanceof Expression.Integer){return e;}else if(e instanceof Expression.NthRoot){return isConstant(e.a);}else if(e instanceof Expression.Multiplication){return isConstant(e.a)&&isConstant(e.b);}else if(e instanceof Expression.Addition){return isConstant(e.a)&&isConstant(e.b);}};if(isConstant(e)){if(operator===Condition.NEZ){return this;}
if(operator===Condition.EQZ){return Condition.FALSE;}}
var contains=function(array,operator,e){for(var i=0;i<array.length;i+=1){if(array[i].operator===operator&&array[i].expression.equals(e)){return true;}}
return false;};if(contains(this.array,operator,e)){return this;}
var y={operator:operator,expression:e};var newArray=[];for(var i=0;i<this.array.length;i+=1){var x=this.array[i];var isSingleVariablePolynomial=function(e){if(e instanceof Expression.Division){return false;}
var v=Expression.getVariable(e);var p=Polynom.toPolynomial(e,v);for(var i=0;i<=p.getDegree();i+=1){if(!(p.getCoefficient(i)instanceof Expression.Integer)){return false;}}
return true;};if(isSingleVariablePolynomial(x.expression.multiply(y.expression))){if(x.operator===Condition.NEZ&&y.operator===Condition.EQZ||x.operator===Condition.EQZ&&y.operator===Condition.NEZ){var g=x.expression.gcd(y.expression);if(x.operator===Condition.EQZ){y={operator:x.operator,expression:x.expression.divide(g)};}else{y={operator:y.operator,expression:y.expression.divide(g)};}
if(isConstant(y.expression)){return Condition.FALSE;}}else if(x.operator===Condition.EQZ&&y.operator===Condition.EQZ){var g=x.expression.gcd(y.expression);if(g instanceof Expression.Integer){return Condition.FALSE;}
y={operator:y.operator,expression:g};}else{newArray.push(x);}}else{newArray.push(x);}}
newArray.push(y);return new Condition(newArray);};Condition.prototype.andNotZero=function(e){return this._and(Condition.NEZ,e);};Condition.prototype.andZero=function(e){return this._and(Condition.EQZ,e);};Condition.prototype.isFalse=function(){return this===Condition.FALSE;};Condition.prototype.isTrue=function(){return this===Condition.TRUE;};Condition.prototype._toStringInternal=function(toString,comma,neq,eqz){if(this===Condition.FALSE||this===Condition.TRUE||this.array.length===0){return"";}
var s="";for(var i=0;i<this.array.length;i+=1){s+=comma+toString(this.array[i].expression)+(this.array[i].operator===Condition.NEZ?neq:"")+(this.array[i].operator===Condition.EQZ?eqz:"");}
return s.slice(comma.length);};Condition.prototype.toString=function(printOptions){return this._toStringInternal(function(e){return e.toString(printOptions);},", "," != 0"," == 0");};Condition.prototype.toMathML=function(printOptions){return this._toStringInternal(function(e){return e.toMathML(printOptions);},"<mo>,</mo>","<mo>&#8800;</mo><mn>0</mn>","<mo>=</mo><mn>0</mn>");};Condition.TRUE=new Condition(new Array(0));Condition.FALSE=new Condition(undefined);Expression.rowReductionGaussJordanMontante=function(matrix,method,usage,rowReduceChangeToHTML,printOptions,resultCallback,flag0){flag0=flag0==undefined?false:flag0;var containerId=printOptions.idPrefix+"-"+RPN.id();var html="";var k=0;html+="<div>";var outputTailMatrix=function(stoppedAtRow,matrix){html+="<math>";html+=new Expression.Matrix(matrix).toMathML(Object.assign({},printOptions,{cellIdGenerator:function(i,j){return containerId+"-"+k.toString()+"-"+i.toString()+"-"+j.toString();},highlightRow:stoppedAtRow}));html+="</math>";html+="</div>";k+=1;};var oldCondition=Condition.TRUE;var result=matrix.toRowEchelonXXX(method,usage,function(change){var stepCondition=Condition.TRUE;if(usage!=="determinant"&&usage!=="inverse"){stepCondition=Condition.TRUE.andNotZero(change.oldMatrix.e(change.pivotRow,change.pivotColumn));if(!stepCondition.isTrue()){oldCondition=oldCondition.andNotZero(change.oldMatrix.e(change.pivotRow,change.pivotColumn));}}
html+=rowReduceChangeToHTML(change,printOptions,containerId,k,stepCondition);k+=1;},usage!=="determinant"&&usage!=="inverse"&&!flag0?Condition.TRUE:undefined);var w=function(result){if(result.c1==undefined&&result.c2==undefined){outputTailMatrix(result.stoppedAtRow,result.matrix);html+=resultCallback({rowEchelonMatrix:result.matrix,stopped:result.stoppedAtRow!==-1,condition:flag0?oldCondition:result.condition});}else{outputTailMatrix(-1,result.matrix);html+="<ol>";html+="<li>";html+="<div>";html+="<math>";html+=result.c1.toMathML(printOptions);html+="</math>";html+="</div>";html+="<div>";w(result.a1());html+="</li>";html+="<li>";html+="<div>";html+="<math>";html+=result.c2.toMathML(printOptions);html+="</math>";html+="</div>";html+="<div>";w(result.a2());html+="</li>";html+="</ol>";}};w(result);return html;};function Result(value,condition){this.value=value;this.condition=condition;}
Result.prototype.toString=function(){return this.value.toString()+(this.condition.isTrue()?"":" if "+this.condition.toString());};Expression.solveByGauss=function(printOptions,fullMatrix,variableNames,options){if(fullMatrix.cols()<2){throw new RangeError("ValueMissingError:A-textarea");}
var containerId=printOptions.idPrefix+"-"+RPN.id();var moreText=options.moreText;var eigenvectors=options.eigenvectors;var freeVariablesXXX=options.freeVariablesXXX;var m=fullMatrix.slice(0,fullMatrix.rows(),0,fullMatrix.cols()-1);if(eigenvectors==undefined&&variableNames==undefined){m=Matrix.trimRight(m);}
var b=fullMatrix.slice(0,fullMatrix.rows(),fullMatrix.cols()-1,fullMatrix.cols());if(variableNames==undefined){variableNames=makeDefaultVariableNames(fullMatrix.cols()-1);}
b=Matrix.Zero(m.rows(),1).map(function(element,row,col){return row<b.rows()&&col<b.cols()?b.e(row,col):0;});var OSLU=1;for(var i=0;i<b.rows()&&OSLU===1;i+=1){if(!b.e(i,0).equals(RPN.ZERO)){OSLU=0;}}
var augmented=m.augment(b);var mstr="";if(moreText){mstr+="<h4>"+options.method.i18n+"</h4>";mstr+="<div>"+i18n.convertTheAugmentedMatrixIntoTheRowEchelonForm+"</div>";}
var solutions=[];mstr+=Expression.rowReductionGaussJordanMontante(augmented,options.method.id,"solving",options.method.rowReduceChangeToHTML,Object.assign({},printOptions,{columnlines:-1}),function(result){var tmp=Expression.solveByGaussNext(result,printOptions,variableNames,moreText,OSLU,fullMatrix,eigenvectors,freeVariablesXXX,containerId);containerId=printOptions.idPrefix+"-"+RPN.id();solutions.push(tmp.result||"");return tmp.mstr;},eigenvectors!=undefined);if(options.solution){return solutions;}
return mstr;};Expression.solveByGaussNext=function(ms,printOptions,variableNames,moreText,OSLU,fullMatrix,eigenvectors,freeVariablesXXX,containerId){var mstr="";var condition=ms.condition;var m=ms.rowEchelonMatrix;var systemId=containerId+"-"+"system_1";mstr+="<div class=\"anchor\" id=\""+systemId+"\"><table class=\"system-table\"><tr><td>"+"<math>"+outSystem(printOptions,m,variableNames)+"</math>"+"</td><td><a href=\"#"+systemId+"\">(1)</a></td></tr></table></div>";var noSolutions=ms.stopped;var createVector=function(size){var vector=new Array(size);for(var n=0;n<size;n+=1){vector[n]=RPN.ZERO;}
return vector;};var isEquals=function(a,b){if(a.length!==b.length){return false;}
for(var i=1;i<a.length;i+=1){if(!(a[i]instanceof NonSimplifiedExpression)||!(b[i]instanceof NonSimplifiedExpression)){throw new TypeError();}
if(!a[i].e.equals(b[i].e)){return false;}}
return true;};if(noSolutions){mstr+="<div>"+i18n.thereAreNoSolutions+"</div>";}else{var freeVariablesCount=0;var solutions=new Array(m.cols()-1);var solutionSymbols=new Array(m.cols());for(var i=0;i<m.cols();i+=1){solutionSymbols[i]=undefined;}
for(var j=0;j<m.cols()-1;j+=1){solutions[j]=undefined;}
mstr+="<ul>";for(var i=m.rows()-1;i>=0;i-=1){var j=0;while(j<m.cols()-1&&m.e(i,j).equals(RPN.ZERO)){j+=1;}
var k=j;if(i===0){k=-1;}
if(j<m.cols()-1){solutions[j]=createVector(m.cols());}
while(++k<m.cols()-1){if(solutions[k]==undefined){freeVariablesCount+=1;solutions[k]=createVector(m.cols());solutions[k][freeVariablesCount]=RPN.ONE;solutionSymbols[freeVariablesCount]=new Expression.Symbol(variableNames[k]);}}
if(j<m.cols()-1){solutions[j][0]=m.e(i,m.cols()-1);for(var k=j+1;k<m.cols()-1;k+=1){if(!m.e(i,k).equals(RPN.ZERO)){for(var n=0;n<m.cols();n+=1){solutions[j][n]=solutions[j][n].subtract(m.e(i,k).multiply(solutions[k][n]));}}}
if(!m.e(i,j).equals(RPN.ONE)){for(var n=0;n<m.cols();n+=1){solutions[j][n]=solutions[j][n].divide(m.e(i,j));}}
condition=condition.andNotZero(m.e(i,j));mstr+="<li>";mstr+="<div>";mstr+=i18n.fromEquationIFindVariable.replace(/\$\{i\}/g,"<math>"+"<mn>"+(i+1).toString()+"</mn>"+"</math>").replace(/\$\{x\}/g,"<math>"+new Expression.Symbol(variableNames[j]).toMathML(printOptions)+"</math>").replace(/\$\{#system_1\}/g,"<a href=\"#"+systemId+"\">(1)</a>");mstr+="</div>";mstr+="<div>";var equation=undefined;equation=[];var equationSymbols1=[];var equationSymbols2=[];equation.push(m.e(i,m.cols()-1));equationSymbols1.push(undefined);equationSymbols2.push(undefined);for(var k=j+1;k<m.cols()-1;k+=1){if(!m.e(i,k).equals(RPN.ZERO)){equation.push(m.e(i,k).negate());equationSymbols1.push(new NonSimplifiedExpression(new Expression.Symbol(variableNames[k])));equationSymbols2.push(new NonSimplifiedExpression(polynomToExpression2(solutions[k],solutionSymbols)));}}
mstr+="<math>";var leftPartCoefficient=m.e(i,j);var leftPartVariable=new Expression.Symbol(variableNames[j]);var leftPart=(leftPartCoefficient.equals(RPN.ONE)?leftPartVariable:new Expression.Multiplication(leftPartCoefficient,leftPartVariable));mstr+=leftPart.toMathML(printOptions);mstr+="<mo>=</mo>";var beforeSubstitution=polynomToExpression2(equation,equationSymbols1).toMathML(Object.assign({},printOptions,{printId:true}));mstr+=beforeSubstitution;var afterSubstitution=polynomToExpression2(equation,equationSymbols2).toMathML(Object.assign({},printOptions,{printId:true}));if(!isEquals(equationSymbols1,equationSymbols2)){mstr+="<mo>=</mo>";mstr+=afterSubstitution;}
var equation3=[];var equationSymbols3=[];for(var k=0;k<m.cols();k+=1){var t=solutions[j][k].multiply(m.e(i,j));if(k===0||!t.equals(RPN.ZERO)){equation3.push(t);equationSymbols3.push(solutionSymbols[k]==undefined?undefined:new NonSimplifiedExpression(solutionSymbols[k]));}}
var afterSimplification=polynomToExpression2(equation3,equationSymbols3).toMathML(printOptions);if(!isEquals(equationSymbols2,equationSymbols3)){mstr+="<mo>=</mo>";mstr+=afterSimplification;}
mstr+="</math>";mstr+="<div hidden>";for(var k=1;k<equationSymbols1.length;k+=1){if(!equationSymbols2[k].e.equals(equationSymbols1[k].e)){mstr+="<a class=\"a-highlight\" data-for=\""+equationSymbols2[k].getId()+"\" data-highlight=\""+equationSymbols1[k].getId()+"\"></a>";}}
mstr+="</div>";var afterDivision=polynomToExpression2(solutions[j],solutionSymbols).toMathML(printOptions);if(!m.e(i,j).equals(RPN.ONE)){mstr+="<div>";mstr+="<math>";mstr+="<mstyle mathvariant=\"bold\">";mstr+="<mrow>";mstr+=new Expression.Symbol(variableNames[j]).toMathML(printOptions);mstr+="<mo>=</mo>";mstr+=afterDivision;mstr+="</mrow>";mstr+="</mstyle>";mstr+="</math>";mstr+="</div>";}
mstr+="</div>";mstr+="</li>";}}
mstr+="</ul>";var solutionsExpressions=new Array(m.cols()-1);for(var i=0;i<m.cols()-1;i+=1){solutionsExpressions[i]=polynomToExpression2(solutions[i],solutionSymbols);}
var solutionsExpressionsData=new Array(1);solutionsExpressionsData[0]=solutionsExpressions;var solutionsExpressionsMatrix=new Matrix(solutionsExpressionsData).transpose();if(moreText){mstr+="<div>"+i18n.textAnswer+"</div>";mstr+="<div class=\"like-table\">";mstr+="<div>";mstr+="<div>";mstr+="<ul>";for(var i=0;i<m.cols()-1;i+=1){mstr+="<li>";mstr+="<math>";mstr+=new Expression.Symbol(variableNames[i]).toMathML(printOptions)+"<mo>=</mo>"+solutionsExpressions[i].toMathML(printOptions);mstr+="</math>";mstr+="</li>";}
mstr+="</ul>";mstr+="</div>";if(!condition.isTrue()){mstr+="<div>";mstr+="<math>";mstr+="<mo>(</mo>";mstr+=condition.toMathML(printOptions);mstr+="<mo>)</mo>";mstr+="</math>";mstr+="</div>";if(global.hit!=undefined){global.hit({condition:condition.toString()+"::"+fullMatrix.toString()});}}
mstr+="</div>";mstr+="</div>";}else{mstr+="<div>"+(moreText?i18n.textGeneralSolution:"")+" "+"<math>"+"<mi>X</mi><mo>=</mo>"+new Expression.Matrix(solutionsExpressionsMatrix).toMathML(printOptions)+"</math>"+"</div>";}
if((moreText||eigenvectors!=undefined)&&OSLU===1&&freeVariablesCount>0){var fundamentalSystemHTML="";for(var i=1;i<=freeVariablesCount;i+=1){var bx=new Array(m.cols()-1);var j=-1;while(++j<m.cols()-1){bx[j]=solutions[j][i];}
var matrixData=new Array(1);matrixData[0]=bx;var basisVector=new Matrix(matrixData).transpose();if(moreText){var basisVectorHTML=new Expression.Matrix(basisVector).toMathML(printOptions);fundamentalSystemHTML+=solutionSymbols[i].toMathML(printOptions)+"<mo>&times;</mo>"+basisVectorHTML;fundamentalSystemHTML+=(i!==freeVariablesCount?"<mo>+</mo>":"");}
if(eigenvectors!=undefined){eigenvectors.push(basisVector);}
if(eigenvectors!=undefined&&freeVariablesXXX!=undefined){freeVariablesXXX.push(solutionSymbols[i].toMathML(printOptions));}}
if(moreText){mstr+="<div>"+i18n.textFundamentalSystem+" "+"<math>"+"<mo>{</mo>"+fundamentalSystemHTML+"<mo>}</mo>"+"</math>"+"</div>";}}
return{mstr:mstr,result:new Result(solutionsExpressionsMatrix,condition)};}
return{mstr:mstr,result:undefined};};Expression.Details.add({type:"solve-using-Cramer's-rule",i18n:function(){return i18n.solveByCrammer;},minRows:1,priority:1,callback:function(printOptions,matrix,variableNames){return solveUsingCramersRule(printOptions,matrix,variableNames);}});Expression.Details.add({type:"solve-using-inverse-matrix-method",i18n:function(){return i18n.solveByInverse;},minRows:1,priority:1,callback:function(printOptions,matrix,variableNames){return solveUsingInverseMatrixMethod(printOptions,matrix,variableNames);}});Polynom.toM=function(polynomial,roots){var np=polynomial;var content=np.getContent();np=np.divide(Polynom.of(content));for(var i=0;i<roots.length;i+=1){np=np.divide(Polynom.of(roots[i].negate(),RPN.ONE));}
return Polynom.toM1(content,np,roots);};Polynom.toM1=function(c,np,roots){var e=undefined;if(!c.equals(RPN.ONE)){e=e!=undefined?new Expression.Multiplication(e,c):c;}
for(var i=0;i<roots.length;i+=1){var p=Polynom.of(roots[i].negate(),RPN.ONE);e=e!=undefined?new Expression.Multiplication(e,p):p;}
if(roots.length===0||!np.equals(RPN.ONE)){e=e!=undefined?new Expression.Multiplication(e,np):np;}
return e;};Expression.getEigenvalues=function(printOptions,matrix){if(!matrix.isSquare()){throw new RangeError("NonSquareMatrixException");}
var determinant=matrix.map(function(e,i,j){return i===j?Polynom.of(e,RPN.ONE.negate()):(e.equals(RPN.ZERO)?Polynom.ZERO:Polynom.of(e));}).determinant();determinant=determinant.map(function(e){return e.simplifyExpression();});var characteristicPolynomial=determinant;var roots=characteristicPolynomial.getroots();var i=-1;var uniqueRoots=[];while(++i<roots.length){var isDuplicate=false;var j=-1;var root=roots[i];while(++j<uniqueRoots.length){if(uniqueRoots[j].equals(root)){isDuplicate=true;}}
if(!isDuplicate){uniqueRoots.push(root);}}
var html="";var variableName="\u03BB";var lambda=new Expression.Symbol(variableName);var matrixWithLambdas=matrix.map(function(element,i,j){return new NonSimplifiedExpression(i===j?new Expression.Addition(element,new Expression.Negation(lambda)):element);});html+="<li>";html+="<div>";html+=i18n.findEigenvaluesFromTheCharacteristicPolynomial;html+="</div>";html+="<div>";printOptions=Object.assign({},printOptions,{polynomialVariable:lambda});html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrixWithLambdas)).toMathML(printOptions)+"<mo>=</mo>"+characteristicPolynomial.toMathML(printOptions);if(roots.length!==0){html+="<mo>=</mo>";html+=Polynom.toM(characteristicPolynomial,roots).toMathML(printOptions);}
html+="</math>";html+="</div>";html+=createDetailsSummary(printOptions.idPrefix,[{type:"determinant",matrix:matrixWithLambdas.toString(),second:undefined}]);var n=-1;while(++n<roots.length){html+="<div>";html+="<math>";html+="<msub><mrow><mi>&lambda;</mi></mrow><mrow><mn>"+(n+1)+"</mn></mrow></msub><mo>=</mo>"+roots[n].toMathML(printOptions);html+="</math>";html+="</div>";}
html+="</li>";return{eigenvalues:{unique:uniqueRoots,all:roots},html:html};};Expression.getEigenvectors=function(printOptions,matrix,eigenvalues){var html="";html+="<li>";html+="<div>";html+=i18n.text13;html+="</div>";var eigenvectors=[];var eigenvaluesForEachVector=[];var i=-1;html+="<ol>";while(++i<eigenvalues.length){html+="<li>";var mm=matrix.subtract(Matrix.I(matrix.cols()).scale(eigenvalues[i]));var array=[];var freeVariablesXXX=[];var fullMatrix=mm.augment(Matrix.Zero(mm.cols(),1));var solutionHTML=Expression.solveByGauss(printOptions,fullMatrix,undefined,{moreText:false,method:{i18n:i18n.solutionByGaussJordanElimination,id:Matrix.GaussJordan,rowReduceChangeToHTML:Expression.rowReduceChangeToHTML},eigenvectors:array,freeVariablesXXX:freeVariablesXXX});var j=-1;while(++j<array.length){var eigenvector=array[j];eigenvectors.push(eigenvector);eigenvaluesForEachVector.push(i);}
html+="<div class=\"anchor\" id=\""+(printOptions.idPrefix+"-eigenvalue-"+(i+1))+"\">";html+="<math>";html+="<msub><mrow><mi>&lambda;</mi></mrow><mrow><mn>"+(i+1)+"</mn></mrow></msub>";html+="<mo>=</mo>"+eigenvalues[i].toMathML(printOptions);html+="</math>";html+="</div>";html+="<div>";html+="<math>";html+="<mi>A</mi><mo>&minus;</mo><mi>&lambda;</mi><mo>&times;</mo><mi>E</mi><mo>=</mo>"+new Expression.Matrix(mm).toMathML(printOptions);html+="</math>";html+="</div>";html+="<div>";html+="<span>";html+="<math>";html+="<mi>A</mi><mo>&minus;</mo><mi>&lambda;</mi><mo>&times;</mo><mi>E</mi><mo>=</mo><mi>O</mi>";html+="</math>";html+="</span>, ";html+=i18n.text12;html+="</div>";html+="<div>"+solutionHTML+"</div>";html+="<div>";for(var j=0;j<array.length;j+=1){var eigenvector=array[j];var index=eigenvaluesForEachVector.length-array.length+j+1;html+=j!==0?" ; ":"";html+=i18n.Let;html+=" ";html+="<math>";for(var k=0;k<freeVariablesXXX.length;k+=1){html+=k!==0?"<mo>,</mo>":"";html+=freeVariablesXXX[k]+"<mo>=</mo>"+"<mn>"+(k===j?1:0)+"</mn>";}
html+="</math>";html+=", ";html+="<div style=\"display: inline-block;\" class=\"anchor\" id=\""+(printOptions.idPrefix+"-eigenvector-"+index)+"\">";html+="<math>";html+="<mstyle mathvariant=\"bold\">";html+="<mrow>";html+=Expression.p("v_"+index+"=V",{V:new Expression.Matrix(eigenvector)},printOptions);html+="</mrow>";html+="</mstyle>";html+="</math>";html+="</div>";}
html+="<div>";html+="</li>";}
html+="</ol>";html+="</li>";return{html:html,eigenvectors:eigenvectors,eigenvaluesForEachVector:eigenvaluesForEachVector};};Expression.findEVectors=function(printOptions,matrix){if(!matrix.isSquare()){throw new RangeError("NonSquareMatrixException");}
var html="";html+="<ol>";var tmp=Expression.getEigenvalues(printOptions,matrix);var eigenvalues=tmp.eigenvalues.unique;html+=tmp.html;if(eigenvalues.length>0){var tmp2=Expression.getEigenvectors(printOptions,matrix,eigenvalues);html+=tmp2.html;}else{html+="<li>";html+=i18n.text14;html+="</li>";}
html+="</ol>";return html;};Expression.diagonalize=function(printOptions,matrix){if(!matrix.isSquare()){throw new RangeError("NonSquareMatrixException");}
var html="";html+="<ol>";var tmp=Expression.getEigenvalues(printOptions,matrix);var eigenvalues=tmp.eigenvalues.unique;var rootsCountWithDuplicates=tmp.eigenvalues.all.length;html+=tmp.html;if(rootsCountWithDuplicates<matrix.cols()){html+="</ol>";return{T:undefined,L:undefined,T_INVERSED:undefined,html:html,message:i18n.notEnoughRationalEigenvalues};}
var tmp2=Expression.getEigenvectors(printOptions,matrix,eigenvalues);html+=tmp2.html;var eigenvectors=tmp2.eigenvectors;var eigenvaluesForEachVector=tmp2.eigenvaluesForEachVector;if(eigenvectors.length<matrix.cols()){var message=i18n.notDiagonalizable.replace(/\$\{n\}/g,matrix.cols());html+="</ol>";return{T:undefined,L:undefined,T_INVERSED:undefined,html:html,message:message};}
var L=Matrix.I(eigenvaluesForEachVector.length).map(function(element,i,j){return(i===j?eigenvalues[eigenvaluesForEachVector[i]]:RPN.ZERO);});var T=Matrix.I(matrix.cols()).map(function(e,i,j){return eigenvectors[j].e(i,0);});html+="<li>";html+="<ul>";html+="<li>";var eigenvaluesLinks="";for(var i=0;i<eigenvaluesForEachVector.length;i+=1){eigenvaluesLinks+=i===0?"":", ";eigenvaluesLinks+="<a href=\"#"+printOptions.idPrefix+"-eigenvalue-"+(eigenvaluesForEachVector[i]+1)+"\"><math>"+Expression.p("\u03BB_"+(eigenvaluesForEachVector[i]+1),undefined,printOptions)+"</math></a>";}
html+="<div>"+i18n.theDiagonalMatrixTheDiagonalEntriesAreTheEigenvalues.replace(/\$\{eigenvaluesLinks\}/g,eigenvaluesLinks)+"</div>";html+="<math>"+Expression.p("D=M",{M:new Expression.Matrix(L)},printOptions)+"</math>";html+="</li>";html+="<li>";var eigenvectorsLinks="";for(var i=0;i<eigenvectors.length;i+=1){eigenvectorsLinks+=i===0?"":", ";eigenvectorsLinks+="<a href=\"#"+printOptions.idPrefix+"-eigenvector-"+(i+1)+"\"><math>"+Expression.p("v_"+(i+1),undefined,printOptions)+"</math></a>";}
html+="<div>"+i18n.theMatrixWithTheEigenvectorsAsItsColumns.replace(/\$\{eigenvectorsLinks\}/g,eigenvectorsLinks)+"</div>";html+="<math>"+Expression.p("P=M",{M:new Expression.Matrix(T)},printOptions)+"</math>";html+="</li>";html+="<li>";html+="<math>"+Expression.p("P^-1=M",{M:new Expression.Matrix(T.inverse())},printOptions)+"</math>";html+=createDetailsSummary(printOptions.idPrefix,[{type:T.getDeterminantEventType("inverse").type,matrix:T.toString(),second:undefined}]);html+="</li>";html+="<li>";html+="<math>"+Expression.p("A=P^-1*D*P",undefined,printOptions)+"</math>";html+=i18n.matrixDiagonalizationLink;html+="</li>";html+="</ul>";html+="</li>";html+="</ol>";return{T:T,L:L,T_INVERSED:T.inverse(),html:html,message:""};};var polyfromtable=function(m){var coefficients=new Array(m.cols());for(var i=0;i<m.cols();i+=1){coefficients[i]=m.e(0,m.cols()-1-i);}
return Polynom.from(coefficients);};Expression.getPolynomialRoots=function(printOptions,matrix){var p=polyfromtable(matrix);var roots=p.getroots();var html="";html+="<div>";html+="<math>";html+="<mrow>";html+=p.toMathML(printOptions);html+="</mrow>";if(roots.length!==0){html+="<mo>=</mo>";html+=Polynom.toM(p,roots).toMathML(printOptions);}
html+="</math>";html+="</div>";html+="<div>";html+="Roots:";if(roots.length===0){html+=" ? ";}
html+="<ul>";for(var k=0;k<roots.length;k+=1){html+="<li>"+"<math>"+roots[k].toMathML(printOptions)+"</math>"+"</li>";}
html+="</ul>";html+="</div>";return html;};Expression.multiplyPolynomials=function(printOptions,matrixA,matrixB){var pA=polyfromtable(matrixA);var pB=polyfromtable(matrixB);var result=pA.multiply(pB);return"<math>"+"<mrow>"+"<mfenced open=\"(\" close=\")\"><mrow>"+pA.toMathML(printOptions)+"</mrow></mfenced>"+"<mo>&times;</mo>"+"<mfenced open=\"(\" close=\")\">"+pB.toMathML(printOptions)+"</mfenced>"+"<mo>=</mo>"+result.toMathML(printOptions)+"</mrow>"+"</math>";};Expression.Details.add({type:"polynomial-roots",minRows:1,callback:function(printOptions,matrix){return Expression.getPolynomialRoots(printOptions,matrix);}});Expression.Details.add({type:"polynomial-multiply",minRows:1,callback:function(printOptions,matrix,second){return Expression.multiplyPolynomials(printOptions,matrix,second.matrix);}});RPN.getMatrix=function(s){var matrix=undefined;if(matrix==undefined){var match=/[\t\n\r]/.exec(s);if(match!=undefined){try{matrix=Matrix.toMatrix(Matrix.split(s));if(matrix.rows()===1&&matrix.cols()===1&&matrix.e(0,0).unwrap()instanceof Expression.Matrix){matrix=matrix.e(0,0);}}catch(error){global.console.log(error);}}}
if(matrix==undefined){var result=undefined;try{result=RPN(s,new RPN.Context());}catch(error){global.console.log(error);}
matrix=result instanceof Matrix?result:(result instanceof Expression.Matrix?result.matrix:(result instanceof NonSimplifiedExpression&&result.e instanceof Expression.Matrix?result.e.matrix:undefined));}
return matrix==undefined?undefined:matrix.toString();};RPN.p=0;RPN.checkElements=function(textareaValue,type){var tmp=RPN.getElementsArray({type:type,mode:"",inputValues:undefined,textareaValue:textareaValue,rows:0,cols:0,textareaStyleWidth:"",textareaStyleHeight:""});var elements=tmp.elements;RPN.p=0;for(var i=0;i<elements.length;i+=1){for(var j=0;j<elements[i].length;j+=1){var value=elements[i][j];var isValid=RPN.checkElement(value||"0");if(!isValid){return false;}
RPN.p+=value.length;}}
return true;};RPN.checkElement=function(input){return RPN(input,new RPN.CheckContext())!=undefined;};RPN.isIJK=function(x,has){if(!(x.unwrap()instanceof Expression.Determinant&&x.unwrap().a.unwrap()instanceof Expression.Matrix)){if(!(x.unwrap()instanceof Expression.NoAnswerExpression&&(x.unwrap().name==="expand-along-column"||x.unwrap().name==="expand-along-row")&&x.unwrap().a.unwrap()instanceof Expression.Matrix)){return false;}}
var m=x.unwrap().a.unwrap().matrix;if(!(m.rows()===3&&m.cols()===3)){return false;}
if(!(m.e(0,0).unwrap()instanceof Expression.Complex&&m.e(0,0).unwrap().equals(Expression.I))){return false;}
if(!(m.e(0,1).unwrap()instanceof Expression.Symbol&&m.e(0,1).unwrap().symbol==="j")){return false;}
if(!(m.e(0,2).unwrap()instanceof Expression.Symbol&&m.e(0,2).unwrap().symbol==="k")){return false;}
for(var i=1;i<3;i+=1){for(var j=0;j<3;j+=1){if(has(m.e(i,j),Expression.Symbol)){return false;}}}
return true;};RPN.isGoodComplexExpression=function(x,has){return!(has(x,Expression.Symbol)||has(x,Expression.NthRoot)||has(x,Expression.Sin)||has(x,Expression.Cos));};RPN.runExpression=function(input,kInputValue,kInputId,matrixTableAState,matrixTableBState,printOptions){var details=[];var listener=function(e){details.push({type:e.type,matrix:e.data.matrix.toString(),second:e.second==undefined?undefined:e.second.matrix.toString()});};Expression.callback=listener;var x=undefined;var variableNames=undefined;var resultError=undefined;var expressionString=undefined;var resultHTML=undefined;var resultMatrix=undefined;try{var test=input.indexOf("X")!==-1?input.replace(/\s+/g,""):"";if(test==="Ax=b"){test="A*X=B";}
if(test==="AX=B"){test="A*X=B";}
if(test==="AX=0"){test="A*X=0";}
if((test==="A*X=B"&&matrixTableAState!=undefined&&matrixTableBState!=undefined)||(test==="A*X=0"&&matrixTableAState!=undefined)){var a0=getMatrixWithVariableNames(matrixTableAState).matrix;var b0=test!=="A*X=B"?Matrix.Zero(a0.rows(),1):getMatrixWithVariableNames(matrixTableBState).matrix;if(b0.rows()===a0.rows()&&b0.cols()===1){input="solve-using-Montante-method("+a0.augment(b0).toString()+")";}else if(test==="A*X=B"){var isInvertible=false;try{isInvertible=a0.rows()===a0.cols()&&!a0.determinant().equals(Expression.Integer.ZERO);}catch(error){global.console.log(error);}
if(isInvertible){input="A^-1*B";}}}
if(input.replace(/^\s+|\s+$/g,"")===""){throw new RangeError("ValueMissingError:"+"expression");}
x=RPN(input,new RPN.Context(function(id){if((id==="k"||id==="K")&&kInputValue!=undefined){var value=kInputValue;if(value.replace(/^\s+|\s+$/g,"")===""){throw new RangeError("ValueMissingError:"+kInputId);}
return RPN(value,new RPN.Context());}
if(id==="X"){return new Expression.MatrixSymbol(id);}
var m=id==="A"?matrixTableAState:(id==="B"?matrixTableBState:undefined);if(m==undefined){return undefined;}
var tmp=getMatrixWithVariableNames(m);var names=tmp.variableNames;var matrix=tmp.matrix;variableNames=names;return new Expression.Matrix(matrix);}));var has=function(e,Class){if(e instanceof Class){return true;}
if(e instanceof Expression.NonSimplifiedExpression){return has(e.e,Class);}
if(e instanceof Expression.BinaryOperation){return has(e.a,Class)||has(e.b,Class);}
if(e instanceof Expression.Negation){return has(e.b,Class);}
if(e instanceof Expression.Function){return has(e.a,Class);}
if(e instanceof Expression.Matrix){var m=e.matrix;for(var i=0;i<m.rows();i+=1){for(var j=0;j<m.cols();j+=1){if(has(m.e(i,j),Class)){return true;}}}}
return false;};if(has(x,Expression.Complex)){if(!RPN.isIJK(x,has)&&!RPN.isGoodComplexExpression(x,has)){self.setTimeout(function(){if(self.sendSnapshot!=undefined){self.sendSnapshot();}},0);}}
var tmp=getResultAndHTML(x,variableNames,x.simplify(),printOptions);var result=tmp.result;resultHTML=tmp.html;var matrix=result instanceof Matrix?result:(result instanceof Expression.Matrix?result.matrix:(result instanceof NonSimplifiedExpression&&result.e instanceof Expression.Matrix?result.e.matrix:undefined));resultMatrix=matrix!=undefined?matrix.toString():"";expressionString=x.toString();}catch(error){resultError={message:error.message,name:error.name,stack:error.stack};}
Expression.callback=undefined;var detailsHTML=createDetailsSummary(printOptions.idPrefix,details,details.length===1?100:1);return{resultError:resultError,details:details,expressionString:expressionString,resultHTML:resultHTML,resultMatrix:resultMatrix,detailsHTML:detailsHTML};};RPN.getDetails=function(array,printOptions){var html="";for(var i=0;i<array.length;i+=1){var data=array[i];html+="<hr />";var callback=Expression.Details.getCallback(data.type);if(callback!=undefined){var matrix=RPN(data.matrix).matrix;var second=data.second!=undefined?RPN(data.second).matrix:undefined;html+=callback(printOptions,matrix,second);}else{throw new Error(data.type);}}
return html;};global.getMatrixWithVariableNames=getMatrixWithVariableNames;RPN.createDetailsSummary=createDetailsSummary;}(this));(function(){"use strict";Expression.Details.add({type:"solve-using-Gaussian-elimination",i18n:function(){return i18n.solveByGauss;},minRows:1,priority:1,callback:function(printOptions,matrix,variableNames){return Expression.solveByGauss(printOptions,matrix,variableNames,{moreText:true,method:{i18n:i18n.solutionByGaussianElimination,id:Matrix.Gauss,rowReduceChangeToHTML:Expression.rowReduceChangeToHTML},eigenvectors:undefined});}});Expression.Details.add({type:"solve-using-Gauss-Jordan-elimination",i18n:function(){return i18n.solveByJordanGauss;},minRows:1,priority:1,callback:function(printOptions,matrix,variableNames){return Expression.solveByGauss(printOptions,matrix,variableNames,{moreText:true,method:{i18n:i18n.solutionByGaussJordanElimination,id:Matrix.GaussJordan,rowReduceChangeToHTML:Expression.rowReduceChangeToHTML},eigenvectors:undefined});}});Expression.Details.add({type:"solve-using-Montante-method",i18n:function(){return i18n.methodOfMontante;},minRows:1,priority:2,callback:function(printOptions,matrix,variableNames){return Expression.solveByGauss(printOptions,matrix,variableNames,{moreText:true,method:{i18n:i18n.solutionByMethodOfMontante,id:Matrix.GaussMontante,rowReduceChangeToHTML:Expression.rowReduceChangeToHTMLMontante},eigenvectors:undefined});}});Expression.rowReduceChangeToHTMLMontante=function(args,printOptions,containerId,k,stepCondition){var t=function(r,c,k){return"<mrow>"+
Expression.p("(a_(${r},${c})*a_(i,j)-a_(i,${c})*a_(${r},j))/p_${k}".replace(/\$\{r\}/g,(r+1).toString()).replace(/\$\{c\}/g,(c+1).toString()).replace(/\$\{k\}/g,(k+1).toString()),undefined,printOptions)+"<mo>&rarr;</mo>"+
Expression.p("a_(i,j)",undefined,printOptions)+"</mrow>";};var cellId=function(containerId,matrixId,i,j){return containerId+"-"+matrixId.toString()+"-"+i.toString()+"-"+j.toString();};var html="";if(true){if(args.type==="swap"||args.type==="swap-negate"){html+=Expression.rowReduceChangeToHTML(args,printOptions,containerId,k,stepCondition);}else if(args.type==="pivot"){var a0=new Expression.Matrix(args.oldMatrix).toMathML(Object.assign({},printOptions,{columnlines:printOptions.columnlines,cellIdGenerator:function(i,j){return cellId(containerId,k,i,j);},pivotCell:{i:args.pivotRow,j:args.pivotColumn}}));var pivotElementText="<munder>"+"<mrow>"+"<mtext>"+i18n.eliminationDetails.pivotElement+"</mtext>"+"</mrow>"+"<mrow>"+"<munder>"+"<mrow>"+
Expression.p("p_"+((k+1).toString())+"=a_"+(args.pivotRow+1).toString()+(args.pivotColumn+1).toString()+"=q",{q:args.oldMatrix.e(args.pivotRow,args.pivotColumn)},printOptions)+"</mrow>"+"<mrow>"+
(stepCondition.isTrue()?"":"<munder>")+"<mrow>"+
t(args.pivotRow,args.pivotColumn,k-1)+"</mrow>"+
(stepCondition.isTrue()?"":"<mrow>")+
(stepCondition.isTrue()?"":stepCondition.toMathML(printOptions))+
(stepCondition.isTrue()?"":"</mrow>")+
(stepCondition.isTrue()?"":"</munder>")+"</mrow>"+"</munder>"+"</mrow>"+"</munder>";html+="<math>";html+=a0+"<mpadded width=\"+0.8em\" lspace=\"+0.4em\"><munder><mrow><mo stretchy=\"false\">~</mo></mrow><mrow>"+pivotElementText+"</mrow></munder></mpadded>";html+="</math>";k+=1;var text="";for(var targetRow=0;targetRow<args.oldMatrix.rows();targetRow+=1){if(targetRow!==args.pivotRow){text+="<div>";for(var i=0;i<args.oldMatrix.cols();i+=1){var divId=cellId(containerId,k,targetRow,i)+"-"+"tooltip";var highlight="<a class=\"a-highlight\" data-for=\""+cellId(containerId,k,targetRow,i)+"\" data-highlight=\""+"#"+cellId(containerId,k-1,args.pivotRow,args.pivotColumn)+", "+"#"+cellId(containerId,k-1,targetRow,i)+", "+"#"+cellId(containerId,k-1,targetRow,args.pivotColumn)+", "+"#"+cellId(containerId,k-1,args.pivotRow,i)+", "+"#"+cellId(containerId,k,targetRow,i)+"\"></a>";var tooltips="<a class=\"a-tooltip\" data-for=\""+cellId(containerId,k,targetRow,i)+"\" data-tooltip=\""+divId+"\"></a>";text+="<div id=\""+divId+"\">"+"<math>"+
Expression.p("a_"+(targetRow+1).toString()+(i+1).toString()+"=(a*b-c*d)/p=r",{a:args.oldMatrix.e(args.pivotRow,args.pivotColumn),b:args.oldMatrix.e(targetRow,i),c:args.oldMatrix.e(targetRow,args.pivotColumn),d:args.oldMatrix.e(args.pivotRow,i),p:args.previousPivot,r:args.newMatrix.e(targetRow,i)},printOptions)+"</math>"+"</div>"+
highlight+
tooltips;}
text+="</div>";}}
html+="<span hidden>"+text+"</span>";}else{throw new Error(args.type);}}
return html;};Expression.Details.add({type:"determinant-Montante",i18n:function(){return i18n.methodOfMontante;},priority:2,callback:function(printOptions,matrix){if(!matrix.isSquare()){throw new RangeError("NonSquareMatrixException");}
var html="";html+="<div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";html+="<h4>";html+=i18n.methodOfMontanteDetails.determinantDetails.header;html+="</h4>";html+="<p>";html+=i18n.methodOfMontanteDetails.determinantDetails.start.replace(/\$\{someDetails3\}/g,Expression.getSomeDetails("someDetails3",printOptions)).replace(/\$\{a_\(i,j\)\=\(a_\(r,c\)\*a_\(i,j\)\-a_\(i,c\)\*a_\(r,j\)\)\/p\}/g,"<math>"+Expression.p("a_(i,j)=(a_(r,c)*a_(i,j)-a_(i,c)*a_(r,j))/p",undefined,printOptions)+"</math>").replace(/\$\{a_\(r,c\)\}/g,"<math>"+Expression.p("a_(r,c)",undefined,printOptions)+"</math>").replace(/\$\{r\}/g,"<math>"+"<mi>r</mi>"+"</math>").replace(/\$\{c\}/g,"<math>"+"<mi>c</mi>"+"</math>").replace(/\$\{p\}/g,"<math>"+"<mi>p</mi>"+"</math>");html+="</p>";html+=Expression.rowReductionGaussJordanMontante(matrix,Matrix.GaussMontante,"determinant",Expression.rowReduceChangeToHTMLMontante,printOptions,function(tmp){var rowEchelonMatrix=tmp.rowEchelonMatrix;var html="";html+="<div>";html+="<math>";html+=new Expression.Determinant(new Expression.Matrix(matrix)).toMathML(printOptions);html+="<mo>=</mo>";var result=(tmp.stopped?RPN.ZERO:rowEchelonMatrix.e(rowEchelonMatrix.rows()-1,rowEchelonMatrix.cols()-1));html+=result.toMathML(printOptions);html+="</math>";html+="</div>";return html;});return html;}});Expression.Details.add({type:"rank-Montante",i18n:function(){return i18n.methodOfMontante;},minRows:2,priority:2,callback:function(printOptions,matrix){var html="";html+="<div>";html+="<math>";html+=new Expression.Rank(new Expression.Matrix(matrix)).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";html+=Expression.rowReductionGaussJordanMontante(matrix,Matrix.GaussMontante,"",Expression.rowReduceChangeToHTMLMontante,printOptions,function(tmp){var html="";var rowEchelon=tmp.rowEchelonMatrix;html+="<div>";html+="<math>";html+=new Expression.Rank(new Expression.Matrix(matrix)).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Rank(new Expression.Matrix(rowEchelon)).toMathML(printOptions);html+="<mo>=</mo>";html+="<mn>"+rowEchelon.rank().toString()+"</mn>";html+="</math>";html+="</div>";return html;});return html;}});Expression.Details.add({type:"inverse-Montante",i18n:function(){return i18n.methodOfMontante;},priority:2,callback:function(printOptions,matrix){var html="";html+="<div>";html+="<math>";html+=new Expression.Exponentiation(new Expression.Matrix(matrix),Expression.Integer.ONE.negate()).toMathML(printOptions)+"<mo>=</mo><mn>?</mn>";html+="</math>";html+="</div>";var augmented=matrix.augment(Matrix.I(matrix.rows()));html+=Expression.rowReductionGaussJordanMontante(augmented,Matrix.GaussMontante,"inverse",Expression.rowReduceChangeToHTMLMontante,Object.assign({},printOptions,{columnlines:-matrix.cols()}),function(tmp){var augmentedResult=tmp.rowEchelonMatrix;var hasZeroElement=false;for(var i=0;i<augmentedResult.rows();i+=1){if(augmentedResult.e(i,i).equals(RPN.ZERO)){hasZeroElement=true;}}
var html="";if(!hasZeroElement){var c=augmentedResult.e(0,0);var result2=Matrix.Zero(matrix.rows(),matrix.rows()).map(function(element,i,j){return augmentedResult.e(i,j+augmentedResult.rows());});var result=result2.map(function(element,i,j){return element.divide(c);});html+="<div>";html+="<math>";html+=new Expression.Exponentiation(new Expression.Matrix(matrix),Expression.Integer.ONE.negate()).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Multiplication(new Expression.Division(RPN.ONE,c),new Expression.Matrix(result2)).toMathML(printOptions);html+="<mo>=</mo>";html+=new Expression.Matrix(result).toMathML(printOptions);html+="</math>";html+="</div>";}else{}
return html;});return html;}});Expression.LUDecomposition=function(matrix){var N=matrix.rows();var a=matrix;var Lower=Matrix.I(N);var P=Matrix.I(N);var swapFlag=false;var pivotRow=0;for(var n=0;n<N;n+=1){var c=pivotRow;if(n<matrix.cols()){if(a.e(pivotRow,n).equals(RPN.ZERO)){for(var k=pivotRow+1;k<N&&c===pivotRow;k+=1){if(!a.e(k,n).equals(RPN.ZERO)){c=k;}}
if(c!==pivotRow){var S=Matrix.I(N);S=S.map(function(element,i,j){return i===pivotRow?S.e(c,j):(i===c?S.e(pivotRow,j):element);});a=S.multiply(a);Lower=S.multiply(Lower.subtract(Matrix.I(N))).add(Matrix.I(N));P=P.multiply(S);swapFlag=true;}}
if(!a.e(pivotRow,n).equals(RPN.ZERO)){var L=Matrix.I(N).map(function(element,i,j){return j===pivotRow&&i>=pivotRow+1?a.e(i,n).divide(a.e(pivotRow,n)).negate():element;});a=L.multiply(a);Lower=Lower.multiply(L);pivotRow+=1;}}}
Lower=Lower.map(function(element,i,j){return i===j?element:element.negate();});return{swapFlag:swapFlag,P:new Expression.Matrix(P),A:new Expression.Matrix(matrix),L:new Expression.Matrix(Lower),U:new Expression.Matrix(a)};};Expression.Details.add({type:"LU-decomposition",i18n:function(){return i18n.index.LUDecomposition;},priority:1,callback:function(printOptions,matrix){var palu=Expression.LUDecomposition(matrix);var html="";html+="<math>";html+=Expression.p(palu.swapFlag?"P*A=L*U":"A=L*U",palu,printOptions);html+="</math>";html+="<div class=\"details-container\"><details open=\"open\"><summary>"+i18n.summaryLabel+" ("+i18n.index.LUDecomposition+")"+"</summary><div class=\"indented\">";html+=Expression.rowReductionGaussJordanMontante(matrix,Matrix.Gauss,"",Expression.rowReduceChangeToHTML,Object.assign({},printOptions,{isLUDecomposition:true}),function(result){return"";});html+="<div>";html+="<math>";html+=Expression.p("L=M",{M:palu.L},Object.assign({},printOptions,{isLUDecomposition2:true}));html+="</math>";html+=", ";html+="<math>";html+=Expression.p("U=M",{U:new Expression.Symbol("U"),M:palu.U},printOptions);html+="</math>";html+="</div>";html+="</div></details></div>";return html;}});}());(function(){"use strict";Expression.prototype.toLaTeX=function(options){throw new RangeError();};Expression.Integer.prototype.toLaTeX=function(options){return this.value.toString();};Expression.Function.prototype.toLaTeX=function(options){return"\\"+this.name+"\\left("+this.a.toLaTeX(options)+"\\right)";};Expression.SquareRoot.prototype.toLaTeX=function(options){return"\\sqrt{"+this.a.toLaTeX(options)+"}";};Expression.NthRoot.prototype.toLaTeX=function(options){return"\\sqrt["+this.n+"]{"+this.a.toLaTeX(options)+"}";};Expression.BinaryOperation.prototype.toLaTeX=function(options){var a=this.a;var b=this.b;var fa=a.getPrecedence()+(a.isRightToLeftAssociative()?-1:0)<this.getPrecedence();var fb=this.getPrecedence()+(this.isRightToLeftAssociative()?-1:0)>=b.getPrecedence();fa=fa||a.isUnaryPlusMinus();fb=fb||b.isUnaryPlusMinus();fa=fa||(this instanceof Expression.Exponentiation&&a instanceof Expression.Function);return(fa?"\\left(":"")+a.toLaTeX(options)+(fa?"\\right)":"")+
this.getS()+
(fb?"\\left(":"")+b.toLaTeX(options)+(fb?"\\right)":"");};Expression.Negation.prototype.toLaTeX=function(options){return"-"+this.b.toLaTeX(options);};Expression.Division.prototype.toLaTeX=function(options){return"\\frac{"+this.a.toLaTeX(options)+"}{"+this.b.toLaTeX(options)+"}";};Expression.Symbol.prototype.toLaTeX=function(options){return this.symbol;};Expression.Matrix.prototype.toLaTeX=function(options){var x=this.matrix;var s="";s+="\\begin{pmatrix}\n";for(var i=0;i<x.rows();i+=1){for(var j=0;j<x.cols();j+=1){var e=x.e(i,j);s+=e.toLaTeX(options)+(j+1<x.cols()?" & ":(i+1<x.rows()?" \\\\":"")+"\n");}}
s+="\\end{pmatrix}";return s;};NonSimplifiedExpression.prototype.toLaTeX=function(options){return this.e.toLaTeX(options);};}());(function(global){"use strict";var getMathMLSupport=function(){var tmp=document.createElement("div");tmp.style.position="absolute";tmp.style.zIndex="-1";tmp.style.clip="rect(0 0 0 0)";tmp.style.whiteSpace="nowrap";tmp.style.width="0px";tmp.style.height="0px";var table="<mtable><mtr><mtd><mn>1</mn></mtd><mtd><mn>2</mn></mtd><mtd><mn>3</mn></mtd><mtd><mn>4</mn></mtd></mtr></mtable>";var table2=table.replace(/<\/mtd><mtd>/g,"</mtd></mtr><mtr><mtd>");var table3=table.replace(/<mtable>/g,"<mtable columnspacing=\"0em\">");var table4=table.replace(/<mtable>/g,"<mtable columnlines=\"none solid none\">");var table5=table.replace(/<mn>1<\/mn>/g,"<mpadded width=\"+0.8em\" lspace=\"+0.4em\"><mn>1</mn></mpadded>");var table6=table.replace(/<mn>1<\/mn>/g,"<menclose notation=\"circle\"><mn>1</mn></menclose>");var table7=table2.replace(/<mtable>/g,"<mtable rowspacing=\"0ex\">");tmp.innerHTML="<math>"+table+table2+table3+table4+table5+table6+table7+"</math>";document.body.appendChild(tmp);var t=tmp.firstElementChild.firstElementChild;var t2=t.nextElementSibling;var t3=t2.nextElementSibling;var t4=t3.nextElementSibling;var t5=t4.nextElementSibling;var t6=t5.nextElementSibling;var t7=t6.nextElementSibling;var math=t.getBoundingClientRect().width>t2.getBoundingClientRect().width;var columnspacing=t.getBoundingClientRect().width>t3.getBoundingClientRect().width;var columnlines=t.getBoundingClientRect().width<t4.getBoundingClientRect().width;var mpadded=t.getBoundingClientRect().width<t5.getBoundingClientRect().width;var menclose=t.getBoundingClientRect().width+t.getBoundingClientRect().height<t6.getBoundingClientRect().width+t6.getBoundingClientRect().height;var rowspacing=t2.getBoundingClientRect().height>t7.getBoundingClientRect().height;document.body.removeChild(tmp);return(math?"":"no-math ")+
(columnspacing?"":"no-columnspacing ")+
(mpadded?"":"no-mpadded ")+
(columnlines?"":"no-columnlines ")+
(menclose?"":"no-menclose ")+
(rowspacing?"":"no-rowspacing");};document.addEventListener("DOMContentLoaded",function(event){if(window.opera!=undefined){document.body.classList.toggle("css-profile",true);document.body.classList.toggle("no-draggable",true);}
var div=document.createElement("div");div.innerHTML="<math><mrow mathcolor=\"#FF0000\"><mn>1</mn></mrow></math>";div.style.position="absolute";div.style.zIndex="-1";div.style.clip="rect(0 0 0 0)";document.body.appendChild(div);var ok=window.getComputedStyle(div.firstElementChild.firstElementChild,undefined).color.indexOf("255")!==-1;document.body.removeChild(div);if(ok){var c=getMathMLSupport();if(c!==""){var classes=c.split(" ");for(var i=0;i<classes.length;i+=1){if(classes[i]!==""){document.body.classList.toggle(classes[i],true);}}}
document.addEventListener("click",function(event){if(event.button!==2){var target=event.target;while(target!=undefined&&(target.nodeType!==Node.ELEMENT_NODE||target.getAttribute("href")==undefined)){target=target.parentNode;}
if(target!=undefined&&target.getAttribute("href")==="#"){var tagName=target.tagName.toUpperCase();if(tagName==="MROW"||tagName==="MTD"||tagName==="MENCLOSE"){event.preventDefault();}}}},false);}else{document.body.classList.toggle("math",true);}},false);}(this));if("webkitUserDrag"in document.documentElement.style){(function(){"use strict";var timeoutId=0;document.addEventListener("keydown",function(event){var DOM_VK_ALT=18;if(event.keyCode===DOM_VK_ALT){if(timeoutId!==0){window.clearTimeout(timeoutId);}else{document.body.classList.toggle("altKey",true);}
timeoutId=window.setTimeout(function(){timeoutId=0;document.body.classList.toggle("altKey",false);},600);}},false);}());}
(function(global){"use strict";function PageUtils(){}
PageUtils.on=function(eventType,selector,listener){PageUtils.initialize(selector,function(element){element.addEventListener(eventType,listener,false);});};PageUtils.escapeHTML=function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};PageUtils.appendScript=function(src){var script=document.createElement("script");script.async=true;script.src=src;document.head.appendChild(script);};var initializers={};var checkElement=function(element){var initialized=element.getAttribute("data-i");if(initialized==undefined){var classList=element.classList;var classListLength=classList==undefined?0:classList.length;if(classListLength!==0){element.setAttribute("data-i","1");}
var t=false;var k=-1;while(++k<classListLength){var className=classList[k];var callback=initializers[className];if(callback!=undefined){if(t){throw new Error(classList.toString());}
t=true;callback(element);}}}};var checkCustomPaint=function(element){if(element.getAttribute("data-custom-paint")!=undefined){if(element.getAttribute("data-p")==undefined&&element.getBoundingClientRect().top!==0){element.setAttribute("data-p","1");var event=document.createEvent("Event");event.initEvent("custom-paint",true,false);element.dispatchEvent(event);}}};var checkSubtree=function(element){checkElement(element);checkCustomPaint(element);var firstElementChild=element.firstElementChild;while(firstElementChild!=undefined){checkSubtree(firstElementChild);firstElementChild=firstElementChild.nextElementSibling;}};var started=false;PageUtils.initialize=function(selector,callback){var className=selector.slice(1);if(started||initializers[className]!=undefined){throw new Error(className);}
initializers[className]=callback;};var observe=function(){if(!started){started=true;checkSubtree(document.documentElement);}};document.addEventListener("DOMContentLoaded",function(event){observe();},false);PageUtils.check=function(element){checkSubtree(element);};PageUtils.check1=function(element){checkSubtree(element);};PageUtils.formatXml=function(xml){var formatted="";var padding="";var nodes=xml.replace(/></g,">\r\n<").split("\r\n");for(var i=0;i<nodes.length;i+=1){var node=nodes[i];var indent="";if((/.+<\/\w[^>]*>$/).exec(node)==undefined){if((/^<\/\w/).exec(node)!=undefined){padding=padding.slice(0,0-"  ".length);}else{if((/^<\w[^>]*[^\/]>.*$/).exec(node)!=undefined){indent="  ";}}}
formatted+=padding+node+"\r\n";padding+=indent;}
return formatted;};global.PageUtils=PageUtils;}(this));(function(global){"use strict";function Dialog(){}
Dialog.lastFocused=undefined;var ANIMATION_DURATION=120;var idCounter=0;var onClose=function(event){var dialog=this;if(dialog.contains(document.activeElement)&&Dialog.lastFocused!=undefined){Dialog.lastFocused.focus();Dialog.lastFocused=undefined;}
if(dialog.animate!=undefined){dialog.style.display="block";dialog.style.opacity="0";dialog.style.transform="scale(0.75)";dialog.animate([{transform:"scale(1.3333333333333333)",opacity:"1"},{transform:"scale(1)",opacity:"0"}],{duration:ANIMATION_DURATION,composite:"add"});window.setTimeout(function(){dialog.style.display="";},ANIMATION_DURATION);}
var backdrop=document.getElementById(this.getAttribute("data-backdrop-id"));if(backdrop!=undefined){if(backdrop.animate!=undefined){backdrop.style.opacity="0";backdrop.animate([{opacity:"1"},{opacity:"0"}],{duration:ANIMATION_DURATION,composite:"add"});window.setTimeout(function(){if(backdrop.parentNode!=undefined){document.body.removeChild(backdrop);}},ANIMATION_DURATION);}else{document.body.removeChild(backdrop);}}};var show=function(anchorRect,anchorPoints,isModal){var dialog=this;if(isModal||anchorRect!=undefined){if(Dialog.lastFocused==undefined){Dialog.lastFocused=document.activeElement;}}
var backdrop=undefined;if(isModal){backdrop=document.createElement("div");backdrop.id=dialog.getAttribute("data-backdrop-id");backdrop.classList.toggle("backdrop",true);document.body.appendChild(backdrop);}
dialog.style.visibility="hidden";dialog.style.display="block";dialog.style.transform="scale(1)";dialog.style.left="0px";dialog.style.top="0px";var rect=dialog.getBoundingClientRect();var style=window.getComputedStyle(dialog,undefined);var marginRect={left:rect.left-Number.parseFloat(style.marginLeft),right:rect.right+Number.parseFloat(style.marginRight),top:rect.top-Number.parseFloat(style.marginTop),bottom:rect.bottom+Number.parseFloat(style.marginBottom)};var width=marginRect.right-marginRect.left;var height=marginRect.bottom-marginRect.top;var left=0;var top=0;if(anchorRect!=undefined||anchorPoints!=undefined){if(anchorPoints!=undefined){left=anchorPoints[0][0]-width*anchorPoints[1][0];top=anchorPoints[0][1]-height*anchorPoints[1][1];}else{left=anchorRect.right;top=anchorRect.bottom;if(left>document.documentElement.clientWidth-width){left=anchorRect.left-width;}
if(top>document.documentElement.clientHeight-height){top=anchorRect.top-height;}}
left=Math.max(0,Math.min(left,document.documentElement.clientWidth-width));top=Math.max(0,Math.min(top,document.documentElement.clientHeight-height));left+=window.pageXOffset;top+=window.pageYOffset;dialog.style.left=left.toString()+"px";dialog.style.top=top.toString()+"px";}else{left=window.pageXOffset+(window.innerWidth-width)/ 2;top=window.pageYOffset+(window.innerHeight-height)/ 2;dialog.style.left=Math.max(0,left).toString()+"px";dialog.style.top=Math.max(0,top).toString()+"px";}
dialog.style.display="";dialog.style.visibility="";if(isModal){dialog.nativeShowModal();}else{dialog.setAttribute("open","open");}
if(dialog.animate!=undefined){dialog.style.opacity="1";dialog.style.transform="scale(1)";dialog.animate([{transform:"scale(0.75)",opacity:"-1"},{transform:"scale(1)",opacity:"0"}],{duration:ANIMATION_DURATION,composite:"add"});}
if(isModal){if(backdrop.animate!=undefined){backdrop.style.opacity="1";backdrop.animate([{opacity:"-1"},{opacity:"0"}],{duration:ANIMATION_DURATION,composite:"add"});}}};Dialog.create=function(){var dialog=document.createElement("dialog");dialog.initDialog();dialog.nativeShowModal=dialog.showModal;dialog.show=Dialog.prototype.show;dialog.showModal=Dialog.prototype.showModal;dialog.addEventListener("close",onClose,false);var backdropId="backdrop"+(idCounter+=1).toString();dialog.setAttribute("data-backdrop-id",backdropId);return dialog;};Dialog.prototype.show=function(anchorRect,anchorPoints){return show.call(this,anchorRect,anchorPoints,false);};Dialog.prototype.showModal=function(anchorRect,anchorPoints){return show.call(this,anchorRect,anchorPoints,true);};Dialog.standard=function(anchorRect,anchorPoints,contentHTML,buttonsHTML){var dialog=Dialog.create();var contentId="dialog-content";dialog.classList.toggle("standard-dialog",true);dialog.setAttribute("aria-describedby",contentId);dialog.innerHTML="<form method=\"dialog\">"+"<button type=\"submit\" class=\"close\">&times;</button>"+"<div id=\""+contentId+"\" class=\"content\">"+contentHTML+"</div>"+"<div class=\"buttons\">"+buttonsHTML+"</div>"+"</form>";document.body.appendChild(dialog);dialog.addEventListener("close",function(event){window.setTimeout(function(){document.body.removeChild(dialog);},2000);},false);dialog.showModal(anchorRect,anchorPoints);return dialog;};Dialog.alert=function(contentHTML){window.setTimeout(function(){Dialog.standard(undefined,undefined,contentHTML,"<button autofocus=\"autofocus\" type=\"submit\">OK</button>");},0);};global.Dialog=Dialog;}(this));(function(global){"use strict";var oldHighlights=undefined;var highlight=function(element){if(oldHighlights!=undefined){for(var i=0;i<oldHighlights.length;i+=1){var t=document.getElementById(oldHighlights[i]);if(t!=undefined){t.removeAttribute("mathbackground");}}
oldHighlights=undefined;}
if(element!=undefined){var highlight=element.getAttribute("data-highlight");if(highlight!=undefined){var newHighlights=highlight.replace(/[#\s]/g,"").split(",");for(var j=0;j<newHighlights.length;j+=1){var e=document.getElementById(newHighlights[j]);if(e!=undefined){e.setAttribute("mathbackground","#FAEBD7");}}
oldHighlights=newHighlights;}}};var tooltip=Dialog.create();tooltip.id="highlight-tooltip";tooltip.setAttribute("role","tooltip");tooltip.classList.toggle("tooltip-dialog",true);var keyDownTarget=undefined;var hideTooltip=function(){keyDownTarget.removeEventListener("keydown",onKeyDown,false);keyDownTarget.removeAttribute("aria-describedby");tooltip.close();keyDownTarget=undefined;};var onKeyDown=function(event){var DOM_VK_ESCAPE=27;if(event.keyCode===DOM_VK_ESCAPE&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();hideTooltip();}};var showTooltip=function(element){if(tooltip.getAttribute("open")!=undefined){hideTooltip();}
if(element!=undefined){var tooltipId=element.getAttribute("data-tooltip");if(tooltipId!=undefined){if(tooltip.parentNode==undefined){document.body.appendChild(tooltip);}
tooltip.innerHTML=document.getElementById(tooltipId).innerHTML;keyDownTarget=document.getElementById(element.getAttribute("data-for"));var rect=keyDownTarget.getBoundingClientRect();keyDownTarget.setAttribute("aria-describedby",tooltip.id);keyDownTarget.addEventListener("keydown",onKeyDown,false);tooltip.show(undefined,[[(rect.left+rect.right)/ 2,rect.top],[0.5,1.0]]);}}};var f=function(highlight){var hoveredElements=[];var focusedElements=[];return function(element){var x=document.getElementById(element.getAttribute("data-for"));x.setAttribute("tabindex","0");var tagName=x.tagName.toUpperCase();if(tagName==="MROW"||tagName==="MTD"||tagName==="MENCLOSE"){x.setAttribute("href","#");}else{if(tagName!=="A"){throw new RangeError(tagName);}}
var highlightInternal=function(){highlight(hoveredElements.length!==0?hoveredElements[hoveredElements.length-1]:(focusedElements.length!==0?focusedElements[focusedElements.length-1]:undefined));};x.addEventListener("mouseenter",function(event){hoveredElements.push(element);highlightInternal();},false);x.addEventListener("mouseleave",function(event){hoveredElements.pop();highlightInternal();},false);x.addEventListener("focus",function(event){focusedElements.push(element);highlightInternal();},false);x.addEventListener("blur",function(event){focusedElements.pop();highlightInternal();},false);};};global.initializeAHighlight=f(highlight);global.initializeATooltip=f(showTooltip);}(this));window.reportValidity=function(input,validationMessage){"use strict";var tooltip=Dialog.create();tooltip.setAttribute("role","tooltip");tooltip.id="report-validity-tooltip-for-"+input.id;tooltip.classList.toggle("tooltip",true);tooltip.classList.toggle("tooltip-dialog",true);var tooltipArrowId="tooltip-arrow-"+input.id;tooltip.innerHTML="<span class=\"exclamation\">!</span> "+validationMessage+"<div class=\"tooltip-arrow-wrapper\"><div id=\""+tooltipArrowId+"\" class=\"tooltip-arrow\"></div></div>";document.body.appendChild(tooltip);input.setAttribute("aria-describedby",tooltip.id);input.focus();var inputRect=input.getBoundingClientRect();tooltip.style.visibility="hidden";tooltip.style.display="block";var rect=tooltip.getBoundingClientRect();var style=window.getComputedStyle(tooltip,undefined);var marginLeft=Number.parseFloat(style.marginLeft);var arrowRect=document.getElementById(tooltipArrowId).getBoundingClientRect();tooltip.style.display="";tooltip.style.visibility="";var left=(inputRect.left+inputRect.right)/ 2-((arrowRect.right-arrowRect.left)/ 2+marginLeft+arrowRect.left-rect.left);var top=inputRect.bottom+(arrowRect.bottom-arrowRect.top)*0.15;tooltip.show(undefined,[[left,top],[0.0,0.0]]);var close=undefined;var onKeyDown=undefined;var timeoutId=0;close=function(event){window.clearTimeout(timeoutId);input.removeEventListener("input",close,false);input.removeEventListener("blur",close,false);input.removeEventListener("keydown",onKeyDown,false);input.removeAttribute("aria-describedby");tooltip.close();window.setTimeout(function(){tooltip.parentNode.removeChild(tooltip);},3000);};onKeyDown=function(event){var DOM_VK_ESCAPE=27;if(event.keyCode===DOM_VK_ESCAPE&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){event.preventDefault();close();}};timeoutId=window.setTimeout(function(){close(undefined);},4000);input.addEventListener("input",close,false);input.addEventListener("blur",close,false);input.addEventListener("keydown",onKeyDown,false);};(function(global){"use strict";function CustomMenclose(){}
CustomMenclose.getPointByCell=function(paddingRect,rows,indexes){var a=indexes[0];var b=indexes[1];var e=rows[a][b];var r=e.getBoundingClientRect();return{x:(r.left+r.right)/ 2-paddingRect.left,y:(r.top+r.bottom)/ 2-paddingRect.top};};CustomMenclose.paint=function(event){var paddingRect=this.getBoundingClientRect();var width=paddingRect.right-paddingRect.left;var height=paddingRect.bottom-paddingRect.top;var svg="";var cells=JSON.parse(this.getAttribute("data-cells"));var color=this.getAttribute("data-color");var strokeStyle=color==="0a"?"#D64040":(color==="0"?"#F7D9D9":(color==="1a"?"#4040D6":(color==="1"?"#D9D9F7":"")));var lineWidth=1.25;var table=this.querySelector("mtable");var rows=[];var c=table.firstElementChild;while(c!=undefined){if(c.tagName.toUpperCase()==="MTR"){var row=[];var t=c.firstElementChild;while(t!=undefined){if(t.tagName.toUpperCase()==="MTD"){row.push(t);}
t=t.nextElementSibling;}
rows.push(row);}
c=c.nextElementSibling;}
for(var i=0;i<cells.length;i+=1){var p1=CustomMenclose.getPointByCell(paddingRect,rows,cells[i]);var p2=CustomMenclose.getPointByCell(paddingRect,rows,i===cells.length-1?cells[0]:cells[i+1]);svg+="<line x1=\""+p1.x.toString()+"\" y1=\""+p1.y.toString()+"\" x2=\""+p2.x.toString()+"\" y2=\""+p2.y.toString()+"\" stroke=\""+strokeStyle+"\" stroke-width=\""+lineWidth.toString()+"\" />";}
var backgroundImage="data:image/svg+xml;charset=utf-8,"+encodeURIComponent("<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+width.toString()+"\" height=\""+height.toString()+"\">"+svg+"</svg>");this.style.backgroundImage="url(\""+backgroundImage+"\")";this.style.backgroundSize="auto auto";};document.addEventListener("custom-paint",function(event){if(event.target.getAttribute("data-custom-paint")==="custom-menclose"){CustomMenclose.paint.call(event.target,event);}},false);}(this));(function(global){"use strict";var initializeAInput=function(container){var input=container.firstElementChild;if(input.tagName.toUpperCase()!=="INPUT"&&input.tagName.toUpperCase()!=="TEXTAREA"){throw new Error();}
var inputStyle=window.getComputedStyle(input,undefined);var fontSize=inputStyle.fontSize;var fontFamily=inputStyle.fontFamily;var lineHeight=inputStyle.lineHeight;var textAlign=inputStyle.textAlign;var marginLeft=Number.parseFloat(inputStyle.marginLeft);var marginTop=Number.parseFloat(inputStyle.marginTop);var marginRight=Number.parseFloat(inputStyle.marginRight);var marginBottom=Number.parseFloat(inputStyle.marginBottom);var paddingLeft=Number.parseFloat(inputStyle.paddingLeft);var paddingTop=Number.parseFloat(inputStyle.paddingTop);var paddingRight=Number.parseFloat(inputStyle.paddingRight);var paddingBottom=Number.parseFloat(inputStyle.paddingBottom);var isActive=false;var backgroundElement=document.createElement("div");backgroundElement.style.fontSize=fontSize;backgroundElement.style.fontFamily=fontFamily;backgroundElement.style.lineHeight=lineHeight;backgroundElement.style.textAlign=textAlign;window.setTimeout(function(){container.insertBefore(backgroundElement,input);},0);var add=function(text,color,backgroundColor,div){var t=color==="transparent"?text.replace(/[^\r\n\t]/g," "):text;var span=document.createElement("span");var style=span.style;style.color=color;style.backgroundColor=backgroundColor;if(color!=="transparent"){if("webkitTextStroke"in style){style.webkitTextStroke="2.5px";}else if("textShadow"in style){style.textShadow="-1px -1px 1px, 1px -1px 1px, -1px 1px 1px, 1px 1px 1px";}else{style.textDecoration="underline";}}
span.appendChild(document.createTextNode(t));div.appendChild(span);};var getBracketMarks=function(value,inputSelectionStart){var selectionStart=inputSelectionStart-1;var c=0;var step=0;var n=selectionStart+2;var pair=0;while(step===0&&selectionStart<n){c=value.charCodeAt(selectionStart);var brackets="(){}[]";for(var k=0;k<brackets.length;k+=2){if(c===brackets.charCodeAt(k)){pair=brackets.charCodeAt(k+1);step=+1;}
if(c===brackets.charCodeAt(k+1)){pair=brackets.charCodeAt(k);step=-1;}}
selectionStart+=1;}
selectionStart-=1;if(step!==0){var i=selectionStart;var depth=1;i+=step;while(i>=0&&i<value.length&&depth>0){var code=value.charCodeAt(i);if(code===c){depth+=1;}
if(code===pair){depth-=1;}
i+=step;}
i-=step;if(depth===0){return{first:{start:selectionStart,end:selectionStart+1,color:"lightgray",backgroundColor:"transparent"},second:{start:i,end:i+1,color:"lightgray",backgroundColor:"transparent"}};}else{return{first:{start:selectionStart,end:selectionStart+1,color:"lightpink",backgroundColor:"transparent"},second:undefined};}}
return{first:undefined,second:undefined};};var getSelectionStart=function(input){try{return input.selectionStart;}catch(error){window.console.log(error);}
return 0;};var update=function(event){var marks=[];if(isActive){var tmp0=getBracketMarks(input.value,getSelectionStart(input));if(tmp0.first!=undefined){marks.push(tmp0.first);}
if(tmp0.second!=undefined){marks.push(tmp0.second);}}
var error=input.getAttribute("data-error");if(error!=undefined){var errorStartEnd=error.split(",");marks.push({start:Number.parseInt(errorStartEnd[0],10),end:Number.parseInt(errorStartEnd[1],10),color:"transparent",backgroundColor:"lightpink"});}
if(marks.length!==0){var scrollLeft=input.scrollLeft;var scrollTop=input.scrollTop;var clientLeft=input.clientLeft;var clientTop=input.clientTop;var inputRect=input.getBoundingClientRect();var clientRight=inputRect.right-inputRect.left-input.clientWidth-input.clientLeft;var clientBottom=inputRect.bottom-inputRect.top-input.clientHeight-input.clientTop;marks.sort(function(a,b){return a.start<b.start?-1:(b.start<a.start?+1:0);});backgroundElement.innerHTML="";backgroundElement.style.marginLeft=(clientLeft+marginLeft+paddingLeft).toString()+"px";backgroundElement.style.marginTop=(clientTop+marginTop+paddingTop).toString()+"px";backgroundElement.style.marginRight=(clientRight+marginRight+paddingRight).toString()+"px";backgroundElement.style.marginBottom=(clientBottom+marginBottom+paddingBottom).toString()+"px";var value=input.value;var start=0;while(start<value.length){var div=document.createElement("div");backgroundElement.appendChild(div);var end=value.indexOf("\n",start)+1;if(end===0){end=value.length;}
for(var i=0;i<marks.length;i+=1){var m=marks[i];var s=m.start>start?m.start:start;var e=m.end<end?m.end:end;if(s<e){add(value.slice(start,s),"transparent","transparent",div);add(value.slice(s,e),m.color,m.backgroundColor,div);start=e;}}
if(start<end){add(value.slice(start,end),"transparent","transparent",div);start=end;}
if(input.getAttribute("list")!=undefined){add("  ","transparent","transparent",div);}}
backgroundElement.scrollLeft=scrollLeft;backgroundElement.scrollTop=scrollTop;}else{while(backgroundElement.firstChild!=undefined){backgroundElement.removeChild(backgroundElement.firstChild);}}};var oldSelectionStart=-1;var timeoutId=0;var check=function(event){if(timeoutId===0){timeoutId=window.setTimeout(function(){timeoutId=0;var newSelectionStart=getSelectionStart(input);if(oldSelectionStart!==newSelectionStart){oldSelectionStart=newSelectionStart;update(undefined);}},0);}};if("onselectionchange"in input){input.addEventListener("selectionchange",check,false);}else{input.addEventListener("keydown",check,false);input.addEventListener("mousedown",check,false);input.addEventListener("mouseup",check,false);}
input.addEventListener("input",update,false);input.addEventListener("update-attribute",update,false);var timeoutId2=0;var onScroll=function(event){if(timeoutId2===0){timeoutId2=window.setTimeout(function(){timeoutId2=0;update(undefined);},0);}};input.addEventListener("scroll",onScroll,false);var onFocus=function(event){isActive=true;update(undefined);};var onBlur=function(event){isActive=false;update(undefined);};input.addEventListener("focus",onFocus,false);input.addEventListener("blur",onBlur,false);};window.initializeAInput=initializeAInput;}(this));(function(global){"use strict";function RPNProxy(){}
RPNProxy.input="";RPNProxy.startPosition=0;RPNProxy.endPosition=0;RPNProxy.p=0;RPNProxy.getMatrix=function(string,callback){var result=RPN.getMatrix(string);callback(result);};RPNProxy.getElementsArray=function(matrixTableState,callback){var result=RPN.getElementsArray(matrixTableState);callback(result);};RPNProxy.checkElements=function(textareaValue,type,callback,errorCallback){try{var result=RPN.checkElements(textareaValue,type);callback(result);}catch(error){RPNProxy.input=RPN.input;RPNProxy.startPosition=RPN.startPosition;RPNProxy.endPosition=RPN.endPosition;RPNProxy.p=RPN.p;errorCallback({message:error.message,name:error.name,stack:error.stack});}};RPNProxy.checkElement=function(input,callback,errorCallback){try{var result=RPN.checkElement(input);callback(result);}catch(error){RPNProxy.input=RPN.input;RPNProxy.startPosition=RPN.startPosition;RPNProxy.endPosition=RPN.endPosition;RPNProxy.p=RPN.p;errorCallback({message:error.message,name:error.name,stack:error.stack});}};RPNProxy.runExpression=function(input,kInputValue,kInputId,matrixTableAState,matrixTableBState,printOptions,callback){var result=RPN.runExpression(input,kInputValue,kInputId,matrixTableAState,matrixTableBState,printOptions);RPNProxy.input=RPN.input;RPNProxy.startPosition=RPN.startPosition;RPNProxy.endPosition=RPN.endPosition;RPNProxy.p=RPN.p;callback(result);};RPNProxy.getDetails=function(array,printOptions,callback,errorCallback){try{var result=RPN.getDetails(array,printOptions);callback(result);}catch(error){RPNProxy.input=RPN.input;RPNProxy.startPosition=RPN.startPosition;RPNProxy.endPosition=RPN.endPosition;RPNProxy.p=RPN.p;errorCallback({message:error.message,name:error.name,stack:error.stack});}};RPNProxy.createDetailsSummary=function(idPrefix,details,bestMethodsLimit,callback){var result=RPN.createDetailsSummary(idPrefix,details,bestMethodsLimit);callback(result);};if(window.location.protocol!=="file:"){window.setTimeout(function(){(new Image()).src="https://counter.yadro.ru/hit?r"+encodeURIComponent(document.referrer)+(window.screen==undefined?"":";s"+Number(window.screen.width).toString()+"*"+Number(window.screen.height).toString()+"*"+"24")+";u"+encodeURIComponent(document.URL)+";h"+";"+(Math.random()+1).toString().slice(2);},256);}
var clickOnEnter=function(event){var DOM_VK_RETURN=13;if(event.keyCode===DOM_VK_RETURN&&!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){if(event.target.tagName.toUpperCase()==="INPUT"){event.preventDefault();this.querySelector("button").click();}}};var Utils=PageUtils;Utils.actHistoryId=0;Utils.initialize(".button-after-input",function(element){element.addEventListener("keydown",clickOnEnter,false);});Utils.initialize(".button-before-input",function(element){element.addEventListener("keydown",clickOnEnter,false);});var hitQueue=[];var sendHits=function(){window.yaCounter40037290.hit(window.location.pathname+window.location.search+window.location.hash,{title:document.title,referer:document.referrer,params:hitQueue});hitQueue=[];};var roundValue=function(value,max){return"10**"+(Math.floor(Math.log(Math.max(value,max)+0.5)/ Math.log(10))+1);};var hit=function(params){hitQueue.push(params);if(window.yaCounter40037290!=undefined){requestIdleCallback("sendHits",sendHits,1000);}};global.hit=hit;var postError=function(error,input,initialInput,classList){input=input||undefined;initialInput=initialInput||undefined;classList=classList||undefined;var e=function(element){if(element==undefined){return undefined;}
var a=element.getAttribute("data-expression");return(element.classList||"").toString()+(a==undefined?"":"[data-expression="+a+"]");};var object={error:error.name+": "+error.message,input:input,initialInput:initialInput,classList:classList,focusedElement:e(document.querySelector(":focus")),decimalFractionDigits:decimalFractionDigits===-1?undefined:decimalFractionDigits};var tables=document.querySelectorAll(".matrix-table");for(var i=0;i<tables.length;i+=1){var id=tables[i].getAttribute("data-id");var table=MatrixTables[id];if(table!=undefined){var x=table.getRawInput(table.mode);var y=x;if(typeof x!=="string"){y="";y+="{";for(var j=0;j<x.length;j+=1){y+=j!==0?",":"";y+="{"+x[j].join(",")+"}";}
y+="}";}
object[id]=y;}}
var inputs=document.querySelectorAll("input");for(var k=0;k<inputs.length;k+=1){var name=inputs[k].name;if(name!=undefined&&(name.slice(0,2)==="k-"||name==="expression")){object[name]=inputs[k].value;}}
var s=JSON.stringify(object);window.onerror(s,error.fileName||"",error.lineNumber||0,error.columnNumber||0,error);};global.postError=postError;var handleError=function(initialInput,classList,e){var message=e.message;if(message.indexOf("ArithmeticException")===0){Dialog.alert(i18n.divisionByZeroError);}else if(message.indexOf("IntegerInputError")===0){var integerInput=message.slice("IntegerInputError:".length);Dialog.alert(getInputErrorHTML(integerInput,-1,-1));}else if(message.indexOf("UserError")===0||message.indexOf("UserError:")===0||message.indexOf("NotSupportedError")===0){Dialog.alert(getInputErrorHTML(RPNProxy.input,RPNProxy.startPosition,RPNProxy.endPosition));postError(e,RPNProxy.input,initialInput,classList);}else if(message.indexOf("SingularMatrixException")===0){Dialog.alert(i18n.determinantIsEqualToZeroTheMatrixIsSingularNotInvertible);}else if(message.indexOf("MatrixDimensionMismatchException")===0){Dialog.alert(i18n.matricesShouldHaveSameDimensions);}else if(message.indexOf("NonSquareMatrixException:")===0){Dialog.alert(message.slice("NonSquareMatrixException:".length));}else if(message.indexOf("NonSquareMatrixException")===0){Dialog.alert(i18n.matrixIsNotSquare);}else if(message.indexOf("DimensionMismatchException")===0){Dialog.alert(i18n.theNumberOfColumnsInFirstMatrixShouldEqualTheNumberOfRowsInSecond);}else if(message.indexOf("ValueMissingError")===0){hit({error:message});var inputElementId=message.slice("ValueMissingError:".length);var inputElement=document.getElementById(inputElementId);reportValidity(inputElement,i18n.pleaseFillOutThisField);}else{Dialog.alert(getInputErrorHTML(RPNProxy.input,RPNProxy.startPosition,RPNProxy.endPosition));postError(e,RPNProxy.input,initialInput,classList);window.sendSnapshot();window.console.log(e);}};var decimalFractionDigits=-1;var toMultilineString=function(array){var table=new Array(array.length);var columnWidths=[];var i=-1;while(++i<array.length){var elements=array[i];var row0=new Array(elements.length);table[i]=row0;var j=-1;while(++j<elements.length){row0[j]=elements[j].toString().replace(/^\s+|\s+$/g,"");if(j<columnWidths.length){columnWidths[j]=columnWidths[j]<row0[j].length?row0[j].length:columnWidths[j];}else{columnWidths.push(row0[j].length);}}}
var result=new Array(table.length);var k=-1;while(++k<table.length){var row=table[k];var h=-1;while(++h<columnWidths.length){var e=h<row.length?row[h]:"";var padding=columnWidths[h]-e.length;var spaces="";while(padding>0){spaces+=" ";padding-=1;}
row[h]=spaces+e;}
result[k]=row.join("\t");}
return result.join("\n");};var getMatrix4=function(input){var rows=[[]];var cellStart=0;var b=0;for(var i=0;i<input.length;i+=1){var c=input.charCodeAt(i);if(c==="{".charCodeAt(0)){b+=1;if(b===2){cellStart=i+1;}}else if(c==="}".charCodeAt(0)){if(b===2){rows[rows.length-1].push(input.slice(cellStart,i));}
b-=1;}else if(c===",".charCodeAt(0)){if(b===2){rows[rows.length-1].push(input.slice(cellStart,i));cellStart=i+1;}else if(b===1){rows.push([]);}}}
return rows;};var serializeMathML=function(element){return(new XMLSerializer()).serializeToString(element).replace(/xmlns\=\"[^"]+\"/g,"");};var getMatrixPresentationsFromMatrix=function(mathmlCode,asciimathCode){var result={};result["application/mathml-presentation+xml"]=PageUtils.formatXml("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">"+mathmlCode+"</math>");result["text/plain"]="\n"+toMultilineString(getMatrix4(asciimathCode))+"\n";result["text/ascii-math"]=asciimathCode;try{result["application/x-latex"]=RPN(asciimathCode,new RPN.Context()).toLaTeX();}catch(error){window.setTimeout(function(){throw error;},0);}
return result;};Expression.getMatrixPresentationsFromMatrix=getMatrixPresentationsFromMatrix;var onShowMathMLOrText=function(matrixMenu,type,singleline){hit({click:"show-text-"+type});var matrixContainer=document.getElementById(matrixMenu.getAttribute("data-for-matrix"));var presentations=getMatrixPresentationsFromMatrix(serializeMathML(matrixContainer),matrixContainer.getAttribute("data-matrix"));var value=presentations[type];var anchorPoint={left:Number.parseFloat(matrixMenu.getAttribute("data-left")),top:Number.parseFloat(matrixMenu.getAttribute("data-top"))};var content=singleline?"<input type=\"text\" value=\""+Utils.escapeHTML(value)+"\" />":"<textarea wrap=\"off\" style=\"width:18em;height:18em;\">"+Utils.escapeHTML(value)+"</textarea>";var dialog=Dialog.standard(undefined,[[anchorPoint.left,anchorPoint.top],[0.5,0.5]],content,"<button autofocus=\"autofocus\" type=\"submit\">"+i18n.close+"</button>");var input=dialog.querySelector("input")||dialog.querySelector("textarea");input.select();input.focus();};var onShowMathML=function(event){var matrixMenu=this.parentNode;onShowMathMLOrText(matrixMenu,"application/mathml-presentation+xml",false);};var onShowText=function(event){var matrixMenu=this.parentNode;onShowMathMLOrText(matrixMenu,"text/ascii-math",true);};var onShowLaTeX=function(event){var matrixMenu=this.parentNode;onShowMathMLOrText(matrixMenu,"application/x-latex",false);};var drawElement=function(element){var boundingRect=element.getBoundingClientRect();var width=Math.floor(boundingRect.right-boundingRect.left+0.5+0.5+2);var height=Math.floor(boundingRect.bottom-boundingRect.top+0.5+0.5);var html=(new XMLSerializer()).serializeToString(element);var css="";var styleSheets=document.styleSheets;for(var j=0;j<styleSheets.length;j+=1){var rules=styleSheets[j].cssRules;if(rules!=undefined){for(var i=0;i<rules.length;i+=1){var rule=rules[i];if(rule.type===window.CSSRule.STYLE_RULE){var cssText=rule.cssText;if(cssText.indexOf(".math ")!==-1||cssText.indexOf("no-")!==-1){css+=cssText+"\n";}}}}}
css+="div {font-size: 17px;background: white; text-align: center;}\n";css+="mtd {vertical-align: middle;}";var data="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+width.toString()+"\" height=\""+height.toString()+"\">"+"<foreignObject width=\"100%\" height=\"100%\">"+"<div xmlns=\"http://www.w3.org/1999/xhtml\">"+"<style>"+css+"</style>"+"<div>"+html+"</div>"+"</div>"+"</foreignObject>"+"</svg>";var src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(data);return{src:src,width:width,height:height};};var onShowImage=function(event){hit({click:"show-image-menuitem"});var matrixMenu=this.parentNode;var matrixContainer=document.getElementById(matrixMenu.getAttribute("data-for-matrix"));var html=PageUtils.formatXml("<math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">"+serializeMathML(matrixContainer)+"</math>");var element=document.createElement("div");element.innerHTML="<div>"+html+"</div>";element.style.visibilty="hidden";element.style.position="absolute";element.style.left="0px";element.style.top="0px";document.body.appendChild(element);var image=drawElement(element.firstElementChild);document.body.removeChild(element);var anchorPoint={left:Number.parseFloat(matrixMenu.getAttribute("data-left")),top:Number.parseFloat(matrixMenu.getAttribute("data-top"))};var dialog=Dialog.standard(undefined,[[anchorPoint.left,anchorPoint.top],[0.5,0.5]],"<img width=\""+image.width+"\" height=\""+image.height+"\" src=\""+image.src+"\" tabindex=\"0\" />","<button autofocus=\"autofocus\" type=\"submit\">"+i18n.close+"</button>");if(window.opera!=undefined){dialog.style.transform="none";var img=dialog.querySelector("img");img.removeAttribute("width");img.removeAttribute("height");img.removeAttribute("src");img.src=image.src;}};var isCommandEnabled=function(command){if(document.queryCommandSupported!=undefined&&document.queryCommandEnabled!=undefined){if(command==="copy"&&window.opera!=undefined){return document.queryCommandSupported("copy");}
try{return document.queryCommandSupported(command)&&document.queryCommandEnabled(command);}catch(error){window.console.log(error);}}
return false;};var insertText=function(input,text,selectionStart,selectionEnd){var value=input.value;if(isCommandEnabled("insertText")){document.execCommand("insertText",false,text);}else{if(isCommandEnabled("ms-beginUndoUnit")){document.execCommand("ms-beginUndoUnit",false,true);}
input.value=value.slice(0,selectionStart)+text+value.slice(selectionEnd);if(isCommandEnabled("ms-endUndoUnit")){document.execCommand("ms-endUndoUnit",false,true);}}};var makeMenuItem=function(id,label){return"<menuitem id=\""+id+"\" label=\""+label+"\"></menuitem>";};var prepareMatrixMenu=function(dataForMatrix,clientX,clientY,rect){var matrixMenu=document.getElementById("matrix-menu");if(matrixMenu==undefined){matrixMenu=document.createElement("menu");matrixMenu.id="matrix-menu";matrixMenu.setAttribute("type","context");var insertInMenuItems="";var tables=document.querySelectorAll(".matrix-table");for(var i=0;i<tables.length;i+=1){var id=tables[i].getAttribute("data-id");insertInMenuItems+=makeMenuItem("print-matrix-menuitem-"+id,i18n.textInsertin+" "+id);}
var isCopyEnabled=isCommandEnabled("copy");matrixMenu.innerHTML=insertInMenuItems+
(isCopyEnabled?makeMenuItem("copy-matrix-to-clipboard-menuitem",i18n.copyToClipboard):"")+
makeMenuItem("show-mathml-menuitem",i18n.showMathML)+
makeMenuItem("show-text-menuitem",i18n.showText)+
makeMenuItem("show-image-menuitem",i18n.showImage)+
makeMenuItem("show-latex-menuitem",i18n.showMathML.replace(/MathML/g,"LaTeX"));document.body.appendChild(matrixMenu);for(var j=0;j<tables.length;j+=1){var menuItemId="print-matrix-menuitem-"+tables[j].getAttribute("data-id");document.getElementById(menuItemId).addEventListener("click",onPrintMatrix,false);}
if(isCopyEnabled){document.getElementById("copy-matrix-to-clipboard-menuitem").addEventListener("click",onCopyMatrixToClipboard,false);}
document.getElementById("show-mathml-menuitem").addEventListener("click",onShowMathML,false);document.getElementById("show-text-menuitem").addEventListener("click",onShowText,false);document.getElementById("show-image-menuitem").addEventListener("click",onShowImage,false);document.getElementById("show-latex-menuitem").addEventListener("click",onShowLaTeX,false);Utils.check(matrixMenu);}
matrixMenu.setAttribute("data-for-matrix",dataForMatrix);matrixMenu.setAttribute("data-left",(clientX!==0?clientX:(rect.left+rect.right)*0.5).toString());matrixMenu.setAttribute("data-top",(clientY!==0?clientY:(rect.top+rect.bottom)*0.5).toString());};var getMatrixMenuDialog=function(matrixMenu){var matrixMenuDialog=document.getElementById("matrix-menu-dialog");if(matrixMenuDialog==undefined){matrixMenuDialog=Dialog.create();matrixMenuDialog.id="matrix-menu-dialog";matrixMenuDialog.classList.toggle("matrix-menu-dialog",true);var items=matrixMenu.querySelectorAll("menuitem");var focusedElements=0;var closeDialog=function(){if(matrixMenuDialog.getAttribute("open")!=undefined){matrixMenuDialog.close();}};var onItemFocus=function(event){focusedElements+=1;};var onItemBlur=function(event){focusedElements-=1;window.setTimeout(function(){if(focusedElements===0){closeDialog();}},10);};var onItemClick=function(event){event.preventDefault();var i=event.target.getAttribute("data-i");if(i!=undefined){items[i].click();}
closeDialog();};matrixMenuDialog.addEventListener("keypress",function(event){if(!event.ctrlKey&&!event.altKey&&!event.metaKey&&!event.defaultPrevented){var target=document.activeElement;if(target.parentNode===this){var s=String.fromCharCode(event.charCode).toLocaleUpperCase();var node=target;for(var x=node.nextElementSibling||this.firstElementChild;x!==target;x=x.nextElementSibling||this.firstElementChild){var label=x.textContent;if(s===label.slice(0,1).toLocaleUpperCase()&&node===target){node=x;}}
if(node!==target){event.preventDefault();node.focus();}}}},false);matrixMenuDialog.addEventListener("keydown",function(event){if(!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){var keyCode=event.keyCode;var target=document.activeElement;if(target.parentNode===this){var DOM_VK_LEFT=37;var DOM_VK_UP=38;var DOM_VK_RIGHT=39;var DOM_VK_DOWN=40;var DOM_VK_ESCAPE=27;var DOM_VK_RETURN=13;if(keyCode===DOM_VK_LEFT||keyCode===DOM_VK_UP){var previous=target.previousElementSibling;if(previous==undefined){previous=this.lastElementChild;}
if(previous!=undefined){event.preventDefault();previous.focus();}}
if(keyCode===DOM_VK_RIGHT||keyCode===DOM_VK_DOWN){var next=target.nextElementSibling;if(next==undefined){next=this.firstElementChild;}
if(next!=undefined){event.preventDefault();next.focus();}}
if(keyCode===DOM_VK_ESCAPE){event.preventDefault();closeDialog();}
if(keyCode===DOM_VK_RETURN){event.preventDefault();target.click();}}}},false);matrixMenuDialog.setAttribute("role","menu");var html="";for(var i=0;i<items.length;i+=1){html+="<a role=\"menuitem\" class=\"menuitem\" tabindex=\"0\" data-i=\""+i.toString()+"\">"+items[i].getAttribute("label")+"</a>";}
matrixMenuDialog.innerHTML=html;var elements=matrixMenuDialog.querySelectorAll(".menuitem");for(var k=0;k<elements.length;k+=1){elements[k].addEventListener("focus",onItemFocus,false);elements[k].addEventListener("blur",onItemBlur,false);elements[k].addEventListener("click",onItemClick,false);}
document.body.appendChild(matrixMenuDialog);}
return matrixMenuDialog;};var onCopyMatrixToClipboard=function(event){hit({click:"copy-matrix-to-clipboard-menuitem"});var matrixMenu=this.parentNode;var matrixContainer=document.getElementById(matrixMenu.getAttribute("data-for-matrix"));var focusNode=matrixContainer.parentNode.parentNode.querySelector(".matrix-menu-show");focusNode.focus();window.getSelection().collapse(focusNode,0);try{document.execCommand("copy");}catch(error){Dialog.alert(Utils.escapeHTML(error.toString()));}};Utils.on("click",".matrix-menu-show",function(event){hit({click:"matrix-menu-show"});prepareMatrixMenu(this.getAttribute("data-for-matrix"),event.clientX,event.clientY,this.getBoundingClientRect());var matrixMenu=document.getElementById("matrix-menu");var matrixMenuDialog=getMatrixMenuDialog(matrixMenu);matrixMenuDialog.show(this.getBoundingClientRect(),undefined);matrixMenuDialog.firstElementChild.focus();});var MatrixTables={};var setInputCustomValidity=function(input,checkedValue,isValid){if(input.value===checkedValue){var dataTitle=input.getAttribute("data-title");if(dataTitle==undefined){var title=input.getAttribute("title");if(title!=undefined){input.setAttribute("data-title",input.getAttribute("title"));}}
if(isValid){if(dataTitle!=undefined){input.setAttribute("title",dataTitle);}else{input.removeAttribute("title");}}else{input.setAttribute("title",i18n.inputError.replace(/\$\{listOfExamples\}/g,i18n.listOfExamples).replace(/\$\{listOfComplexExamples\}/g,i18n.listOfComplexExamples).replace(/<code>/g,"").replace(/<\/code>/g,""));}
var e=input.parentNode.classList.contains("a-input")?input.parentNode:input;e.classList.toggle("invalid",!isValid);}};var delayByInput={};var checkInput=function(input,inputName,type){var getInputValue4Page=function(value,type){var v=value.replace(/^\s+|\s+$/g,"");if((v==="-"||v==="+")&&(type==="system"||type==="polynomial")){return v+"1";}
if(v===""){return"0";}
return value;};requestIdleCallback(inputName,function(){var start=Date.now();var checkedValue=input.value;var value=getInputValue4Page(checkedValue,type);var onEnd=function(){var end=Date.now();if(end-start>300){hit({checkInput:roundValue(end-start,1000-1)});}
delayByInput[inputName]=Math.min(50,end-start);};RPNProxy.checkElement(value,function(){setInputCustomValidity(input,checkedValue,true);onEnd();},function(error){updateDataErrorAttribute(input,error);setInputCustomValidity(input,checkedValue,false);onEnd();});},delayByInput[inputName]||50);};var checkTextarea=function(textarea,textareaName,type){requestIdleCallback(textarea.name,function(){var textareaValue=textarea.value;RPNProxy.checkElements(textareaValue,type,function(){setInputCustomValidity(textarea,textareaValue,true);},function(error){if(type!=="system"||textarea.value.indexOf("=")===-1){updateDataErrorAttribute(textarea,error,RPNProxy.p);}
window.console.log(error);setInputCustomValidity(textarea,textareaValue,false);});},200);};Utils.initialize(".a-input",function(element){window.setTimeout(function(){initializeAInput(element);},0);var input=element.querySelector(".fraction-input");if(input!=undefined){input.addEventListener("input",function(event){var input=event.target;checkInput(input,input.name,"");},false);checkInput(input,input.name,"");}});Utils.initialize(".a-highlight",initializeAHighlight);Utils.initialize(".a-tooltip",initializeATooltip);var keyStorage={a:function(methodName,key,value,callback){var start=Date.now();var ok=false;var storage=undefined;try{storage=window.localStorage;ok=true;}catch(error){window.console.log(error);}
var end=Date.now();if(!ok||end-start>16){var duration=roundValue(end-start,10-1);hit({localStorage:"access"+"-"+(ok?"successful":"unsuccessful")+"-"+"?"+"-"+duration});}
var result=undefined;if(storage!=undefined){var start=Date.now();var ok=false;try{if(methodName==="getItem"){result=storage.getItem(key);}else if(methodName==="setItem"){storage.setItem(key,value);}else{throw new Error(methodName);}
ok=true;}catch(error){window.console.log(error);}
var end=Date.now();var duration=roundValue(end-start,10-1);var n=methodName==="getItem"?result:(methodName==="setItem"?value:"");var valueLength=roundValue(n!=undefined?n.length:0,1000-1);hit({localStorage:methodName+"-"+(ok?"successful":"unsuccessful")+"-"+valueLength+"-"+duration});}
if(callback!=undefined){callback(result);}},getItem:function(key,callback){keyStorage.a("getItem",key,undefined,callback);},setItem:function(key,value){keyStorage.a("setItem",key,value,undefined);}};var timeoutIds={};var requestIdleCallback=function(key,callback,delay){var timeoutId=timeoutIds[key];if(timeoutId==undefined||timeoutId===0){timeoutId=window.setTimeout(function(){timeoutIds[key]=0;callback();},delay);timeoutIds[key]=timeoutId;}};function MatrixTable(name,initialRows,initialCols,type,container){this.name=name;this.rows=0;this.cols=0;this.initRows=initialRows;this.initCols=initialCols;this.mode="cells";this.minWidth=type==="system"?3.0:3.8;this.type=type;this.container=container;this.onmodechange=undefined;this.textarea=undefined;this.table=[];this.updateTimeoutId=0;}
MatrixTable.prototype.getState=function(){return{type:this.type,mode:this.mode,inputValues:this.getRawInput("cells"),textareaValue:this.getRawInput(""),rows:this.rows,cols:this.cols,textareaStyleWidth:this.textarea!=undefined?this.textarea.style.width:undefined,textareaStyleHeight:this.textarea!=undefined?this.textarea.style.height:undefined,firstInputElementId:this.getFirstInputElementId()};};MatrixTable.prototype.updateInputWidths=function(){var dimensions=this.getDimensions();var expectedRows=dimensions.rows;var expectedCols=dimensions.cols;var table=this.table;var maxLengths=[];var i=-1;var j=-1;while(++i<table.length){j=-1;while(++j<table[i].length){var l=table[i][j].value.length;if(j<maxLengths.length){maxLengths[j]=maxLengths[j]<l?l:maxLengths[j];}else{maxLengths.push(l);}}}
i=-1;while(++i<table.length){j=-1;while(++j<table[i].length){var w=maxLengths[j]*0.8;var minWidth=this.minWidth;if(w<minWidth){w=minWidth;}
if(w>10){w=10;}
var input=table[i][j];input.style.minWidth=minWidth.toString()+"em";input.style.maxWidth=w.toString()+"em";if(i<expectedRows&&j<expectedCols){input.setAttribute("placeholder","0");}else{input.removeAttribute("placeholder");}
var far=i>expectedRows||j>expectedCols;input.classList.toggle("far",far);var nextElementSibling=input.parentNode.nextElementSibling;if(nextElementSibling!=undefined){nextElementSibling.classList.toggle("far",far);}}}};MatrixTable.prototype.updateTextareaWidth=function(){var value=this.textarea.value;var i=0;var c=0;while(i>=0){c+=1;i=value.indexOf("\n",i+1);}
var placeholderLines=3;var h=Math.floor(Math.max(placeholderLines+1,c+2)*4 / 3);this.textarea.style.minHeight=Math.min(h,12).toString()+"em";};MatrixTable.prototype.update=function(event){var that=this;if(this.updateTimeoutId===0){this.updateTimeoutId=window.setTimeout(function(){that.updateTimeoutId=0;if(that.mode==="cells"){that.updateInputWidths();}else{that.updateTextareaWidth();}},9);}};MatrixTable.prototype.insert=function(inputValues,textareaValue,rows,cols,textareaStyleWidth,textareaStyleHeight,mode){if(inputValues==undefined){inputValues=[];}
if(textareaValue==undefined){textareaValue=toMultilineString(inputValues);}
if(rows==undefined){rows=inputValues.length;}
if(cols==undefined){cols=0;for(var y=0;y<inputValues.length;y+=1){cols=Math.max(cols,inputValues[y].length);}}
if(textareaStyleWidth==undefined){textareaStyleWidth=this.textarea!=undefined?this.textarea.style.width:"";}
if(textareaStyleHeight==undefined){textareaStyleHeight=this.textarea!=undefined?this.textarea.style.height:"";}
if(mode==undefined){mode=this.mode;}
if(rows===0){rows=this.initRows;cols=this.initCols;}
if(rows<1){rows=1;}
if(cols<1){cols=1;}
if(this.type==="polynomial"){rows=1;cols=Math.max(cols,2);}
this.rows=rows;this.cols=cols;var st="";var i=-1;var j=-1;var type=this.type;var container=this.container;var autocomplete="off";st+="<div data-for=\""+this.name+"\" tabindex=\"0\" class=\"matrix-table-inner "+(type==="polynomial"?"":(type==="system"?"matrix-system":"matrix-with-braces"))+"\">";var tableHTML="";tableHTML+="<table>";i=-1;while(++i<this.rows){tableHTML+="<tr>";j=-1;while(++j<this.cols){tableHTML+="<td class=\"matrix-table-cell\">";tableHTML+="<span class=\"a-input\">";var inputTitle="";var inputName=this.name+"-"+i.toString()+"-"+j.toString();var inputValue=(i<inputValues.length&&j<inputValues[i].length?Utils.escapeHTML(inputValues[i][j].replace(/^\s+|\s+$/g,"")):"");tableHTML+="<input id=\""+inputName+"\" name=\""+inputName+"\" class=\"matrix-table-input unfocused-placeholder\" type=\"text\" autocomplete=\""+autocomplete+"\" spellcheck=\"false\" x-inputmode=\"numeric\" inputmode=\"numeric\" autocapitalize=\"off\" data-for=\""+this.name+"\" data-row=\""+i.toString()+"\" data-column=\""+j.toString()+"\""+(inputTitle!==""?" title=\""+inputTitle+"\"":"")+" value=\""+inputValue+"\" />";tableHTML+="</span>";if(type==="system"){tableHTML+="<span>";tableHTML+="<math>"+
(j<this.cols-1?"<msub><mrow><mi>x</mi></mrow><mrow><mn>"+(j+1).toString()+"</mn></mrow></msub>":"")+
(j===this.cols-1?"<mtext>&nbsp;</mtext>":(j===this.cols-2?"<mo>=</mo>":"<mo>+</mo>"))+"</math>";tableHTML+="</span>";}
if(type==="polynomial"){tableHTML+="<span>";tableHTML+="<math>"+
(j<this.cols-2?"<msup><mrow><mi>x</mi></mrow><mrow><mn>"+(this.cols-j-1).toString()+"</mn></mrow></msup>":"")+
(j===this.cols-2?"<mi>x</mi>":"")+
(j<this.cols-1?"<mo>+</mo>":"<mtext>&nbsp;</mtext>")+"</math>";tableHTML+="</span>";}
tableHTML+="</td>";}
tableHTML+="</tr>";}
tableHTML+="</table>";var placeholder="-2  2 -3&#10;-1  1  3&#10; 2  0 -1";var textareaName=this.name+"-textarea";var textareaHTML="<textarea id=\""+textareaName+"\" name=\""+textareaName+"\" wrap=\"off\" class=\"matrix-table-textarea unfocused-placeholder\" autocomplete=\""+autocomplete+"\" spellcheck=\"false\" x-inputmode=\"numeric\" inputmode=\"numeric\" autocapitalize=\"off\" placeholder=\""+placeholder+"\"></textarea>";st+=tableHTML;st+="<div class=\"textarea-container\">";st+="<span class=\"a-input\">";st+=textareaHTML;st+="</span>";st+="</div>";st+="</div>";st+="<div class=\"nowrap\"><label><input type=\"checkbox\" tabindex=\"-1\" class=\"swap-mode-input\" data-for=\""+this.name+"\" /><button type=\"button\" aria-pressed=\"mixed\" class=\"swap-mode-button\">"+i18n.cells+"</button></label>"+"<button type=\"button\" class=\"clear-table-button\" data-for=\""+this.name+"\">"+i18n.textClear+"</button>"+"<button type=\"button\" class=\"increment-size-button resize-table-button\" data-for=\""+this.name+"\" data-inc=\"+1\">+</button>"+"<button type=\"button\" class=\"decrement-size-button resize-table-button\" data-for=\""+this.name+"\" data-inc=\"-1\">&minus;</button>"+"</div>";container.classList.toggle("matrix-table",true);container.classList.toggle("cells",mode==="cells");container.classList.toggle("textarea",mode!=="cells");var that=this;var oldTextarea=this.textarea;if(container.querySelector(".swap-mode-input")!=undefined){var tmp=document.createElement("div");tmp.innerHTML=tableHTML;var innerContainer=container.firstElementChild;innerContainer.removeChild(innerContainer.firstElementChild);innerContainer.insertBefore(tmp.firstElementChild,innerContainer.firstElementChild);}else{container.innerHTML=st;container.querySelector(".clear-table-button").addEventListener("click",function(event){hit({click:"clear-table-button"});that.insert([],"",that.initRows,that.initCols);},false);var onResizeTable=function(event){hit({click:"resize-table-button"});var inc=this.getAttribute("data-inc");var n=Number.parseInt(inc,10);that.insert(that.getRawInput("cells"),that.getRawInput(""),that.rows+(that.type!=="polynomial"?n:0),that.cols+n);};container.querySelector(".increment-size-button").addEventListener("click",onResizeTable,false);container.querySelector(".decrement-size-button").addEventListener("click",onResizeTable,false);}
container.setAttribute("data-matrix-table",this.name);if(oldTextarea==undefined){this.textarea=container.querySelector("textarea");}
this.textarea.style.width=textareaStyleWidth;this.textarea.style.height=textareaStyleHeight;this.table=new Array(this.rows);i=-1;while(++i<this.rows){this.table[i]=new Array(this.cols);j=-1;while(++j<this.cols){this.table[i][j]=undefined;}}
var onKeyDown=function(event){that.onKeyDown(event);};var onInput=function(event){var input=event.target;checkInput(input,input.name,that.type);that.update(event);};var inputs=container.querySelectorAll(".matrix-table-input");i=inputs.length;while(--i>=0){var input=inputs[i];input.addEventListener("keydown",onKeyDown,false);input.addEventListener("input",onInput,false);var row=Number.parseInt(input.getAttribute("data-row"),10);var column=Number.parseInt(input.getAttribute("data-column"),10);this.table[row][column]=input;checkInput(input,input.name,this.type);}
this.updateInputWidths();if(document.activeElement===this.textarea){this.textarea.setSelectionRange(0,this.textarea.value.length);insertText(this.textarea,textareaValue,0,this.textarea.value.length);}else{this.textarea.value=textareaValue;}
var onTextareaInput=function(event){var textarea=that.textarea;checkTextarea(textarea,textarea.name,that.type);that.update(event);};if(oldTextarea==undefined){this.textarea.addEventListener("input",onTextareaInput,false);}
checkTextarea(this.textarea,this.textarea.name,this.type);this.updateTextareaWidth();Utils.check(container);var swapModeCheckbox=container.querySelector(".swap-mode-input");var swapModeButton=container.querySelector(".swap-mode-button");if(oldTextarea==undefined){var onSwapModeChange=function(event){hit({swapMode:(window.matchMedia!=undefined?window.matchMedia("(any-pointer: fine)").matches.toString():"?")});event.preventDefault();var element=this.tagName.toUpperCase()==="INPUT"?this:this.previousElementSibling;if(element!==this){element.checked=!element.checked;}
if((element.checked&&that.mode!=="cells")||(!element.checked&&that.mode==="cells")){that.onswapmode();}};swapModeButton.addEventListener("click",onSwapModeChange,false);swapModeCheckbox.addEventListener("change",onSwapModeChange,false);}
var isCellsMode=mode==="cells";if(swapModeCheckbox.checked!==isCellsMode){swapModeCheckbox.checked=isCellsMode;}
swapModeButton.setAttribute("aria-pressed",isCellsMode?"true":"false");container.querySelector(".increment-size-button").disabled=!isCellsMode;container.querySelector(".decrement-size-button").disabled=!isCellsMode;if(this.mode!==mode){this.mode=mode;if(this.onmodechange!=undefined){this.onmodechange();}}};MatrixTable.prototype.getRawInput=function(mode){if(this.textarea!=undefined){if(mode!=="cells"){return this.textarea.value;}
var dimensions=this.getDimensions();var rows=dimensions.rows;var cols=dimensions.cols;var result=new Array(rows);var i=-1;while(++i<rows){result[i]=new Array(cols);var j=-1;while(++j<cols){var value=this.table[i][j].value;result[i][j]=value;}}
return result;}
return"";};MatrixTable.prototype.getFirstInputElementId=function(){return this.mode!=="cells"?this.textarea.id:this.table[0][0].id;};MatrixTable.prototype.getDimensions=function(){var rows=0;var cols=(this.type==="system"||this.type==="polynomial")&&this.table.length!==0?this.table[0].length:0;for(var i=0;i<this.table.length;i+=1){for(var j=0;j<this.table[i].length;j+=1){if(this.table[i][j].value.replace(/^\s+|\s+$/g,"")!==""){rows=Math.max(rows,i+1);cols=Math.max(cols,j+1);}}}
return{rows:rows,cols:cols};};MatrixTable.prototype.isSpace=function(value){var code=value.length>=4?value.charCodeAt(value.length-4):0;var isAlpha=(code>="a".charCodeAt(0)&&code<="z".charCodeAt(0))||(code>="A".charCodeAt(0)&&code<="Z".charCodeAt(0));var t=value.slice(-3);return isAlpha||(t!=="sin"&&t!=="sen"&&t!=="cos");};MatrixTable.prototype.onKeyDown=function(event){if(!event.ctrlKey&&!event.altKey&&!event.shiftKey&&!event.metaKey&&!event.defaultPrevented){var mt=this;var input=event.target;var i=Number.parseInt(input.getAttribute("data-row"),10);var j=Number.parseInt(input.getAttribute("data-column"),10);var oldI=i;var oldJ=j;var k=0;var keyCode=event.keyCode;if(i>=mt.table.length||j>=mt.table[i].length){return;}
var DOM_VK_BACK_SPACE=8;var DOM_VK_RETURN=13;var DOM_VK_SPACE=32;var DOM_VK_LEFT=37;var DOM_VK_UP=38;var DOM_VK_RIGHT=39;var DOM_VK_DOWN=40;if((keyCode===DOM_VK_SPACE||keyCode===DOM_VK_RIGHT)&&input.selectionStart===input.value.length&&input.selectionEnd===input.value.length){if(keyCode!==DOM_VK_SPACE||this.isSpace(input.value)){j+=1;event.preventDefault();}else{hit({input:"space"});}}else if(keyCode===DOM_VK_RETURN||keyCode===DOM_VK_DOWN){j=keyCode===DOM_VK_RETURN?0:j;i+=1;event.preventDefault();}else if((keyCode===DOM_VK_BACK_SPACE||keyCode===DOM_VK_LEFT)&&input.selectionStart===0&&input.selectionEnd===0){if(j>0){j-=1;}else{if(i>0){i-=1;j=mt.cols-1;}}
event.preventDefault();}else if(keyCode===DOM_VK_UP){i=i>0?i-1:i;event.preventDefault();}
if(i!==oldI||j!==oldJ){var hideCol=j<oldJ&&oldJ===mt.cols-1&&mt.cols>mt.initCols;k=-1;while(hideCol&&++k<mt.rows){hideCol=mt.table[k][mt.cols-1].value.length===0;}
var hideRow=i<oldI&&oldI===mt.rows-1&&mt.rows>mt.initRows;k=-1;while(hideRow&&++k<mt.cols){hideRow=mt.table[mt.rows-1][k].value.length===0;}
if(hideCol||hideRow||i===mt.rows||j===mt.cols){mt.insert(mt.getRawInput("cells"),mt.getRawInput(""),mt.rows+(hideRow?-1:(i===mt.rows?+1:0)),mt.cols+(hideCol?-1:(j===mt.cols?+1:0)));}
var e=mt.table[i][j];e.focus();e.select();}}};function ActHistoryItem(data){var oldVersion=data.version||0;if(oldVersion===0){var resultHTML=data.length>0?data[0]:"";data={resultHTML:resultHTML.indexOf("</custom-math>")===-1&&resultHTML.indexOf("</math>")===-1?"<div class=\"math\">"+resultHTML+"</div>":resultHTML,resultMatrix:data.length>1?data[1]:undefined,details:data.length>2?data[2]:undefined,expressionString:data.length>3?data[3]:undefined,actHistoryId:data.length>4?Number.parseInt(data[4],10):(Utils.actHistoryId+=1),detailsHTML:data.length>5?data[5]:undefined,version:7};}
if(oldVersion<=7){if(data.resultMatrix!=undefined&&data.resultMatrix.indexOf(";")!==-1){data.resultMatrix="{{"+data.resultMatrix.replace(/\s*;\s*/g,"},{").replace(/\t/g,",").replace(/\x20/g,"")+"}}";hit({bc:"resultMatrix"});}}
if(oldVersion<ActHistoryItem.version){var addMROWs=function(e){var c=e.firstElementChild;while(c!=undefined){var next=c.nextElementSibling;if(c.tagName.toUpperCase()!=="MROW"){hit({bc:"msub+msup"});var mrow=document.createElement("mrow");e.insertBefore(mrow,c);c.parentNode.removeChild(c);mrow.appendChild(c);}
c=next;}};var fixSummary=function(e){var elements=e.querySelectorAll(".summary");for(var i=0;i<elements.length;i+=1){var oldSummary=elements[i];if(oldSummary!=undefined&&oldSummary.tagName.toUpperCase()!=="SUMMARY"){hit({bc:".summary"});var newSummary=document.createElement("summary");while(oldSummary.firstChild!=undefined){newSummary.appendChild(oldSummary.firstChild);}
oldSummary.parentNode.insertBefore(newSummary,oldSummary);oldSummary.parentNode.removeChild(oldSummary);}}};var fixMSUBAndMSUP=function(node){if(" MFRAC MSQRT MROOT MSUB MSUP MUNDER ".indexOf(" "+node.tagName.toUpperCase()+" ")!==-1){addMROWs(node);}
var c=node.firstElementChild;while(c!=undefined){fixMSUBAndMSUP(c);c=c.nextElementSibling;}};var fixDetails=function(e){var elements=e.querySelectorAll(".details");for(var i=0;i<elements.length;i+=1){var oldDetails=elements[i];hit({bc:".details"});var container=document.createElement("div");container.classList.toggle("details-container",true);oldDetails.parentNode.insertBefore(container,oldDetails);oldDetails.parentNode.removeChild(oldDetails);oldDetails.classList.toggle("details",false);container.appendChild(oldDetails);}};var fixDetailsContainer=function(e){var elements=e.querySelectorAll(".details-container");for(var i=0;i<elements.length;i+=1){var old=elements[i];var c=old.firstElementChild;if(c.classList.contains("details-container")){hit({bc:".details-container"});old.removeChild(c);old.parentNode.insertBefore(c,old);old.parentNode.removeChild(old);}}};var fixOldDetailsTypes=function(e){var elements=e.querySelectorAll("[data-details]");for(var i=0;i<elements.length;i+=1){var element=elements[i];var arrayAttribute=element.getAttribute("data-details");var array=JSON.parse(arrayAttribute);for(var j=0;j<array.length;j+=1){var type=array[j].type;if(type==="determinant"||type==="inverse"||type==="rank"){hit({bc:"details-"+type});array[j].type=type+"-Gauss";}}
element.setAttribute("data-details",JSON.stringify(array));}};var fixMatrixContainer=function(e){var elements=e.querySelectorAll(".matrix-container");for(var i=0;i<elements.length;i+=1){var element=elements[i];var matrix=element.querySelector(".matrix-menu-show");if(matrix!=undefined){hit({bc:"matrix-container"});matrix=matrix.getAttribute("data-matrix");if(matrix!=undefined){if(matrix.indexOf(";")!==-1||matrix.indexOf("\t")!==-1){matrix="{{"+matrix.replace(/\s*;\s*/g,"},{").replace(/\t/g,",").replace(/\x20/g,"")+"}}";}
var columnlines=undefined;var useBraces=undefined;if(element.firstElementChild.tagName.toUpperCase()==="MFENCED"){columnlines=element.firstElementChild.firstElementChild.getAttribute("columnlines");if(columnlines!=undefined){columnlines=-1;}}
if(element.querySelector("[open=\"|\"]")!=undefined){useBraces=["|","|"];}
if(element.querySelector("[open=\"{\"]")!=undefined){useBraces=["{"," "];}
var x=RPN(matrix,new RPN.Context());var tmp=document.createElement("div");tmp.innerHTML=x.toMathML({columnlines:columnlines,useBraces:useBraces});element.parentNode.insertBefore(tmp.firstElementChild,element);element.parentNode.removeChild(element);}}}};var fixTop=function(e){var elements=e.querySelectorAll(".top");for(var i=0;i<elements.length;i+=1){var element=elements[i];if(element.innerHTML==="-1"||element.innerHTML==="T"){hit({bc:"top"});var base=element.previousElementSibling;var tmp=document.createElement("div");tmp.innerHTML="<msup><mrow></mrow><mrow>"+RPN(element.innerHTML).toMathML({})+"</mrow></msup>";base.parentNode.removeChild(base);tmp.firstElementChild.firstElementChild.appendChild(base);element.parentNode.insertBefore(tmp.firstElementChild,element);element.parentNode.removeChild(element);}}};var fixDivMath=function(e){var x=e.firstElementChild;if(x!=undefined&&x.tagName.toUpperCase()==="DIV"&&x.classList.contains("math")){x.style.display="inline-block";}};var fixTable=function(e){var elements=e.querySelectorAll(".inTable");for(var i=0;i<elements.length;i+=1){var element=elements[i];var span=element.nextElementSibling;if(span!=undefined&&span.tagName.toUpperCase()==="SPAN"&&span.style.display==="none"){hit({bc:"inTable"});var tmp=document.createElement("div");var matrix=span.innerHTML;matrix="{{"+matrix.replace(/\s*;\s*/g,"},{").replace(/\t/g,",").replace(/\x20/g,"")+"}}";var isDeterminant=element.querySelector(".matrix-img-line")!=undefined;var x=RPN(matrix,new RPN.Context());tmp.innerHTML=(isDeterminant?new Expression.Determinant(x):x).toMathML({});span.parentNode.removeChild(span);element.parentNode.insertBefore(tmp.firstElementChild,element);element.parentNode.removeChild(element);}}};var fixArrowWithLabel=function(e){var elements=e.querySelectorAll(".arrow-with-label");for(var i=0;i<elements.length;i+=1){var element=elements[i];if(element.getAttribute("data-custom-paint")!=="arrow-with-label"){element.setAttribute("data-custom-paint","arrow-with-label");hit({bc:"arrow-with-label"});}}};var fixMencloseInMenclose=function(e){var elements=e.querySelectorAll("menclose[notation=none]");for(var i=0;i<elements.length;i+=1){var element=elements[i];var es=element.firstElementChild.querySelectorAll("menclose[notation=none]");for(var j=0;j<es.length;j+=1){var e=es[j];if(e.querySelector("mtable")!=undefined){hit({bc:"menclose-menclose"});element.parentNode.insertBefore(e,element);element.parentNode.removeChild(element);}}}};var fixHTML=function(html){if(html==undefined){return html;}
var tmp=document.createElement("div");tmp.innerHTML=html;if(oldVersion<=10){fixMSUBAndMSUP(tmp);fixSummary(tmp);fixDetails(tmp);fixDetailsContainer(tmp);fixOldDetailsTypes(tmp);fixMatrixContainer(tmp);fixTable(tmp);fixTop(tmp);fixDivMath(tmp);fixArrowWithLabel(tmp);fixMencloseInMenclose(tmp);}
return tmp.innerHTML;};data.resultHTML=fixHTML(data.resultHTML);data.detailsHTML=fixHTML(data.detailsHTML);}
this.oldVersion=oldVersion;this.resultHTML=data.resultHTML;this.resultMatrix=data.resultMatrix;this.details=data.details;this.expressionString=data.expressionString;this.actHistoryId=data.actHistoryId;this.detailsHTML=data.detailsHTML;this.version=ActHistoryItem.version;}
ActHistoryItem.version=11;function ActHistoryStorage(){}
ActHistoryStorage.keyStorage=keyStorage;ActHistoryStorage.actHistory=undefined;ActHistoryStorage.actHistoryModificationCount=0;ActHistoryStorage.saveResultsFlag=false;ActHistoryStorage.saveResults=function(limit){ActHistoryStorage.actHistoryModificationCount+=1;if(ActHistoryStorage.saveResultsFlag){return;}
ActHistoryStorage.saveResultsFlag=true;var c=ActHistoryStorage.actHistoryModificationCount;var data=[];for(var i=0;i<ActHistoryStorage.actHistory.length;i+=1){if(ActHistoryStorage.actHistory[i]!=undefined){data.push(ActHistoryStorage.actHistory[i]);}}
if(data.length>limit){var newData=[];for(var j=0;j<limit;j+=1){newData.push(data[data.length-limit+j]);}
data=newData;}
var valueToSave=JSON.stringify(data);ActHistoryStorage.keyStorage.setItem("resdiv",valueToSave);ActHistoryStorage.keyStorage.getItem("resdiv",function(value){ActHistoryStorage.saveResultsFlag=false;if(c!==ActHistoryStorage.actHistoryModificationCount){ActHistoryStorage.saveResults(ActHistoryStorage.actHistory.length);}else{if(value!==valueToSave&&limit>1&&valueToSave.length>1024*1024){ActHistoryStorage.saveResults(Math.floor(limit / 2));}}});};ActHistoryStorage.getActHistoryIndex=function(actHistoryId){for(var i=0;i<ActHistoryStorage.actHistory.length;i+=1){if(ActHistoryStorage.actHistory[i]!=undefined&&ActHistoryStorage.actHistory[i].actHistoryId===actHistoryId){return i;}}
return-1;};ActHistoryStorage.load=function(callback){ActHistoryStorage.keyStorage.getItem("resdiv",function(storedActHistory){try{storedActHistory=storedActHistory!=undefined?JSON.parse(storedActHistory):undefined;if(storedActHistory!=undefined&&!(storedActHistory instanceof Array)){throw new RangeError();}}catch(error){window.setTimeout(function(){throw error;},0);}
ActHistoryStorage.actHistory=[];if(storedActHistory!=undefined){var i=-1;while(++i<storedActHistory.length){var storedActHistoryItem=new ActHistoryItem(storedActHistory[i]);if(storedActHistoryItem.detailsHTML==undefined){var details=storedActHistoryItem.details;if(details!=undefined&&details.length!==0){hit({bc:"createDetailsSummary"});RPNProxy.createDetailsSummary("i"+storedActHistoryItem.actHistoryId.toString(),details,details.length===1?100:1,function(detailsHTML){storedActHistoryItem.detailsHTML=detailsHTML;});}}
ActHistoryStorage.actHistory.push(storedActHistoryItem);}}
callback(ActHistoryStorage.actHistory);});};ActHistoryStorage.getPreviousItem=function(){var previousEntryIndex=ActHistoryStorage.actHistory.length-1;while(previousEntryIndex>=0&&ActHistoryStorage.actHistory[previousEntryIndex]==undefined){previousEntryIndex-=1;}
var previousItem=previousEntryIndex===-1?undefined:ActHistoryStorage.actHistory[previousEntryIndex];return previousItem;};ActHistoryStorage.size=function(){var size=0;for(var i=0;i<ActHistoryStorage.actHistory.length;i+=1){if(ActHistoryStorage.actHistory[i]!=undefined){size+=1;}}
return size;};ActHistoryStorage.getItem=function(actHistoryId){var i=ActHistoryStorage.getActHistoryIndex(actHistoryId);return i===-1?undefined:ActHistoryStorage.actHistory[i];};ActHistoryStorage.setItem=function(item){var i=ActHistoryStorage.getActHistoryIndex(item.actHistoryId);if(i===-1){ActHistoryStorage.actHistory.push(item);ActHistoryStorage.saveResults(ActHistoryStorage.actHistory.length);}};ActHistoryStorage.removeItem=function(actHistoryId){var i=ActHistoryStorage.getActHistoryIndex(actHistoryId);if(i!==-1){ActHistoryStorage.actHistory[i]=undefined;ActHistoryStorage.saveResults(ActHistoryStorage.actHistory.length);}};ActHistoryStorage.clear=function(){ActHistoryStorage.actHistory=[];ActHistoryStorage.saveResults(ActHistoryStorage.actHistory.length);};global.ActHistoryItem=ActHistoryItem;global.ActHistoryStorage=ActHistoryStorage;var setLocationHash=function(hash){if(window.location.protocol!=="file:"&&window.history.replaceState!=undefined){var url=window.location.protocol+"//"+window.location.hostname+(window.location.port!==""?":"+window.location.port:"")+window.location.pathname+window.location.search+hash;var historyState=Object.assign({},window.history.state);window.history.replaceState(historyState,document.title,url);}else{window.location.replace(hash===""?"#":hash);}};Utils.on("click",".clear-all-button",function(event){hit({click:"clear-all-button"});document.getElementById("resdiv").innerHTML="";ActHistoryStorage.clear();lastHash="";setLocationHash("");});var onDecimalFractionDigitsChange=function(event){if(event!=undefined){hit({click:"onDecimalFractionDigitsChange"});}
var useDecimalFractions=document.getElementById("decfraccheckbox").checked;var value=Number.parseInt(document.getElementById("frdigits").value,10)||0;document.getElementById("frdigitsspan").hidden=!useDecimalFractions;decimalFractionDigits=useDecimalFractions?value:-1;if(event!=undefined){keyStorage.setItem("decfraccheckbox",useDecimalFractions?"true":"false");keyStorage.setItem("frdigits",value.toString());}};Utils.initialize(".decimal-fraction-digits-controls",function(element){document.getElementById("decfraccheckbox").addEventListener("change",onDecimalFractionDigitsChange,false);document.getElementById("frdigits").addEventListener("change",onDecimalFractionDigitsChange,false);keyStorage.getItem("decfraccheckbox",function(checked){keyStorage.getItem("frdigits",function(value){if(checked!=undefined){document.getElementById("decfraccheckbox").checked=checked==="true";}
if(value!=undefined){document.getElementById("frdigits").value=value;}
onDecimalFractionDigitsChange(undefined);});});});var DnD={};DnD.onDragEnterOrDragOver=function(event){if(event.target==undefined||event.target.nodeType!==Node.ELEMENT_NODE||(event.target.tagName.toUpperCase()!=="TEXTAREA"&&event.target.tagName.toUpperCase()!=="INPUT")){event.dataTransfer.dropEffect="copy";event.preventDefault();}};DnD.getDataTransferItems=function(event){var dataTransfer=event.type==="paste"?event.clipboardData:event.dataTransfer;var result={};result["text/plain"]=dataTransfer==undefined?"":dataTransfer.getData("Text");return result;};DnD.onDropOrPaste=function(event){var target=this;var input=event.target;var caretPosition=event.type==="paste"||(event.clientX===0&&event.clientY===0)?-1:document.caretPositionFromPoint(event.clientX,event.clientY).offset;var selectText=event.type==="drop";var text=DnD.getDataTransferItems(event)["text/plain"];event.preventDefault();RPNProxy.getMatrix(text,function(matrix){if(matrix!=undefined&&target.getAttribute("data-matrix-table")!=undefined){MatrixTables[target.getAttribute("data-matrix-table")].insert(getMatrix4(matrix));}else if(input.tagName.toUpperCase()==="INPUT"||input.tagName.toUpperCase()==="TEXTAREA"){input.focus();if(caretPosition!==-1){input.setSelectionRange(caretPosition,caretPosition);}
var selectionStart=input.selectionStart;var selectionEnd=input.selectionEnd;insertText(input,matrix!=undefined?matrix:text,selectionStart,selectionEnd);input.setSelectionRange(selectionStart+(selectText?0:text.length),selectionStart+text.length);var inputEvent=document.createEvent("Event");inputEvent.initEvent("input",false,false);input.dispatchEvent(inputEvent);}});};DnD.setData=function(dataTransfer,dataItemsByType){for(var type in dataItemsByType){if(Object.prototype.hasOwnProperty.call(dataItemsByType,type)){var content=dataItemsByType[type];try{dataTransfer.setData(type==="text/plain"?"Text":(type==="text/uri-list"?"URL":type),content);}catch(error){window.console.log(error);}}}};var checkIfCanCopy=function(){var selection=window.getSelection();var isCollapsed=selection.isCollapsed||document.getElementById("copy-fix")!=undefined;if(!isCollapsed){return undefined;}
var target=document.activeElement;if(target==undefined||target.classList==undefined){return undefined;}
if(target.classList.contains("matrix-menu-show")){target=document.getElementById(target.getAttribute("data-for-matrix"));}
if(target.getAttribute("data-matrix")==undefined&&!target.classList.contains("matrix-table-inner")){return undefined;}
return target;};document.addEventListener("beforecopy",function(event){if(checkIfCanCopy()!=undefined){event.preventDefault();}},false);var onCopy=function(event){var clipboardData=event.clipboardData;if(clipboardData==undefined){return;}
var target=checkIfCanCopy();if(target!=undefined){event.preventDefault();var presentations=undefined;if(target.getAttribute("data-matrix")!=undefined){var matrixContainer=target;hit({click:"copy-matrix-container"});presentations=getMatrixPresentationsFromMatrix(serializeMathML(matrixContainer),matrixContainer.getAttribute("data-matrix"));}else{hit({click:"copy-matrix-table"});var tableName=target.getAttribute("data-for");var matrix=getMatrixWithVariableNames(MatrixTables[tableName].getState()).matrix;presentations=getMatrixPresentationsFromMatrix(new Expression.Matrix(matrix).toMathML({idPrefix:"g",fractionDigits:decimalFractionDigits,useMatrixContainer:false}),matrix.toString());}
DnD.setData(clipboardData,presentations);}};document.addEventListener("copy",onCopy,false);document.addEventListener("contextmenu",function(event){var target=event.target;while(target!=undefined&&(target.nodeType!==Node.ELEMENT_NODE||target.getAttribute("data-matrix")==undefined)){target=target.parentNode;}
if(target!=undefined){hit({click:"contextmenu"});prepareMatrixMenu(target.getAttribute("id"),event.clientX,event.clientY,target.getBoundingClientRect());}},false);document.addEventListener("dragstart",function(event){var target=event.target;while(target!=undefined&&(target.nodeType!==Node.ELEMENT_NODE||target.getAttribute("data-matrix")==undefined)){target=target.parentNode;}
if(target!=undefined){var matrixContainer=target;hit({click:"dragstart"});event.dataTransfer.effectAllowed="copy";var presentations=getMatrixPresentationsFromMatrix(serializeMathML(matrixContainer),matrixContainer.getAttribute("data-matrix"));DnD.setData(event.dataTransfer,presentations);}},false);var grow=function(element,resdiv,resultsContainer){if(resultsContainer.animate!=undefined){resdiv.style.overflowY="hidden";var rect=element.getBoundingClientRect();var from=rect.top-rect.bottom;resultsContainer.animate([{transform:"translateY("+from.toString()+"px)"},{transform:"translateY(0px)"}],{duration:400,composite:"add"});window.setTimeout(function(){resdiv.style.overflowY="visible";},400);}};var onPrintMatrix=function(event){hit({click:"print-matrix-menuitem"});var matrixTableId=this.id.slice("print-matrix-menuitem-".length);var matrixMenu=this.parentNode;var matrixContainer=document.getElementById(matrixMenu.getAttribute("data-for-matrix"));var matrixElements=getMatrix4(matrixContainer.getAttribute("data-matrix"));MatrixTables[matrixTableId].insert(matrixElements);};Utils.on("click",".print-matrix-button",function(event){hit({click:"print-matrix-button"});var actHistoryId=this.getAttribute("data-act-history-id");var item=actHistoryId.slice(0,1)==="#"?{resultMatrix:actHistoryId.slice(1)}:ActHistoryStorage.getItem(Number.parseInt(actHistoryId,10));var matrixElements=getMatrix4(item.resultMatrix);MatrixTables[this.getAttribute("data-print-matrix-to")].insert(matrixElements);});Utils.on("click",".clear-button",function(event){hit({click:"clear-button"});var p=this.parentNode.parentNode.parentNode;p.parentNode.removeChild(p);var actHistoryId=Number.parseInt(this.getAttribute("data-act-history-id"),10);ActHistoryStorage.removeItem(actHistoryId);});var getInputErrorHTML=function(input,startPosition,endPosition){return i18n.inputError.replace(/\$\{listOfExamples\}/g,i18n.listOfExamples).replace(/\$\{listOfComplexExamples\}/g,i18n.listOfComplexExamples)+i18n.colonSpacing+":\n"+"<div class=\"input-error-wrapper\">"+
(startPosition===-1||endPosition===-1?Utils.escapeHTML(input):Utils.escapeHTML(input.slice(0,startPosition))+"<b class=\"input-error-position\"><span>"+Utils.escapeHTML(input.slice(startPosition,endPosition)||" ")+"</span></b>"+Utils.escapeHTML(input.slice(endPosition)))+"</div>";};var updateDataErrorAttribute=function(input,error,extraPositionOffset){extraPositionOffset=extraPositionOffset==undefined?0:extraPositionOffset;if(input!=undefined){var message=error.message;if(message.indexOf("UserError:")===0||(RPNProxy.startPosition!==-1&&RPNProxy.endPosition!==-1)){var position=RPNProxy.startPosition;var end=RPNProxy.endPosition;position+=extraPositionOffset;end+=extraPositionOffset;position=Math.min(position,input.value.length-1);end=Math.min(end,input.value.length);input.setAttribute("data-error",position.toString()+","+end.toString());var inputEvent=document.createEvent("Event");inputEvent.initEvent("update-attribute",false,false);input.dispatchEvent(inputEvent);var onInput=function(event){window.setTimeout(function(){input.removeEventListener("input",onInput,false);input.removeAttribute("data-error");var inputEvent=document.createEvent("Event");inputEvent.initEvent("update-attribute",false,false);input.dispatchEvent(inputEvent);},0);};input.addEventListener("input",onInput,false);}}};var onExpressionClick=function(event){var expression=this.getAttribute("data-expression");var expressionInput=undefined;if(expression==undefined){expressionInput=this.previousElementSibling.classList.contains("a-input")?this.previousElementSibling.querySelector("input"):this.previousElementSibling;expression=expressionInput.value;keyStorage.setItem("expression",expression);}
hit({onExpressionClick:expression});var kInput=this.parentNode.classList.contains("button-before-input")?this.parentNode.querySelector("input"):undefined;var kInputValue=kInput==undefined?undefined:kInput.value;var kInputId=kInput==undefined?undefined:kInput.id;var matrixTableAState=MatrixTables["A"]==undefined?undefined:MatrixTables["A"].getState();var matrixTableBState=MatrixTables["B"]==undefined?undefined:MatrixTables["B"].getState();var actHistoryId=(Utils.actHistoryId+=1);var printOptions={idPrefix:"i"+actHistoryId.toString(),fractionDigits:decimalFractionDigits};var classList=this.classList.toString();var start=Date.now();RPNProxy.runExpression(expression,kInputValue,kInputId,matrixTableAState,matrixTableBState,printOptions,function(result){var resultError=result.resultError;var details=result.details;var expressionString=result.expressionString;var resultHTML=result.resultHTML;var resultMatrix=result.resultMatrix;var detailsHTML=result.detailsHTML;if(resultError==undefined){lastHash=expressionString.replace(/\s/g,"");setLocationHash("#"+encodeLocationHash(lastHash));zInsAct(resultHTML,resultMatrix,details,expressionString,actHistoryId,detailsHTML,false);var end=Date.now();hit({click:"onExpressionClick-"+roundValue(end-start,10-1)});}else{updateDataErrorAttribute(expressionInput,resultError);if(resultError.message.indexOf("SingularMatrixException")===0){hit({click:"SingularMatrixException"});zInsAct("<div>"+i18n.determinantIsEqualToZeroTheMatrixIsSingularNotInvertible+"</div>","",details,expression,actHistoryId,detailsHTML,false);}
handleError(expression,classList,resultError);}});};var zInsAct=function(resultHTML,resultMatrix,details,expressionString,actHistoryId,detailsHTML,loading){if(typeof resultHTML!=="string"||typeof resultMatrix!=="string"){throw new RangeError();}
var clearButton="<div><button type=\"button\" class=\"clear-button\" data-act-history-id=\""+actHistoryId.toString()+"\">"+i18n.textClear+"</button></div>";var s="";if(resultMatrix!==""){var tables=document.querySelectorAll(".matrix-table");var i=-1;while(++i<tables.length){var id=tables[i].getAttribute("data-id");s+="<div><button type=\"button\" class=\"print-matrix-button\" data-act-history-id=\""+actHistoryId.toString()+"\" data-print-matrix-to=\""+id+"\">"+i18n.textInsertin+" "+id+"</button></div>";}}
var element=document.createElement("li");element.classList.toggle("actline",true);var insertButtonsHTML="<div class=\"insert-buttons\">"+s+clearButton+"</div>";var html=resultHTML+insertButtonsHTML;if(detailsHTML!=undefined){html+=detailsHTML;}
element.innerHTML=html;var resdiv=document.getElementById("resdiv");var resultsContainer=resdiv.firstElementChild;if(resultsContainer==undefined){resultsContainer=document.createElement("ol");resultsContainer.id="results-container";resdiv.appendChild(resultsContainer);}
resultsContainer.insertBefore(element,resultsContainer.firstChild);Utils.check(element);if(!loading){element.scrollIntoViewIfNeeded(false);grow(element,resdiv,resultsContainer);ActHistoryStorage.setItem(new ActHistoryItem({resultHTML:resultHTML,resultMatrix:resultMatrix,details:details,expressionString:expressionString,actHistoryId:actHistoryId,detailsHTML:detailsHTML,version:ActHistoryItem.version}));}};Utils.initialize(".details-container",function(element){var details=element.firstElementChild;var summary=details.firstElementChild;details.initDetails(summary);details.addEventListener("toggle",function(event){Utils.check1(event.target);},false);details.addEventListener("toggle",function(event){var element=this;var arrayAttribute=element.getAttribute("data-details");if(arrayAttribute==undefined){return;}
element.removeAttribute("data-details");var idPrefix=element.getAttribute("data-id-prefix");var printOptions={idPrefix:idPrefix,fractionDigits:decimalFractionDigits};var array=JSON.parse(arrayAttribute);for(var i=0;i<array.length;i+=1){hit({details:array[i].type});}
RPNProxy.getDetails(array,printOptions,function(html){element.firstElementChild.nextElementSibling.innerHTML=html;Utils.check(element.firstElementChild.nextElementSibling);},function(error){window.console.log(error);});},false);});Utils.on("click",".change-button",function(event){hit({click:"change-button"});var s1=this.getAttribute("data-for1");var s2=this.getAttribute("data-for2");var table1=MatrixTables[s1];var table2=MatrixTables[s2];var t1=table1.getState();var t2=table2.getState();table1.insert(t2.inputValues,t2.textareaValue,t2.rows,t2.cols,t2.textareaStyleWidth,t2.textareaStyleHeight,t2.mode);table2.insert(t1.inputValues,t1.textareaValue,t1.rows,t1.cols,t1.textareaStyleWidth,t1.textareaStyleHeight,t1.mode);});var onInputExampleLinkClick=function(event){hit({click:"input-example-link"});event.preventDefault();var s=this.parentNode.parentNode.querySelector(".input-example-code").textContent;s=s.replace(/\u0020+/g," ").replace(/^\s+|\s+$/g,"").replace(/\n\u0020/g,"\n");var mt=MatrixTables["A"];if(mt.mode==="cells"){mt.container.querySelector(".swap-mode-button").click();}
mt.textarea.value=s;mt.container.scrollIntoViewIfNeeded(false);};Utils.initialize(".input-example-link-container",function(element){element.firstElementChild.addEventListener("click",onInputExampleLinkClick,false);});Utils.initialize(".insert-table",function(element){var id=element.getAttribute("data-id");var sizes=element.getAttribute("data-sizes")||"";var type=element.getAttribute("data-type")||"simple";var initialRows=3;var initialCols=3;var match=(/^(\d+)x(\d+)$/).exec(sizes);if(match!=undefined){initialRows=Number.parseInt(match[1],10);initialCols=Number.parseInt(match[2],10);}
var state=undefined;var stateKey1=id+"1";if(window.location.protocol!=="file:"&&window.history.replaceState!=undefined){var historyState=window.history.state;if(historyState!=undefined&&historyState[stateKey1]!=undefined){state=historyState[stateKey1];}}
if(state==undefined){state={mode:undefined,inputValues:[],textareaValue:"",rows:initialRows,cols:initialCols,textareaStyleWidth:undefined,textareaStyleHeight:undefined};}
var x=new MatrixTable(id,initialRows,initialCols,type,element,state);MatrixTables[id]=x;element.style.visibility="hidden";var modeKey="~"+window.location.pathname+"~"+id+"~"+"mode";keyStorage.getItem(modeKey,function(mode){if(mode==undefined){mode=x.mode;}
x.mode=mode;x.insert(state.inputValues,state.textareaValue,state.rows,state.cols,state.textareaStyleWidth,state.textareaStyleHeight,state.mode);element.style.visibility="";});x.onmodechange=function(){keyStorage.setItem(modeKey,x.mode);};x.onswapmode=function(){var newMode=x.mode==="cells"?"":"cells";RPNProxy.getElementsArray(x.getState(),function(result){var elements=result.elements;x.insert(elements,undefined,undefined,undefined,undefined,undefined,newMode);});};element.addEventListener("dragenter",DnD.onDragEnterOrDragOver,false);element.addEventListener("dragover",DnD.onDragEnterOrDragOver,false);element.addEventListener("drop",DnD.onDropOrPaste,false);element.addEventListener("paste",DnD.onDropOrPaste,false);if(window.location.protocol!=="file:"&&window.history.replaceState!=undefined){window.addEventListener("pagehide",function(event){var historyState=Object.assign({},window.history.state);historyState[stateKey1]=x.getState();window.history.replaceState(historyState,document.title,window.location.href);},false);}});Utils.on("click",".expression-button",onExpressionClick);Utils.on("click",".expression-input-button",onExpressionClick);Utils.initialize(".expression-input-container",function(element){var input=element.querySelector("input");input.addEventListener("input",function(event){event.target.style.width=Math.max(21,(event.target.value.length*0.7)).toString()+"em";},false);if(input.value===input.getAttribute("value")){input.disabled=true;keyStorage.getItem("expression",function(value){input.disabled=false;if(value!=undefined&&value!==""){input.value=value;}
input.addEventListener("input",function(event){var input=event.target;checkInput(input,input.name,"");},false);checkInput(input,input.name,"");});}
input.addEventListener("drop",DnD.onDropOrPaste,false);input.addEventListener("paste",DnD.onDropOrPaste,false);});var encodeLocationHash=function(hash){return encodeURIComponent(hash).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/\./g,"%2E").replace(/~/g,"%7E").replace(/%2C/g,",");};var decodeLocationHash=function(hash){try{return decodeURIComponent(hash);}catch(error){window.onerror(error.message+" : "+hash,"",0,0,error);}
return"";};var lastHash="";var onHashChange=function(event){var hash=decodeLocationHash(window.location.hash.slice(1));if(lastHash===hash){return;}
lastHash=hash;if(document.getElementById(hash)!=undefined){return;}
if(/^hcm\=\d+$/.exec(hash)!=undefined){return;}
if(/^[\-\da-zA-Z]*system_1$/.exec(hash)!=undefined){return;}
if(hash.replace(/^\s+|\s+$/g,"")===""){return;}
var actHistoryId=(Utils.actHistoryId+=1);var printOptions={idPrefix:"i"+actHistoryId.toString(),fractionDigits:decimalFractionDigits};RPNProxy.runExpression(hash,undefined,undefined,undefined,undefined,printOptions,function(result){var resultError=result.resultError;var details=result.details;var expressionString=result.expressionString;var resultHTML=result.resultHTML;var resultMatrix=result.resultMatrix;var detailsHTML=result.detailsHTML;if(resultError==undefined){var previousItem=ActHistoryStorage.getPreviousItem();if(previousItem==undefined||(previousItem.resultHTML!==resultHTML&&previousItem.expressionString!==expressionString)){zInsAct(resultHTML,resultMatrix,details,expressionString,actHistoryId,detailsHTML,false);}}else{if(resultError.message.indexOf("UserError")===0){}else{handleError(hash,"location.hash",resultError);}}});};Utils.initialize(".from-cookie",function(element){var examples=document.getElementById("examples");if(examples!=undefined){var list=examples.querySelectorAll("a");for(var i=0;i<list.length;i+=1){var s=list[i].textContent;var html="";if(s==="{{11,3},{7,11}}*{{8,0,1},{0,3,5}}"){html="<mrow><mfenced open=\"(\" close=\")\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mrow><mn>11</mn></mrow></mtd><mtd><mrow><mn>3</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>7</mn></mrow></mtd><mtd><mrow><mn>11</mn></mrow></mtd></mtr></mtable></mrow></mfenced><mo>&times;</mo><mfenced open=\"(\" close=\")\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mrow><mn>8</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>3</mn></mrow></mtd><mtd><mrow><mn>5</mn></mrow></mtd></mtr></mtable></mrow></mfenced></mrow>";}else if(s==="determinant({{1,2,3},{4,5,6},{7,2,9}})"){html="<mfenced open=\"|\" close=\"|\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd><mtd><mrow><mn>3</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>4</mn></mrow></mtd><mtd><mrow><mn>5</mn></mrow></mtd><mtd><mrow><mn>6</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>7</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd><mtd><mrow><mn>9</mn></mrow></mtd></mtr></mtable></mrow></mfenced>";}else if(s==="{{1,2},{3,4}}^-1"){html="<msup><mrow><mfenced open=\"(\" close=\")\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>3</mn></mrow></mtd><mtd><mrow><mn>4</mn></mrow></mtd></mtr></mtable></mrow></mfenced></mrow><mrow><mfenced open=\"(\" close=\")\"><mrow><mo>&minus;</mo><mrow><mn>1</mn></mrow></mrow></mfenced></mrow></msup>";}else if(s==="{{1,2,3},{4,5,6},{7,2,9}}^-1"){html="<msup><mrow><mfenced open=\"(\" close=\")\"><mrow><mtable rowspacing=\"0ex\"><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd><mtd><mrow><mn>3</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>4</mn></mrow></mtd><mtd><mrow><mn>5</mn></mrow></mtd><mtd><mrow><mn>6</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>7</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd><mtd><mrow><mn>9</mn></mrow></mtd></mtr></mtable></mrow></mfenced></mrow><mrow><mfenced open=\"(\" close=\")\"><mrow><mo>&minus;</mo><mrow><mn>1</mn></mrow></mrow></mfenced></mrow></msup>";}
list[i].innerHTML="<math>"+html+"</math>";}}
ActHistoryStorage.load(function(storedActHistory){var exampleAttribute=element.getAttribute("data-example");var needsExample=exampleAttribute!=undefined;var oldVersion=ActHistoryItem.version;if(true){var i=-1;while(++i<storedActHistory.length){var storedActHistoryItem=storedActHistory[i];zInsAct(storedActHistoryItem.resultHTML,storedActHistoryItem.resultMatrix,storedActHistoryItem.details,storedActHistoryItem.expressionString,storedActHistoryItem.actHistoryId,storedActHistoryItem.detailsHTML,true);Utils.actHistoryId=Math.max(Utils.actHistoryId,storedActHistoryItem.actHistoryId);needsExample=false;oldVersion=Math.min(oldVersion,storedActHistoryItem.oldVersion);if(storedActHistoryItem.expressionString==undefined){oldVersion=-1;}}
if(storedActHistory.length!==0){hit({version:"version-"+oldVersion});}}
window.addEventListener("hashchange",onHashChange,false);onHashChange(undefined);needsExample=needsExample&&ActHistoryStorage.size()===0;if(needsExample){var printOptions={idPrefix:"g",fractionDigits:-1};RPNProxy.runExpression("{{6},{78},{-4}}+{{3},{-18},{45}}",undefined,undefined,undefined,undefined,printOptions,function(result){handleError("","",result.resultError);});}});if(window.XDomainRequest==undefined&&!("draggable"in document.documentElement)){document.body.classList.toggle("no-draggable",true);}});var detailsDetails=[{"type":"determinant-Gauss","i18n":i18n.methodOfGauss},{"type":"determinant-Triangle","i18n":i18n.ruleOfTriangle},{"type":"determinant-Sarrus","i18n":i18n.ruleOfSarrus},{"type":"determinant-Leibniz","i18n":i18n.formulaOfLeibniz},{"type":"determinant-Montante","i18n":i18n.methodOfMontante},{"type":"solve-using-Cramer's-rule","i18n":i18n.solveByCrammer},{"type":"solve-using-inverse-matrix-method","i18n":i18n.solveByInverse},{"type":"solve-using-Montante-method","i18n":i18n.methodOfMontante},{"type":"solve-using-Gaussian-elimination","i18n":i18n.solveByGauss},{"type":"solve-using-Gauss-Jordan-elimination","i18n":i18n.solveByJordanGauss}];var addButtons=function(element,typePrefix,i18nStart){for(var i=0;i<detailsDetails.length;i+=1){var x=detailsDetails[i];if(x.type.indexOf(typePrefix)===0&&x.i18n!==""){var div=document.createElement("div");div.innerHTML="<button type=\"button\" class=\"expression-button\" data-expression=\"${type} A\">${i18n}</button>".replace(/\$\{type\}/g,x.type).replace(/\$\{i18n\}/g,i18nStart+x.i18n);element.appendChild(div);}}
Utils.check(element);};Utils.initialize(".slu-buttons",function(element){addButtons(element,"solve-","");});Utils.initialize(".det-buttons",function(element){addButtons(element,"determinant-",i18n.use+" ");});var toggleValidDropTarget=function(force){var dropzones=document.querySelectorAll(".matrix-table");for(var i=0;i<dropzones.length;i+=1){dropzones[i].classList.toggle("valid-drop-target",force);}
var expressionInput=document.getElementById("expression");if(expressionInput!=undefined){expressionInput.classList.toggle("valid-drop-target",force);}};var onDragOverOrDragEnd=function(event){var key="data-drop-target-timeout";var a=Number.parseInt(document.body.getAttribute(key)||0,10)||0;if(a!==0){window.clearTimeout(a);}else{toggleValidDropTarget(true);}
a=window.setTimeout(function(){toggleValidDropTarget(false);document.body.setAttribute(key,"0");},event.type==="dragend"?0:600);document.body.setAttribute(key,a.toString());};document.addEventListener("dragover",onDragOverOrDragEnd,false);document.addEventListener("dragend",onDragOverOrDragEnd,false);var arrowWithLabelInitialize=function(arrowWithLabel){var arrow=arrowWithLabel.querySelector(".arrow");var table=arrowWithLabel.previousElementSibling.querySelector("mtable");var start=Number.parseInt(arrowWithLabel.getAttribute("data-start"),10);var end=Number.parseInt(arrowWithLabel.getAttribute("data-end"),10);var n=0;var row=table.firstElementChild;var startRow=undefined;var endRow=undefined;while(row!=undefined){if(n===start){startRow=row;}
if(n===end){endRow=row;}
n+=1;row=row.nextElementSibling;}
var startRowRect=startRow.getBoundingClientRect();var endRowRect=endRow.getBoundingClientRect();var tableRect=table.getBoundingClientRect();if(end<start){var tmp=endRowRect;endRowRect=startRowRect;startRowRect=tmp;}
var arrowHeight=((endRowRect.top+endRowRect.bottom)/ 2-(startRowRect.top+startRowRect.bottom)/ 2);var arrowWithLabelVerticalAlign=((tableRect.top+tableRect.bottom)/ 2-(startRowRect.top+endRowRect.bottom)/ 2);window.setTimeout(function(){arrow.style.height=arrowHeight.toString()+"px";arrow.style.top="50%";arrow.style.marginTop=(-arrowHeight / 2).toString()+"px";arrowWithLabel.style.verticalAlign=arrowWithLabelVerticalAlign.toString()+"px";},0);};document.addEventListener("custom-paint",function(event){if(event.target.getAttribute("data-custom-paint")==="arrow-with-label"){arrowWithLabelInitialize(event.target);}},false);if(window.location.protocol!=="file:"){if(("serviceWorker"in window.navigator)){window.navigator.serviceWorker.register("sw.js",{scope:"./"}).then(function(registration){window.console.log("ServiceWorker registration succeeded:",registration);})["catch"](function(error){window.console.log("ServiceWorker registration failed:",error);});}}
window.addEventListener("beforeinstallprompt",function(event){event.preventDefault();hit({beforeinstallprompt:"show"});},false);Utils.initialize(".share-button",function(shareButton){if(window.navigator.share!=undefined){shareButton.addEventListener("click",function(event){window.navigator.share({url:shareButton.getAttribute("data-url")});},false);shareButton.hidden=false;}});Utils.initialize(".more-button",function(button){var container=button.previousElementSibling;button.addEventListener("click",function(event){container.hidden=!container.hidden;button.setAttribute("aria-expanded",container.hidden?"true":"false");},false);});}(this));